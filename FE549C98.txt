000001*  PROBA MEMBER=FE549C98 CODE=FA05 AUTH=SASTRE?MAT
000002*  PROBA  STAND 11.12.2025(14.02) LAN=COB
000010*  CBL DBCS, TRUNC(BIN), map
000020 IDENTIFICATION DIVISION.
000030 PROGRAM-ID.    FE549C.
000040******************************************************************
000050* PGM:    FE549C
000060* TITLE:  VKMS Verarbeitung Transponder für Produktion
000070* SA:     F3                                       SYS-NAME: FAZIT
000080* AUTHOR: Wolfgang Ulrich, msg systems ag               TEL:
000090*
000100* DESC: VKMS
000110* DESC: Transponder-Verarbeitung Produktion
000120* DESC:
000130* DESC: Dieses Modul verarbeitet die Telegramme VS02, DT02, TRA4
000140* DESC: Aufruf aus FE551E
000150* DESC: Ruft auf : FE540C
000160*-----------------------------------------------------------------
000170* PCOPY: FESQLC SQL-SQLCA
000180* PCOPY: FESQLV SQL-STATES
000190* PCOPY: FE551V Schnittstelle FE551 Parameter 1 Steuerungsbereich
000200* PCOPY: FE551W Schnittstelle FE551 Parameter 2 Ein
000210* PCOPY: FE551X Schnittstelle FE551 Parameter 3 Aus
000220* PCOPY: FEV043 FAZIT LIEFER-TRANSP-BART Select
000230* PCOPY: FEV208 Fahrzeug aktuell         Select
000240* PCOPY: FEV0X3 Transponder              Select
000250* PCOPY: FEV2X3 Transponder aktuell      Select
000260*-----------------------------------------------------------------
000270* SUB-PGM: FE540C Verarbeitung WFS6-Fraese/Transponder
000280* SUB-PGM:
000290* SUB-PGM: DSNTIAR AUFBEREITUNG SQLCA
000300*-----------------------------------------------------------------
000310* MOD: 00 29.07.2020 Wolfgang Ulrich, msg systems ag
000320* MOD:               Neuerstellung
000330* MOD:    28.10.2020 Änderungen wg. letztem Stand Konzept
000340* MOD:               aufgrund WFS-6-Meeting
000350* MOD: 01 04.12.2020 Wolfgang Ulrich, msg systems ag
000360* MOD:               Änderung PCOPY FE551W04/X02
000370* MOD:    01.02.2021 Einbau TRA4 f. Rel. 6.8
000380* MOD: 02 04.05.2021 Wolfgang Ulrich, msg systems ag
000390* MOD:               C10- Fehler in Schublade
000400* MOD:                 S551AX-A-VS02-S-BGRP-NUMMER = SPACE
000410* MOD:               Für VS02-R TRA-BGRP-Ermittlung geändert
000420* MOD:               Neue Sections:
000430* MOD:               - C28-TRA-BGRP  - ermittel vorh. BGRP
000440* MOD:               - C28A-TRA-BGRP - Zuordnen BGRP
000450* MOD:               Erweiterung für SmartCard bei VS02-Z
000460* MOD:                neue Section C16-SMARTCARD-ZUORDN-AUFH
000470* MOD:                in C12-TRAN-RAUF-VS02
000480* MOD: 03 15.09.2021 Wolfgang Ulrich, msg systems ag
000490* MOD:               Defect FAZIT-6557
000500* MOD:               Initialize X30-Indikatoren in D95
000510* MOD: 04 09.07.2021 Wolfgang Ulrich, msg systems ag
000520* MOD:               Rel. 6.10, 21.11.2021
000530* MOD:               neues PCOPY FE540V02: neues Feld PSS-VIN
000540* MOD:               neue PCOPYs FEV0X301: neues Feld PSS-VIN
000550* MOD:                           FEV2X301: neues Feld PSS-VIN
000560* MOD:                           FEVXX301: neues Feld PSS-VIN
000570* MOD:               Section T-100-FEV0X3-SEL4PSS geändert (MAX..)
000580* MOD:               Defect 6836: in D96-WRITE-TRANSP-TRA4
000590* MOD:               Initialisieren der Indikatoren für X30
000600* MOD: 05 24.11.2022 Eric Amedjoe, DT Systems Hungary Ltd.
000610* MOD:               Release 6.14 (05.02.2023)
000620* MOD:               Anpassungen wegen FAZIT-6933 und FAZIT-8623
000630* MOD:               Sektion E40-TRANSPOND-LIEF deaktiviert  und
000640* MOD                Sektion E41-TRANSPOND-LIEF-NEIN aktiviert
000650* MOD: 05 14.12.2022 Harald Dieterich, T-Systems
000660* MOD:               Section E41 entfern E40 aktiviert
000670* MOD:
000680* MOD:
000690* MOD: 06 08.03.2023 Lothar Peschke, T-Systems
000700* MOD:               Adjustments for VS02-Z telegram
000710* MOD:
000720* MOD:
000730* MOD: 07 29.03.2023 juan vijande  , T-Systems
000740* MOD:               Adjustments for dcl version 03 vkd1
000750* MOD:               Fazit-10204, modified version of pcopy
000760* MOD:                  fe551x03
000770* MOD:
000780* MOD: 08 24.04.2023 Harald Dieterich T-Systems
000790* MOD:               Rueckbau FAZIT-10204
000800* MOD:               geaenderte version von pcopy
000810* MOD:               fe551x03 zurück  auf FE551X02
000820* MOD:
000830* MOD: 09 13.04.2023 Lothar Peschke, T-Systems
000840* MOD:               Adjustments for VS02-Z telegram
000850* MOD:
000860* MOD: 10 22.06.2023 juan vijande  , T-Systems
000870* MOD:               Adjustments for dcl version 03 vkd1
000880* MOD:               Fazit-10204, modified version of pcopy
000890* MOD:                  fe551x03, based on 09
000900* MOD:
000910* MOD: 11 09.05.2023 Lothar Peschke, T-Systems
000920* MOD:               #12890, #12682
000930* MOD:    07.06.2023 Irina Rurenko, T-Systems onsite
000940* MOD:               #13611, #12890, #12682, #13919 -
000950* MOD:               Defects zu #8625 Fehlerbung VS02Z
000960* MOD:               #12682 - geänderte Anforderung zu Output-
000970* MOD:                        Parameter VS02Z
000980* MOD:               #13611 - Input-Parameter darf nicht geändert
000990* MOD:                        werden
001000* MOD:               #13919 - Erhöhung KEY-TYP-ID-ZAHL, wenn die
001010* MOD:                        Transponder-Aufhebung ohne Aufruf
001020* MOD:                        FE540B läuft.
001030* MOD:               #12890 - Fehlerbehebung (3022)
001040* MOD: 12 14.08.2023 Jakub Maciejewski, T-Systems
001050* MOD:               #18442 - VS02 telegram -> Deactivating all
001060* MOD:               SmartCards assigned to given VIN
001070* MOD: 13 13.10.2023 Irina Rurenko, T-Systems onsite
001080* MOD:               Release voraussichtlih R.6.19
001090* MOD:               #14513 - VS02-A telegram -> Aufhebung
001100* MOD:               Schließcode mit leerer Schließsatz-
001110* MOD:               Identifikaion
001120* MOD                C17-SCODE-CHECK - neue Section
001130* MOD                B01-VS02 - geändert bzgl. Belegung des Output
001140* MOD                           -Parameters Gesamtergebnis für
001150* MOD                           VS02 Anfragetyp A (Schließcode
001160* MOD                           Aufhebung)
001170* MOD                C15-SCODE-AUFH-VS02 - geändert
001180* MOD                           Ausbau der SCHLIESSSATZ-ID-Prüfung
001190* MOD                           auf Space
001200* MOD                D98-WRITE-BGRP-LOEKZ-J -geändert
001210* MOD: 14 29.03.2024 Michal Jarnecki, T-Systems
001220* MOD:               R.6.19 FAZIT-15609 TRA4 Response unplausibel
001230* MOD:               B03 und D40 Anpassung.
001240* MOD: 15 16.08.2024 Vera Bachmann-Budzynska, TSI
001250* MOD:               Anlernen Transponder test failing on checks
001260* MOD:               in XX3 table
001270* MOD:               Anpassung: D91B-AUFGEH-SETZEN SQLAX-SQLSTATE
001280* MOD:               statt SQLSTATE
001290* MOD: 16 12.09.2024 Anna Cholewik, TSI
001300* MOD:               R.6.21 FAZIT-15605 WFS - VS02-Z Korrektur
001310* MOD:               Verarbeitungsergebnis
001320* MOD:               Anpassung: B01-VS02, C12-TRAN-RAUF-VS02,
001330* MOD:               D91B-AUFGEH-SETZEN
001340* MOD: 17 16.10.2024 MICHAL JARNECKI, TSI
001350* MOD:               R6.21 FAZIT-16335: BGRP-NUMMER IN VS02-R
001360* MOD:               ANTWORTTELEGRAMM IST LEER
001370* MOD:               ANPASSUNG: C10-TRAN-REG-VS02
001380* MOD: 18 03.02.2025 Anna Cholewik, TSI
001390* MOD:               R6.22 FAZIT-8175 - WFS - Anpassung Anzahl
001400* MOD:               Transponder registriert in TRA4 Antwort
001410* MOD:               ANPASSUNG: B03-TRA4
001420* MOD:               NEUE:  T-100-FEV2X3-ANZ-TRA-REG
001430* MOD:
001440* MOD: 19 02.05.2025 ANNA CHOLEWIK, TSI
001450* MOD:               FAZIT-22497 MODIFIED PCOPY VERSION
001460* MOD:               FE551X04 USED
001470* MOD:               CHANGED: ORDER OF LEG1-DLC-KS-IKAV/IKA
001480* MOD:
001490******************************************************************
001500 ENVIRONMENT DIVISION.
001510 DATA DIVISION.
001520 WORKING-STORAGE SECTION.
001521 77  PROBA-ID                PIC X(34)       VALUE
001522     'FE549C98/FA05 STAND 11.12.25 14.02'.
001550
001560*-----------------------------------------------------------------
001570* aufgerufene Unterprogramme
001580*-----------------------------------------------------------------
001590 01  P1.
001600     10 FE333C                     PIC X(8) VALUE 'FE333C  '.
001610     10 FE378C                     PIC X(8) VALUE 'FE378C  '.
001620     10 FE540C                     PIC X(8) VALUE 'FE540C  '.
001630     10 FE553C                     PIC X(8) VALUE 'FE553C  '.
001640     10 FE557C                     PIC X(8) VALUE 'FE557C  '.
001650     10 FE560C                     PIC X(8) VALUE 'FE560C  '.
001660     10 FE585D                     PIC X(8) VALUE 'FE585D  '.
001670     10 FE587D                     PIC X(8) VALUE 'FE587D  '.
001680     10 FE589D                     PIC X(8) VALUE 'FE589D  '.
001690     10 FE775C                     PIC X(8) VALUE 'FE775C  '.
001700     10 FE778C                     PIC X(8) VALUE 'FE778C  '.
001710     10 CSNBXCB                    PIC X(8) VALUE 'CSNBXCB '.
001720     10 CSNBXBC                    PIC X(8) VALUE 'CSNBXBC '.
001730******************************************************************
001740* DB2-DEFINITIONEN
001750******************************************************************
001760     EXEC SQL
001770       INCLUDE SQLCA
001780     END-EXEC
001790*-----------------------------------------------------------------
001800* SQL COMMUNICATION AREA INTERN
001810*-----------------------------------------------------------------
001820 01  SQL-SQLCA.
001830*PCOPY=FESQLC00,PRFX=SQL
001831*  PROBA PCOPYANF
001832*  PROBA MEMBER=FESQLC00 CODE=ZW08 AUTH=GEIER-HUBE TYPE=S
001833*  PROBA  STAND  4.10.2001(10.07) LAN=COB
001835******************************************************************
001836* MEMBER: FESQLC00                                FIRST: JUNI 2001
001837* TITLE:  SQL COMMUNICATION AREA FÜR FAZIT-SCHNITTSTELLEN
001838* SA:     F3                                       SYS-NAME: FAZIT
001839* AUTHOR: THOMAS FIEBIGER, MSG SYSTEME GMBH             TEL:
001840*
001841* DESC:   SQL COMMUNICATION AREA FÜR FAZIT-SCHNITTSTELLEN
001842*-----------------------------------------------------------------
001843* MOD:    00 01.06.2001 THOMAS FIEBIGER, MSG SYSTEME GMBH
001844* MOD:                  NEUERSTELLUNG
001845******************************************************************
001846     05 SQLAX-SQLCAID              PIC X(8).
001847     05 SQLAN-SQLCABC              PIC S9(9) COMP.
001848     05 SQLAN-SQLCODE              PIC S9(9) COMP.
001849     05 SQLAX-SQLERRM.
001850     49 SQLAN-SQLERRML             PIC S9(4) COMP.
001851     49 SQLAX-SQLERRMC             PIC X(70).
001852     05 SQLAX-SQLERRP              PIC X(8).
001853     05 SQLAN-SQLERRD  OCCURS 6 TIMES
001854                                   PIC S9(9) COMP.
001855     05 SQLAX-SQLWARN.
001856     10 SQLAX-SQLWARN0             PIC X.
001857     10 SQLAX-SQLWARN1             PIC X.
001858     10 SQLAX-SQLWARN2             PIC X.
001859     10 SQLAX-SQLWARN3             PIC X.
001860     10 SQLAX-SQLWARN4             PIC X.
001861     10 SQLAX-SQLWARN5             PIC X.
001862     10 SQLAX-SQLWARN6             PIC X.
001863     10 SQLAX-SQLWARN7             PIC X.
001864     05 SQLAX-SQLEXT.
001865     10 SQLAX-SQLWARN8             PIC X.
001866     10 SQLAX-SQLWARN9             PIC X.
001867     10 SQLAX-SQLWARNA             PIC X.
001868     10 SQLAX-SQLSTATE             PIC X(5).
001870*  PROBA PCOPYEND
002210*-----------------------------------------------------------------
002220* SQLSTATES
002230*-----------------------------------------------------------------
002240*PCOPY=FESQLV01
002241*  PROBA PCOPYANF
002242*  PROBA MEMBER=FESQLV01 CODE=RZ01 AUTH=KOLMEDER-K TYPE=S
002243*  PROBA  STAND 31.03.2016(11.06) LAN=COB
002245******************************************************************
002246* MEMBER: FESQLV00                                FIRST: März 2012
002247* TITLE:  Konstanten für DB2 SQLSTATE
002248* SA:     F3                                       SYS-NAME: FAZIT
002249* AUTHOR: Thomas Fiebiger, msg systems ag
002250*
002251* DESC:   Konstanten für DB2 SQLSTATE
002252*-----------------------------------------------------------------
002253* MOD: 00 27.03.2012 Thomas Fiebiger, msg systems ag
002254* MOD:               Neuerstellung
002255******************************************************************
002256 01  K1AX-SQL-STATES.
002257     10 DB2-OK                     PIC X(5) VALUE '00000'.
002258     10 DB2-STP-OK                 PIC X(5) VALUE '0100C'.
002259     10 DB2-WARNING-COL            PIC X(5) VALUE '01003'.
002260     10 DB2-TRUNCATION             PIC X(5) VALUE '01004'.
002261     10 DB2-NOT-FOUND              PIC X(5) VALUE '02000'.
002262     10 DB2-COMMUNICATION          PIC X(5) VALUE '08001'.
002263     10 DB2-MORE-ROWS              PIC X(5) VALUE '21000'.
002264     10 DB2-DUP-KEY                PIC X(5) VALUE '23505'.
002265     10 DB2-DATE-TIME-ERROR        PIC X(5) VALUE '22007'.
002267*  PROBA PCOPYEND
002490
002500*-----------------------------------------------------------------
002510* LIEFER-TRANSP-BART
002520*-----------------------------------------------------------------
002530*PCOPY=FEV04301,PRFX=B043
002531*  PROBA PCOPYANF
002532*  PROBA MEMBER=FEV04301 CODE=ZB02 AUTH=FIEBIGER-T TYPE=S
002533*  PROBA  STAND 23.04.2014(15.34) LAN=COB
002535******************************************************************
002536* DCLGEN TABLE(FEV043)                                           *
002537*        LIBRARY(DB2J.SRCLIB.DATA(FEV043))                       *
002538*        ACTION(REPLACE)                                         *
002539*        LANGUAGE(COBOL)                                         *
002540*        APOST                                                   *
002541* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
002542******************************************************************
002543     EXEC SQL DECLARE FEV043 TABLE
002544     ( TRANSPOND_ID                CHAR(8)         NOT NULL
002545     , TRANSPOND_FAM               CHAR(10)        NOT NULL
002546     , BART_NR                     CHAR(11)        NOT NULL
002547     , SATZ_ID_T1                  CHAR(7)         NOT NULL
002548     , SATZ_ID_T2                  CHAR(15)        NOT NULL
002549     , ELEMENT_TYP                 CHAR(1)         NOT NULL
002550     , SCHLUESSEL_ART              CHAR(3)         NOT NULL
002551     , TRANSPOND_TYP               CHAR(4)         NOT NULL
002552     , SKC                         CHAR(32)        NOT NULL
002553     , SCHLUESSEL_TYP              CHAR(2)         NOT NULL
002554     , TRANSPOND_TRF               CHAR(2)         NOT NULL
002555     ) END-EXEC.
002556******************************************************************
002557* COBOL DECLARATION FOR TABLE FEV043                             *
002558******************************************************************
002559 01  B043-DCLFEV043.
002560     10 B043AX-TRANSPOND-ID        PIC X(8).
002561     10 B043AX-TRANSPOND-FAM       PIC X(10).
002562     10 B043AX-BART-NR             PIC X(11).
002563     10 B043AX-SATZ-ID-T1          PIC X(7).
002564     10 B043AX-SATZ-ID-T2          PIC X(15).
002565     10 B043AX-ELEMENT-TYP         PIC X.
002566     10 B043AX-SCHLUESSEL-ART      PIC X(3).
002567     10 B043AX-TRANSPOND-TYP       PIC X(4).
002568     10 B043AX-SKC                 PIC X(32).
002569     10 B043AX-SCHLUESSEL-TYP      PIC X(2).
002570     10 B043AX-TRANSPOND-TRF       PIC X(2).
002571******************************************************************
002572* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 11      *
002573******************************************************************
002575*  PROBA PCOPYEND
002960
002970*-----------------------------------------------------------------
002980* AKTUELLE SERIE AUS FAZIT-BGRP
002990*-----------------------------------------------------------------
003000*PCOPY=FEV20506,PRFX=B205
003001*  PROBA PCOPYANF
003002*  PROBA MEMBER=FEV20506 CODE=MC05 AUTH=FIEBIGER-T TYPE=S
003003*  PROBA  STAND 30.09.2013(09.45) LAN=COB
003005******************************************************************
003006* DCLGEN TABLE(FEV205)                                           *
003007*        LIBRARY(DB2J.SRCLIB.DATA(FEV205))                       *
003008*        ACTION(REPLACE)                                         *
003009*        LANGUAGE(COBOL)                                         *
003010*        APOST                                                   *
003011* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
003012******************************************************************
003013     EXEC SQL DECLARE FEV205 TABLE
003014     ( V_ID                        TIMESTAMP       NOT NULL
003015     , VIN                         CHAR(17)        NOT NULL
003016     , BGRP                        CHAR(3)         NOT NULL
003017     , BGRP_FAM                    CHAR(3)         NOT NULL
003018     , BGRP_INHALT                 CHAR(27)        NOT NULL
003019     , LOESCH_KZ                   CHAR(1)         NOT NULL
003020     , PIN                         CHAR(4)
003021     , SKC                         CHAR(96)
003022     , IKA                         CHAR(32)
003023     , KOMP_S_TYP                  CHAR(4)
003024     , RUECKKANAL                  CHAR(1)         NOT NULL
003025     , MEK                         CHAR(32)        NOT NULL
003026     , WFS_SHE_KZ                  CHAR(1)         NOT NULL
003027     , KOMP_SHE_KZ                 CHAR(1)         NOT NULL
003028     , KOMP_GFA_KZ                 CHAR(1)         NOT NULL
003029     , BGRP_CHECKSUM_V             CHAR(2)         NOT NULL
003030     , TRANSPOND_CHECKSUM_V        CHAR(2)         NOT NULL
003031     , IKA_ZAHL                    CHAR(2)         NOT NULL
003032     , MEK_ZAHL                    CHAR(2)         NOT NULL
003033     , TEXT_IKA_ART                INTEGER
003034     , TEXT_MEK_ART                INTEGER
003035     ) END-EXEC.
003036******************************************************************
003037* COBOL DECLARATION FOR TABLE FEV205 FZ-BAUGRUPPE AKTUELL - SELECT
003038******************************************************************
003039 01  B205-DCLFEV205.
003040     10 B205AX-V-ID                  PIC X(26).
003041     10 B205AX-VIN                   PIC X(17).
003042     10 B205AX-BGRP                  PIC X(3).
003043     10 B205AX-BGRP-FAM              PIC X(3).
003044     10 B205AX-BGRP-INHALT           PIC X(27).
003045     10 B205AX-LOESCH-KZ             PIC X.
003046     10 B205AX-PIN                   PIC X(4).
003047     10 B205AX-SKC                   PIC X(96).
003048     10 B205AX-IKA                   PIC X(32).
003049     10 B205AX-KOMP-S-TYP            PIC X(4).
003050     10 B205AX-RUECKKANAL            PIC X.
003051     10 B205AX-MEK                   PIC X(32).
003052     10 B205AX-WFS-SHE-KZ            PIC X.
003053     10 B205AX-KOMP-SHE-KZ           PIC X.
003054     10 B205AX-KOMP-GFA-KZ           PIC X.
003055     10 B205AX-BGRP-CHECKSUM-V       PIC X(2).
003056     10 B205AX-TRANSPOND-CHECKSUM-V  PIC X(2).
003057     10 B205AX-IKA-ZAHL              PIC X(2).
003058     10 B205AX-MEK-ZAHL              PIC X(2).
003059     10 B205AN-TEXT-IKA-ART          PIC S9(9) COMP.
003060     10 B205AN-TEXT-MEK-ART          PIC S9(9) COMP.
003061 01  B205-I-DCLFEV205.
003062     10 B205AN-I-PIN                 PIC S9(4) COMP.
003063     10 B205AN-I-SKC                 PIC S9(4) COMP.
003064     10 B205AN-I-IKA                 PIC S9(4) COMP.
003065     10 B205AN-I-KOMP-S-TYP          PIC S9(4) COMP.
003066     10 B205AN-I-TEXT-IKA-ART        PIC S9(4) COMP.
003067     10 B205AN-I-TEXT-MEK-ART        PIC S9(4) COMP.
003068******************************************************************
003069* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 21      *
003070******************************************************************
003072*  PROBA PCOPYEND
003700
003710*-----------------------------------------------------------------
003720* FEV208 Fahrzeug aktuell - Select
003730*-----------------------------------------------------------------
003740*PCOPY=FEV20812,PRFX=V208
003741*  PROBA PCOPYANF
003742*  PROBA MEMBER=FEV20812 CODE=LC01 AUTH=FIEBIGER-T TYPE=S
003743*  PROBA  STAND 17.11.2017(09.00) LAN=COB
003745******************************************************************
003746* DCLGEN TABLE(FEV208)                                           *
003747*        LIBRARY(DB2J.SRCLIB.DATA(FEV208))                       *
003748*        ACTION(REPLACE)                                         *
003749*        LANGUAGE(COBOL)                                         *
003750*        APOST                                                   *
003751* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
003752******************************************************************
003753     EXEC SQL DECLARE FEV208 TABLE
003754     ( V_ID                        TIMESTAMP       NOT NULL
003755     , VIN                         CHAR(17)        NOT NULL
003756     , TEXT_SYSTEM                 INTEGER         NOT NULL
003757     , PIN                         CHAR(16)
003758     , SKC                         CHAR(96)
003759     , TEXT_DRT_VERSION            INTEGER
003760     , WFS_INHALT                  CHAR(27)
003761     , FSC                         CHAR(16)
003762     , P_KLASSE                    CHAR(2)
003763     , TRANSPOND_FAM               CHAR(10)
003764     , GFA                         CHAR(32)
003765     , ID_ZAHL                     CHAR(2)         NOT NULL
003766     , WERK                        CHAR(2)         NOT NULL
003767     , SPJ                         CHAR(4)         NOT NULL
003768     , KNR                         CHAR(7)         NOT NULL
003769     , VIN_FZ_KLASSE               CHAR(2)         NOT NULL
003770     , WFS_MARKE                   CHAR(2)         NOT NULL
003771     , PRNR_MOT                    CHAR(3)         NOT NULL
003772     , DATUM_ZP8                   DATE
003773     , ZP8_NR                      CHAR(2)         NOT NULL
003774     , KOMP_MASTER                 CHAR(3)         NOT NULL
003775     , WFS_MASTER                  CHAR(3)         NOT NULL
003776     , MODELL                      CHAR(8)         NOT NULL
003777     , GFA_ZAHL                    CHAR(2)         NOT NULL
003778     , TEXT_SKC_ART                INTEGER
003779     , TEXT_GFA_ART                INTEGER
003780     , LABEL_SERIE_NR              CHAR(11)        NOT NULL
003781     , GARNITUR_SERIE_NR           CHAR(23)        NOT NULL
003782     , PIN_WERK                    CHAR(2)         NOT NULL
003783     , PIN_SPJ                     CHAR(4)         NOT NULL
003784     , PIN_KNR                     CHAR(7)         NOT NULL
003785     ) END-EXEC.
003786******************************************************************
003787* COBOL DECLARATION FOR TABLE FEV208                             *
003788******************************************************************
003789 01  V208-DCLFEV208.
003790     10 V208AX-V-ID                PIC X(26).
003791     10 V208AX-VIN                 PIC X(17).
003792     10 V208AN-TEXT-SYSTEM         PIC S9(9) COMP.
003793     10 V208AX-PIN                 PIC X(16).
003794     10 V208AX-SKC                 PIC X(96).
003795     10 V208AN-TEXT-DRT-VERSION    PIC S9(9) COMP.
003796     10 V208AX-WFS-INHALT          PIC X(27).
003797     10 V208AX-FSC                 PIC X(16).
003798     10 V208AX-P-KLASSE            PIC X(2).
003799     10 V208AX-TRANSPOND-FAM       PIC X(10).
003800     10 V208AX-GFA                 PIC X(32).
003801     10 V208AX-ID-ZAHL             PIC X(2).
003802     10 V208AX-WERK                PIC X(2).
003803     10 V208AX-SPJ                 PIC X(4).
003804     10 V208AX-KNR                 PIC X(7).
003805     10 V208AX-VIN-FZ-KLASSE       PIC X(2).
003806     10 V208AX-WFS-MARKE           PIC X(2).
003807     10 V208AX-PRNR-MOT            PIC X(3).
003808     10 V208AX-DATUM-ZP8           PIC X(10).
003809     10 V208AX-ZP8-NR              PIC X(2).
003810     10 V208AX-KOMP-MASTER         PIC X(3).
003811     10 V208AX-WFS-MASTER          PIC X(3).
003812     10 V208AX-MODELL              PIC X(8).
003813     10 V208AX-GFA-ZAHL            PIC X(2).
003814     10 V208AN-TEXT-SKC-ART        PIC S9(9) COMP.
003815     10 V208AN-TEXT-GFA-ART        PIC S9(9) COMP.
003816     10 V208AX-LABEL-SERIE-NR      PIC X(11).
003817     10 V208AX-GARNITUR-SERIE-NR   PIC X(23).
003818     10 V208AX-PIN-WERK            PIC X(2).
003819     10 V208AX-PIN-SPJ             PIC X(4).
003820     10 V208AX-PIN-KNR             PIC X(7).
003821 01  V208-I-DCLFEV208.
003822     10 V208AN-I-PIN               PIC S9(4) COMP.
003823     10 V208AN-I-SKC               PIC S9(4) COMP.
003824     10 V208AN-I-TEXT-DRT-VERSION  PIC S9(4) COMP.
003825     10 V208AN-I-WFS-INHALT        PIC S9(4) COMP.
003826     10 V208AN-I-FSC               PIC S9(4) COMP.
003827     10 V208AN-I-P-KLASSE          PIC S9(4) COMP.
003828     10 V208AN-I-TRANSPOND-FAM     PIC S9(4) COMP.
003829     10 V208AN-I-GFA               PIC S9(4) COMP.
003830     10 V208AN-I-DATUM-ZP8         PIC S9(4) COMP.
003831     10 V208AN-I-TEXT-SKC-ART      PIC S9(4) COMP.
003832     10 V208AN-I-TEXT-GFA-ART      PIC S9(4) COMP.
003833******************************************************************
003834* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 31      *
003835******************************************************************
003837*  PROBA PCOPYEND
004690
004700*-----------------------------------------------------------------
004710* FEV24H   Transponder Markierung
004720*-----------------------------------------------------------------
004730*PCOPY=FEV04H00,PRFX=B04H
004731*  PROBA PCOPYANF
004732*  PROBA MEMBER=FEV04H00 CODE=PA01 AUTH=FIEBIGER-T TYPE=S
004733*  PROBA  STAND 13.02.2013(10.50) LAN=COB
004735******************************************************************
004736* DCLGEN TABLE(FEV04H)                                           *
004737*        LIBRARY(DB2J.SRCLIB.DATA(FEV04H))                       *
004738*        ACTION(REPLACE)                                         *
004739*        LANGUAGE(COBOL)                                         *
004740*        APOST                                                   *
004741* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
004742******************************************************************
004743     EXEC SQL DECLARE FEV04H TABLE
004744     ( V_ID                        TIMESTAMP       NOT NULL
004745     , TRANSPOND_ID                CHAR(8)         NOT NULL
004746     , TRANSPOND_FAM               CHAR(10)        NOT NULL
004747     , TEXT_MARKIERUNG             INTEGER         NOT NULL
004748     , LKZ2                        CHAR(2)         NOT NULL
004749     , MARKE                       CHAR(2)         NOT NULL
004750     , USER_ID_MELDUNG             CHAR(12)        NOT NULL
004751     , INAKTIV_VON                 TIMESTAMP
004752     , INAKTIV_BIS                 TIMESTAMP
004753     , VORGANGSNR                  CHAR(14)        NOT NULL
004754     , LOESCH_KZ                   CHAR(1)         NOT NULL
004755     ) END-EXEC.
004756******************************************************************
004757* COBOL DECLARATION FOR TABLE FEV04H                             *
004758******************************************************************
004759 01  B04H-DCLFEV04H.
004760     10 B04HAX-V-ID                PIC X(26).
004761     10 B04HAX-TRANSPOND-ID        PIC X(8).
004762     10 B04HAX-TRANSPOND-FAM       PIC X(10).
004763     10 B04HAN-TEXT-MARKIERUNG     PIC S9(9) COMP.
004764     10 B04HAX-LKZ2                PIC X(2).
004765     10 B04HAX-MARKE               PIC X(2).
004766     10 B04HAX-USER-ID-MELDUNG     PIC X(12).
004767     10 B04HAX-INAKTIV-VON         PIC X(26).
004768     10 B04HAX-INAKTIV-BIS         PIC X(26).
004769     10 B04HAX-VORGANGSNR          PIC X(14).
004770     10 B04HAX-LOESCH-KZ           PIC X.
004771 01  B04H-I-DCLFEV04H.
004772     10 B04HAN-I-INAKTIV-VON       PIC S9(4) COMP.
004773     10 B04HAN-I-INAKTIV-BIS       PIC S9(4) COMP.
004774******************************************************************
004775* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 11      *
004776******************************************************************
004778*  PROBA PCOPYEND
005190
005200*-----------------------------------------------------------------
005210* FEV045 FAZIT - MARKEN
005220*-----------------------------------------------------------------
005230*PCOPY=FEV04504,PRFX=B045
005231*  PROBA PCOPYANF
005232*  PROBA MEMBER=FEV04504 CODE=HC02 AUTH=GEIER-RAIN TYPE=S
005233*  PROBA  STAND  8.10.2008(16.52) LAN=COB
005235******************************************************************
005236* DCLGEN TABLE(FEV045)                                           *
005237*        LIBRARY(DB2J.SRCLIB.DATA(FEV045))                       *
005238*        ACTION(REPLACE)                                         *
005239*        LANGUAGE(COBOL)                                         *
005240*        APOST                                                   *
005241* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
005242******************************************************************
005243     EXEC SQL DECLARE FEV045 TABLE
005244     ( WFS_MARKE                   CHAR(2)         NOT NULL,
005245       BEZEICHNUNG                 CHAR(60)        NOT NULL,
005246       PORTAL_ROLLE                CHAR(60)        NOT NULL,
005247       PORTAL_MELD_KLASSE          SMALLINT        NOT NULL,
005248       NUR_RECHTE_KZ               CHAR(1)         NOT NULL,
005249       MARKE_VON_CARPORT           CHAR(1)         NOT NULL,
005250       MARKE_ZU_CARPORT            CHAR(1)         NOT NULL,
005251       USER_ID                     CHAR(12)        NOT NULL,
005252       BEARBEITET_AM               TIMESTAMP       NOT NULL,
005253       VIN_VIRTUELL_T1             CHAR(3)         NOT NULL
005254     ) END-EXEC.
005255******************************************************************
005256* COBOL DECLARATION FOR TABLE FEV045                             *
005257******************************************************************
005258 01  B045-DCLFEV045.
005259     10 B045AX-WFS-MARKE           PIC X(2).
005260     10 B045AX-BEZEICHNUNG         PIC X(60).
005261     10 B045AX-PORTAL-ROLLE        PIC X(60).
005262     10 B045AN-PORTAL-MELD-KLASSE  PIC S9(4) COMP.
005263     10 B045AX-NUR-RECHTE-KZ       PIC X.
005264     10 B045AX-MARKE-VON-CARPORT   PIC X.
005265     10 B045AX-MARKE-ZU-CARPORT    PIC X.
005266     10 B045AX-USER-ID             PIC X(12).
005267     10 B045AX-BEARBEITET-AM       PIC X(26).
005268     10 B045AX-VIN-VIRTUELL-T1     PIC X(3).
005269******************************************************************
005270* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 10      *
005271******************************************************************
005273*  PROBA PCOPYEND
005640
005650*-----------------------------------------------------------------
005660* FEV2VD VKMS Fahrzeug - aktuell
005670*-----------------------------------------------------------------
005680*PCOPY=FEV2VD00,PRFX=B2VD
005681*  PROBA PCOPYANF
005682*  PROBA MEMBER=FEV2VD00 CODE=WZ03 AUTH=FIEBIGER-T TYPE=S
005683*  PROBA  STAND 21.09.2017(16.06) LAN=COB
005685******************************************************************
005686* DCLGEN TABLE(FEV2VD)                                           *
005687*        LIBRARY(DB2J.SRCLIB.DATA(FEV2VD))                       *
005688*        ACTION(REPLACE)                                         *
005689*        LANGUAGE(COBOL)                                         *
005690*        APOST                                                   *
005691* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
005692******************************************************************
005693     EXEC SQL DECLARE FEV2VD TABLE
005694     ( UTC_V_ID                    TIMESTAMP       NOT NULL
005695     , VIN                         CHAR(17)        NOT NULL
005696     , FZ_ID_ZAHL                  INTEGER
005697     , PRNR_TPL                    CHAR(3)
005698     , KRYPTO_REGION               CHAR(3)
005699     ) END-EXEC.
005700******************************************************************
005701* COBOL DECLARATION FOR TABLE FEV2VD                             *
005702******************************************************************
005703 01  B2VD-DCLFEV2VD.
005704     10 B2VDAX-UTC-V-ID            PIC X(26).
005705     10 B2VDAX-VIN                 PIC X(17).
005706     10 B2VDAN-FZ-ID-ZAHL          PIC S9(9) COMP.
005707     10 B2VDAX-PRNR-TPL            PIC X(3).
005708     10 B2VDAX-KRYPTO-REGION       PIC X(3).
005709 01  B2VD-I-DCLFEV2VD.
005710     10 B2VDAN-I-FZ-ID-ZAHL        PIC S9(4) COMP.
005711     10 B2VDAN-I-PRNR-TPL          PIC S9(4) COMP.
005712     10 B2VDAN-I-KRYPTO-REGION     PIC S9(4) COMP.
005713******************************************************************
005714* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
005715******************************************************************
005717*  PROBA PCOPYEND
006030
006040*-----------------------------------------------------------------
006050* FEV2VI VKMS Fz-Key-Typ MAX(UTC_V_ID)
006060*-----------------------------------------------------------------
006070*PCOPY=FEV2VI01,PRFX=B2VI
006071*  PROBA PCOPYANF
006072*  PROBA MEMBER=FEV2VI01 CODE=GA01 AUTH=FIEBIGER-T TYPE=S
006073*  PROBA  STAND  6.02.2019(12.12) LAN=COB
006075******************************************************************
006076* DCLGEN TABLE(FEV2VI)                                           *
006077*        LIBRARY(DB2J.SRCLIB.DATA(FEV2VI))                       *
006078*        ACTION(REPLACE)                                         *
006079*        LANGUAGE(COBOL)                                         *
006080*        APOST                                                   *
006081* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
006082******************************************************************
006083     EXEC SQL DECLARE FEV2VI TABLE
006084     ( UTC_V_ID                    TIMESTAMP       NOT NULL
006085     , VIN                         CHAR(17)        NOT NULL
006086     , KEY_TYP_ID                  INTEGER         NOT NULL
006087     , KEY_TYP_ID_ZAHL             INTEGER         NOT NULL
006088     , DATEN_INHALT                VARCHAR(4064)
006089     ) END-EXEC.
006090******************************************************************
006091* COBOL DECLARATION FOR TABLE FEV2VI                             *
006092******************************************************************
006093 01  B2VI-DCLFEV2VI.
006094     10 B2VIAX-UTC-V-ID            PIC X(26).
006095     10 B2VIAX-VIN                 PIC X(17).
006096     10 B2VIAN-KEY-TYP-ID          PIC S9(9) COMP.
006097     10 B2VIAN-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
006098     10 B2VIAX-DATEN-INHALT.
006099     49 B2VIAN-DATEN-INHALT-LEN    PIC S9(4) COMP.
006100     49 B2VIAX-DATEN-INHALT-TEXT   PIC X(4064).
006101 01  B2VI-I-DCLFEV2VI.
006102     10 B2VIAN-I-DATEN-INHALT      PIC S9(4) COMP.
006103******************************************************************
006104* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
006105******************************************************************
006107*  PROBA PCOPYEND
006420
006430*V11 IR neues PCopy
006440*-----------------------------------------------------------------
006450* VKMS Key-Typ Hierarchieebenen - Recursive Select
006460*-----------------------------------------------------------------
006470*PCOPY=FEV3V200,PRFX=B3V2
006471*  PROBA PCOPYANF
006472*  PROBA MEMBER=FEV3V200 CODE=LB01 AUTH=UNGER-GUNT TYPE=S
006473*  PROBA  STAND 18.01.2021(12.08) LAN=COB
006475******************************************************************
006476* DCLGEN TABLE(FEV3V2)                                           *
006477*        LIBRARY(DB2J.SRCLIB.DATA(FEV3V2))                       *
006478*        ACTION(REPLACE)                                         *
006479*        LANGUAGE(COBOL)                                         *
006480*        APOST                                                   *
006481* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
006482******************************************************************
006483     EXEC SQL DECLARE FEV3V2 TABLE
006484     ( KEY_TYP_ID                  INTEGER
006485     , LEVEL                       INTEGER
006486     , ROOT                        INTEGER
006487     , PARENT                      INTEGER
006488     , HIERARCHIE                  VARCHAR(80)
006489     ) END-EXEC.
006490******************************************************************
006491* COBOL DECLARATION FOR TABLE FEV3V2                             *
006492******************************************************************
006493 01  B3V2-DCLFEV3V2.
006494     10 B3V2AN-KEY-TYP-ID           PIC S9(9) COMP.
006495     10 B3V2AN-LEVEL                PIC S9(9) COMP.
006496     10 B3V2AN-ROOT                 PIC S9(9) COMP.
006497     10 B3V2AN-PARENT               PIC S9(9) COMP.
006498     10 B3V2AX-HIERARCHIE.
006499     49 B3V2AN-HIERARCHIE-LEN       PIC S9(4) COMP.
006500     49 B3V2AX-HIERARCHIE-TEXT      PIC X(80).
006501 01  B3V2-I-DCLFEV3V2.
006502     10 B3V2AN-I-KEY-TYP-ID         PIC S9(4) COMP.
006503     10 B3V2AN-I-LEVEL              PIC S9(4) COMP.
006504     10 B3V2AN-I-ROOT               PIC S9(4) COMP.
006505     10 B3V2AN-I-PARENT             PIC S9(4) COMP.
006506     10 B3V2AN-I-HIERARCHIE         PIC S9(4) COMP.
006507******************************************************************
006508* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
006509******************************************************************
006511*  PROBA PCOPYEND
006860
006870*V11 IR neues PCopy
006880*-----------------------------------------------------------------
006890* VKMS Fz-Key-Typ aktuell - Select
006900*-----------------------------------------------------------------
006910*PCOPY=FEVXVI01,PRFX=BXVI
006911*  PROBA PCOPYANF
006912*  PROBA MEMBER=FEVXVI01 CODE=LZ01 AUTH=FIEBIGER-T TYPE=S
006913*  PROBA  STAND  6.02.2019(12.12) LAN=COB
006915******************************************************************
006916* DCLGEN TABLE(FEVXVI)                                           *
006917*        LIBRARY(DB2J.SRCLIB.DATA(FEVXVI))                       *
006918*        ACTION(REPLACE)                                         *
006919*        LANGUAGE(COBOL)                                         *
006920*        APOST                                                   *
006921* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
006922******************************************************************
006923     EXEC SQL DECLARE FEVXVI TABLE
006924     ( UTC_V_ID                    TIMESTAMP       NOT NULL
006925     , VIN                         CHAR(17)        NOT NULL
006926     , KEY_TYP_ID                  INTEGER         NOT NULL
006927     , KEY_TYP_ID_ZAHL             INTEGER         NOT NULL
006928     , DATEN_INHALT                VARCHAR(4064)
006929     ) END-EXEC.
006930******************************************************************
006931* COBOL DECLARATION FOR TABLE FEVXVI                             *
006932******************************************************************
006933 01  BXVI-DCLFEVXVI.
006934     10 BXVIAX-UTC-V-ID            PIC X(26).
006935     10 BXVIAX-VIN                 PIC X(17).
006936     10 BXVIAN-KEY-TYP-ID          PIC S9(9) COMP.
006937     10 BXVIAN-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
006938     10 BXVIAX-DATEN-INHALT.
006939     49 BXVIAN-DATEN-INHALT-LEN    PIC S9(4) COMP.
006940     49 BXVIAX-DATEN-INHALT-TEXT   PIC X(4064).
006941 01  BXVI-I-DCLFEVXVI.
006942     10 BXVIAN-I-DATEN-INHALT      PIC S9(4) COMP.
006943******************************************************************
006944* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
006945******************************************************************
006947*  PROBA PCOPYEND
007260
007270
007280*V11 IR neues PCopy
007290*-----------------------------------------------------------------
007300* VKMS Fz-BGRP-Key-Typ insert
007310*-----------------------------------------------------------------
007320*PCOPY=FEVXVM01,PRFX=BXVM
007321*  PROBA PCOPYANF
007322*  PROBA MEMBER=FEVXVM01 CODE=GA01 AUTH=FIEBIGER-T TYPE=S
007323*  PROBA  STAND 21.10.2019(16.08) LAN=COB
007325******************************************************************
007326* DCLGEN TABLE(FEVXVM)                                           *
007327*        LIBRARY(DB2J.SRCLIB.DATA(FEVXVM))                       *
007328*        ACTION(REPLACE)                                         *
007329*        LANGUAGE(COBOL)                                         *
007330*        APOST                                                   *
007331* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
007332******************************************************************
007333     EXEC SQL DECLARE FEVXVM TABLE
007334     ( UTC_V_ID                    TIMESTAMP       NOT NULL
007335     , VIN                         CHAR(17)        NOT NULL
007336     , BGRP                        CHAR(3)         NOT NULL
007337     , KEY_TYP_ID                  INTEGER         NOT NULL
007338     , KEY_TYP_ID_ZAHL             INTEGER
007339     , DATEN_INHALT                VARCHAR(4096)
007340     ) END-EXEC.
007341******************************************************************
007342* COBOL DECLARATION FOR TABLE FEVXVM                             *
007343******************************************************************
007344 01  BXVM-DCLFEVXVM.
007345     10 BXVMAX-UTC-V-ID            PIC X(26).
007346     10 BXVMAX-VIN                 PIC X(17).
007347     10 BXVMAX-BGRP                PIC X(3).
007348     10 BXVMAN-KEY-TYP-ID          PIC S9(9) COMP.
007349     10 BXVMAN-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
007350     10 BXVMAX-DATEN-INHALT.
007351     49 BXVMAN-DATEN-INHALT-LEN    PIC S9(4) COMP.
007352     49 BXVMAX-DATEN-INHALT-TEXT   PIC X(4096).
007353 01  BXVM-I-DCLFEVXVM.
007354     10 BXVMAN-I-KEY-TYP-ID-ZAHL   PIC S9(4) COMP.
007355     10 BXVMAN-I-DATEN-INHALT      PIC S9(4) COMP.
007356******************************************************************
007357* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
007358******************************************************************
007360*  PROBA PCOPYEND
007700
007710
007720*V11 IR neues PCopy
007730*-----------------------------------------------------------------
007740* VKMS FZ-Baugruppe-Key-Typ
007750*-----------------------------------------------------------------
007760*PCOPY=FEV2VM01,PRFX=B2VM
007761*  PROBA PCOPYANF
007762*  PROBA MEMBER=FEV2VM01 CODE=CB01 AUTH=FIEBIGER-T TYPE=S
007763*  PROBA  STAND 21.10.2019(16.08) LAN=COB
007765******************************************************************
007766* DCLGEN TABLE(FEV2VM)                                           *
007767*        LIBRARY(DB2J.SRCLIB.DATA(FEV2VM))                       *
007768*        ACTION(REPLACE)                                         *
007769*        LANGUAGE(COBOL)                                         *
007770*        APOST                                                   *
007771* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
007772******************************************************************
007773     EXEC SQL DECLARE FEV2VM TABLE
007774     ( UTC_V_ID                    TIMESTAMP       NOT NULL
007775     , VIN                         CHAR(17)        NOT NULL
007776     , BGRP                        CHAR(3)         NOT NULL
007777     , KEY_TYP_ID                  INTEGER         NOT NULL
007778     , KEY_TYP_ID_ZAHL             INTEGER
007779     , DATEN_INHALT                VARCHAR(4096)
007780     ) END-EXEC.
007781******************************************************************
007782* COBOL DECLARATION FOR TABLE FEV2VM                             *
007783******************************************************************
007784 01  B2VM-DCLFEV2VM.
007785     10 B2VMAX-UTC-V-ID            PIC X(26).
007786     10 B2VMAX-VIN                 PIC X(17).
007787     10 B2VMAX-BGRP                PIC X(3).
007788     10 B2VMAN-KEY-TYP-ID          PIC S9(9) COMP.
007789     10 B2VMAN-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
007790     10 B2VMAX-DATEN-INHALT.
007791     49 B2VMAN-DATEN-INHALT-LEN    PIC S9(4) COMP.
007792     49 B2VMAX-DATEN-INHALT-TEXT   PIC X(4096).
007793 01  B2VM-I-DCLFEV2VM.
007794     10 B2VMAN-I-KEY-TYP-ID-ZAHL   PIC S9(4) COMP.
007795     10 B2VMAN-I-DATEN-INHALT      PIC S9(4) COMP.
007796******************************************************************
007797* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
007798******************************************************************
007800*  PROBA PCOPYEND
008140
008150
008160*-----------------------------------------------------------------
008170* VKMS FZ-BGRP-DLC
008180*-----------------------------------------------------------------
008190*PCOPY=FEV2VN00,PRFX=B2VN
008191*  PROBA PCOPYANF
008192*  PROBA MEMBER=FEV2VN00 CODE=CB02 AUTH=FIEBIGER-T TYPE=S
008193*  PROBA  STAND 17.07.2017(15.50) LAN=COB
008195******************************************************************
008196* DCLGEN TABLE(FEV2VN)                                           *
008197*        LIBRARY(DB2J.SRCLIB.DATA(FEV2VN))                       *
008198*        ACTION(REPLACE)                                         *
008199*        LANGUAGE(COBOL)                                         *
008200*        APOST                                                   *
008201* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
008202******************************************************************
008203     EXEC SQL DECLARE FEV2VN TABLE
008204     ( UTC_V_ID                        TIMESTAMP    NOT NULL
008205     , VIN                             CHAR(17)     NOT NULL
008206     , BGRP                            CHAR(3)      NOT NULL
008207     , SERIE_NR                        CHAR(23)
008208     , DLC_CHECKSUM                    BINARY(16)   NOT NULL
008209     , PSS_CHECKSUM                    BINARY(16)   NOT NULL
008210     , FZ_ID_ZAHL                      INTEGER      NOT NULL
008211     , SG_ID_ZAHL                      INTEGER      NOT NULL
008212     , PSS_VIN                         CHAR(17)     NOT NULL
008213     , PSS_FZ_ID_ZAHL                  INTEGER      NOT NULL
008214     , PSS_KRYPTOREGION                CHAR(3)      NOT NULL
008215     , PSS_BGRP                        CHAR(3)      NOT NULL
008216     , PSS_KEY_TYP_ID                  INTEGER      NOT NULL
008217     , PSS_KEY_TYP_ID_ZAHL             INTEGER      NOT NULL
008218     , PSS_KEY_AUFBAU_VERSION          INTEGER      NOT NULL
008219     ) END-EXEC.
008220******************************************************************
008221* COBOL DECLARATION FOR TABLE FEV2VN                             *
008222******************************************************************
008223 01  B2VN-DCLFEV2VN.
008224     10 B2VNAX-UTC-V-ID                PIC X(26).
008225     10 B2VNAX-VIN                     PIC X(17).
008226     10 B2VNAX-BGRP                    PIC X(3).
008227     10 B2VNAX-SERIE-NR                PIC X(23).
008228     10 B2VNAX-DLC-CHECKSUM      USAGE SQL TYPE IS BINARY(16).
008229     10 B2VNAX-PSS-CHECKSUM      USAGE SQL TYPE IS BINARY(16).
008230     10 B2VNAN-FZ-ID-ZAHL              PIC S9(9) COMP.
008231     10 B2VNAN-SG-ID-ZAHL              PIC S9(9) COMP.
008232     10 B2VNAX-PSS-VIN                 PIC X(17).
008233     10 B2VNAN-PSS-FZ-ID-ZAHL          PIC S9(9) COMP.
008234     10 B2VNAX-PSS-KRYPTOREGION        PIC X(3).
008235     10 B2VNAX-PSS-BGRP                PIC X(3).
008236     10 B2VNAN-PSS-KEY-TYP-ID          PIC S9(9) COMP.
008237     10 B2VNAN-PSS-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
008238     10 B2VNAN-PSS-KEY-AUFBAU-VERSION  PIC S9(9) COMP.
008239 01  B2VN-I-DCLFEV2VN.
008240     10 B2VNAN-I-SERIE-NR              PIC S9(4) COMP.
008241******************************************************************
008242* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 15      *
008243******************************************************************
008245*  PROBA PCOPYEND
008720
008730*-----------------------------------------------------------------
008740* VKMS FZ-BGRP-DLC-KEY-TYP
008750*-----------------------------------------------------------------
008760*PCOPY=FEV0VP00,PRFX=B0VP
008761*  PROBA PCOPYANF
008762*  PROBA MEMBER=FEV0VP00 CODE=CB05 AUTH=FIEBIGER-T TYPE=S
008763*  PROBA  STAND 25.09.2017(09.12) LAN=COB
008765******************************************************************
008766* DCLGEN TABLE(FEV0VP)                                           *
008767*        LIBRARY(DB2J.SRCLIB.DATA(FEV0VP))                       *
008768*        ACTION(REPLACE)                                         *
008769*        LANGUAGE(COBOL)                                         *
008770*        APOST                                                   *
008771* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
008772******************************************************************
008773     EXEC SQL DECLARE FEV0VP TABLE
008774     ( UTC_V_ID                        TIMESTAMP   NOT NULL
008775     , VIN                             CHAR(17)    NOT NULL
008776     , BGRP                            CHAR(3)     NOT NULL
008777     , KEY_TYP_ID                      INTEGER     NOT NULL
008778     , KEY_TYP_ID_ZAHL                 INTEGER
008779     , KEY_TYP_IM_DLC_KZ               CHAR(1)     NOT NULL
008780     , ZERT_SERIE_NR                   BINARY(11)
008781     ) END-EXEC.
008782******************************************************************
008783* COBOL DECLARATION FOR TABLE FEV0VP                             *
008784******************************************************************
008785 01  B0VP-DCLFEV0VP.
008786     10 B0VPAX-UTC-V-ID                PIC X(26).
008787     10 B0VPAX-VIN                     PIC X(17).
008788     10 B0VPAX-BGRP                    PIC X(3).
008789     10 B0VPAN-KEY-TYP-ID              PIC S9(9) COMP.
008790     10 B0VPAN-KEY-TYP-ID-ZAHL         PIC S9(9) COMP.
008791     10 B0VPAX-KEY-TYP-IM-DLC-KZ       PIC X.
008792     10 B0VPAX-ZERT-SERIE-NR     USAGE SQL TYPE IS BINARY(11).
008793 01  B0VP-I-DCLFEV0VP.
008794     10 B0VPAN-I-KEY-TYP-ID-ZAHL       PIC S9(4) COMP.
008795     10 B0VPAN-I-ZERT-SERIE-NR         PIC S9(4) COMP.
008796******************************************************************
008797* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 7       *
008798******************************************************************
008800*  PROBA PCOPYEND
009140
009150*-----------------------------------------------------------------
009160* VKMS Fz-Transponder SELECT
009170*-----------------------------------------------------------------
009180*PCOPY=FEV0X301,PRFX=B0X3
009181*  PROBA PCOPYANF
009182*  PROBA MEMBER=FEV0X301 CODE=LB01 AUTH=FIEBIGER-T TYPE=S
009183*  PROBA  STAND 19.07.2021(09.01) LAN=COB
009185******************************************************************
009186* DCLGEN TABLE(FEV0X3)                                           *
009187*        LIBRARY(DB2J.SRCLIB.DATA(FEV0X3))                       *
009188*        LANGUAGE(COBOL)                                         *
009189*        APOST                                                   *
009190* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
009191******************************************************************
009192     EXEC SQL DECLARE FEV0X3 TABLE
009193     ( UTC_V_ID                    TIMESTAMP   NOT NULL
009194     , VIN                         CHAR(17)    NOT NULL
009195     , TRANSPOND_ID                CHAR(8)     NOT NULL
009196     , TRANSPOND_TYP               CHAR(4)     NOT NULL
009197     , TEXT_TRANSPOND_STATUS       INTEGER     NOT NULL
009198     , BGRP                        CHAR(3)
009199     , SKC0_KEY_TYP_ID             INTEGER
009200     , SKC0_KEY_TYP_ID_ZAHL        INTEGER
009201     , TRANSPOND_ID_ZAHL           INTEGER     NOT NULL
009202     , PSS_FZ_ID_ZAHL              INTEGER     NOT NULL
009203     , PSS_KRYPTOREGION            CHAR(3)     NOT NULL
009204     , PSS_BGRP                    CHAR(3)     NOT NULL
009205     , PSS_KEY_TYP_ID              INTEGER     NOT NULL
009206     , PSS_KEY_TYP_ID_ZAHL         INTEGER     NOT NULL
009207     , PSS_VKMS_KEY_AUFBAU_VERSION INTEGER     NOT NULL
009208     , PSS_VIN                     CHAR(17)    NOT NULL
009209     ) END-EXEC.
009210******************************************************************
009211* COBOL DECLARATION FOR TABLE FEV0X3                             *
009212******************************************************************
009213 01  B0X3-DCLFEV0X3.
009214     10 B0X3AX-UTC-V-ID                PIC X(26).
009215     10 B0X3AX-VIN                     PIC X(17).
009216     10 B0X3AX-TRANSPOND-ID            PIC X(8).
009217     10 B0X3AX-TRANSPOND-TYP           PIC X(4).
009218     10 B0X3AN-TEXT-TRANSPOND-STATUS   PIC S9(9) COMP.
009219     10 B0X3AX-BGRP                    PIC X(3).
009220     10 B0X3AN-SKC0-KEY-TYP-ID         PIC S9(9) COMP.
009221     10 B0X3AN-SKC0-KEY-TYP-ID-ZAHL    PIC S9(9) COMP.
009222     10 B0X3AN-TRANSPOND-ID-ZAHL       PIC S9(9) COMP.
009223     10 B0X3AN-PSS-FZ-ID-ZAHL          PIC S9(9) COMP.
009224     10 B0X3AX-PSS-KRYPTOREGION        PIC X(3).
009225     10 B0X3AX-PSS-BGRP                PIC X(3).
009226     10 B0X3AN-PSS-KEY-TYP-ID          PIC S9(9) COMP.
009227     10 B0X3AN-PSS-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
009228     10 B0X3AN-PSS-VKMS-KEY-AUFBAU-VER PIC S9(9) COMP.
009229     10 B0X3AX-PSS-VIN                 PIC X(17).
009230 01  B0X3-I-DCLFEV0X3.
009231     10 B0X3AN-I-BGRP                  PIC S9(4) COMP.
009232     10 B0X3AN-I-SKC0-KEY-TYP-ID       PIC S9(4) COMP.
009233     10 B0X3AN-I-SKC0-KEY-TYP-ID-ZAHL  PIC S9(4) COMP.
009234******************************************************************
009235* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 16      *
009236******************************************************************
009238*  PROBA PCOPYEND
009740
009750*-----------------------------------------------------------------
009760* VKMS Fz-Transponder SELECT aktuell
009770*-----------------------------------------------------------------
009780*PCOPY=FEV2X301,PRFX=B2X3
009781*  PROBA PCOPYANF
009782*  PROBA MEMBER=FEV2X301 CODE=QB01 AUTH=FIEBIGER-T TYPE=S
009783*  PROBA  STAND 19.07.2021(09.02) LAN=COB
009785******************************************************************
009786* DCLGEN TABLE(FEV2X3)                                           *
009787*        LIBRARY(DB2J.SRCLIB.DATA(FEV2X3))                       *
009788*        LANGUAGE(COBOL)                                         *
009789*        APOST                                                   *
009790* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
009791******************************************************************
009792     EXEC SQL DECLARE FEV2X3 TABLE
009793     ( UTC_V_ID                    TIMESTAMP   NOT NULL
009794     , VIN                         CHAR(17)    NOT NULL
009795     , TRANSPOND_ID                CHAR(8)     NOT NULL
009796     , TRANSPOND_TYP               CHAR(4)     NOT NULL
009797     , TEXT_TRANSPOND_STATUS       INTEGER     NOT NULL
009798     , BGRP                        CHAR(3)
009799     , SKC0_KEY_TYP_ID             INTEGER
009800     , SKC0_KEY_TYP_ID_ZAHL        INTEGER
009801     , TRANSPOND_ID_ZAHL           INTEGER     NOT NULL
009802     , PSS_FZ_ID_ZAHL              INTEGER     NOT NULL
009803     , PSS_KRYPTOREGION            CHAR(3)     NOT NULL
009804     , PSS_BGRP                    CHAR(3)     NOT NULL
009805     , PSS_KEY_TYP_ID              INTEGER     NOT NULL
009806     , PSS_KEY_TYP_ID_ZAHL         INTEGER     NOT NULL
009807     , PSS_VKMS_KEY_AUFBAU_VERSION INTEGER     NOT NULL
009808     , PSS_VIN                     CHAR(17)    NOT NULL
009809     ) END-EXEC.
009810******************************************************************
009811* COBOL DECLARATION FOR TABLE FEV2X3                             *
009812******************************************************************
009813 01  B2X3-DCLFEV2X3.
009814     10 B2X3AX-UTC-V-ID                PIC X(26).
009815     10 B2X3AX-VIN                     PIC X(17).
009816     10 B2X3AX-TRANSPOND-ID            PIC X(8).
009817     10 B2X3AX-TRANSPOND-TYP           PIC X(4).
009818     10 B2X3AN-TEXT-TRANSPOND-STATUS   PIC S9(9) COMP.
009819     10 B2X3AX-BGRP                    PIC X(3).
009820     10 B2X3AN-SKC0-KEY-TYP-ID         PIC S9(9) COMP.
009821     10 B2X3AN-SKC0-KEY-TYP-ID-ZAHL    PIC S9(9) COMP.
009822     10 B2X3AN-TRANSPOND-ID-ZAHL       PIC S9(9) COMP.
009823     10 B2X3AN-PSS-FZ-ID-ZAHL          PIC S9(9) COMP.
009824     10 B2X3AX-PSS-KRYPTOREGION        PIC X(3).
009825     10 B2X3AX-PSS-BGRP                PIC X(3).
009826     10 B2X3AN-PSS-KEY-TYP-ID          PIC S9(9) COMP.
009827     10 B2X3AN-PSS-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
009828     10 B2X3AN-PSS-VKMS-KEY-AUFBAU-VER PIC S9(9) COMP.
009829     10 B2X3AX-PSS-VIN                 PIC X(17).
009830 01  B2X3-I-DCLFEV2X3.
009831     10 B2X3AN-I-BGRP                  PIC S9(4) COMP.
009832     10 B2X3AN-I-SKC0-KEY-TYP-ID       PIC S9(4) COMP.
009833     10 B2X3AN-I-SKC0-KEY-TYP-ID-ZAHL  PIC S9(4) COMP.
009834******************************************************************
009835* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 16      *
009836******************************************************************
009838*  PROBA PCOPYEND
010340
010350*-----------------------------------------------------------------
010360* VKMS Fz-Transponder Update
010370*-----------------------------------------------------------------
010380*PCOPY=FEVXX301,PRFX=BXX3
010381*  PROBA PCOPYANF
010382*  PROBA MEMBER=FEVXX301 CODE=UA01 AUTH=FIEBIGER-T TYPE=S
010383*  PROBA  STAND 19.07.2021(09.02) LAN=COB
010385******************************************************************
010386* DCLGEN TABLE(FEVXX3)                                           *
010387*        LIBRARY(DB2J.SRCLIB.DATA(FEVXX3))                       *
010388*        LANGUAGE(COBOL)                                         *
010389*        APOST                                                   *
010390* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
010391******************************************************************
010392     EXEC SQL DECLARE FEVXX3 TABLE
010393     ( UTC_V_ID                    TIMESTAMP   NOT NULL
010394     , VIN                         CHAR(17)    NOT NULL
010395     , TRANSPOND_ID                CHAR(8)     NOT NULL
010396     , TRANSPOND_TYP               CHAR(4)     NOT NULL
010397     , TEXT_TRANSPOND_STATUS       INTEGER     NOT NULL
010398     , BGRP                        CHAR(3)
010399     , SKC0_KEY_TYP_ID             INTEGER
010400     , SKC0_KEY_TYP_ID_ZAHL        INTEGER
010401     , TRANSPOND_ID_ZAHL           INTEGER     NOT NULL
010402     , PSS_FZ_ID_ZAHL              INTEGER     NOT NULL
010403     , PSS_KRYPTOREGION            CHAR(3)     NOT NULL
010404     , PSS_BGRP                    CHAR(3)     NOT NULL
010405     , PSS_KEY_TYP_ID              INTEGER     NOT NULL
010406     , PSS_KEY_TYP_ID_ZAHL         INTEGER     NOT NULL
010407     , PSS_VKMS_KEY_AUFBAU_VERSION INTEGER     NOT NULL
010408     , PSS_VIN                     CHAR(17)    NOT NULL
010409     ) END-EXEC.
010410******************************************************************
010411* COBOL DECLARATION FOR TABLE FEVXX3                             *
010412******************************************************************
010413 01  BXX3-DCLFEVXX3.
010414     10 BXX3AX-UTC-V-ID                PIC X(26).
010415     10 BXX3AX-VIN                     PIC X(17).
010416     10 BXX3AX-TRANSPOND-ID            PIC X(8).
010417     10 BXX3AX-TRANSPOND-TYP           PIC X(4).
010418     10 BXX3AN-TEXT-TRANSPOND-STATUS   PIC S9(9) COMP.
010419     10 BXX3AX-BGRP                    PIC X(3).
010420     10 BXX3AN-SKC0-KEY-TYP-ID         PIC S9(9) COMP.
010421     10 BXX3AN-SKC0-KEY-TYP-ID-ZAHL    PIC S9(9) COMP.
010422     10 BXX3AN-TRANSPOND-ID-ZAHL       PIC S9(9) COMP.
010423     10 BXX3AN-PSS-FZ-ID-ZAHL          PIC S9(9) COMP.
010424     10 BXX3AX-PSS-KRYPTOREGION        PIC X(3).
010425     10 BXX3AX-PSS-BGRP                PIC X(3).
010426     10 BXX3AN-PSS-KEY-TYP-ID          PIC S9(9) COMP.
010427     10 BXX3AN-PSS-KEY-TYP-ID-ZAHL     PIC S9(9) COMP.
010428     10 BXX3AN-PSS-VKMS-KEY-AUFBAU-VER PIC S9(9) COMP.
010429     10 BXX3AX-PSS-VIN                 PIC X(17).
010430 01  BXX3-I-DCLFEVXX3.
010431     10 BXX3AN-I-BGRP                  PIC S9(4) COMP.
010432     10 BXX3AN-I-SKC0-KEY-TYP-ID       PIC S9(4) COMP.
010433     10 BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL  PIC S9(4) COMP.
010434******************************************************************
010435* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 16      *
010436******************************************************************
010438*  PROBA PCOPYEND
010940
010950*-----------------------------------------------------------------
010960* VKMS FZ-Smartcard Select
010970*-----------------------------------------------------------------
010980*PCOPY=FEV0XA00,PRFX=B0XA
010981*  PROBA PCOPYANF
010982*  PROBA MEMBER=FEV0XA00 CODE=NZ02 AUTH=FIEBIGER-T TYPE=S
010983*  PROBA  STAND  7.06.2021(12.10) LAN=COB
010985******************************************************************
010986* DCLGEN TABLE(FEV0XA)                                           *
010987*        LIBRARY(DB2J.SRCLIB.DATA(FEV0XA))                       *
010988*        ACTION(REPLACE)                                         *
010989*        LANGUAGE(COBOL)                                         *
010990*        APOST                                                   *
010991* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
010992******************************************************************
010993     EXEC SQL DECLARE FEV0XA TABLE
010994     ( UTC_V_ID                    TIMESTAMP       NOT NULL
010995     , VIN                         CHAR(17)        NOT NULL
010996     , SMARTCARD_ID                CHAR(36)        NOT NULL
010997     , TEXT_SMARTCARD_STATUS       INTEGER         NOT NULL
010998     , SKC0_KEY_TYP_ID             INTEGER
010999     , SKC0_KEY_TYP_ID_ZAHL        INTEGER
011000     ) END-EXEC.
011001******************************************************************
011002* COBOL DECLARATION FOR TABLE FEV0XA                             *
011003******************************************************************
011004 01  B0XA-DCLFEV0XA.
011005     10 B0XAAX-UTC-V-ID                PIC X(26).
011006     10 B0XAAX-VIN                     PIC X(17).
011007     10 B0XAAX-SMARTCARD-ID            PIC X(36).
011008     10 B0XAAN-TEXT-SMARTCARD-STATUS   PIC S9(9) COMP.
011009     10 B0XAAN-SKC0-KEY-TYP-ID         PIC S9(9) COMP.
011010     10 B0XAAN-SKC0-KEY-TYP-ID-ZAHL    PIC S9(9) COMP.
011011 01  B0XA-I-DCLFEV0XA.
011012     10 B0XAAN-I-SKC0-KEY-TYP-ID       PIC S9(4) COMP.
011013     10 B0XAAN-I-SKC0-KEY-TYP-ID-ZAHL  PIC S9(4) COMP.
011014******************************************************************
011015* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 6       *
011016******************************************************************
011018*  PROBA PCOPYEND
011340
011350*-----------------------------------------------------------------
011360* VKMS FZ-Smartcard Update
011370*-----------------------------------------------------------------
011380*PCOPY=FEVXXA00,PRFX=BXXA
011381*  PROBA PCOPYANF
011382*  PROBA MEMBER=FEVXXA00 CODE=WY02 AUTH=FIEBIGER-T TYPE=S
011383*  PROBA  STAND  7.06.2021(12.10) LAN=COB
011385******************************************************************
011386* DCLGEN TABLE(FEVXXA)                                           *
011387*        LIBRARY(DB2J.SRCLIB.DATA(FEVXXA))                       *
011388*        ACTION(REPLACE)                                         *
011389*        LANGUAGE(COBOL)                                         *
011390*        APOST                                                   *
011391* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
011392******************************************************************
011393     EXEC SQL DECLARE FEVXXA TABLE
011394     ( UTC_V_ID                    TIMESTAMP       NOT NULL
011395     , VIN                         CHAR(17)        NOT NULL
011396     , SMARTCARD_ID                CHAR(36)        NOT NULL
011397     , TEXT_SMARTCARD_STATUS       INTEGER         NOT NULL
011398     , SKC0_KEY_TYP_ID             INTEGER
011399     , SKC0_KEY_TYP_ID_ZAHL        INTEGER
011400     ) END-EXEC.
011401******************************************************************
011402* COBOL DECLARATION FOR TABLE FEVXXA                             *
011403******************************************************************
011404 01  BXXA-DCLFEVXXA.
011405     10 BXXAAX-UTC-V-ID                PIC X(26).
011406     10 BXXAAX-VIN                     PIC X(17).
011407     10 BXXAAX-SMARTCARD-ID            PIC X(36).
011408     10 BXXAAN-TEXT-SMARTCARD-STATUS   PIC S9(9) COMP.
011409     10 BXXAAN-SKC0-KEY-TYP-ID         PIC S9(9) COMP.
011410     10 BXXAAN-SKC0-KEY-TYP-ID-ZAHL    PIC S9(9) COMP.
011411 01  BXXA-I-DCLFEVXXA.
011412     10 BXXAAN-I-SKC0-KEY-TYP-ID       PIC S9(4) COMP.
011413     10 BXXAAN-I-SKC0-KEY-TYP-ID-ZAHL  PIC S9(4) COMP.
011414******************************************************************
011415* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 6       *
011416******************************************************************
011418*  PROBA PCOPYEND
011740
011750*-----------------------------------------------------------------
011760* VKMS AK-Transpond  UPDATE
011770*-----------------------------------------------------------------
011780*PCOPY=FEVXX400,PRFX=BXX4
011781*  PROBA PCOPYANF
011782*  PROBA MEMBER=FEVXX400 CODE=UA01 AUTH=UNGER-GUNT TYPE=S
011783*  PROBA  STAND 12.06.2019(14.01) LAN=COB
011785******************************************************************
011786* DCLGEN TABLE(FEVXX4)                                           *
011787*        LIBRARY(DB2J.SRCLIB.DATA(FEVXX4))                       *
011788*        LANGUAGE(COBOL)                                         *
011789*        APOST                                                   *
011790* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
011791******************************************************************
011792     EXEC SQL DECLARE FEVXX4 TABLE
011793     ( UTC_V_ID                    TIMESTAMP             NOT NULL
011794     , TRANSPOND_ID                CHAR(8)               NOT NULL
011795     , TRANSPOND_TYP               CHAR(4)               NOT NULL
011796     , TEXT_VERARB                 INTEGER               NOT NULL
011797     , TEXT_FEHLER_KLASSE          INTEGER
011798     ) END-EXEC.
011799******************************************************************
011800* COBOL DECLARATION FOR TABLE FEVXX4                             *
011801******************************************************************
011802 01  BXX4-DCLFEVXX4.
011803     10 BXX4AX-UTC-V-ID             PIC X(26).
011804     10 BXX4AX-TRANSPOND-ID         PIC X(8).
011805     10 BXX4AX-TRANSPOND-TYP        PIC X(4).
011806     10 BXX4AN-TEXT-VERARB          PIC S9(9) COMP.
011807     10 BXX4AN-TEXT-FEHLER-KLASSE   PIC S9(9) COMP.
011808 01  BXX4-I-DCLFEVXX4.
011809     10 BXX4AN-I-TEXT-FEHLER-KLASSE PIC S9(4) COMP.
011810******************************************************************
011811* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
011812******************************************************************
011814*  PROBA PCOPYEND
012100
012110*-----------------------------------------------------------------
012120* SCHNITTSTELLE FE333  Markierungsprüfung
012130*-----------------------------------------------------------------
012140*PCOPY=FE333V01
012141*  PROBA PCOPYANF
012142*  PROBA MEMBER=FE333V01 CODE=QB06 AUTH=KOLMEDER-K TYPE=S
012143*  PROBA  STAND 15.10.2012(10.22) LAN=COB
012145******************************************************************
012146* MEMBER: FE333V00                            FIRST: JANUAR   2012
012147* TITLE:  MARKIERUNGSPRUEFUNG
012148* SA:     F3                                       SYS-NAME: FAZIT
012149* AUTHOR: KONRAD KOLMEDER, MSG SYSTEMS AG
012150*
012151* DESC:   SCHNITTSTELLE FE333B/C
012152* DESC:   ZENTRALE MARKIERUNGSPRUEFUNG
012153*-----------------------------------------------------------------
012154* MOD:    00 18.01.2012 KONRAD KOLMEDER, MSG SYSTEMS AG
012155* MOD:                  NEUERSTELLUNG
012156* MOD:    01 01.10.2012 KONRAD KOLMEDER, MSG SYSTEMS AG
012157* MOD:                  ÄA-154b neue Markierungsdarstellung
012158******************************************************************
012159 01  SP333-BEREICH1.
012160     05 SP333AX-STD-EIN.
012161*       -- 01 : Prüfen Fahrzeug auf Markierungen
012162*               SYSTEM-NAME = 'FAZIT'
012163*       -- 02 : Prüfen Baugruppe auf Markierungen
012164*       -- 03 : Prüfen Baugruppe auf Markierungen "über Fahrzeug"
012165*               SYSTEM-NAME = 'FAZIT'
012166*               Fahrzeug übergeben in -VIN-G
012167*               Marke kann mitgegeben werden (wg Ausnahme),
012168*               wenn nicht wird sie aus VIN-G bestimmt
012169*       -- 04 : Kombination aus 02 und 03
012170*               Fahrzeug übergeben in -VIN-G
012171*               Marke muss mitgegeben werden
012172*       -- 05 : Prüfen Transponder auf Markierungen
012173*               Marke muss mitgegeben werden
012174*       -- 06 : Prüfen Transponder auf Markierungen
012175*               in irgendeiner Marke
012176*               Marke muss leer sein
012177*       -- 07 : Prüfen Baugruppe auf Markierungen
012178*               in irgendeiner Marke
012179*               Marke muss leer sein
012180*       -- 11 : Liefern Markierungsinformationen zu Fahrzeug
012181*               SYSTEM-NAME = 'FAZIT'
012182*               hier gibt es keinen Hinweis oder Fehler
012183*               in SP333AX-TEXT-FEHLER-KLASSE
012184*               es werden erweiterte Informationen geliefert
012185*       -- 51 : Prüfen Fahrzeug auf Markierungen
012186*               SYSTEM-NAME wird übergeben
012187        10 SP333AX-AKTION                     PIC X(2).
012188        10 SP333AX-USER-ID                    PIC X(12).
012189        10 SP333AN-SPRACH-KZ                  PIC S9(9) COMP.
012190
012191     05 SP333AX-STD-AUS.
012192        10 SP333AN-TEXT-RC                    PIC S9(9) COMP.
012193        10 SP333AN-TEXT-FEHLER-KLASSE         PIC S9(9) COMP.
012194        10 SP333AX-BESCHREIBUNG               PIC X(254).
012195        10 SP333AX-FEHLER-PARM.
012196           49 SP333AN-FEHLER-PARM-LEN         PIC S9(4) COMP.
012197           49 SP333AX-FEHLER-PARM-TEXT        PIC X(254).
012198
012199     05 SP333AX-EINGABE.
012200*       -- das darf nur in der Testumgebung gesetzt werden:
012201*       -- (oder abhängig von Display-Schalter des Aufrufers)
012202        10 SP333AX-MIT-TRACE                  PIC X(01).
012203
012204*       -- zu prüfende VIN
012205        10 SP333AX-VIN                        PIC X(17).
012206
012207*       -- zu prüfende Baugruppe
012208*       -- Marke des Fahrzeugs
012209*       -- Fahrzeug aus dem das (gebrauchte)Steuergerät stammt
012210        10 SP333AX-BGRP-INHALT                PIC X(27).
012211        10 SP333AX-BGRP-FZ-MARKE              PIC X(2).
012212        10 SP333AX-BGRP-VIN-G                 PIC X(17).
012213
012214*       -- zu prüfender Transponder
012215*       -- Marke des Fahrzeugs
012216        10 SP333AX-TRANSPOND-ID               PIC X(8).
012217        10 SP333AX-TRANSPOND-FAM              PIC X(10).
012218        10 SP333AX-TRANSPOND-FZ-MARKE         PIC X(2).
012219
012220*       -- Prüfung für welches anfragende SYSTEM
012221        10 SP333AX-SYSTEM-NAME                PIC X(15).
012222
012223
012224        10 SP333AX-EINGABE-FREI               PIC X(185).
012225
012226     05 SP333AX-AUSGABE.
012227*       -- Text Markierung Typ
012228*       -- 'gesperrt' 'beobachtet' etc
012229        10 SP333AX-TEXT-MARKIERUNG-TYP.
012230*          -- "Gesamtzustand" der Markierungen
012231           15 SP333AN-TEXT-M-TYP-GESAMT       PIC S9(9) COMP.
012232*          -- mindestens 1 Markierung "ohne Auswirkung" 9065
012233           15 SP333AN-TEXT-M-TYP-OHNE-AUSWI   PIC S9(9) COMP.
012234*          -- mindestens 1 Markierung "Beobachtung"     6802
012235           15 SP333AN-TEXT-M-TYP-BEOBACHTUNG  PIC S9(9) COMP.
012236*          -- mindestens 1 Markierung "Sperre"          6801
012237           15 SP333AN-TEXT-M-TYP-SPERRE       PIC S9(9) COMP.
012238
012239*       -- alle Markierungs-RCs (Fehler und Hinweise)
012240        10 SP333AX-TABELLE-RC.
012241           15 SP333AN-TRC-ANZAHL              PIC S9(9) COMP.
012242           15 SP333AX-TRC-ZEILE OCCURS 20.
012243*             -- der Text
012244              20 SP333AN-TRC-TEXT-RC          PIC S9(9) COMP.
012245*             -- Fehler oder Hinweis
012246              20 SP333AN-TRC-TEXT-FEHLER-KLASSE PIC S9(9) COMP.
012247*             -- Text Markierung Typ
012248*             -- 'Sperre' , 'Beobachtung' , ...
012249              20 SP333AN-TRC-TE-M-TYP-MARK       PIC S9(9) COMP.
012250                 88 SP333A8-TRC-TYP-SPERRE       VALUE +6801.
012251                 88 SP333A8-TRC-TYP-BEOBACHTUNG  VALUE +6802.
012252                 88 SP333A8-TRC-TYP-OHNE-AUSWI   VALUE +9065.
012253*             -- was ist es: Fahrzeug, Baugruppe, Transponder
012254              20 SP333AX-TRC-ART-OBJEKT       PIC X(1).
012255                 88 SP333A8-TRC-ART-FAHRZEUG    VALUE 'F'.
012256                 88 SP333A8-TRC-ART-BAUGRUPPE   VALUE 'B'.
012257                 88 SP333A8-TRC-ART-TRANSPONDER VALUE 'T'.
012258*             -- frei
012259              20 SP333AX-TRC-FREI-1           PIC X(1).
012260*             -- obs in die Auskunft-Fz-Beobachtung soll
012261              20 SP333AX-TRC-AUSK-FZ-BEOB     PIC X(1).
012262                 88 SP333A8-TRC-NACH-AUSK-FZ-BEOB VALUE 'J'.
012263*             -- obs in die Auskunft-Baugruppe soll
012264              20 SP333AX-TRC-AUSK-BGRP        PIC X(1).
012265                 88 SP333A8-TRC-NACH-AUSK-BGRP    VALUE 'J'.
012266*             -- obs in die Auskunft-Transponder soll
012267              20 SP333AX-TRC-AUSK-TRAN        PIC X(1).
012268                 88 SP333A8-TRC-NACH-AUSK-TRAN    VALUE 'J'.
012269
012270*       -- zusätzliche Ergebnisse aus Aktion 11
012271        10 SP333AX-A11-ZUSATZ.
012272*          -- 6802 Beobachtung Fahrzeug zu irgendeiner Zeit
012273           15 SP333AN-A11-HISTO-BEOB          PIC S9(9) COMP.
012274*          -- 6801 Sperre      Fahrzeug zu irgendeiner Zeit
012275           15 SP333AN-A11-HISTO-SPERRE        PIC S9(9) COMP.
012276*          -- 6802 Beobachtung Baugruppen zum Fahrzeug
012277           15 SP333AN-A11-BGRP-ZU-VIN-BEOB    PIC S9(9) COMP.
012278*          -- 6801 Sperre      Baugruppen zum Fahrzeug
012279           15 SP333AN-A11-BGRP-ZU-VIN-SPERRE  PIC S9(9) COMP.
012280
012281        10 SP333AX-AUSGABE-FREI               PIC X(500).
012282
012283*    -- Parameter 2 für alle Aktionen,
012284*    -- die nur einen Platzhalter übergeben
012285 01  SP333-BEREICH2-STD.
012286     05 SP333AX-STD-B2                        PIC X(1).
012287
012289*  PROBA PCOPYEND
013610
013620
013630*-----------------------------------------------------------------
013640* SCHNITTSTELLE FE378B Insert FE01T4H0 Transpond-Markierung
013650*-----------------------------------------------------------------
013660 01  S378.
013670*PCOPY=FE378V00,XXXX=S378
013671*  PROBA PCOPYANF
013672*  PROBA MEMBER=FE378V00 CODE=BB03 AUTH=FIEBIGER-T TYPE=S
013673*  PROBA  STAND 13.02.2013(12.12) LAN=COB
013675******************************************************************
013676* MEMBER: FE378V00                             FIRST: Februar 2013
013677* TITLE:  Unterprogramm: Insert FE01T4H0 Transpond-Markierung
013678* SA:     F3                                       SYS-NAME: FAZIT
013679* AUTHOR: Thomas Fiebiger, msg systems ag
013680*
013681* DESC:   Schnittstelle für Programm FE378B
013682*-----------------------------------------------------------------
013683* PCOPY:  FEPARM01 Parameter- und Fehlerbereich für Fazit-Schnitt-
013684*                  stellen
013685*-----------------------------------------------------------------
013686* MOD: 00 13.02.2013 Thomas Fiebiger, msg systems ag
013687* MOD:               ÄA-171: neue Markierungsmöglichkeiten
013688* MOD:               - Neuerstellung
013689******************************************************************
013690*PCOPY=FEPARM01,YYYY=S378
013691*  PROBA PCOPYANF
013692*  PROBA MEMBER=FEPARM01 CODE=JW05 AUTH=FIEBIGER-T TYPE=S
013693*  PROBA  STAND 15.02.2011(18.27) LAN=COB
013695******************************************************************
013696* MEMBER: FEPARM01                            FIRST: Dezember 2010
013697* TITLE:  Parameter- und Fehlerbereich für Fazit-Schnittstellen
013698* SA:     F3                                       SYS-NAME: FAZIT
013699* AUTHOR: Thomas Fiebiger, msg systems ag
013700*
013701* DESC:   Parameter- und Fehlerbereich für Fazit-Schnittstellen
013702*-----------------------------------------------------------------
013703* MOD: 01 28.12.2010 Thomas Fiebiger, msg systems ag
013704* MOD:               Neuerstellung
013705******************************************************************
013706
013707* -- Übergabeparameter
013708     03 S378-PARAMETER.
013709*       -- Vergleichskennzeichen:
013710*       --          'N'  => kein Vergleich
013711*       --         sonst => Vergleich mit letztem Tabellen-Eintrag
013712        10 S378AX-VGL-KZ              PIC X.
013713
013714* -- Rückgabeparameter
013715     03 S378-FEHLER.
013716        10 S378AN-TEXT-RC             PIC S9(9) COMP.
013717        10 S378AN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
013718        10 S378AX-BESCHREIBUNG.
013719           15 S378AX-PROGRAMM         PIC X(8).
013720           15 S378AX-SECTION          PIC X(26).
013721           15 S378AX-INFO             PIC X(220).
013722        10 S378AX-FEHLER-PARM.
013723           49 S378AN-FEHLER-PARM-LEN  PIC S9(4) COMP.
013724           49 S378AX-FEHLER-PARM-TEXT PIC X(254).
013725        10 S378AX-SQLCA               PIC X(136).
013727*  PROBA PCOPYEND
013728******************************************************************
013729* Cobol Declaration for Table FE01T4H0 Transpond-Markierung
013730******************************************************************
013731     03 S378-DCLFE01T4H0.
013732        10 S378AX-V-ID                   PIC X(26).
013733        10 S378AX-TRANSPOND-ID           PIC X(8).
013734        10 S378AX-TRANSPOND-FAM          PIC X(10).
013735        10 S378AN-TEXT-MARKIERUNG        PIC S9(9) COMP.
013736        10 S378AX-LKZ2                   PIC X(2).
013737        10 S378AX-MARKE                  PIC X(2).
013738        10 S378AX-USER-ID-MELDUNG        PIC X(12).
013739        10 S378AX-INAKTIV-VON            PIC X(26).
013740        10 S378AX-INAKTIV-BIS            PIC X(26).
013741        10 S378AX-VORGANGSNR             PIC X(14).
013742        10 S378AX-LOESCH-KZ              PIC X.
013743     03 S378-I-DCLFE01T4H0.
013744        10 S378AN-I-INAKTIV-VON          PIC S9(4) COMP.
013745        10 S378AN-I-INAKTIV-BIS          PIC S9(4) COMP.
013746******************************************************************
013747* The Number of Columns described by this Declaration is 11
013748******************************************************************
013750*  PROBA PCOPYEND
014430
014440*-----------------------------------------------------------------
014450* SCHNITTSTELLE FE540C Verarbeitung WFS6-Fraese/Transponder
014460*-----------------------------------------------------------------
014470 01 S540.
014480*PCOPY=FE540V02,XXXX=S540
014481*  PROBA PCOPYANF
014482*  PROBA MEMBER=FE540V02 CODE=TB02 AUTH=ULRICH-WOL TYPE=S
014483*  PROBA  STAND 28.07.2021(08.44) LAN=COB
014485******************************************************************
014486* MEMBER: FE540V02                               FIRST: Sept. 2020
014487* TITLE:  Schnittstelle FE540
014488* SA:     F3                                       SYS-NAME: FAZIT
014489* AUTHOR: Wolfgang Ulrich, msg systems ag
014490*
014491* DESC:   Schnittstelle FE540
014492*-----------------------------------------------------------------
014493* MOD: 00 08.09.2020 Wolfgang Ulrich, msg systems ag
014494* MOD:               Neuerstellung
014495* MOD: 01 19.02.2021 Wolfgang Ulrich, msg systems ag
014496* MOD:               für Rel. 6.8 TRA4
014497* MOD:                neues Feld S540AX-E-TRANSPOND-ID-ZAHL
014498* MOD: 02 09.07.2021 Wolfgang Ulrich, msg systems ag
014499* MOD:               für Rel. 6.10 DB Anpassungen
014500* MOD:               Neues Feld S540AX-A-PSS-VIN
014501******************************************************************
014502*-----------------------------------------------------------------
014503*-- EINGABE
014504*-----------------------------------------------------------------
014505   05 S540-EIN.
014506*-----------------------------------------------------------------
014507     10 S540AX-E-ALLGEMEIN.
014508        20 S540AX-E-AKTION                 PIC X(002).
014509        20 S540AX-E-LOG-UTC-V-ID           PIC X(026).
014510        20 S540AX-E-LOG-V-ID               PIC X(026).
014511        20 S540AX-E-STELLE6-STDMODUL       PIC X.
014512        20 S540AX-E-STELLE6-CMODUL         PIC X.
014513        20 S540AN-E-SPRACH-KZ              PIC S9(9) COMP.
014514        20 S540AN-E-DISPLAYLEVEL           PIC S9(4) COMP.
014515        20 S540AN-E-TRACELEVEL             PIC S9(4) COMP.
014516        20 S540AX-E-V-ID-TRACE             PIC X(026).
014517        20 S540AX-E-KT-PLUS                PIC X(001).
014518        20 S540AX-E-RESERVE-1              PIC X(099).
014519*-----------------------------------------------------------------
014520     10 S540AX-E-FAHRZEUG.
014521        20 S540AX-E-VIN                    PIC X(017).
014522*-----------------------------------------------------------------
014523     10 S540A-E-FRAESE.
014524        20 S540AX-E-TESTER-ID              PIC X(030).
014525        20 S540AX-E-AGENT-HOSTNAME         PIC X(030).
014526        20 S540AX-E-CHALLENGE              PIC X(032).
014527        20 S540AX-E-SIGNATURE              PIC X(032).
014528        20 S540AX-E-ID-ZAHL                PIC X(002).
014529*-----------------------------------------------------------------
014530     10 S540AX-E-TRANSPONDER.
014531        20 S540AX-E-TRANSPOND-TYP          PIC X(004).
014532        20 S540AX-E-TRANSPOND-ID           PIC X(008).
014533        20 S540AX-E-TRANSPOND-ID-ZAHL      PIC S9(09) COMP.
014534        20 S540AX-E-USER-MEMORY            PIC X(256).
014535        20 S540AX-E-TRANSPOND-BGRP         PIC X(003).
014536        20 S540AX-E-ANZAHL-TRANSPOND       PIC 9(003).
014537*-----------------------------------------------------------------
014538     10 S540AX-E-SONSTIGE.
014539        20 S540AX-E-SCHLIESS-SATZ          PIC X(027).
014540        20 S540AX-E-PIN-LABEL-GARN-SNR     PIC X(027).
014541        20 S540AX-E-BEMERKUNG.
014542           25 S540AN-E-BEMERKUNG-LEN       PIC S9(04) COMP.
014543           25 S540AX-E-BEMERKUNG-TEXT      PIC X(1000).
014544     10 S540AX-E-RESERVE-2                 PIC X(100).
014545*-----------------------------------------------------------------
014546*-- AUSGABE
014547*-----------------------------------------------------------------
014548   05 S540-AUS.
014549     10 S540AX-A-SCHREIBEN                 PIC X(001).
014550     10 S540AX-A-KT-PLUS                   PIC X(001).
014551     10 S540AX-A-RESERVE-3                 PIC X(098).
014552*-----------------------------------------------------------------
014553     10 S540-A-FAHRZEUG.
014554        20 S540AX-A-V-ID                   PIC X(026).
014555        20 S540AX-A-VIN                    PIC X(017).
014556        20 S540AN-A-TEXT-SYSTEM            PIC S9(09) COMP.
014557        20 S540AX-A-PIN                    PIC X(016).
014558        20 S540AX-A-SKC                    PIC X(096).
014559        20 S540AN-A-TEXT-DRT-VERSION       PIC S9(09) COMP.
014560        20 S540AX-A-WFS-INHALT             PIC X(027).
014561        20 S540AX-A-FSC                    PIC X(016).
014562        20 S540AX-A-P-KLASSE               PIC X(002).
014563        20 S540AX-A-TRANSPOND-FAM-FZ       PIC X(010).
014564        20 S540AX-A-GFA                    PIC X(032).
014565        20 S540AX-A-ID-ZAHL                PIC X(002).
014566        20 S540AX-A-WERK                   PIC X(002).
014567        20 S540AX-A-SPJ                    PIC X(004).
014568        20 S540AX-A-KNR                    PIC X(007).
014569        20 S540AX-A-VIN-FZ-KLASSE          PIC X(002).
014570        20 S540AX-A-WFS-MARKE              PIC X(002).
014571        20 S540AX-A-PRNR-MOT               PIC X(003).
014572        20 S540AX-A-DATUM-ZP8              PIC X(010).
014573        20 S540AX-A-ZP8-NR                 PIC X(002).
014574        20 S540AX-A-KOMP-MASTER            PIC X(003).
014575        20 S540AX-A-WFS-MASTER             PIC X(003).
014576        20 S540AX-A-MODELL                 PIC X(008).
014577        20 S540AX-A-GFA-ZAHL               PIC X(002).
014578        20 S540AN-A-TEXT-SKC-ART           PIC S9(09) COMP.
014579        20 S540AN-A-TEXT-GFA-ART           PIC S9(09) COMP.
014580        20 S540AX-A-LABEL-SERIE-NR         PIC X(011).
014581        20 S540AX-A-GARNITUR-SERIE-NR      PIC X(023).
014582        20 S540AX-A-PIN-WERK               PIC X(002).
014583        20 S540AX-A-PIN-SPJ                PIC X(004).
014584        20 S540AX-A-PIN-KNR                PIC X(007).
014585     10 S540-A-I-FAHRZEUG.
014586        20 S540AN-A-I-PIN                  PIC S9(4) COMP.
014587        20 S540AN-A-I-SKC                  PIC S9(4) COMP.
014588        20 S540AN-A-I-TEXT-DRT-VERSION     PIC S9(4) COMP.
014589        20 S540AN-A-I-WFS-INHALT           PIC S9(4) COMP.
014590        20 S540AN-A-I-FSC                  PIC S9(4) COMP.
014591        20 S540AN-A-I-P-KLASSE             PIC S9(4) COMP.
014592        20 S540AN-A-I-TRANSPOND-FAM-FZ     PIC S9(4) COMP.
014593        20 S540AN-A-I-GFA                  PIC S9(4) COMP.
014594        20 S540AN-A-I-DATUM-ZP8            PIC S9(4) COMP.
014595        20 S540AN-A-I-TEXT-SKC-ART         PIC S9(4) COMP.
014596        20 S540AN-A-I-TEXT-GFA-ART         PIC S9(4) COMP.
014597*-----------------------------------------------------------------
014598     10 S540-A-TRANSPONDER.
014599        20 S540AN-A-TRANSPOND-STATUS       PIC S9(09) COMP.
014600        20 S540AX-A-BGRP                   PIC X(003).
014601        20 S540AX-A-TRANSPOND-TYP          PIC X(004).
014602        20 S540AX-A-TRANSPOND-FAM          PIC X(010).
014603        20 S540AX-A-USER-MEMORY            PIC X(256).
014604        20 S540AN-A-SKC0-KEY-TYP-ID        PIC S9(09) COMP.
014605        20 S540AN-A-SKC0-KEY-TYP-ID-ZAHL   PIC S9(09) COMP.
014606        20 S540AN-A-TRANSPOND-ID-ZAHL      PIC S9(09) COMP.
014607        20 S540AX-A-TRANSPOND-ID-ZAHL-HEX  PIC X(002).
014608        20 S540AX-A-PSS-VIN                PIC X(017).
014609        20 S540AN-A-PSS-FZ-ID-ZAHL         PIC S9(09) COMP.
014610        20 S540AX-A-PSS-KRYPTOREGION       PIC X(003).
014611        20 S540AX-A-PSS-BGRP               PIC X(003).
014612        20 S540AN-A-PSS-KEY-TYP-ID         PIC S9(09) COMP.
014613        20 S540AN-A-PSS-KEY-TYP-ID-ZAHL    PIC S9(09) COMP.
014614        20 S540AN-A-PSS-VKMS-KEY-AUF-VER   PIC S9(09) COMP.
014615        20 S540AX-A-TRANSPOND-DL4.
014616           25 S540AN-A-TRANSP-DL4-LEN      PIC S9(4) COMP.
014617           25 S540AX-A-TRANSP-DL4-TEXT     PIC X(2048).
014618*---------------------------------------------------------------
014619     10 S540-A-FRAESE.
014620        20 S540AX-A-FRAESE-ID              PIC X(010).
014621        20 S540AX-A-SERIE-NR               PIC X(008).
014622        20 S540AX-A-SKC-ALT                PIC X(032).
014623        20 S540AX-A-ID-ZAHL-ALT            PIC X(002).
014624        20 S540AX-A-SKC-NEU                PIC X(032).
014625        20 S540AX-A-ID-ZAHL-NEU            PIC X(002).
014626        20 S540AX-A-BEZEICHNUNG            PIC X(060).
014627        20 S540AX-A-BEMERKUNG.
014628           25 S540AN-A-BEMERKUNG-LEN       PIC S9(04) COMP.
014629           25 S540AX-A-BEMERKUNG-TEXT      PIC X(1000).
014630        20 S540AX-A-USER-BESTELLER         PIC X(012).
014631        20 S540AX-A-GUELTIG-BIS            PIC X(026).
014632        20 S540AX-A-AKTIV-KZ               PIC X(001).
014633        20 S540AX-A-USER-ID                PIC X(012).
014634        20 S540AX-A-BEARBEITET-AM          PIC X(026).
014635        20 S540AX-A-LIEFERANT-DUNS-NR      PIC X(011).
014636        20 S540AX-A-KENNUNG                PIC X(001).
014637        20 S540AX-A-HW-TEILE-NR            PIC X(030).
014638        20 S540AX-A-FRAESE-TYP             PIC X(001).
014639        20 S540AX-A-SHE-KZ                 PIC X(001).
014640        20 S540AX-A-HERGESTELLT-AM         PIC X(026).
014641        20 S540AX-A-VERSION-DATENSATZ      PIC X(002).
014642        20 S540AX-A-LOESCH-KZ              PIC X(001).
014643        20 S540AX-A-AKTIVIERUNG-KZ         PIC X(001).
014644*        -- Nur bei FE535B Aktion 06 nötig
014645        20 S540AX-A-FRAESUNG               PIC X(020).
014646*       -- BLOB ist 1MB (1.048.576 Byte)
014647        20 S540AX-A-DXF-DATEN    USAGE SQL TYPE IS BLOB-LOCATOR.
014648        20 S540AX-A-FRAESE-DOWNLOAD.
014649           25 S540AN-A-FRAESE-DL-LEN       PIC S9(4) COMP.
014650           25 S540AX-A-FRAESE-DL-TEXT      PIC X(2048).
014651*    -- Sonstige
014652     10 S540AX-A-SONSTIGE.
014653        20 S540AX-A-SCHLIESS-SATZ-NEU      PIC X(027).
014654     10 S540AX-A-RESERVE-4                 PIC X(100).
014655*-----------------------------------------------------------------
014656*    -- TABELLE FÜR AK-HINWEIS
014657     10 S540AN-A-TXVR-ANZAHL               PIC S9(4) COMP.
014658     10 S540-A-TXVRAX-BEREICH.
014659        20 S540-A-TXVRAX-FELDER OCCURS 20.
014660           25 S540-A-TXVRAN-TEXT-VERARB    PIC S9(9) COMP.
014661           25 S540-A-TXVRAN-TEXT-FEHL-KL   PIC S9(9) COMP.
014662*    -- TABELLE FÜR AK-TRANSPONDER
014663     10 S540AN-A-TXX4-ANZAHL               PIC S9(4) COMP.
014664     10 S540-A-TXX4AX-BEREICH.
014665        20 S540-A-TXX4AX-FELDER OCCURS 20.
014666           25 S540-A-TXX4AX-TRANSPOND-ID   PIC X(8).
014667           25 S540-A-TXX4AX-TRANSPOND-TYP  PIC X(4).
014668           25 S540-A-TXX4AN-TEXT-VERARB    PIC S9(9) COMP.
014669           25 S540-A-TXX4AN-TEXT-FEHL-KL   PIC S9(9) COMP.
014670*-----------------------------------------------------------------
014671     10 S540-A-GESAMTSTATUS.
014672        20 S540AN-A-TEXT-RC                PIC S9(9) COMP.
014673        20 S540AN-A-TEXT-FEHLER-KLASSE     PIC S9(9) COMP.
014674        20 S540AX-A-BESCHREIBUNG           PIC X(254).
014675        20 REDEFINES S540AX-A-BESCHREIBUNG.
014676           25 S540AX-A-PROGRAMM            PIC X(8).
014677           25 S540AX-A-SECTION             PIC X(26).
014678           25 S540AX-A-INFO                PIC X(220).
014679        20 S540AX-A-FEHLER-PARM.
014680           25 S540AN-A-FEHLER-PARM-LEN     PIC S9(4) COMP.
014681           25 S540AX-A-FEHLER-PARM-TEXT    PIC X(254).
014683*  PROBA PCOPYEND
016490
016500*----------------------------------------------------------------
016510* FE553B/C VKMS Symmetrischen Schlüssel ableiten vom Masterkey
016520*----------------------------------------------------------------
016530*PCOPY=FE553V00
016531*  PROBA PCOPYANF
016532*  PROBA MEMBER=FE553V00 CODE=UB21 AUTH=KOLMEDER-K TYPE=S
016533*  PROBA  STAND 12.09.2017(15.55) LAN=COB
016535******************************************************************
016536* FE553V Schnittstelle FE553
016537******************************************************************
016538 01  S553.
016539     05 s553-ein.
016540*       -- Aktionen
016541*       -- 01 : Schlüssel ableiten
016542        10 s553ax-aktion                      pic x(02).
016543        10 s553an-displaylevel                pic s9(9) comp.
016544        10 s553ax-stelle6-stdmodul            PIC X(01).
016545        10 s553ax-stelle6-cmodul              PIC X(01).
016546
016547        10 s553ax-vin                         PIC X(17).
016548        10 s553ax-kryptoregion                PIC x(03).
016549
016550        10 s553ax-domaene                     PIC x(03).
016551        10 s553ax-bgrp                        PIC X(03).
016552        10 s553an-keytype-id                  PIC S9(9) COMP.
016553        10 s553an-fz-id-zahl                  PIC S9(9) COMP.
016554        10 s553an-typanlernzaehler            PIC S9(9) COMP.
016555        10 s553an-stgindivi                   PIC S9(4) COMP.
016556        10 s553an-bytelen                     PIC S9(9) COMP.
016557
016558        10 s553an-aufvers-rein                PIC S9(9) COMP.
016559        10 s553ax-ipa-610-stage               pic x(01).
016560        10 s553ax-ipa-620-version             pic x(05).
016561
016562        10 s553ax-e-frei                      pic x(100).
016563
016564     05 s553-aus.
016565*       -- Ergebnisschlüssel
016566        10 s553an-key-len                     PIC S9(9) COMP.
016567        10 s553ax-key-wert                    PIC x(256).
016568
016569*       -- ermittelter Wert, ab der 1. Ableitung fix
016570        10 s553an-aufvers-ermittelt           PIC S9(9) COMP.
016571
016572*       -- ...
016573        10 s553ax-a-frei                      pic x(100).
016574
016575        10 s553-ergebnisstatus.
016576           20 s553an-text-rc                  pic s9(9) comp.
016577           20 s553an-text-fehler-klasse       pic s9(9) comp.
016578           20 s553ax-beschreibung             pic x(254).
016579           20 redefines s553ax-beschreibung.
016580              30 s553ax-programm              pic x(8).
016581              30 s553ax-section               pic x(26).
016582              30 s553ax-info                  pic x(220).
016583           20 s553ax-fehler-parm.
016584              30 s553an-fehler-parm-len       pic s9(4) comp.
016585              30 s553ax-fehler-parm-text      pic x(254).
016587*  PROBA PCOPYEND
017080
017090*-----------------------------------------------------------------
017100* FE560B Schlüsselrekonstruktion
017110*-----------------------------------------------------------------
017120*PCOPY=FE560V00
017121*  PROBA PCOPYANF
017122*  PROBA MEMBER=FE560V00 CODE=TB05 AUTH=KOLMEDER-K TYPE=S
017123*  PROBA  STAND 20.12.2017(13.17) LAN=COB
017125******************************************************************
017126* FE560V Schnittstelle FE560B
017127******************************************************************
017128 01  S560AX-AKTION                       PIC X(02).
017129 01  S560AX-USER-ID                      PIC X(12).
017130 01  S560AN-SPRACH-KZ                    PIC S9(9) COMP.
017131
017132 01  S560AX-VIN                          PIC X(17).
017133 01  S560AX-bgrp                         PIC X(03).
017134 01  S560AN-KEY-TYP-ID                   PIC S9(9) COMP.
017135 01  S560AX-DLC-UTC-V-ID                 PIC X(26).
017136
017137*    -- OUT
017138 01  S560AX-SCHLUESSELWERT-bin       SQL TYPE IS VARBINARY(2000).
017139 01  S560AX-SCHLUESSELWERT-char.
017140     49 S560AN-SCHLUESSELWERT-char-len   PIC S9(4) COMP.
017141     49 S560AX-SCHLUESSELWERT-char-tx    PIC X(4000).
017142
017143 01  S560AN-TEXT-RC                      PIC S9(9) COMP.
017144 01  S560AN-TEXT-FEHLER-KLASSE           PIC S9(9) COMP.
017145 01  S560AX-BESCHREIBUNG                 PIC X(254).
017146 01  REDEFINES S560AX-BESCHREIBUNG.
017147     10 S560AX-PROGRAMM                  PIC X(8).
017148     10 S560AX-SECTION                   PIC X(26).
017149     10 S560AX-INFO                      PIC X(220).
017150 01  S560AX-FEHLER-PARM.
017151     49 S560AN-FEHLER-PARM-LEN           PIC S9(4) COMP.
017152     49 S560AX-FEHLER-PARM-TEXT          PIC X(254).
017153
017154 01  S560AN-I-AKTION                     PIC S9(4) COMP.
017155 01  S560AN-I-USER-ID                    PIC S9(4) COMP.
017156 01  S560AN-I-SPRACH-KZ                  PIC S9(4) COMP.
017157
017158 01  S560AN-I-VIN                        PIC S9(4) COMP.
017159 01  S560AN-I-bgrp                       PIC S9(4) COMP.
017160 01  S560AN-I-KEY-TYP-ID                 PIC S9(4) COMP.
017161 01  S560AN-I-DLC-UTC-V-ID               PIC S9(4) COMP.
017162
017163 01  S560AN-I-SCHLUESSELWERT-bin         PIC S9(4) COMP.
017164 01  S560AN-I-SCHLUESSELWERT-char        PIC S9(4) COMP.
017165
017166 01  S560AN-I-TEXT-RC                    PIC S9(4) COMP.
017167 01  S560AN-I-TEXT-FEHLER-KLASSE         PIC S9(4) COMP.
017168 01  S560AN-I-BESCHREIBUNG               PIC S9(4) COMP.
017169 01  S560AN-I-FEHLER-PARM                PIC S9(4) COMP.
017171*  PROBA PCOPYEND
017610
017620*-----------------------------------------------------------------
017630* Fehlertext aufbereiten
017640*-----------------------------------------------------------------
017650*PCOPY=FE557V00
017651*  PROBA PCOPYANF
017652*  PROBA MEMBER=FE557V00 CODE=YB09 AUTH=KOLMEDER-K TYPE=S
017653*  PROBA  STAND  5.07.2017(13.34) LAN=COB
017655******************************************************************
017656* FE557V Schnittstelle FE557
017657******************************************************************
017658 01  S557.
017659     05 s557-ein.
017660*       -- 01 Aufbereiten Produktionsgerecht, Mldklasse übergeben
017661*       -- 02 Aufbereiten Tester/Web-gerecht, Mldklasse übergeben
017662*       -- 03 Aufbereiten Tester/Web-gerecht, Mldklasse übergeben
017663*       --               Fehlerparm wird angehängt
017664        10 s557ax-aktion                      pic x(02).
017665        10 s557ax-stelle6-stdmodul            PIC X(01).
017666        10 s557ax-stelle6-cmodul              PIC X(01).
017667        10 s557ax-user-id                     pic x(12).
017668        10 s557an-sprach-kz                   pic s9(9) comp.
017669        10 s557an-meldung-klasse              pic s9(4) comp.
017670
017671*       -- was aufbereitet werden soll:
017672        10 s557an-e-text-rc                   pic s9(9) comp.
017673        10 s557an-e-text-fehler-klasse        pic s9(9) comp.
017674        10 s557ax-e-beschreibung              pic x(254).
017675        10 redefines s557ax-e-beschreibung.
017676           15 s557ax-e-programm               pic x(8).
017677           15 s557ax-e-section                pic x(26).
017678           15 s557ax-e-info                   pic x(220).
017679        10 s557ax-e-fehler-parm.
017680           15 s557an-e-fehler-parm-len        pic s9(4) comp.
017681           15 s557ax-e-fehler-parm-text       pic x(254).
017682*       -- Variablen zum Ersetzen im Fehlertext
017683        10 s557ax-e-var-tab.
017684           15 s557an-e-var-tab-anzahl         pic s9(4) comp.
017685           15 s557ax-e-var-tab-text.
017686              20 s557ax-e-var-zeile occurs 5.
017687                 25 s557ax-e-var-name         pic x(20).
017688                 25 s557ax-e-var.
017689                    30 s557an-e-var-len       pic s9(4) comp.
017690                    30 s557ax-e-var-text      pic x(50).
017691
017692     05 s557-aus.
017693*       -- wenn FE557 selbst einen Fehler macht
017694*       -- gibt es nicht die übliche Fehlerinformation zurück
017695*       -- sondern in jedem Fall einen verwertbaren Text
017696
017697        10 s557ax-a-produktionstext.
017698           25 s557ax-a-prod-syskenn           pic x(3).
017699           25 s557an-a-prod-nummer            pic 9(5).
017700           25 s557ax-a-prod-trz               pic x(2).
017701           25 s557ax-a-prod-klartext          pic x(199).
017702
017703        10 s557ax-a-webtext.
017704           49 s557an-a-webtext-len            pic s9(4) comp.
017705           49 s557ax-a-webtext-text           pic x(1000).
017706        10 s557ax-a-sgrc                      pic x(10).
017708*  PROBA PCOPYEND
018210
018220*-----------------------------------------------------------------
018230* PCOPIES für die C-Module
018240*-----------------------------------------------------------------
018250*PCOPY=FE585V01,XXXX=S585
018251*  PROBA PCOPYANF
018252*  PROBA MEMBER=FE585V01 CODE=CC01 AUTH=FIEBIGER-T TYPE=S
018253*  PROBA  STAND 22.10.2020(11.07) LAN=COB
018255******************************************************************
018256* MEMBER: FE585V00                                FIRST: Juni 2019
018257* TITLE:  Schnittstelle C-Modul FE585B/D Wfs-6 - Ident-Daten
018258*                                                aufbereiten
018259* SA:     F3                                       SYS-NAME: FAZIT
018260* AUTHOR: Thomas Fiebiger, msg systems ag
018261*
018262* DESC:   Schnittstelle C-Modul FE585B/D Wfs-6 - Ident-Daten
018263* DESC:                                          aufbereiten
018264* DESC:   - jeder Parameter muss den Ende-Begrenzer x'00' für
018265* DESC:     String-Eingaben in C haben.
018266*-----------------------------------------------------------------
018267* MOD: 00 12.06.2019 Thomas Fiebiger, msg systems ag
018268* MOD:               Neuerstellung
018269* MOD: 01 22.10.2020 Thomas Fiebiger, msg systems ag
018270* MOD:               neu: STARTSKCLDATEN
018271******************************************************************
018272
018273* -- Eingabeparameter
018274
018275* -- Wegfahsperren Identifikations Daten             288*2 Zeichen
018276 01  S585-WFSIDENTDATA.
018277     10 S585AX-WFSIDENTDATA             PIC X(576).
018278     10 S585AX-WFSIDENTDATA-E           PIC X VALUE X'00'.
018279* -- Signatur Schlüssel, VKMS-KEY-ID 1009             16*2 Zeichen
018280 01  S585-WFSSIGKEY.
018281     10 S585AX-WFSSIGKEY                PIC X(32).
018282     10 S585AX-WFSSIGKEY-E              PIC X VALUE X'00'.
018283* -- Start-SKC aus den Lieferantendaten               16*2 Zeichen
018284 01  S585-STARTSKCLDATEN.
018285     10 S585AX-STARTSKCLDATEN           PIC X(32).
018286     10 S585AX-STARTSKCLDATEN-E         PIC X VALUE X'00'.
018287
018288* -- Ausgabeparameter
018289
018290* -- Version der WFSIdentifikationsDaten Dienst        1*2 Zeichen
018291 01  S585-VERSIONWFSIDENTDATEN.
018292     10 S585AX-VERSIONWFSIDENTDATEN     PIC X(2).
018293     10 S585AX-VERSIONWFSIDENTDATEN-E   PIC X VALUE X'00'.
018294* -- Trainingscounter des SIG-KEY                      2*2 Zeichen
018295 01  S585-TRAININGSCNT.
018296     10 S585AX-TRAININGSCNT             PIC X(4).
018297     10 S585AX-TRAININGSCNT-E           PIC X VALUE X'00'.
018298* -- Fazit SN                                           23 Zeichen
018299 01  S585-FAZITID.
018300     10 S585AX-FAZITID                  PIC X(23).
018301     10 S585AX-FAZITID-E                PIC X VALUE X'00'.
018302* -- Version von TransponderAktuell Dienst             1*2 Zeichen
018303 01  S585-TRANSPONDERVERSION.
018304     10 S585AX-TRANSPONDERVERSION       PIC X(2).
018305     10 S585AX-TRANSPONDERVERSION-E     PIC X VALUE X'00'.
018306* -- Transponder ID                                    4*2 Zeichen
018307 01  S585-TRANSPONDERID.
018308     10 S585AX-TRANSPONDERID            PIC X(8).
018309     10 S585AX-TRANSPONDERID-E          PIC X VALUE X'00'.
018310* -- BatterieStatus                                    1*2 Zeichen
018311 01  S585-BATTERYSTATUS.
018312     10 S585AX-BATTERYSTATUS            PIC X(2).
018313     10 S585AX-BATTERYSTATUS-E          PIC X VALUE X'00'.
018314* -- aktueller Traningscounter                         2*2 Zeichen
018315 01  S585-TRAININGCOUNTER.
018316     10 S585AX-TRAININGCOUNTER          PIC X(4).
018317     10 S585AX-TRAININGCOUNTER-E        PIC X VALUE X'00'.
018318* -- errechnete MAC                                    4*2 Zeichen
018319 01  S585-MAC.
018320     10 S585AX-MAC                      PIC X(8).
018321     10 S585AX-MAC-E                    PIC X VALUE X'00'.
018322* -- SchlüsselStatus                                   1*2 Zeichen
018323 01  S585-KEYFOBSTATUS.
018324     10 S585AX-KEYFOBSTATUS             PIC X(2).
018325     10 S585AX-KEYFOBSTATUS-E           PIC X VALUE X'00'.
018326* -- Version vom Challenge Dienst                      1*2 Zeichen
018327 01  S585-CHALLENGEVERSION.
018328     10 S585AX-CHALLENGEVERSION         PIC X(2).
018329     10 S585AX-CHALLENGEVERSION-E       PIC X VALUE X'00'.
018330* -- Challenge vom Steuergerät                        16*2 Zeichen
018331 01  S585-CHALLENGE.
018332     10 S585AX-CHALLENGE                PIC X(32).
018333     10 S585AX-CHALLENGE-E              PIC X VALUE X'00'.
018334* -- Fahrgestellnummer aus Steuergerät                  17 Zeichen
018335 01  S585-VIN.
018336     10 S585AX-VIN                      PIC X(17).
018337     10 S585AX-VIN-E                    PIC X VALUE X'00'.
018338* -- Version vom Status Konfigurations Dienst          1*2 Zeichen
018339 01  S585-STATUSKONFIGVERSION.
018340     10 S585AX-STATUSKONFIGVERSION      PIC X(2).
018341     10 S585AX-STATUSKONFIGVERSION-E    PIC X VALUE X'00'.
018342* -- akt. Lebenszustand                                1*2 Zeichen
018343 01  S585-LEBENSZUSTAND.
018344     10 S585AX-LEBENSZUSTAND            PIC X(2).
018345     10 S585AX-LEBENSZUSTAND-E          PIC X VALUE X'00'.
018346* -- P-Klasse                                          1*2 Zeichen
018347 01  S585-PKLASSE.
018348     10 S585AX-PKLASSE                  PIC X(2).
018349     10 S585AX-PKLASSE-E                PIC X VALUE X'00'.
018350* -- Anzahl angelernter KeyFobs                        1*2 Zeichen
018351 01  S585-ANGELERNTESCHLUESSEL.
018352     10 S585AX-ANGELERNTESCHLUESSEL     PIC X(2).
018353     10 S585AX-ANGELERNTESCHLUESSEL-E   PIC X VALUE X'00'.
018354* -- Anzahl noch anzulernender Schlüssel               1*2 Zeichen
018355 01  S585-ANZULERNENSCHLUESSEL.
018356     10 S585AX-ANZULERNENSCHLUESSEL     PIC X(2).
018357     10 S585AX-ANZULERNENSCHLUESSEL-E   PIC X VALUE X'00'.
018358* -- verbleibende Restzeit für Kl.15ein nach Login     1*2 Zeichen
018359 01  S585-LOGINKL15ANRESTZEIT.
018360     10 S585AX-LOGINKL15ANRESTZEIT      PIC X(2).
018361     10 S585AX-LOGINKL15ANRESTZEIT-E    PIC X VALUE X'00'.
018362* -- Status Debug Services                             1*2 Zeichen
018363 01  S585-STATUSDEBUGSERVICE.
018364     10 S585AX-STATUSDEBUGSERVICE       PIC X(2).
018365     10 S585AX-STATUSDEBUGSERVICE-E     PIC X VALUE X'00'.
018366* -- Reserve                                           4*2 Zeichen
018367 01  S585-RESERVE-1.
018368     10 S585AX-RESERVE-1                PIC X(8).
018369     10 S585AX-RESERVE-1-E              PIC X VALUE X'00'.
018370* -- Version vom Status Kommunikations Dienst          1*2 Zeichen
018371 01  S585-STATUSKOMMVERSION.
018372     10 S585AX-STATUSKOMMVERSION        PIC X(2).
018373     10 S585AX-STATUSKOMMVERSION-E      PIC X VALUE X'00'.
018374* -- Status der Klemmenaktivierung                     2*2 Zeichen
018375 01  S585-STATUSKLEMMAKTIV.
018376     10 S585AX-STATUSKLEMMAKTIV         PIC X(4).
018377     10 S585AX-STATUSKLEMMAKTIV-E       PIC X VALUE X'00'.
018378* -- Status WFS-Master                                 1*2 Zeichen
018379 01  S585-IMMOBILIZERSTATUS.
018380     10 S585AX-IMMOBILIZERSTATUS        PIC X(2).
018381     10 S585AX-IMMOBILIZERSTATUS-E      PIC X VALUE X'00'.
018382* -- Status MSG1/LE4                                   1*2 Zeichen
018383 01  S585-MSG1LE4STATUS.
018384     10 S585AX-MSG1LE4STATUS            PIC X(2).
018385     10 S585AX-MSG1LE4STATUS-E          PIC X VALUE X'00'.
018386* -- Status MSG2/LE3                                   1*2 Zeichen
018387 01  S585-MSG2LE3STATUS.
018388     10 S585AX-MSG2LE3STATUS            PIC X(2).
018389     10 S585AX-MSG2LE3STATUS-E          PIC X VALUE X'00'.
018390* -- Status MSG3/LE2                                   1*2 Zeichen
018391 01  S585-MSG3LE2STATUS.
018392     10 S585AX-MSG3LE2STATUS            PIC X(2).
018393     10 S585AX-MSG3LE2STATUS-E          PIC X VALUE X'00'.
018394* -- Status MSG4/LE1                                   1*2 Zeichen
018395 01  S585-MSG4LE1STATUS.
018396     10 S585AX-MSG4LE1STATUS            PIC X(2).
018397     10 S585AX-MSG4LE1STATUS-E          PIC X VALUE X'00'.
018398* -- Status Getriebe                                   1*2 Zeichen
018399 01  S585-GSGSTATUS.
018400     10 S585AX-GSGSTATUS                PIC X(2).
018401     10 S585AX-GSGSTATUS-E              PIC X VALUE X'00'.
018402* -- Status ELV                                        1*2 Zeichen
018403 01  S585-ELVSTATUS.
018404     10 S585AX-ELVSTATUS                PIC X(2).
018405     10 S585AX-ELVSTATUS-E              PIC X VALUE X'00'.
018406* -- Status VTS                                        1*2 Zeichen
018407 01  S585-VTSSTATUS.
018408     10 S585AX-VTSSTATUS                PIC X(2).
018409     10 S585AX-VTSSTATUS-E              PIC X VALUE X'00'.
018410* -- Status Parksperre                                 1*2 Zeichen
018411 01  S585-PARKSPERRESTATUS.
018412     10 S585AX-PARKSPERRESTATUS         PIC X(2).
018413     10 S585AX-PARKSPERRESTATUS-E       PIC X VALUE X'00'.
018414* -- Reserve                                           5*2 Zeichen
018415 01  S585-RESERVE-2.
018416     10 S585AX-RESERVE-2                PIC X(10).
018417     10 S585AX-RESERVE-2-E              PIC X VALUE X'00'.
018418* -- Version vom TimeStamp Dienst                      1*2 Zeichen
018419 01  S585-VERSIONTIMESTAMP.
018420     10 S585AX-VERSIONTIMESTAMP         PIC X(2).
018421     10 S585AX-VERSIONTIMESTAMP-E       PIC X VALUE X'00'.
018422* -- Zeitpunkt letzter VKMS DLD                        4*2 Zeichen
018423 01  S585-LETZTEVKMSDLD.
018424     10 S585AX-LETZTEVKMSDLD            PIC X(8).
018425     10 S585AX-LETZTEVKMSDLD-E          PIC X VALUE X'00'.
018426* -- Zeitpunkt letzter Login                           4*2 Zeichen
018427 01  S585-LETZTELOGIN.
018428     10 S585AX-LETZTELOGIN              PIC X(8).
018429     10 S585AX-LETZTELOGIN-E            PIC X VALUE X'00'.
018430* -- Zeitpunkt letzter DL4/5                           4*2 Zeichen
018431 01  S585-LETZTERSCHLUESSELDLD.
018432     10 S585AX-LETZTERSCHLUESSELDLD     PIC X(8).
018433     10 S585AX-LETZTERSCHLUESSELDLD-E   PIC X VALUE X'00'.
018434* -- Version vom KeyFobTable Dienst                    1*2 Zeichen
018435 01  S585-KEYFOBTABLEVERSION.
018436     10 S585AX-KEYFOBTABLEVERSION       PIC X(2).
018437     10 S585AX-KEYFOBTABLEVERSION-E     PIC X VALUE X'00'.
018438* -- KeyFob Table                                    128*2 Zeichen
018439 01  S585-KEYFOBTABLE.
018440     10 S585AX-KEYFOBTABLE              PIC X(256).
018441     10 S585AX-KEYFOBTABLE-E            PIC X VALUE X'00'.
018442* -- Reserve                                          13*2 Zeichen
018443 01  S585-RESERVE-3.
018444     10 S585AX-RESERVE-3                PIC X(26).
018445     10 S585AX-RESERVE-3-E              PIC X VALUE X'00'.
018446* -- Fazit/VKMS Challenge                             16*2 Zeichen
018447 01  S585-FAZITCHALLENGE.
018448     10 S585AX-FAZITCHALLENGE           PIC X(32).
018449     10 S585AX-FAZITCHALLENGE-E         PIC X VALUE X'00'.
018450* -- MAC über WFSIdentifikationsdaten                 16*2 Zeichen
018451 01  S585-WFSIDENTDATENMAC.
018452     10 S585AX-WFSIDENTDATENMAC         PIC X(32).
018453     10 S585AX-WFSIDENTDATENMAC-E       PIC X VALUE X'00'.
018454* -- vom Modul errechnete MAC über Daten              16*2 Zeichen
018455 01  S585-WFSIDENTDATENMACCALC.
018456     10 S585AX-WFSIDENTDATENMACCALC     PIC X(32).
018457     10 S585AX-WFSIDENTDATENMACCALC-E   PIC X VALUE X'00'.
018458* -- Status vom CryptModule                            2*2 Zeichen
018459 01  S585-ERROR.
018460     10 S585AX-ERROR                    PIC X(4).
018461     10 S585AX-ERROR-E                  PIC X VALUE X'00'.
018463*  PROBA PCOPYEND
020360
020370*PCOPY=FE587V00,XXXX=S587
020371*  PROBA PCOPYANF
020372*  PROBA MEMBER=FE587V00 CODE=CC10 AUTH=FIEBIGER-T TYPE=S
020373*  PROBA  STAND 27.06.2019(15.40) LAN=COB
020375******************************************************************
020376* MEMBER: FE587V00                                FIRST: Juni 2019
020377* TITLE:  Schnittstelle C-Modul FE587B/D Wfs-6 - GetStat-Daten
020378*                                                prüfen
020379* SA:     F3                                       SYS-NAME: FAZIT
020380* AUTHOR: Thomas fiebiger, msg systems ag
020381*
020382* DESC:   Schnittstelle C-Modul FE587B/D Wfs-6 - GetStat-Daten
020383* DESC:                                          prüfen
020384* DESC:   - jeder Parameter muss den Ende-Begrenzer x'00' für
020385* DESC:     String-Eingaben in C haben.
020386*-----------------------------------------------------------------
020387* MOD: 00 12.06.2019 Thomas Fiebiger, msg systems ag
020388* MOD:               Neuerstellung
020389******************************************************************
020390
020391* -- Eingabeparameter
020392
020393* -- aktuellen Start-SKC bzw. PSS, VKMS-KEY-ID 10x9,    32 Zeichen
020394 01  S587-PSS.
020395     10 S587AX-PSS                      PIC X(32).
020396     10 S587AX-PSS-E                    PIC X VALUE X'00'.
020397* -- Version von TransponderAktuell Dienst             1*2 Zeichen
020398 01  S587-VERSION.
020399     10 S587AX-VERSION                  PIC X(2).
020400     10 S587AX-VERSION-E                PIC X VALUE X'00'.
020401* -- Transponder ID, 8 Zeichen                         4*2 Zeichen
020402 01  S587-TRANSPONDERID.
020403     10 S587AX-TRANSPONDERID            PIC X(8).
020404     10 S587AX-TRANSPONDERID-E          PIC X VALUE X'00'.
020405* -- BatterieStatus, 2 Zeichen                         1*2 Zeichen
020406 01  S587-BATTERYSTATUS.
020407     10 S587AX-BATTERYSTATUS            PIC X(2).
020408     10 S587AX-BATTERYSTATUS-E          PIC X VALUE X'00'.
020409* -- aktueller Traningscounter                         2*2 Zeichen
020410 01  S587-TRAININGCOUNTER.
020411     10 S587AX-TRAININGCOUNTER          PIC X(4).
020412     10 S587AX-TRAININGCOUNTER-E        PIC X VALUE X'00'.
020413* -- errechnete MAC                                    4*2 Zeichen
020414 01  S587-MAC.
020415     10 S587AX-MAC                      PIC X(8).
020416     10 S587AX-MAC-E                    PIC X VALUE X'00'.
020417
020418* -- Ausgabeparameter
020419
020420* -- errechnete MAC                                    4*2 Zeichen
020421 01  S587-MACCALC.
020422     10 S587AX-MACCALC                  PIC X(8).
020423     10 S587AX-MACCALC-E                PIC X VALUE X'00'.
020424* -- FehlerStatus                                      2*2 Zeichen
020425 01  S587-ERROR.
020426     10 S587AX-ERROR                    PIC X(4).
020427     10 S587AX-ERROR-E                  PIC X VALUE X'00'.
020429*  PROBA PCOPYEND
020940
020950*PCOPY=FE589V00,XXXX=S589
020951*  PROBA PCOPYANF
020952*  PROBA MEMBER=FE589V00 CODE=EC09 AUTH=FIEBIGER-T TYPE=S
020953*  PROBA  STAND 27.06.2019(16.00) LAN=COB
020955******************************************************************
020956* MEMBER: FE589V00                                FIRST: Juni 2019
020957* TITLE:  Schnittstelle C-Modul FE589B/D Wfs-6 - KeyTable zerlegen
020958* SA:     F3                                       SYS-NAME: FAZIT
020959* AUTHOR: Thomas Fiebiger, msg systems ag
020960*
020961* DESC:   Schnittstelle C-Modul FE589B/D Wfs-6 - KeyTable zerlegen
020962* DESC:   - jeder Parameter muss den Ende-Begrenzer x'00' für
020963* DESC:     String-Eingaben in C haben.
020964*-----------------------------------------------------------------
020965* MOD: 00 12.06.2019 Thomas Fiebiger, msg systems ag
020966* MOD:               Neuerstellung
020967******************************************************************
020968
020969* -- Eingabeparameter
020970
020971* -- KeyFobTableVersion                                1*2 Zeichen
020972 01  S589-KEYFOBTABLEVERSION.
020973     10 S589AX-KEYFOBTABLEVERSION       PIC X(2).
020974     10 S589AX-KEYFOBTABLEVERSION-E     PIC X VALUE X'00'.
020975* -- KeyFobTable                                     128*2 Zeichen
020976 01  S589-KEYFOBTABLE.
020977     10 S589AX-KEYFOBTABLE              PIC X(256).
020978     10 S589AX-KEYFOBTABLE-E            PIC X VALUE X'00'.
020979
020980* -- Ausgabeparameter
020981
020982* -- Status von KeyFob-1                               1*2 Zeichen
020983 01  S589-STATUS-1.
020984     10 S589AX-STATUS-1                 PIC X(2).
020985     10 S589AX-STATUS-1-E               PIC X VALUE X'00'.
020986* -- TransponderID von KeyFob-1                        4*2 Zeichen
020987 01  S589-TRANSPONDERID-1.
020988     10 S589AX-TRANSPONDERID-1          PIC X(8).
020989     10 S589AX-TRANSPONDERID-1-E        PIC X VALUE X'00'.
020990* -- TrainingsCounter von KeyFob-1                     2*2 Zeichen
020991 01  S589-TRAININGCOUNTER-1.
020992     10 S589AX-TRAININGCOUNTER-1        PIC X(4).
020993     10 S589AX-TRAININGCOUNTER-1-E      PIC X VALUE X'00'.
020994* -- SchlüsselTyp von KeyFob-1                         1*2 Zeichen
020995 01  S589-SCHLUESSELTYP-1.
020996     10 S589AX-SCHLUESSELTYP-1          PIC X(2).
020997     10 S589AX-SCHLUESSELTYP-1-E        PIC X VALUE X'00'.
020998* -- Reserve Bytes für KeyFob-1                        8*2 Zeichen
020999 01  S589-RESERVE-1.
021000     10 S589AX-RESERVE-1                PIC X(16).
021001     10 S589AX-RESERVE-1-E              PIC X VALUE X'00'.
021002* -- Status von KeyFob-2                               1*2 Zeichen
021003 01  S589-STATUS-2.
021004     10 S589AX-STATUS-2                 PIC X(2).
021005     10 S589AX-STATUS-2-E               PIC X VALUE X'00'.
021006* -- TransponderID von KeyFob-2                        4*2 Zeichen
021007 01  S589-TRANSPONDERID-2.
021008     10 S589AX-TRANSPONDERID-2          PIC X(8).
021009     10 S589AX-TRANSPONDERID-2-E        PIC X VALUE X'00'.
021010* -- TrainingsCounter von KeyFob-2                     2*2 Zeichen
021011 01  S589-TRAININGCOUNTER-2.
021012     10 S589AX-TRAININGCOUNTER-2        PIC X(4).
021013     10 S589AX-TRAININGCOUNTER-2-E      PIC X VALUE X'00'.
021014* -- SchlüsselTyp von KeyFob-2                         1*2 Zeichen
021015 01  S589-SCHLUESSELTYP-2.
021016     10 S589AX-SCHLUESSELTYP-2          PIC X(2).
021017     10 S589AX-SCHLUESSELTYP-2-E        PIC X VALUE X'00'.
021018* -- Reserve Bytes für KeyFob-2                        8*2 Zeichen
021019 01  S589-RESERVE-2.
021020     10 S589AX-RESERVE-2                PIC X(16).
021021     10 S589AX-RESERVE-2-E              PIC X VALUE X'00'.
021022* -- Status von KeyFob-3                               1*2 Zeichen
021023 01  S589-STATUS-3.
021024     10 S589AX-STATUS-3                 PIC X(2).
021025     10 S589AX-STATUS-3-E               PIC X VALUE X'00'.
021026* -- TransponderID von KeyFob-3                        4*2 Zeichen
021027 01  S589-TRANSPONDERID-3.
021028     10 S589AX-TRANSPONDERID-3          PIC X(8).
021029     10 S589AX-TRANSPONDERID-3-E        PIC X VALUE X'00'.
021030* -- TrainingsCounter von KeyFob-3                     2*2 Zeichen
021031 01  S589-TRAININGCOUNTER-3.
021032     10 S589AX-TRAININGCOUNTER-3        PIC X(4).
021033     10 S589AX-TRAININGCOUNTER-3-E      PIC X VALUE X'00'.
021034* -- SchlüsselTyp von KeyFob-3                         1*2 Zeichen
021035 01  S589-SCHLUESSELTYP-3.
021036     10 S589AX-SCHLUESSELTYP-3          PIC X(2).
021037     10 S589AX-SCHLUESSELTYP-3-E        PIC X VALUE X'00'.
021038* -- Reserve Bytes für KeyFob-3                        8*2 Zeichen
021039 01  S589-RESERVE-3.
021040     10 S589AX-RESERVE-3                PIC X(16).
021041     10 S589AX-RESERVE-3-E              PIC X VALUE X'00'.
021042* -- Status von KeyFob-4                               1*2 Zeichen
021043 01  S589-STATUS-4.
021044     10 S589AX-STATUS-4                 PIC X(2).
021045     10 S589AX-STATUS-4-E               PIC X VALUE X'00'.
021046* -- TransponderID von KeyFob-4                        4*2 Zeichen
021047 01  S589-TRANSPONDERID-4.
021048     10 S589AX-TRANSPONDERID-4          PIC X(8).
021049     10 S589AX-TRANSPONDERID-4-E        PIC X VALUE X'00'.
021050* -- TrainingsCounter von KeyFob-4                     2*2 Zeichen
021051 01  S589-TRAININGCOUNTER-4.
021052     10 S589AX-TRAININGCOUNTER-4        PIC X(4).
021053     10 S589AX-TRAININGCOUNTER-4-E      PIC X VALUE X'00'.
021054* -- SchlüsselTyp von KeyFob-4                         1*2 Zeichen
021055 01  S589-SCHLUESSELTYP-4.
021056     10 S589AX-SCHLUESSELTYP-4          PIC X(2).
021057     10 S589AX-SCHLUESSELTYP-4-E        PIC X VALUE X'00'.
021058* -- Reserve Bytes für KeyFob-4                        8*2 Zeichen
021059 01  S589-RESERVE-4.
021060     10 S589AX-RESERVE-4                PIC X(16).
021061     10 S589AX-RESERVE-4-E              PIC X VALUE X'00'.
021062* -- Status von KeyFob-5                               1*2 Zeichen
021063 01  S589-STATUS-5.
021064     10 S589AX-STATUS-5                 PIC X(2).
021065     10 S589AX-STATUS-5-E               PIC X VALUE X'00'.
021066* -- TransponderID von KeyFob-5                        4*2 Zeichen
021067 01  S589-TRANSPONDERID-5.
021068     10 S589AX-TRANSPONDERID-5          PIC X(8).
021069     10 S589AX-TRANSPONDERID-5-E        PIC X VALUE X'00'.
021070* -- TrainingsCounter von KeyFob-5                     2*2 Zeichen
021071 01  S589-TRAININGCOUNTER-5.
021072     10 S589AX-TRAININGCOUNTER-5        PIC X(4).
021073     10 S589AX-TRAININGCOUNTER-5-E      PIC X VALUE X'00'.
021074* -- SchlüsselTyp von KeyFob-5                         1*2 Zeichen
021075 01  S589-SCHLUESSELTYP-5.
021076     10 S589AX-SCHLUESSELTYP-5          PIC X(2).
021077     10 S589AX-SCHLUESSELTYP-5-E        PIC X VALUE X'00'.
021078* -- Reserve Bytes für KeyFob-5                        8*2 Zeichen
021079 01  S589-RESERVE-5.
021080     10 S589AX-RESERVE-5                PIC X(16).
021081     10 S589AX-RESERVE-5-E              PIC X VALUE X'00'.
021082* -- Status von KeyFob-6                               1*2 Zeichen
021083 01  S589-STATUS-6.
021084     10 S589AX-STATUS-6                 PIC X(2).
021085     10 S589AX-STATUS-6-E               PIC X VALUE X'00'.
021086* -- TransponderID von KeyFob-6                        4*2 Zeichen
021087 01  S589-TRANSPONDERID-6.
021088     10 S589AX-TRANSPONDERID-6          PIC X(8).
021089     10 S589AX-TRANSPONDERID-6-E        PIC X VALUE X'00'.
021090* -- TrainingsCounter von KeyFob-6                     2*2 Zeichen
021091 01  S589-TRAININGCOUNTER-6.
021092     10 S589AX-TRAININGCOUNTER-6        PIC X(4).
021093     10 S589AX-TRAININGCOUNTER-6-E      PIC X VALUE X'00'.
021094* -- SchlüsselTyp von KeyFob-6                         1*2 Zeichen
021095 01  S589-SCHLUESSELTYP-6.
021096     10 S589AX-SCHLUESSELTYP-6          PIC X(2).
021097     10 S589AX-SCHLUESSELTYP-6-E        PIC X VALUE X'00'.
021098* -- Reserve Bytes für KeyFob-6                        8*2 Zeichen
021099 01  S589-RESERVE-6.
021100     10 S589AX-RESERVE-6                PIC X(16).
021101     10 S589AX-RESERVE-6-E              PIC X VALUE X'00'.
021102* -- Status von KeyFob-7                               1*2 Zeichen
021103 01  S589-STATUS-7.
021104     10 S589AX-STATUS-7                 PIC X(2).
021105     10 S589AX-STATUS-7-E               PIC X VALUE X'00'.
021106* -- TransponderID von KeyFob-7                        4*2 Zeichen
021107 01  S589-TRANSPONDERID-7.
021108     10 S589AX-TRANSPONDERID-7          PIC X(8).
021109     10 S589AX-TRANSPONDERID-7-E        PIC X VALUE X'00'.
021110* -- TrainingsCounter von KeyFob-7                     2*2 Zeichen
021111 01  S589-TRAININGCOUNTER-7.
021112     10 S589AX-TRAININGCOUNTER-7        PIC X(4).
021113     10 S589AX-TRAININGCOUNTER-7-E      PIC X VALUE X'00'.
021114* -- SchlüsselTyp von KeyFob-7                         1*2 Zeichen
021115 01  S589-SCHLUESSELTYP-7.
021116     10 S589AX-SCHLUESSELTYP-7          PIC X(2).
021117     10 S589AX-SCHLUESSELTYP-7-E        PIC X VALUE X'00'.
021118* -- Reserve Bytes für KeyFob-7                        8*2 Zeichen
021119 01  S589-RESERVE-7.
021120     10 S589AX-RESERVE-7                PIC X(16).
021121     10 S589AX-RESERVE-7-E              PIC X VALUE X'00'.
021122* -- Status von KeyFob-8                               1*2 Zeichen
021123 01  S589-STATUS-8.
021124     10 S589AX-STATUS-8                 PIC X(2).
021125     10 S589AX-STATUS-8-E               PIC X VALUE X'00'.
021126* -- TransponderID von KeyFob-8                        4*2 Zeichen
021127 01  S589-TRANSPONDERID-8.
021128     10 S589AX-TRANSPONDERID-8          PIC X(8).
021129     10 S589AX-TRANSPONDERID-8-E        PIC X VALUE X'00'.
021130* -- TrainingsCounter von KeyFob-8                     2*2 Zeichen
021131 01  S589-TRAININGCOUNTER-8.
021132     10 S589AX-TRAININGCOUNTER-8        PIC X(4).
021133     10 S589AX-TRAININGCOUNTER-8-E      PIC X VALUE X'00'.
021134* -- SchlüsselTyp von KeyFob-8                         1*2 Zeichen
021135 01  S589-SCHLUESSELTYP-8.
021136     10 S589AX-SCHLUESSELTYP-8          PIC X(2).
021137     10 S589AX-SCHLUESSELTYP-8-E        PIC X VALUE X'00'.
021138* -- Reserve Bytes für KeyFob-8                        8*2 Zeichen
021139 01  S589-RESERVE-8.
021140     10 S589AX-RESERVE-8                PIC X(16).
021141     10 S589AX-RESERVE-8-E              PIC X VALUE X'00'.
021142* -- FehlerStatus                                      2*2 Zeichen
021143 01  S589-ERROR.
021144     10 S589AX-ERROR                    PIC X(4).
021145     10 S589AX-ERROR-E                  PIC X VALUE X'00'.
021147*  PROBA PCOPYEND
022900
022910*-----------------------------------------------------------------
022920* SCHNITTSTELLE FE01T05 FAZIT-BGRP
022930*-----------------------------------------------------------------
022940 01  S775-DATEN.
022950*PCOPY=FE775V06,XXXX=S775
022951*  PROBA PCOPYANF
022952*  PROBA MEMBER=FE775V06 CODE=NC04 AUTH=HELLINGER- TYPE=S
022953*  PROBA  STAND 31.07.2013(10.36) LAN=COB
022955******************************************************************
022956* MEMBER: FE775V                                  FIRST: JULI 2001
022957* TITLE:  UNTERPROGRAMM: INSERT FE01T05 BAUGRUPPE
022958* SA:     F3                                       SYS-NAME: FAZIT
022959* AUTHOR: THOMAS FIEBIGER, MSG SYSTEME GMBH
022960*
022961* DESC:   SCHNITTSTELLE FÜR PROGRAMM FE775B
022962*
022963* PCOPY:  FEPARM01 PARAMETER- UND FEHLERBEREICH FÜR FAZIT-SCHNITT-
022964*                  STELLEN
022965*-----------------------------------------------------------------
022966* MOD: 00 01.07.2001 THOMAS FIEBIGER, MSG SYSTEME GMBH
022967* MOD:               - NEUERSTELLUNG
022968* MOD: 01 31.01.2002 THOMAS FIEBIGER, MSG SYSTEMS AG
022969* MOD:               - NEUE COLUMNS PIN UND SKC
022970* MOD: 02 26.05.2003 THOMAS FIEBIGER, MSG SYSTEMS AG
022971* MOD:               - COLUMN SKC: NEUE LÄNGE=32
022972* MOD:               - NEUE COLUMN IKA
022973* MOD:               - NEUE COLUMN KOMP-S-TYP
022974* MOD: 03 19.04.2005 KONRAD KOLMEDER, MSG SYSTEMS AG
022975* MOD:               - COLUMN SKC: NEUE LÄNGE=64
022976* MOD:               - TRENNEN BGRP-FAM BGRP-INHALT
022977* MOD:               - NEUE COLUMN RUECKKANAL
022978* MOD: 04 17.04.2007 RAINER GEIER, MSG SYSTEMS AG
022979* MOD:               - COLUMN SKC: NEUE LÄNGE=96
022980* MOD: 05 07.10.2011 THOMAS FIEBIGER, MSG SYSTEMS AG
022981* MOD:               - NEUE COLUMN MEK
022982* MOD:               - NEUE COLUMN WFS-SHE-KZ
022983* MOD:               - NEUE COLUMN KOMP-SHE-KZ
022984* MOD:               - NEUE COLUMN KOMP-GFA-KZ
022985* MOD:               - NEUE COLUMN BGRP-CHECKSUM-V
022986* MOD:               - NEUE COLUMN TRANSPOND-CHECKSUM-V
022987* MOD: 06 02.07.2013 WOLFGANG HELLINGER, MSG SYSTEMS AG
022988* MOD:               ÄA-186 GEHEIMNISABLEITUNG
022989* MOD:               - NEUE COLUMN IKA-ZAHL
022990* MOD:               - NEUE COLUMN MEK-ZAHL
022991* MOD:               - NEUE COLUMN TEXT-IKA-ART
022992* MOD:               - NEUE COLUMN TEXT-MEK-ART
022993******************************************************************
022994*PCOPY=FEPARM01,YYYY=S775
022995*  PROBA PCOPYANF
022996*  PROBA MEMBER=FEPARM01 CODE=JW05 AUTH=FIEBIGER-T TYPE=S
022997*  PROBA  STAND 15.02.2011(18.27) LAN=COB
022999******************************************************************
023000* MEMBER: FEPARM01                            FIRST: Dezember 2010
023001* TITLE:  Parameter- und Fehlerbereich für Fazit-Schnittstellen
023002* SA:     F3                                       SYS-NAME: FAZIT
023003* AUTHOR: Thomas Fiebiger, msg systems ag
023004*
023005* DESC:   Parameter- und Fehlerbereich für Fazit-Schnittstellen
023006*-----------------------------------------------------------------
023007* MOD: 01 28.12.2010 Thomas Fiebiger, msg systems ag
023008* MOD:               Neuerstellung
023009******************************************************************
023010
023011* -- Übergabeparameter
023012     03 S775-PARAMETER.
023013*       -- Vergleichskennzeichen:
023014*       --          'N'  => kein Vergleich
023015*       --         sonst => Vergleich mit letztem Tabellen-Eintrag
023016        10 S775AX-VGL-KZ              PIC X.
023017
023018* -- Rückgabeparameter
023019     03 S775-FEHLER.
023020        10 S775AN-TEXT-RC             PIC S9(9) COMP.
023021        10 S775AN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
023022        10 S775AX-BESCHREIBUNG.
023023           15 S775AX-PROGRAMM         PIC X(8).
023024           15 S775AX-SECTION          PIC X(26).
023025           15 S775AX-INFO             PIC X(220).
023026        10 S775AX-FEHLER-PARM.
023027           49 S775AN-FEHLER-PARM-LEN  PIC S9(4) COMP.
023028           49 S775AX-FEHLER-PARM-TEXT PIC X(254).
023029        10 S775AX-SQLCA               PIC X(136).
023031*  PROBA PCOPYEND
023032******************************************************************
023033* COBOL DECLARATION FOR TABLE FE01T05 FZ-BAUGRUPPE               *
023034******************************************************************
023035     03 S775-DCLFE01T05.
023036        10 S775AX-V-ID                 PIC X(26).
023037        10 S775AX-BGRP                 PIC X(3).
023038        10 S775AX-VIN                  PIC X(17).
023039        10 S775AX-BGRP-FAM             PIC X(3).
023040        10 S775AX-BGRP-INHALT          PIC X(27).
023041        10 S775AX-LOESCH-KZ            PIC X.
023042        10 S775AX-PIN                  PIC X(4).
023043        10 S775AX-SKC                  PIC X(96).
023044        10 S775AX-IKA                  PIC X(32).
023045        10 S775AX-KOMP-S-TYP           PIC X(4).
023046        10 S775AX-RUECKKANAL           PIC X.
023047        10 S775AX-MEK                  PIC X(32).
023048        10 S775AX-WFS-SHE-KZ           PIC X.
023049        10 S775AX-KOMP-SHE-KZ          PIC X.
023050        10 S775AX-KOMP-GFA-KZ          PIC X.
023051        10 S775AX-BGRP-CHECKSUM-V      PIC X(2).
023052        10 S775AX-TRANSPOND-CHECKSUM-V PIC X(2).
023053        10 S775AX-IKA-ZAHL             PIC X(2).
023054        10 S775AX-MEK-ZAHL             PIC X(2).
023055        10 S775AN-TEXT-IKA-ART         PIC S9(9) COMP.
023056        10 S775AN-TEXT-MEK-ART         PIC S9(9) COMP.
023057     03 S775-I-DCLFE01T05.
023058        10 S775AN-I-PIN                PIC S9(4) COMP.
023059        10 S775AN-I-SKC                PIC S9(4) COMP.
023060        10 S775AN-I-IKA                PIC S9(4) COMP.
023061        10 S775AN-I-KOMP-S-TYP         PIC S9(4) COMP.
023062        10 S775AN-I-TEXT-IKA-ART       PIC S9(4) COMP.
023063        10 S775AN-I-TEXT-MEK-ART       PIC S9(4) COMP.
023064******************************************************************
023065* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 21      *
023066******************************************************************
023068*  PROBA PCOPYEND
024090
024100*-----------------------------------------------------------------
024110* SCHNITTSTELLE FE01T08 FAZIT-FAHRZEUG
024120*-----------------------------------------------------------------
024130 01  S778-DATEN.
024140*PCOPY=FE778V12,XXXX=S778
024141*  PROBA PCOPYANF
024142*  PROBA MEMBER=FE778V12 CODE=JC02 AUTH=FIEBIGER-T TYPE=S
024143*  PROBA  STAND 17.11.2017(09.00) LAN=COB
024145******************************************************************
024146* MEMBER: FE778V08                                FIRST: Juli 2001
024147* TITLE:  Unterprogramm: Insert FE01T08 Fahrzeug
024148* SA:     F3                                       SYS-NAME: FAZIT
024149* AUTHOR: Thomas Fiebiger, msg Systeme GmbH
024150*
024151* DESC:   Schnittstelle für Programm FE778B/C
024152*-----------------------------------------------------------------
024153* PCOPY:  FEPARM01 Parameter- und Fehlerbereich für Fazit-Schnitt-
024154*                  stellen
024155*-----------------------------------------------------------------
024156* MOD: 00 01.07.2001 Thomas Fiebiger, msg Systeme GmbH
024157* MOD:               Neuerstellung
024158* MOD: 01 31.01.2002 Thomas Fiebiger, msg systems ag
024159* MOD:               - neue Columns FSC und P_KLASSE
024160* MOD: 02 26.03.2003 Hubert Geier, msg systems ag
024161* MOD:               - neue Column TRANSPOND_FAM
024162* MOD: 03 26.05.2003 Thomas Fiebiger, msg systems ag
024163* MOD:               - Column SKC: neue Länge=32
024164* MOD:               - neue Column GFA
024165* MOD: 04 18.04.2005 Hubert Geier, msg systems ag
024166* MOD:               - Column SKC: neue Länge=64
024167* MOD:               - Column WFS_INHALT: neue Länge=27
024168* MOD:               - neue Column ID_ZAHL
024169* MOD: 05 17.04.2007 Rainer Geier, msg systems ag
024170* MOD:               - Column SKC: neue Länge=96
024171* MOD:    19.04.2007 Peter Unger,  msg systems ag
024172* MOD:               - neue Columns WERK, SPJ, KNR und
024173* MOD:                 VIN_FZ_KLASSE ( VIN_FZ_KLASSE ist identisch
024174* MOD:                 mit VIN(7:2) )
024175* MOD: 06 20.05.2008 Markus Lutz, msg systems ag
024176* MOD:               - Columns TEXT_SPERRE, DRT_SPERR_KZ,
024177* MOD:                 BKA_SPERR_KZ und GUELTIG_AB entfernt
024178* MOD:               - neue Columns WFS_MARKE, PRNR_MOT und
024179* MOD:                 DATUM_ZP8
024180* MOD: 07 24.11.2009 Kay Wagner, msg systems ag
024181* MOD:               - neue Columns ZP8_NR, KOMP_MASTER,
024182* MOD:                 WFS_MASTER und MODELL
024183* MOD: 08 13.05.2013 Thomas Fiebiger, msg systems ag
024184* MOD:               OR-526 fremde PCOPYs in Fazit-Modulen
024185* MOD:               - TGSQLV04 durch FESQLV00 ersetzt
024186* MOD:               - FE01T08 durch FEVX08 ersetzt
024187* MOD: 09 02.07.2013 Wolfgang Hellinger, msg systems ag
024188* MOD:               ÄA-186 Geheimnisableitung Fazit4myCar
024189* MOD:               - neue Columns GFA_ZAHL, TEXT_SKC_ART und
024190* MOD:                 TEXT_GFA_ART
024191* MOD: 10 20.01.2014 Thomas Fiebiger, msg systems ag
024192* MOD:               ÄA-206 Fz-Label-Serienr
024193* MOD:               - neue Column LABEL_SERIE_NR
024194* MOD: 11 26.08.2014 Thomas Fiebiger, msg systems ag
024195* MOD:               ÄA-213 Entfall Geldbörsenschlüssel
024196* MOD:               - neue Column GARNITUR_SERIE_NR
024197* MOD: 12 09.11.2017 Thomas Fiebiger, msg systems ag
024198* MOD:               ÄA-213 Entfall Geldbörsenschlüssel
024199* MOD:               - neue Columns PIN_WERK, PIN_SPJ und PIN_KNR
024200******************************************************************
024201*PCOPY=FEPARM01,YYYY=S778
024202*  PROBA PCOPYANF
024203*  PROBA MEMBER=FEPARM01 CODE=JW05 AUTH=FIEBIGER-T TYPE=S
024204*  PROBA  STAND 15.02.2011(18.27) LAN=COB
024206******************************************************************
024207* MEMBER: FEPARM01                            FIRST: Dezember 2010
024208* TITLE:  Parameter- und Fehlerbereich für Fazit-Schnittstellen
024209* SA:     F3                                       SYS-NAME: FAZIT
024210* AUTHOR: Thomas Fiebiger, msg systems ag
024211*
024212* DESC:   Parameter- und Fehlerbereich für Fazit-Schnittstellen
024213*-----------------------------------------------------------------
024214* MOD: 01 28.12.2010 Thomas Fiebiger, msg systems ag
024215* MOD:               Neuerstellung
024216******************************************************************
024217
024218* -- Übergabeparameter
024219     03 S778-PARAMETER.
024220*       -- Vergleichskennzeichen:
024221*       --          'N'  => kein Vergleich
024222*       --         sonst => Vergleich mit letztem Tabellen-Eintrag
024223        10 S778AX-VGL-KZ              PIC X.
024224
024225* -- Rückgabeparameter
024226     03 S778-FEHLER.
024227        10 S778AN-TEXT-RC             PIC S9(9) COMP.
024228        10 S778AN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
024229        10 S778AX-BESCHREIBUNG.
024230           15 S778AX-PROGRAMM         PIC X(8).
024231           15 S778AX-SECTION          PIC X(26).
024232           15 S778AX-INFO             PIC X(220).
024233        10 S778AX-FEHLER-PARM.
024234           49 S778AN-FEHLER-PARM-LEN  PIC S9(4) COMP.
024235           49 S778AX-FEHLER-PARM-TEXT PIC X(254).
024236        10 S778AX-SQLCA               PIC X(136).
024238*  PROBA PCOPYEND
024239******************************************************************
024240* Cobol Declaration for Table FE01T08 Fahrzeug
024241******************************************************************
024242     03 S778-DCLFE01T08.
024243        10 S778AX-V-ID                PIC X(26).
024244        10 S778AX-VIN                 PIC X(17).
024245        10 S778AN-TEXT-SYSTEM         PIC S9(9) COMP.
024246        10 S778AX-PIN                 PIC X(16).
024247        10 S778AX-SKC                 PIC X(96).
024248        10 S778AN-TEXT-DRT-VERSION    PIC S9(9) COMP.
024249        10 S778AX-WFS-INHALT          PIC X(27).
024250        10 S778AX-FSC                 PIC X(16).
024251        10 S778AX-P-KLASSE            PIC X(2).
024252        10 S778AX-TRANSPOND-FAM       PIC X(10).
024253        10 S778AX-GFA                 PIC X(32).
024254        10 S778AX-ID-ZAHL             PIC X(2).
024255        10 S778AX-WERK                PIC X(2).
024256        10 S778AX-SPJ                 PIC X(4).
024257        10 S778AX-KNR                 PIC X(7).
024258        10 S778AX-VIN-FZ-KLASSE       PIC X(2).
024259        10 S778AX-WFS-MARKE           PIC X(2).
024260        10 S778AX-PRNR-MOT            PIC X(3).
024261        10 S778AX-DATUM-ZP8           PIC X(10).
024262        10 S778AX-ZP8-NR              PIC X(2).
024263        10 S778AX-KOMP-MASTER         PIC X(3).
024264        10 S778AX-WFS-MASTER          PIC X(3).
024265        10 S778AX-MODELL              PIC X(8).
024266        10 S778AX-GFA-ZAHL            PIC X(2).
024267        10 S778AN-TEXT-SKC-ART        PIC S9(9) COMP.
024268        10 S778AN-TEXT-GFA-ART        PIC S9(9) COMP.
024269        10 S778AX-LABEL-SERIE-NR      PIC X(11).
024270        10 S778AX-GARNITUR-SERIE-NR   PIC X(23).
024271        10 S778AX-PIN-WERK            PIC X(2).
024272        10 S778AX-PIN-SPJ             PIC X(4).
024273        10 S778AX-PIN-KNR             PIC X(7).
024274     03 S778-I-DCLFE01T08.
024275        10 S778AN-I-PIN               PIC S9(4) COMP.
024276        10 S778AN-I-SKC               PIC S9(4) COMP.
024277        10 S778AN-I-TEXT-DRT-VERSION  PIC S9(4) COMP.
024278        10 S778AN-I-WFS-INHALT        PIC S9(4) COMP.
024279        10 S778AN-I-FSC               PIC S9(4) COMP.
024280        10 S778AN-I-P-KLASSE          PIC S9(4) COMP.
024281        10 S778AN-I-TRANSPOND-FAM     PIC S9(4) COMP.
024282        10 S778AN-I-GFA               PIC S9(4) COMP.
024283        10 S778AN-I-DATUM-ZP8         PIC S9(4) COMP.
024284        10 S778AN-I-TEXT-SKC-ART      PIC S9(4) COMP.
024285        10 S778AN-I-TEXT-GFA-ART      PIC S9(4) COMP.
024286******************************************************************
024287* The Number of Columns described by this Declaration is 31
024288******************************************************************
024290*  PROBA PCOPYEND
025600
025610******************************************************************
025620* PROGRAMMSPEZIFISCHE VARIABLEN UND KONSTANTEN
025630******************************************************************
025640*-----------------------------------------------------------------
025650* KONSTANTE
025660*-----------------------------------------------------------------
025670 01  K1.
025680*    -- STATUS DES TRANSPONDERS
025690*    --------
025700*    -- 2937 = INAKTIV
025710     10 K1AN-2937-INAKTIV          PIC 9(04)        VALUE 2937.
025720*    -- 8043 = VERSCHROTTET GEMELDET
025730     10 K1AN-8043-VERSCHROTTET     PIC 9(04)        VALUE 8043.
025740*    -- 8080 = REGISTRIERT FÜR DOWNLOAD 4
025750     10 K1AN-8080-DL4-REG          PIC 9(04)        VALUE 8080.
025760*    -- 8082 = DOWNLOAD 4 ERZEUGT
025770     10 K1AN-8082-DL4-ERZEUGT      PIC 9(04)        VALUE 8082.
025780*    -- 8045 = AKTIV
025790     10 K1AN-8045-AKTIV            PIC 9(04)        VALUE 8045.
025800*    -- 8086 = REGISTRIERUNG AUFGEHOBEN
025810     10 K1AN-8086-AUFGEHOBEN       PIC 9(04)        VALUE 8086.
025820*    -- 8085 = PROGRAMMIERT FÜR DOWNLOAD 5
025830*    10 K1AN-8085-DL5-ERZEUGT      PIC 9(04)        VALUE 8085.
025840*    -- 8087 = DOWNLOAD 4 ERZEUGT NACH ANFRAGE FÜR DL5
025850*    10 K1AN-8087-DL4-NACH-DL5     PIC 9(04)        VALUE 8087.
025860*
025870*    -- Markierung Transponder in Produktion gelöscht
025880     10 K1AN-MARKIERUNG-8519       PIC 9(04)        VALUE 8519.
025890*
025900*    -- BGRP 501-508
025910     10 K1AX-BGRP501               PIC X(3)  VALUE  '501'.
025920     10 K1AX-BGRP502               PIC X(3)  VALUE  '502'.
025930     10 K1AX-BGRP503               PIC X(3)  VALUE  '503'.
025940     10 K1AX-BGRP504               PIC X(3)  VALUE  '504'.
025950     10 K1AX-BGRP505               PIC X(3)  VALUE  '505'.
025960     10 K1AX-BGRP506               PIC X(3)  VALUE  '506'.
025970     10 K1AX-BGRP507               PIC X(3)  VALUE  '507'.
025980     10 K1AX-BGRP508               PIC X(3)  VALUE  '508'.
025990*
026000     10 K1AX-DOMAENE-VKM           PIC X(3)  VALUE 'VKM'.
026010     10 K1AN-TRAN-ANZAHL-MAX       PIC S9(4) COMP VALUE +8.
026020
026030*-----------------------------------------------------------------
026040* K1 - KONSTANTE FÜR TEXTE
026050*-----------------------------------------------------------------
026060*PCOPY=FE549T02,XXXX=K1
026061*  PROBA PCOPYANF
026062*  PROBA MEMBER=FE549T02 CODE=YB01 AUTH=JARNECKI-M TYPE=S
026063*  PROBA  STAND 11.04.2024(11.21) LAN=COB
026065*PCOPY=FETE9903
026066*  PROBA PCOPYANF
026067*  PROBA MEMBER=FETE9903 CODE=JB02 AUTH=KOLMEDER-K TYPE=S
026068*  PROBA  STAND 22.09.2014(15.46) LAN=COB
026070******************************************************************
026071* MEMBER: FETE9902                                FIRST: Juli 2002
026072* TITLE:  Fazit-Standardtexte
026073* SA:     F3                                       SYS-NAME: FAZIT
026074* AUTHOR: Hubert Geier, msg systems ag
026075*
026076* DESC:   Text-Konstante für FE01T300 Sprache-Text
026077*-----------------------------------------------------------------
026078* MOD: 00 16.07.2002 Hubert Geier, msg systems ag
026079* MOD:               Neuerstellung
026080******************************************************************
026081
026082*-----> COLUMN: TEXT-FEHLER-KLASSE
026083*    -- OK
026084     10 K1AN-OK                    PIC S9(4) COMP VALUE +9000.
026085*    -- Hinweis
026086     10 K1AN-HINWEIS               PIC S9(4) COMP VALUE +9001.
026087*    -- Fehler
026088     10 K1AN-FEHLER                PIC S9(4) COMP VALUE +9002.
026089*    -- Systemfehler
026090     10 K1AN-SYSTEM                PIC S9(4) COMP VALUE +9003.
026091
026092*-----> COLUMN: TEXT-RC
026093*    -- Aktion &AKTION. nicht bekannt
026094     10 K1AN-T1001                 PIC S9(4) COMP VALUE +1001.
026095*    -- es sind nicht alle benötigten Felder gefüllt
026096     10 K1AN-T1002                 PIC S9(4) COMP VALUE +1002.
026097*    -- unerwarteter Abbruch in DB2
026098     10 K1AN-T1004                 PIC S9(4) COMP VALUE +1004.
026099*    -- Programmfehler
026100     10 K1AN-T1009                 PIC S9(4) COMP VALUE +1009.
026102*  PROBA PCOPYEND
026103
026104*-----> TEXT-RC
026105*    -- Transponder noch aktiv einem Fahrzeug zugeordnet
026106     10 K1AN-T0128                 PIC S9(4) COMP VALUE +0128.
026107*    -- Transponder nicht in Lieferantendaten
026108     10 K1AN-T1150                 PIC S9(4) COMP VALUE +1150.
026109*    -- Transpond-Fam der VIN ungleich Lieferantendatei
026110     10 K1AN-T1180                 PIC S9(4) COMP VALUE +1180.
026111*    -- Instanzparameter 620 zur KEY-LABEL-Bildung wurde nicht gef
026112     10 K1AN-T1498                 PIC S9(4) COMP VALUE +1498.
026113*    -- Instanzparameter 610 zur KEY-LABEL-Bildung wurde nicht gef
026114     10 K1AN-T1499                 PIC S9(4) COMP VALUE +1499.
026115*    -- Fehler aus IBM-Routine CSNBXBC Character/Nibble Conversion
026116     10 K1AN-T1506                 PIC S9(4) COMP VALUE +1506.
026117*    -- Fehler in IBM-Routine CSNBXCB Datenkonvertierung HEX to BI
026118     10 K1AN-T1763                 PIC S9(4) COMP VALUE +1763.
026119*    -- Transponder ist VIN nicht zugeordnet
026120     10 K1AN-T2205                 PIC S9(4) COMP VALUE +2205.
026121*    -- WFS-Identifikationsdaten fehlen
026122     10 K1AN-T2847                 PIC S9(4) COMP VALUE +2847.
026123*    -- VIN fehlt in Datenbank Fazit, FZ nicht bekannt
026124     10 K1AN-T2848                 PIC S9(4) COMP VALUE +2848.
026125*    -- FZ nicht für VKMS vorbereitet
026126     10 K1AN-T2849                 PIC S9(4) COMP VALUE +2849.
026127*    -- Lebenszustand Transponder falsch
026128     10 K1AN-T2850                 PIC S9(4) COMP VALUE +2850.
026129*    -- Transp.status in den WFS-Identifikationsdaten fehlerhaft
026130     10 K1AN-T2870                 PIC S9(4) COMP VALUE +2870.
026131*    -- Anzahl Transponder falsch
026132     10 K1AN-T2871                 PIC S9(4) COMP VALUE +2871.
026133*    -- Transponder nicht gefunden (fe01tx30)
026134     10 K1AN-T2872                 PIC S9(4) COMP VALUE +2872.
026135*    -- VIN aus den WFS-Identdaten falsch
026136     10 K1AN-T2876                 PIC S9(4) COMP VALUE +2876.
026137*    -- Lebenszustand ungültig
026138     10 K1AN-T2877                 PIC S9(4) COMP VALUE +2877.
026139*    -- Transponder nicht gefüllt, aber Status <> 00
026140     10 K1AN-T2935                 PIC S9(4) COMP VALUE +2935.
026141*    -- Config Data Master nicht gefunden
026142     10 K1AN-T2958                 PIC S9(4) COMP VALUE +2958.
026143*    -- Wegfahrsperre-Typ ist für die Verarbeitung nicht zulässig
026144     10 K1AN-T3009                 PIC S9(4) COMP VALUE +3009.
026145*    -- TRANSPOND_ID darf nicht leer sein
026146     10 K1AN-T3022                 PIC S9(4) COMP VALUE +3022.
026147*    -- Transponder ist bereits zu diesem FZ aktiviert.
026148     10 K1AN-T3049                 PIC S9(4) COMP VALUE +3049.
026149*    -- Ungültiger Anfragetyp in VS02-Anfrage
026150     10 K1AN-T3058                 PIC S9(4) COMP VALUE +3058.
026151*    -- Ungültiger Anfragetyp in DT02-Anfrage
026152     10 K1AN-T3059                 PIC S9(4) COMP VALUE +3059.
026153*    -- Transponder-Anzahl ungl. Transponder-Anzahl in WFS-Master
026154     10 K1AN-T3102                 PIC S9(4) COMP VALUE +3102.
026155*    -- Schließsatz-Identifikation darf nicht leer sein
026156     10 K1AN-T3109                 PIC S9(4) COMP VALUE +3109.
026157*    -- Zuerst WFS-Master anlernen
026158     10 K1AN-T3209                 PIC S9(4) COMP VALUE +3209.
026159*    -- Das ausgelesene Key-FOB-Table ist leer
026160     10 K1AN-T3378                 PIC S9(4) COMP VALUE +3378.
026161*    -- Fahrzeug hat schon ZP8
026162     10 K1AN-T7737                 PIC S9(4) COMP VALUE +7737.
026163*    -- Falscher Telegrammaufbau (Container unbekannt in FAZIT)
026164     10 K1AN-T7829                 PIC S9(4) COMP VALUE +7829.
026165* C-Modulmeldungen
026166*    -- C-Modul WFS-6: 0004 Länge SKC falsch
026167     10 K1AN-T2857                 PIC S9(4) COMP VALUE +2857.
026168*    -- C-Modul WFS-6: 0008 WFS-TYP nicht definiert
026169     10 K1AN-T2858                 PIC S9(4) COMP VALUE +2858.
026170*    -- C-Modul WFS-6: 0009 Länge Challange falsch
026171     10 K1AN-T2859                 PIC S9(4) COMP VALUE +2859.
026172*    -- C-Modul WFS-6: 0011 Länge Start-SKC falsch
026173     10 K1AN-T2860                 PIC S9(4) COMP VALUE +2860.
026174*    -- C-Modul WFS-6: 0013 Neu/Gebraucht falsch
026175     10 K1AN-T2861                 PIC S9(4) COMP VALUE +2861.
026176*    -- C-Modul WFS-6: 0016 Steuergerät falsch
026177     10 K1AN-T2862                 PIC S9(4) COMP VALUE +2862.
026178*    -- C-Modul WFS-6: Unbekannter Fehler aus C-Modul
026179     10 K1AN-T2863                 PIC S9(4) COMP VALUE +2863.
026180*    -- C-Modul WFS-6: 0019 Aktion falsch
026181     10 K1AN-T2864                 PIC S9(4) COMP VALUE +2864.
026182*    -- C-Modul WFS-6: 0020 Aktion im Steuergerät falsch
026183     10 K1AN-T2865                 PIC S9(4) COMP VALUE +2865.
026184*    -- C-Modul WFS-6: 0021 Login-Parm falsch
026185     10 K1AN-T2866                 PIC S9(4) COMP VALUE +2866.
026186*    -- C-Modul WFS-6: 0070 IKA falsch
026187     10 K1AN-T1802                 PIC S9(4) COMP VALUE +1802.
026188*    -- C-Modul WFS-6: 0114 Länge WFS-Identifikations-Daten falsch
026189     10 K1AN-T2783                 PIC S9(4) COMP VALUE +2783.
026190*    -- C-Modul WFS-6: 0115 MAC WFS-Identifikations-Daten falsch
026191     10 K1AN-T2784                 PIC S9(4) COMP VALUE +2784.
026192*    -- C-Modul WFS-6: 0116 Länge VKMS-Key 1009 (WFS SIG) falsch
026193     10 K1AN-T2785                 PIC S9(4) COMP VALUE +2785.
026194*    -- C-Modul WFS-6: 0117 Version WFS-Identifikations-Daten
026195*                           falsch
026196     10 K1AN-T2786                 PIC S9(4) COMP VALUE +2786.
026197*    -- C-Modul WFS-6: 0123 Länge Key-FOB-Table falsch
026198     10 K1AN-T2792                 PIC S9(4) COMP VALUE +2792.
026199*    -- C-Modul WFS-6: 0124 Version Key-FOB-Table falsch
026200     10 K1AN-T2793                 PIC S9(4) COMP VALUE +2793.
026201*    -- C-Modul WFS-6: 0134 Länge Key-FOB-Table-Version falsch
026202     10 K1AN-T2800                 PIC S9(4) COMP VALUE +2800.
026203*    -- C-Modul WFS-6: 0032 Länge Transponder-aktuell  falsch
026204     10 K1AN-T8172                 PIC S9(4) COMP VALUE +8172.
026205*    -- C-Modul FE587B: 0120 Länge MAC nicht korrekt
026206     10 K1AN-T2939                 PIC S9(4) COMP VALUE +2939.
026207*    -- C-Modul FE587B: 0121 GetStat MAC nicht korrekt
026208     10 K1AN-T2940                 PIC S9(4) COMP VALUE +2940.
026210*  PROBA PCOPYEND
027520
027530*-----------------------------------------------------------------
027540* TRACE-LOGGING
027550*-----------------------------------------------------------------
027560*PCOPY=FEVX1200,PRFX=BX12
027561*  PROBA PCOPYANF
027562*  PROBA MEMBER=FEVX1200 CODE=AA01 AUTH=FIEBIGER-T TYPE=S
027563*  PROBA  STAND  7.05.2013(13.12) LAN=COB
027565******************************************************************
027566* DCLGEN TABLE(FEVX12)                                           *
027567*        LIBRARY(DB2J.SRCLIB.DATA(FEVX12))                       *
027568*        ACTION(REPLACE)                                         *
027569*        LANGUAGE(COBOL)                                         *
027570*        APOST                                                   *
027571* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
027572******************************************************************
027573     EXEC SQL DECLARE FEVX12 TABLE
027574     ( V_ID_TRACE                  TIMESTAMP       NOT NULL
027575     , ZEITPUNKT                   TIMESTAMP       NOT NULL
027576     , INSTANZ                     CHAR(1)         NOT NULL
027577     , MODUL_NAME                  CHAR(8)         NOT NULL
027578     , TEXT                        VARCHAR(1000)   NOT NULL
027579     ) END-EXEC.
027580******************************************************************
027581* COBOL DECLARATION FOR TABLE FEVX12 TRACE-LOGGING - UPDATE      *
027582******************************************************************
027583 01  BX12-DCLFEVX12.
027584     10 BX12AX-V-ID-TRACE          PIC X(26).
027585     10 BX12AX-ZEITPUNKT           PIC X(26).
027586     10 BX12AX-INSTANZ             PIC X.
027587     10 BX12AX-MODUL-NAME          PIC X(8).
027588     10 BX12AX-TEXT.
027589     49 BX12AN-TEXT-LEN            PIC S9(4) COMP.
027590     49 BX12AX-TEXT-TEXT           PIC X(1000).
027591******************************************************************
027592* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 5       *
027593******************************************************************
027595*  PROBA PCOPYEND
027890
027900*-----------------------------------------------------------------
027910* VKMS AUSKUNFT-HINWEIS
027920*-----------------------------------------------------------------
027930*PCOPY=FEVXVR00,PRFX=BXVR
027931*  PROBA PCOPYANF
027932*  PROBA MEMBER=FEVXVR00 CODE=QA01 AUTH=FIEBIGER-T TYPE=S
027933*  PROBA  STAND 16.06.2017(10.09) LAN=COB
027935******************************************************************
027936* DCLGEN TABLE(FEVXVR)                                           *
027937*        LIBRARY(DB2J.SRCLIB.DATA(FEVXVR))                       *
027938*        ACTION(REPLACE)                                         *
027939*        LANGUAGE(COBOL)                                         *
027940*        APOST                                                   *
027941* ... IS THE DCLGEN COMMAND THAT MADE THE FOLLOWING STATEMENTS   *
027942******************************************************************
027943     EXEC SQL DECLARE FEVXVR TABLE
027944     ( UTC_V_ID                    TIMESTAMP       NOT NULL
027945     , VIN                         CHAR(17)        NOT NULL
027946     , TEXT_VERARB                 INTEGER         NOT NULL
027947     , TEXT_FEHLER_KLASSE          INTEGER         NOT NULL
027948     ) END-EXEC.
027949******************************************************************
027950* COBOL DECLARATION FOR TABLE FEVXVR                             *
027951******************************************************************
027952 01  BXVR-DCLFEVXVR.
027953     10 BXVRAX-UTC-V-ID            PIC X(26).
027954     10 BXVRAX-VIN                 PIC X(17).
027955     10 BXVRAN-TEXT-VERARB         PIC S9(9) COMP.
027956     10 BXVRAN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
027957******************************************************************
027958* THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 4       *
027959******************************************************************
027961*  PROBA PCOPYEND
028220
028230*-----------------------------------------------------------------
028240* Schalter
028250*-----------------------------------------------------------------
028260 01  U1.
028270     10 U1AX-AKTION                PIC X.
028280        88 U1AX-NORMAL                    VALUE 'N'.
028290        88 U1AX-TEST                      VALUE 'T'.
028300     10 U1AX-VERARBEITUNG          PIC X.
028310        88 U1AX-VERARB-OK                 VALUE 'O'.
028320        88 U1AX-VERARB-FEHLER             VALUE 'F'.
028330     10 U1AX-TRANSPON-ZUSTAND      PIC X.
028340        88 U1AX-TRANSPOND-NEU             VALUE 'N'.
028350        88 U1AX-TRANSPOND-GEBR            VALUE 'G'.
028360     10 U1AX-TRANSPOND-IN-ANFRAGE  PIC X.
028370        88 U1AX-TRAN-IN-ANF               VALUE 'J'.
028380        88 U1AX-TRAN-NICHT-IN-ANF         VALUE 'N'.
028390*V11b IR Aufhebung über D91C-WRITE-AUFGEH
028400     10 U1-D92C-AUFHEB              PIC X(1).
028410        88 U1AX-D92C-AUFHEB-N             VALUE 'N'.
028420        88 U1AX-D92C-AUFHEB-Y             VALUE 'Y'.
028430*-----------------------------------------------------------------
028440* Indices
028450*-----------------------------------------------------------------
028460 01  I1.
028470     10 I1AN-TRA                   PIC S9(4) COMP VALUE ZERO.
028480     10 I1AN-NA                    PIC S9(4) COMP VALUE ZERO.
028490     10 I1AN-NZ                    PIC 9(10) VALUE ZERO.
028500     10 I1AN-VARTAB                PIC S9(9) COMP.
028510     10 I1AN-1                     PIC S9(4) COMP VALUE ZERO.
028520
028530*-----------------------------------------------------------------
028540* ARBEITSVARIABLEN
028550*-----------------------------------------------------------------
028560 01  W1.
028570     05 W1AN-ANZ-TRA-AUFGEHOBEN    PIC 9(3).
028580     05 W1AN-SKC0-KT-ID-ZAHL       PIC S9(9) COMP.
028590     05 W1AX-TRALOG-TEXT           PIC X(1000).
028600     05 W1AN-N1                    PIC S9(9) COMP.
028610     05 W1AN-N2                    PIC S9(9) COMP.
028620     05 W1AN-CNT                   PIC S9(4) COMP.
028630     05 W1AN-S585TC-NUM            PIC S9(9) COMP.
028640     05 W1AN-TRAN-ANZAHL           PIC S9(4) comp.
028650     05 W1AX-TRANSP-EXST-TBL.
028660        10 W1AX-TRANSP-EXST-FLD OCCURS 8.
028670           15 W1AX-TRANS-EXST-FLG     PIC X.
028680     05 W1AN-ANZ-TRA-X30-ANG       PIC S9(09) binary.
028690     05 W1AN-I-ANZ-TRA-X30-ANG     PIC S9(4) COMP.
028700     05 W1AX-TRA-LISTE             PIC X(64).
028710     05       REDEFINES W1AX-TRA-LISTE.
028720         10 W1AX-TRA-LIST-ARR OCCURS 8.
028730           15 W1AX-TRA-LIST        PIC X(8).
028740     05 W1AX-TRA-IN-ANFRAGE.
028750       10 W1AX-TRA-1               PIC X(8).
028760       10 W1AX-TRA-2               PIC X(8).
028770       10 W1AX-TRA-3               PIC X(8).
028780       10 W1AX-TRA-4               PIC X(8).
028790       10 W1AX-TRA-5               PIC X(8).
028800       10 W1AX-TRA-6               PIC X(8).
028810       10 W1AX-TRA-7               PIC X(8).
028820       10 W1AX-TRA-8               PIC X(8).
028830     05 W1AN-ANZ-SCHU              PIC 9(4).
028840     05 W1AX-SQLSTATE              PIC X(5).
028850     05 W1AN-AUFB1                 PIC 9.
028860     05 W1AN-AUFB2                 PIC 9(2).
028870     05 W1AN-AUFB4                 PIC 9(4).
028880     05 W1AN-AUFB9                 PIC 9(9).
028890*V11 -->
028900     05 W1AN-AUFB3                 PIC 9(3).
028910     05 W1AN-AUFB10                PIC 9(10).
028920     05 W1AN-AUFB10-V2             PIC 9(10).
028930     05 W1AN-ANZ-TRA-X30           PIC S9(09) COMP VALUE ZERO.
028940     05 W1AN-I-ANZ-TRA-X30         PIC S9(04) COMP VALUE ZERO.
028950     05 W1AN-ANZ-TRA-2X3-FAZ       PIC S9(09) COMP VALUE ZERO.
028960     05 W1AN-I-ANZ-TRA-2X3-FAZ     PIC S9(04) COMP VALUE ZERO.
028970*V11 <--
028980     05 W1AN-ANZ-TRA-X30-REG       PIC S9(09) COMP VALUE ZERO.
028990     05 W1AN-I-ANZ-TRA-X30-REG     PIC S9(04) COMP VALUE ZERO.
029000     05 W1AX-WFS-CONFIGBYTE0       PIC X.
029010     05 W1AN-ANZ-KEYFOB            PIC 9.
029020     05 W1AN-ANZ-TRA-MAX           PIC 9.
029030     05 W1AN-KEYFOB-ENDE           PIC 9.
029040     05 W1AN-TEXT-TRANSP-STATUS    PIC S9(9) COMP.
029050     05 W1AN-STATUS                PIC S9(9) COMP.
029060     05 W1AN-TRA-BGRP              PIC 9(3).
029070     05 W1AX-FE778-CALL            PIC X.
029080     05 W1AX-FE775-CALL            PIC X.
029090*    -- Anzahl Tran. in DATEN_INHALT FEV2VI
029100     05 W1AN-ANZ-TRA-ANGEF         PIC 9(2).
029110*    -- Anzahl mit Verarb. OK
029120     05 W1AN-ANZ-TRA-OK            PIC 9(3).
029130     05 W1AN-ANZ-TRA-NOK           PIC 9(3).
029140     05 W1AN-TEXT-RC               PIC S9(9) COMP.
029150     05 W1AN-TEXT-FEHLER-KLASSE    PIC S9(9) COMP.
029160
029170*    -- Hilfsfelder Umrechnung Hex-Zahl (O50...)
029180     05 HEX2DEC.
029190*       -- Länge des Eingabe-Hex-Wertes
029200        10 I-CNT                   PIC 9(4).
029210*       -- Exponent
029220        10 I-EXPO                  PIC 9(4).
029230*       -- HEX-Wert, der umgerechnet wird
029240        10 W1AX-EIN-HEXWERT        PIC X(4).
029250*       -- Tabelle zum Umrechnen, OCCURS = Länge Ein-Hex-Wert
029260        10 FILLER           REDEFINES W1AX-EIN-HEXWERT.
029270           15 W1AX-EIN-HEX-TAB     OCCURS 4.
029280              20 W1AX-EIN-HEX-BYTE PIC X.
029290        10 W1AN-ZW-DECIMAL         PIC S9(9) COMP.
029300        10 W1AN-NUM-X              PIC 9(2).
029310*       -- Ergebis als Dezimalzahl
029320        10 W1AN-ERGEBNIS-DEC       PIC S9(9) COMP.
029330
029340*      -- Hilsfelder zum Ermitteln der TRA-BGRP
029350       05 W1AX-BGRP-GEFUNDEN         PIC X.
029360       05 W1AN-TAB-BGRP              PIC 9(3).
029370*      --
029380       05 W1AN-TB-TAB-IX             PIC 9.
029390       05 W1AX-TRANSPOND-BGRP-TAB OCCURS 8.
029400          10 W1AX-TB-TAB-TRANSPOND-ID  PIC X(8).
029410          10 W1AN-TB-TAB-BGRP          PIC 9(3).
029420
029430*    -- Hilfsfelderl für DT02/TRA4
029440     05 W1AX-TRANSP-TAB OCCURS 8.
029450        10 W1AX-TRANSP-SCHREIBEN       PIC X(1).
029460        10 W1AX-TRANSPOND-ID           PIC X(8).
029470        10 W1AX-TRANSPOND-TYP          PIC X(4).
029480        10 W1AN-TRANSPOND-STATUS       PIC S9(09) COMP.
029490        10 W1AX-TRANSPOND-BGRP         PIC X(3).
029500        10 W1AX-TRANSPOND-FAM          PIC X(010).
029510        10 W1AX-USER-MEMORY            PIC X(256).
029520        10 W1AN-SKC0-KEY-TYP-ID        PIC S9(09) COMP.
029530        10 W1AN-SKC0-KEY-TYP-ID-ZAHL   PIC S9(09) COMP.
029540        10 W1AN-TRANSPOND-ID-ZAHL      PIC S9(09) COMP.
029550        10 W1AX-TRANSPOND-ID-ZAHL-HEX  PIC X(002).
029560        10 W1AN-PSS-FZ-ID-ZAHL         PIC S9(09) COMP.
029570        10 W1AX-PSS-KRYPTOREGION       PIC X(003).
029580        10 W1AX-PSS-BGRP               PIC X(003).
029590        10 W1AN-PSS-KEY-TYP-ID         PIC S9(09) COMP.
029600        10 W1AN-PSS-KEY-TYP-ID-ZAHL    PIC S9(09) COMP.
029610        10 W1AN-PSS-VKMS-KEY-AUF-VER   PIC S9(09) COMP.
029620        10 W1AX-PSS-VIN                PIC X(017).
029630        10 W1AX-TRANSPOND-DL4.
029640          15 W1AN-TRANSP-DL4-LEN       PIC S9(4) USAGE COMP.
029650          15 W1AX-TRANSP-DL4-TEXT      PIC X(2048).
029660*          -- nur bei TRA genutzt
029670        10 W1AN-FEHLER-NR              PIC 9(5).
029680        10 W1AX-FEHLER-TEXT            PIC X(199).
029690*    -- Hilfsfelder für Instanzparameter (STAGE, VERSION)
029700     05 W1AX-INSTANZPARAMETER.
029710        10 W1AX-IPA-INSTANZ        PIC X(30).
029720        10 W1AX-IPA-610-STAGE      PIC X(01).
029730        10 W1AX-IPA-620-VERSION    PIC X(05).
029740        10 W1AX-IPA-610-WERT       PIC X(255).
029750        10 W1AX-IPA-620-WERT       PIC X(255).
029760        10 W1AN-IPA-I-610WERT      PIC S9(4) COMP.
029770        10 W1AN-IPA-I-620WERT      PIC S9(4) COMP.
029780*    -- Hilfsfelder für TRA4
029790*    -- Transponder-Tabelle
029800     05 W1-TRANSPONDER-TAB     OCCURS 8.
029810        10 W1AX-TRA-KEY-FOB-STATUS          PIC X(2).
029820        10 W1AX-TRA-TRANSPONDERID           PIC X(08).
029830        10 W1AN-TRA-ID-ZAHL-HEX             PIC X(04).
029840        10 W1AN-TRA-ID-ZAHL                 PIC S9(9) COMP.
029850        10 W1AX-TRA-TYP                     PIC X(04).
029860*       -- SchlüsselTyp von KeyFob
029870        10 W1AX-TRA-SCHLUESSELTYP           PIC X(02).
029880        10 W1AX-TRA-BGRP                    PIC X(03).
029890        10 W1AN-TRA-LFDNR                   PIC 9(02).
029900        10 W1AN-TRA-TEXT-RC                 PIC 9(9) comp.
029910        10 W1AN-TRA-FEHLER-KLASSE           PIC 9(9) comp.
029920*    -- Hilfsfelder für Schlüsseldaten
029930     05 W1AX-SCHLUESSELDATEN.
029940        10 W1AN-KEY-LEN                     PIC S9(9) COMP.
029950        10 W1AX-KEY-WERT                    PIC X(2048).
029960*    -- Hilfsfelder für aktuellen PSS des Transponders
029970     05 W1AX-PSS-TRANSPONDER.
029980        10 W1AX-PSS-AKT                     PIC X(32).
029990        10 W1AX-PSS-TRA-BGRP                PIC X(3).
030000*    -- Hilfsfelder für PSS bilden aus FE553
030010     05 W1AX-PSS-BILDEN.
030020        10 W1AX-553-AKTION                  PIC X(02).
030030        10 W1AN-553-DISPLAYLEVEL            PIC S9(9) COMP.
030040        10 W1AX-553-VIN                     PIC X(17).
030050        10 W1AX-553-KRYPTOREGION            PIC X(03).
030060        10 W1AX-553-DOMAENE                 PIC X(03).
030070        10 W1AX-553-BGRP                    PIC X(03).
030080        10 W1AN-553-KEYTYPE-ID              PIC S9(9) COMP.
030090        10 W1AN-553-FZ-ID-ZAHL              PIC S9(9) COMP.
030100        10 W1AN-553-TYPANLERNZAEHLER        PIC S9(9) COMP.
030110        10 W1AN-553-STGINDIVI               PIC S9(4) COMP.
030120        10 W1AN-553-BYTELEN                 PIC S9(9) COMP.
030130        10 W1AN-553-AUFVERS-REIN            PIC S9(9) COMP.
030140        10 W1AX-553-IPA-610-STAGE           PIC X(01).
030150        10 W1AX-553-IPA-620-VERSION         PIC X(05).
030160        10 W1AN-553-PSS-LEN                 PIC S9(9) COMP.
030170        10 W1AX-553-PSS-WERT                PIC x(256).
030180*
030190     05 W1AX-FAZITFF3.
030200*       -- Fehler(Meldungs-)nummer
030210        10 W1AN-FF3-FEHLERNUMMER         PIC S9(8) COMP.
030220        10 W1AX-FF3-FEHLER-PARM.
030230           20 W1AN-FF3-FEHLER-PARM-LEN   PIC S9(4) COMP.
030240           20 W1AX-FF3-FEHLER-PARM-TEXT  PIC X(254).
030250*       -- Variablen zum Ersetzen im Fehlertext
030260        10 W1AX-FF3-VAR-TAB.
030270           20 W1AN-FF3-VAR-TAB-ANZAHL    PIC S9(4) COMP.
030280           20 W1AX-FF3-VAR-TAB-TEXT.
030290              30 W1AX-FF3-VAR-ZEILE OCCURS 5.
030300                 35 W1AX-FF3-VAR-NAME    PIC X(20).
030310                 35 W1AX-FF3-VAR.
030320                    40 W1AN-FF3-VAR-LEN  PIC S9(4) COMP.
030330                    40 W1AX-FF3-VAR-TEXT PIC X(50).
030340
030350*    TABELLE FÜR AK-HINWEIS
030360*    AK Hinweis schreibt Aufrufer
030370     05 TXVR-TAB.
030380        10 TXVRAN-TAB-MAX               PIC S9(4) COMP.
030390        10 TXVRAN-I                     PIC S9(4) COMP.
030400        10 TXVRAX-BEREICH.
030410          15 TXVRAX-FELDER  OCCURS 20.
030420            20 TXVRAN-TEXT-VERARB       PIC S9(9) COMP.
030430            20 TXVRAN-TEXT-FEHLER-KLASSE PIC S9(9) COMP.
030440
030450*    TABELLE FÜR AK-TRANSPONDER
030460     05 TXX4-TAB.
030470        10 TXX4AN-TAB-MAX               PIC S9(4) COMP.
030480        10 TXX4AN-I                     PIC S9(4) COMP.
030490        10 TXX4AX-BEREICH.
030500          15 TXX4AX-FELDER  OCCURS 20.
030510            20 TXX4AX-TRANSPOND-ID      PIC X(8).
030520            20 TXX4AX-TRANSPOND-TYP     PIC X(4).
030530            20 TXX4AN-TEXT-VERARB       PIC S9(9) COMP.
030540            20 TXX4AN-TEXT-FEHLER-KLASSE PIC S9(9) COMP.
030550
030560 01  CSN-ALLE.
030570     10 CSN-RETURN-CODE                  PIC 9(8) COMP.
030580     10 CSN-REASON-CODE                  PIC 9(8) COMP.
030590     10 CSN-EXIT-DATA-LEN                PIC 9(8) COMP.
030600     10 CSN-EXIT-DATA                    PIC X(4).
030610     10 CSN-RULE-ARRAY-COUNT             PIC 9(8) COMP.
030620     10 CSN-RULE-ARRAY.
030630        15 CSN-RULE                      PIC X(8) OCCURS 4.
030640
030650     10 CSN-STATUS.
030660        25 CSN-TEXT-RC                   PIC S9(9) COMP.
030670        25 CSN-TEXT-FEHKL                PIC S9(9) COMP.
030680        25 CSN-FEHLER-PARM.
030690           30 CSN-FEHLER-PARM-LEN        PIC S9(4) COMP.
030700           30 CSN-FEHLER-PARM-TEXT       PIC X(254).
030710
030720*    CSNBXCB  -> Umrechnung Hex(in Character) nach Binär
030730*    CSNBXBC  -> Umrechnung Binär nach Hex(in Character)
030740 01  CSN-BXCB-BXBC-DT.
030750     10 BBCB-EXIT-DATA-LEN         PIC 9(8) COMP.
030760     10 BBCB-EXIT-DATA             PIC X(4).
030770     10 BBCB-TEXT-LEN              PIC 9(8) COMP.
030780     10 BBCB-SOURCE-TEXT           PIC X(5000).
030790     10 BBCB-TARGET-TEXT           PIC X(10000).
030800     10 BBCB-CODE-TABLE            PIC X(16).
030810*----------------------------------------------------------------
030820* Arbeitsbereich für Ein-/Ausgabe
030830*----------------------------------------------------------------
030840 01 W549.
030850*PCOPY=FE549V00,XXXX=W549
030851*  PROBA PCOPYANF
030852*  PROBA MEMBER=FE549V00 CODE=YB08 AUTH=ULRICH-WOL TYPE=S
030853*  PROBA  STAND  1.10.2020(10.31) LAN=COB
030855******************************************************************
030856* MEMBER: FE549V00                               FIRST: APRIL 2020
030857* TITLE:  SST STORED PROCEDURE FE549C - PROD.TELEGRAMME TRANSP.
030858* SA:     F3                                       SYS-NAME: FAZIT
030859* AUTHOR: WOLFGANG ULRICH, MSG SYSTEMS AG               TEL:
030860*
030861* DESC:   KOMMUNIKATIONS-SCHNITTSTELLE FÜR FE549C
030862*-----------------------------------------------------------------
030863* MOD: 00 03.08.02 WOLFGANG ULRICH, MSG SYSTEMS AG
030864* MOD:             NEUERSTELLUNG
030865******************************************************************
030866   05 W549-EIN.
030867*    -- AKTION
030868*    -- 01 : VS02
030869*    -- 02 : DT02
030870*    -- 03 : TRA4
030871     10 W549AX-AKTION              PIC X(02).
030872     10 W549AX-LOG-UTC-V-ID        PIC X(26).
030873     10 W549AX-LOG-V-ID            PIC X(26).
030874*    -- ZUM TRACE-ANKNIPSEN
030875     10 W549AX-V-ID-TRACE          PIC X(26).
030876     10 W549AN-TRACE-LEVEL         PIC S9(4) COMP.
030877*    -- AUSGABEN
030878   05 W549-AUS.
030879*    -- RETURNCODE
030880     10 W549AN-TEXT-RC             PIC S9(9) COMP.
030881     10 W549AN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
030882     10 W549AX-BESCHREIBUNG.
030883        20 W549AX-PROGRAMM         PIC X(8).
030884        20 W549AX-SECTION          PIC X(26).
030885        20 W549AX-INFO             PIC X(220).
030886     10 W549AX-FEHLER-PARM.
030887        20 W549AN-FEHLER-PARM-LEN  PIC S9(4) USAGE COMP.
030888        20 W549AX-FEHLER-PARM-TEXT PIC X(254).
030890*  PROBA PCOPYEND
031230*-----------------------------------------------------------------
031240*----------------------------------------------------------------
031250*
031260*----------------------------------------------------------------
031270 LINKAGE SECTION.
031280 01 S549.
031290*PCOPY=FE549V00,XXXX=S549
031291*  PROBA PCOPYANF
031292*  PROBA MEMBER=FE549V00 CODE=YB08 AUTH=ULRICH-WOL TYPE=S
031293*  PROBA  STAND  1.10.2020(10.31) LAN=COB
031295******************************************************************
031296* MEMBER: FE549V00                               FIRST: APRIL 2020
031297* TITLE:  SST STORED PROCEDURE FE549C - PROD.TELEGRAMME TRANSP.
031298* SA:     F3                                       SYS-NAME: FAZIT
031299* AUTHOR: WOLFGANG ULRICH, MSG SYSTEMS AG               TEL:
031300*
031301* DESC:   KOMMUNIKATIONS-SCHNITTSTELLE FÜR FE549C
031302*-----------------------------------------------------------------
031303* MOD: 00 03.08.02 WOLFGANG ULRICH, MSG SYSTEMS AG
031304* MOD:             NEUERSTELLUNG
031305******************************************************************
031306   05 S549-EIN.
031307*    -- AKTION
031308*    -- 01 : VS02
031309*    -- 02 : DT02
031310*    -- 03 : TRA4
031311     10 S549AX-AKTION              PIC X(02).
031312     10 S549AX-LOG-UTC-V-ID        PIC X(26).
031313     10 S549AX-LOG-V-ID            PIC X(26).
031314*    -- ZUM TRACE-ANKNIPSEN
031315     10 S549AX-V-ID-TRACE          PIC X(26).
031316     10 S549AN-TRACE-LEVEL         PIC S9(4) COMP.
031317*    -- AUSGABEN
031318   05 S549-AUS.
031319*    -- RETURNCODE
031320     10 S549AN-TEXT-RC             PIC S9(9) COMP.
031321     10 S549AN-TEXT-FEHLER-KLASSE  PIC S9(9) COMP.
031322     10 S549AX-BESCHREIBUNG.
031323        20 S549AX-PROGRAMM         PIC X(8).
031324        20 S549AX-SECTION          PIC X(26).
031325        20 S549AX-INFO             PIC X(220).
031326     10 S549AX-FEHLER-PARM.
031327        20 S549AN-FEHLER-PARM-LEN  PIC S9(4) USAGE COMP.
031328        20 S549AX-FEHLER-PARM-TEXT PIC X(254).
031330*  PROBA PCOPYEND
031670
031680*PCOPY=FE551W04
031681*  PROBA PCOPYANF
031682*  PROBA MEMBER=FE551W04 CODE=AC11 AUTH=PFATRISCH- TYPE=S
031683*  PROBA  STAND 12.01.2021(10.05) LAN=COB
031685******************************************************************
031686* FE551W Schnittstelle FE551 Parameter 2
031687* Der von der Produktion geschickte Anfragesatz
031688* ----------------------------------------------------------------
031689* VKMS-Telegramme: Steuergeräte
031690* -VKV1  VKMS Fahrzeug anlegen
031691* -VKD1  Anlernen VKMS-Teilnehmer neu und gebraucht
031692* -VKR1  Rückmeldung Anlernen VKMS-Teilnehmer
031693* VKMS-Telegramme: Mischverbau
031694* -LEG1  Anlernen WFS5- oder KS2-Slaves
031695* -BGR3  Meldung Baugruppen WFS5- oder KS2-Slaves
031696* VKMS-Telegramme: Transponder
031697* -VS02  Vorkommissionierung von Schlüsseln für WFS6
031698* -DT02  Transponder-Downloads in den WFS6-Master
031699* -TRA4  Angelernte Schlüssel aus WFS6-Master
031700******************************************************************
031701 01  S551-EINGABESATZ.
031702
031703*    -- gemeinsamer Kopf aller VKMS-Anfragetelegramme
031704     10 S551AX-E-KOPF.
031705*       -- "ECOSERF3"
031706        15 S551AX-E-SATZART                        PIC X(8).
031707        15 S551AN-E-LAENGE                         PIC 9(6).
031708        15 S551AX-E-ERSTELLT-AM.
031709           20 S551AX-E-EAM-JJJJ                    PIC X(4).
031710           20 S551AX-E-EAM-MM                      PIC X(2).
031711           20 S551AX-E-EAM-TT                      PIC X(2).
031712           20 S551AX-E-EAM-STU                     PIC X(2).
031713           20 S551AX-E-EAM-MIN                     PIC X(2).
031714           20 S551AX-E-EAM-SEC                     PIC X(2).
031715        15 S551AX-E-ZEITZONE                       PIC X(5).
031716        15 S551AX-E-ERFASSUNGSTERMINAL             PIC X(20).
031717        15 S551AX-E-SPRACH-KZ                      PIC X(2).
031718        15 S551AX-E-RESERVE1                       PIC X(20).
031719
031720*    -- Fahrzeug- oder Auftragsidentifikation
031721     10 S551AX-E-AUFTRAGS-ID.
031722        15 S551AX-E-VIN                            PIC X(17).
031723        15 S551AX-E-PKNR.
031724           20 S551AX-E-PK-WERK                     PIC X(2).
031725           20 S551AX-E-PK-SPJ                      PIC X(4).
031726           20 S551AX-E-PK-KNR                      PIC X(7).
031727        15 S551AX-E-PIN.
031728           20 S551AX-E-PIN-WERK                    PIC X(2).
031729           20 S551AX-E-PIN-SPJ                     PIC X(4).
031730           20 S551AX-E-PIN-KNR.
031731              25 S551AX-E-PIN-MONTAGESEG           PIC X(1).
031732              25 S551AX-E-PIN-WOCHE                PIC X(2).
031733              25 S551AX-E-PIN-LFDNR                PIC X(4).
031734        15 S551AX-E-RESERVE2                       PIC X(43).
031735
031736*    -- Nutzdaten
031737     10 S551AX-E-NUTZDATEN.
031738        15 S551AX-E-CONTAINER                      PIC X(4).
031739        15 S551AX-E-CONTAINERDATEN                 PIC X(999834).
031740
031741*       -- Container VKV1 ----------------------------------------
031742        15 S551AX-E-VKV1-DATEN REDEFINES S551AX-E-CONTAINERDATEN.
031743           20 S551AX-E-VKV1-CONTAINERKOPF.
031744              25 S551AX-E-VKV1-ANFRAGETYP          PIC X(1).
031745           20 S551AX-E-VKV1-LISTEN                 PIC X(999833).
031746*          -- die Baugruppenliste im container VKV1
031747           20 S551AX-E-VKV1-BAUGRUPPENLISTE
031748                           REDEFINES S551AX-E-VKV1-LISTEN.
031749              25 S551AX-E-VKV1-BGRP-KOPF.
031750                 30 S551AX-E-VKV1-BGRP-MARKIERUNG  PIC X(7).
031751                 30 S551AN-E-VKV1-BGRP-ANZAHL      PIC 9(3).
031752              25 S551AX-E-VKV1-BGRP-ARRAY.
031753                 30 S551AX-E-VKV1-BGRP-ZEILE OCCURS 200.
031754                    35 S551AX-E-VKV1-BGRP-NUMMER   PIC X(6).
031755                    35 S551AX-E-VKV1-BGRP-TNR      PIC X(20).
031756              25 S551AX-E-VKV1-BGRP-DAHINTER       PIC X(994623).
031757
031758*       -- Container VKD1 ----------------------------------------
031759        15 S551AX-E-VKD1-DATEN REDEFINES S551AX-E-CONTAINERDATEN.
031760           20 S551AX-E-VKD1-CONTAINERKOPF.
031761              25 S551AX-E-VKD1-ANFRAGETYP          PIC X(1).
031762           20 S551AX-E-VKD1-LISTEN                 PIC X(999833).
031763*          -- die Baugruppenliste im container VKD1
031764           20 S551AX-E-VKD1-SGLISTE
031765                           REDEFINES S551AX-E-VKD1-LISTEN.
031766              25 S551AX-E-VKD1-SG-KOPF.
031767                 30 S551AX-E-VKD1-SG-MARKIERUNG    PIC X(7).
031768                 30 S551AN-E-VKD1-SG-ANZAHL        PIC 9(3).
031769              25 S551AX-E-VKD1-SG-ARRAY.
031770                 30 S551AX-E-VKD1-SG-ZEILE OCCURS 115.
031771                    35 S551AX-E-VKD1-SG-BGRP       PIC X(6).
031772                    35 S551AX-E-VKD1-SG-SERIE-NR   PIC X(30).
031773                    35 S551AX-E-VKD1-SG-VIN        PIC X(17).
031774                    35 S551AX-E-VKD1-SG-ID-ZAHL    PIC X(4).
031775                    35 S551AX-E-VKD1-SG-PSSCHCKSU  PIC X(32).
031776                    35 S551AX-E-VKD1-SG-IDTCHCKSU  PIC X(32).
031777                    35 S551AX-E-VKD1-SG-RESERVE3   PIC X(1039).
031778              25 S551AX-E-VKD1-SG-DAHINTER         PIC X(866423).
031779
031780*       -- Container VKR1 ----------------------------------------
031781        15 S551AX-E-VKR1-DATEN REDEFINES S551AX-E-CONTAINERDATEN.
031782           20 S551AX-E-VKR1-CONTAINERKOPF.
031783              25 S551AX-E-VKR1-ANFRAGETYP          PIC X(1).
031784           20 S551AX-E-VKR1-LISTEN                 PIC X(999833).
031785*          -- die Baugruppenliste im container VKR1
031786           20 S551AX-E-VKR1-SGLISTE
031787                           REDEFINES S551AX-E-VKR1-LISTEN.
031788              25 S551AX-E-VKR1-SG-KOPF.
031789                 30 S551AX-E-VKR1-SG-MARKIERUNG    PIC X(7).
031790                 30 S551AN-E-VKR1-SG-ANZAHL        PIC 9(3).
031791              25 S551AX-E-VKR1-SG-ARRAY.
031792                 30 S551AX-E-VKR1-SG-ZEILE OCCURS 115.
031793                    35 S551AX-E-VKR1-SG-BGRP       PIC X(6).
031794                    35 S551AX-E-VKR1-SG-SERIE-NR   PIC X(30).
031795                    35 S551AX-E-VKR1-SG-VIN        PIC X(17).
031796                    35 S551AX-E-VKR1-SG-ID-ZAHL    PIC X(4).
031797                    35 S551AX-E-VKR1-SG-PSSCHCKSU  PIC X(32).
031798                    35 S551AX-E-VKR1-SG-IDTCHCKSU  PIC X(32).
031799                    35 S551AX-E-VKR1-SG-RESERVE3   PIC X(49).
031800              25 S551AX-E-VKR1-SG-DAHINTER         PIC X(980273).
031801
031802*       -- Container LEG1 ----------------------------------------
031803        15 S551AX-E-LEG1-DATEN REDEFINES S551AX-E-CONTAINERDATEN.
031804           20 S551AX-E-LEG1-CONTAINERKOPF.
031805              25 S551AX-E-LEG1-ANFRAGETYP          PIC X(1).
031806           20 S551AX-E-LEG1-LISTEN                 PIC X(999833).
031807*          -- die Baugruppenliste im container LEG1
031808           20 S551AX-E-LEG1-SGLISTE
031809                           REDEFINES S551AX-E-LEG1-LISTEN.
031810              25 S551AX-E-LEG1-SG-KOPF.
031811                 30 S551AX-E-LEG1-SG-LISTE-ART     PIC X(7).
031812                 30 S551AN-E-LEG1-SG-LISTE-ANZ     PIC 9(3).
031813              25 S551AX-E-LEG1-SG-ARRAY.
031814                 30 S551AX-E-LEG1-SG-ZEILE OCCURS 50.
031815                    35 S551AX-E-LEG1-SG-BGRP       PIC X(6).
031816                    35 S551AX-E-LEG1-SG-SERIE-NR   PIC X(30).
031817                    35 S551AX-E-LEG1-SG-WFS-VIN    PIC X(17).
031818                    35 S551AX-E-LEG1-SG-WFS-ST     PIC X(20).
031819                    35 S551AX-E-LEG1-SG-WFS-ST-SLV PIC X(20).
031820                    35 S551AX-E-LEG1-SG-WFS-ST-SHE PIC X(10).
031821                    35 S551AX-E-LEG1-SG-KSB-KONFIG PIC X(14).
031822                    35 S551AX-E-LEG1-SG-CHALLA     PIC X(8).
031823                    35 S551AX-E-LEG1-SG-CHECKSUM   PIC X(10).
031824                    35 S551AX-E-LEG1-SG-RESERVE3   PIC X(115).
031825*             -- S551AX-E-LEG1-LISTEN                    999833
031826*             -- 10 + 50*250                           -  12510
031827*             -- REST                                  = 987323
031828              25 S551AX-E-LEG1-SG-DAHINTER         PIC X(987323).
031829
031830*       -- Container BGR3 ----------------------------------------
031831        15 S551AX-E-BGR3-DATEN REDEFINES S551AX-E-CONTAINERDATEN.
031832           20 S551AX-E-BGR3-CONTAINERKOPF.
031833              25 S551AX-E-BGR3-ANFRAGETYP          PIC X(1).
031834           20 S551AX-E-BGR3-LISTEN                 PIC X(999833).
031835*          -- die Baugruppenliste im Container BGR3
031836           20 S551AX-E-BGR3-SGLISTE
031837                           REDEFINES S551AX-E-BGR3-LISTEN.
031838              25 S551AX-E-BGR3-SG-KOPF.
031839                 30 S551AX-E-BGR3-SG-LISTE-ART     PIC X(7).
031840                 30 S551AN-E-BGR3-SG-LISTE-ANZ     PIC 9(3).
031841              25 S551AX-E-BGR3-SG-ARRAY.
031842                 30 S551AX-E-BGR3-SG-ZEILE OCCURS 50.
031843                    35 S551AX-E-BGR3-SG-BGRP       PIC X(6).
031844                    35 S551AX-E-BGR3-SG-SERIE-NR   PIC X(30).
031845                    35 S551AX-E-BGR3-SG-WFS-VIN    PIC X(17).
031846                    35 S551AX-E-BGR3-SG-WFS-ST     PIC X(20).
031847                    35 S551AX-E-BGR3-SG-WFS-ST-SLV PIC X(20).
031848                    35 S551AX-E-BGR3-SG-WFS-ST-SHE PIC X(10).
031849                    35 S551AX-E-BGR3-SG-KSB-KONFIG PIC X(14).
031850                    35 S551AX-E-BGR3-SG-CHALLA     PIC X(8).
031851                    35 S551AX-E-BGR3-SG-CHECKSUM   PIC X(10).
031852                    35 S551AX-E-BGR3-SG-RESERVE3   PIC X(115).
031853*             -- S551AX-E-BGR3-LISTEN                    999833
031854*             -- 10 + 50*250                           -  12510
031855*             -- REST                                  = 987323
031856              25 S551AX-E-BGR3-SG-DAHINTER         PIC X(987323).
031857
031858*       -- Container VS02 ----------------------------------------
031859*       -- Satzaufbau für den variablen Anfrage-Teil mit
031860*       --   bis zu 8 Schubladen
031861*       --   - Anfragetyp              1 Stelle
031862*       --   - Schließsatz-ID         27 Stellen
031863*       --   - Reserve                54 Stellen
031864*       --   - Anzahl Schubladen       3 Stellen
031865*       --   - pro Baugruppe         400 Stellen
031866*       --   85 + 8*400                = 3285
031867*       ----------------------------------------------------------
031868        15 S551AX-E-VS02-DATEN  REDEFINES S551AX-E-CONTAINERDATEN.
031869          20 S551AX-E-VS02-CONTAINERKOPF.
031870             25 S551AX-E-VS02-ANFRAGETYP           PIC X(1).
031871             25 S551AX-E-VS02-SCHLIESSSATZ-ID      PIC X(27).
031872             25 S551AX-E-VS02-RESERVE              PIC X(54).
031873          20 S551AX-E-VS02-LISTEN                  PIC X(3203).
031874*         -- die Schubladenliste im Container VS02
031875          20 S551AX-E-VS02-SCHUBLADENLISTE
031876                               REDEFINES   S551AX-E-VS02-LISTEN.
031877             25 S551AX-E-VS02-SCHU-KOPF.
031878                30 S551AN-E-VS02-SCHU-ANZAHL       PIC 9(3).
031879             25 S551AX-E-VS02-SCHU-ARRAY.
031880                30 S551AX-E-VS02-SCHU-ZEILE OCCURS 8.
031881                   35 S551AX-E-VS02-S-CRYPTBOX-ID    PIC X(8).
031882                   35 S551AX-E-VS02-S-CRYPTBOX-HOST  PIC X(32).
031883                   35 S551AX-E-VS02-S-CRYPTBOX-ZAHL  PIC X(2).
031884                   35 S551AX-E-VS02-S-CRYPTBOX-CHALL PIC X(32).
031885                   35 S551AX-E-VS02-S-CRYPTBOX-SIGN  PIC X(32).
031886                   35 S551AX-E-VS02-S-TRANSPOND-ID   PIC X(8).
031887                   35 S551AX-E-VS02-S-TRANSPOND-TYP  PIC X(4).
031888                   35 S551AX-E-VS02-S-TRANSPOND-MEM  PIC X(256).
031889                   35 S551AX-E-VS02-S-RESERVE        PIC X(26).
031890          20 S551AX-E-VS02-DATEN-DAHINTER          PIC X(996549).
031891*       -- Container DT02 ----------------------------------------
031892*       -- Satzaufbau für den variablen Anfrage-Teil
031893*       --   - Anfragetyp              1 Stelle
031894*       ----------------------------------------------------------
031895        15 S551AX-E-DT02-DATEN  REDEFINES S551AX-E-CONTAINERDATEN.
031896           20 S551AX-E-DT02-CONTAINERKOPF.
031897              25 S551AX-E-DT02-ANFRAGETYP          PIC X(1).
031898           20 S551AX-E-DT02-DAHINTER               PIC X(999833).
031899*       -- Container TRA4 ----------------------------------------
031900*       -- Satzaufbau für den variablen Anfrage-Teil
031901*       --   - WFS-ID-Daten (Status) 835 Stellen
031902*       ----------------------------------------------------------
031903        15 S551AX-E-TRA4-DATEN  REDEFINES S551AX-E-CONTAINERDATEN.
031904          20 S551AX-E-TRA4-CONTAINERKOPF.
031905             25 S551AX-E-TRA4-WFS-ID-DATEN         PIC X(835).
031906          20 S551AX-E-TRA4-DAHINTER                PIC X(998999).
031907*    -- die Parameterliste im Container VKV1
031908*    -- dieser Bereich ist im Container variabel positioniert
031909 01  S551-E-VKV1-PARAMETERLISTE.
031910     10 S551AX-E-VKV1-PARAM-KOPF.
031911        15 S551AX-E-VKV1-PARAM-MARKIERUNG          PIC X(7).
031912        15 S551AN-E-VKV1-PARAM-ANZAHL              PIC 9(3).
031913     10 S551AX-E-VKV1-PARAM-ARRAY.
031914        15 S551AX-E-VKV1-PARAM-ZEILE OCCURS 300.
031915           20 S551AX-E-VKV1-PARAM-NAME             PIC X(6).
031916           20 S551AX-E-VKV1-PARAM-OBJTYP-ID        PIC X(4).
031917           20 S551AX-E-VKV1-PARAM-WERT             PIC X(32).
031919*  PROBA PCOPYEND
034050***PCOPY=FE551X03 Änderungen von Juan 23.06.23 um 16:50 zurückges.
034060*PCOPY=FE551X04
034061*  PROBA PCOPYANF
034062*  PROBA MEMBER=FE551X04 CODE=CC02 AUTH=CHOLEWIK-A TYPE=S
034063*  PROBA  STAND  1.05.2025(23.46) LAN=COB
034065******************************************************************
034066* FE551X Schnittstelle FE551 Parameter 3
034067* Der Ausgabesatz an die Produktion
034068* ----------------------------------------------------------------
034069* VKMS-Telegramme: Steuergeräte
034070* -VKV1  VKMS Fahrzeug anlegen
034071* -VKD1  Anlernen VKMS-Teilnehmer neu und gebraucht
034072* -VKR1  Rückmeldung Anlernen VKMS-Teilnehmer
034073* VKMS-Telegramme: Mischverbau
034074* -LEG1  Anlernen WFS5- oder KS2-Slaves
034075* -BGR3  Meldung Baugruppen WFS5- oder KS2-Slaves
034076* VKMS-Telegramme: Transponder
034077* -VS02  Vorkommissionierung von Schlüsseln für WFS6
034078* -DT02  Transponder-Downloads in den WFS6-Master
034079* -TRA4  Angelernte Schlüssel aus WFS6-Master
034080******************************************************************
034081* MOD: 04 01.05.2025 Anna Cholewik, TSI
034082* MOD:               FAZIT-22497
034083******************************************************************
034084 01  S551-AUSGABESATZ.
034085*    -- gemeinsamer Kopf aller VKMS-Antworttelegramme
034086     10 S551AX-A-KOPF.
034087*       -- "ECOSREP3"
034088        15 S551AX-A-SATZART                        PIC X(8).
034089        15 S551AN-A-LAENGE                         PIC 9(6).
034090        15 S551AX-A-ERSTELLT-AM                    PIC X(14).
034091        15 S551AX-A-ZEITZONE                       PIC X(5).
034092        15 S551AX-A-ERFASSUNGSTERMINAL             PIC X(20).
034093        15 S551AX-A-VERARBEITET-AM.
034094           20 S551AX-A-VAM-JJJJ                    PIC X(4).
034095           20 S551AX-A-VAM-MM                      PIC X(2).
034096           20 S551AX-A-VAM-TT                      PIC X(2).
034097           20 S551AX-A-VAM-STU                     PIC X(2).
034098           20 S551AX-A-VAM-MIN                     PIC X(2).
034099           20 S551AX-A-VAM-SEC                     PIC X(2).
034100        15 S551AX-A-RESERVE1                       PIC X(20).
034101
034102*    -- Fahrzeug- oder Auftragsidentifikation
034103     10 S551AX-A-AUFTRAGS-ID.
034104        15 S551AX-A-VIN                            PIC X(17).
034105        15 S551AX-A-PKNR                           PIC X(13).
034106        15 S551AX-A-PIN                            PIC X(13).
034107        15 S551AX-A-RESERVE2                       PIC X(31).
034108
034109*    -- Nutzdaten
034110     10 S551AX-A-NUTZDATEN.
034111        15 S551AX-A-CONTAINER                      PIC X(4).
034112        15 S551AX-A-CONTAINERDATEN                 PIC X(999834).
034113
034114*       -- die Baugruppenliste im Ausgabecontainer VKV1
034115        15 S551AX-A-VKV1-BAUGRUPPENLISTE
034116                               REDEFINES S551AX-A-CONTAINERDATEN.
034117           20 S551AX-A-VKV1-BGRP-KOPF.
034118              25 S551AX-A-VKV1-BGRP-MARKIERUNG     PIC X(7).
034119              25 S551AN-A-VKV1-BGRP-ANZAHL         PIC 9(3).
034120           20 S551AX-A-VKV1-BGRP-ARRAY.
034121              25 S551AX-A-VKV1-BGRP-ZEILE OCCURS 200.
034122                 30 S551AX-A-VKV1-BGRP-NUMMER      PIC X(6).
034123                 30 S551AX-A-VKV1-BGRP-ERGEBNIS.
034124                    35 S551AX-A-VKV1-SYSKENNUNG    PIC X(3).
034125                    35 S551AX-A-VKV1-FEHLERNUMMER  PIC X(5).
034126                    35 S551AX-A-VKV1-TRZ           PIC X(2).
034127                    35 S551AX-A-VKV1-KLARTEXT      PIC X(199).
034128*                -- Downloads aufgrund Korrektur geändert
034129                 30 S551AX-A-VKV1-BGRP-DLCKORRAE   PIC X(1).
034130*                -- Baugruppenindividualisierung ab Lieferant
034131                 30 S551AX-A-VKV1-BGRP-INDIVABLIEF PIC X(1).
034132*                -- VKMS-DLC-Version
034133                 30 S551AX-A-VKV1-BGRP-VKMSDLCVERS PIC X(2).
034134*                -- WFS-DLC-Version
034135                 30 S551AX-A-VKV1-BGRP-WFSDLCVERS  PIC X(2).
034136*                -- WFS über VKMS bedatet
034137                 30 S551AX-A-VKV1-BGRP-WFSUEVKMS   PIC X(1).
034138*                -- KS-DLC-Version
034139                 30 S551AX-A-VKV1-BGRP-KSDLCVERS   PIC X(2).
034140*                -- KS über VKMS bedatet
034141                 30 S551AX-A-VKV1-BGRP-KSUEVKMS    PIC X(1).
034142
034143                 30 S551AX-A-VKV1-BGRP-RESERVE3    PIC X(35).
034144           20 S551AX-A-VKV1-BGRP-DAHINTER          PIC X(947824).
034145
034146*       -- die Downloadcontainerliste im Ausgabecontainer VKD1
034147        15 S551AX-A-VKD1-DATEN
034148                               REDEFINES S551AX-A-CONTAINERDATEN.
034149           20 S551AX-A-VKD1-DLC-KOPF.
034150              25 S551AX-A-VKD1-DLC-MARKIERUNG      PIC X(7).
034151              25 S551AN-A-VKD1-DLC-ANZAHL          PIC 9(3).
034152           20 S551AX-A-VKD1-DLC-ARRAY.
034153              25 S551AX-A-VKD1-DLC-ZEILE OCCURS 115.
034154                 30 S551AX-A-VKD1-DLC-BGRP-NUMMER  PIC X(6).
034155                 30 S551AX-A-VKD1-DLC-SG           PIC X(30).
034156                 30 S551AX-A-VKD1-DLC-ERGEBNIS.
034157                    35 S551AX-A-VKD1-SYSKENNUNG    PIC X(3).
034158                    35 S551AX-A-VKD1-FEHLERNUMMER  PIC X(5).
034159                    35 S551AX-A-VKD1-TRZ           PIC X(2).
034160                    35 S551AX-A-VKD1-KLARTEXT      PIC X(199).
034161                 30 S551AX-A-VKD1-DLC-DLC          PIC X(8192).
034162                 30 S551AX-A-VKD1-DLC-VERICHCKSU   PIC X(32).
034163                 30 S551AX-A-VKD1-DLC-TEIL         pic x(02).
034164                 30 S551AX-A-VKD1-DLC-ANZTEIL      pic x(02).
034165                 30 S551AX-A-VKD1-DLC-RESERVE4     PIC X(77).
034166           20 S551AX-A-VKD1-DLC-DAHINTER           PIC X(16574).
034167
034168*       -- die Baugruppenliste im Ausgabecontainer VKR1
034169        15 S551AX-A-VKR1-DATEN REDEFINES S551AX-A-CONTAINERDATEN.
034170           20 S551AX-A-VKR1-KOPF.
034171              25 S551AX-A-VKR1-MARKIERUNG          PIC X(7).
034172              25 S551AN-A-VKR1-ANZAHL              PIC 9(3).
034173           20 S551AX-A-VKR1-BGRP-ARRAY.
034174              25 S551AX-A-VKR1-BGRP-ZEILE OCCURS 115.
034175                 30 S551AX-A-VKR1-BGRP-NUMMER      PIC X(6).
034176                 30 S551AX-A-VKR1-SG               PIC X(30).
034177                 30 S551AX-A-VKR1-ERGEBNIS.
034178                    35 S551AX-A-VKR1-SYSKENNUNG    PIC X(3).
034179                    35 S551AX-A-VKR1-FEHLERNUMMER  PIC X(5).
034180                    35 S551AX-A-VKR1-TRZ           PIC X(2).
034181                    35 S551AX-A-VKR1-KLARTEXT      PIC X(199).
034182                 30 S551AX-A-VKR1-RESERVE4         PIC X(55).
034183           20 S551AX-A-VKR1-DAHINTER               PIC X(965324).
034184
034185*       -- die Downloadcontainerliste im Ausgabecontainer LEG1
034186        15 S551AX-A-LEG1-DATEN
034187                               REDEFINES S551AX-A-CONTAINERDATEN.
034188           20 S551AX-A-LEG1-DLC-KOPF.
034189              25 S551AX-A-LEG1-DLC-LISTE-ART       PIC X(7).
034190              25 S551AN-A-LEG1-DLC-LISTE-ANZ       PIC 9(3).
034191           20 S551AX-A-LEG1-DLC-ARRAY.
034192              25 S551AX-A-LEG1-DLC-ZEILE OCCURS 50.
034193                 30 S551AX-A-LEG1-DLC-BGRP-NUMMER  PIC X(6).
034194                 30 S551AX-A-LEG1-DLC-SG           PIC X(30).
034195                 30 S551AX-A-LEG1-DLC-ERGEBNIS.
034196                    35 S551AX-A-LEG1-SYSKENNUNG    PIC X(3).
034197                    35 S551AX-A-LEG1-FEHLERNUMMER  PIC X(5).
034198                    35 S551AX-A-LEG1-TRZ           PIC X(2).
034199                    35 S551AX-A-LEG1-KLARTEXT      PIC X(199).
034200                 30 S551AX-A-LEG1-DLC-WFS-DLC.
034201                    35 S551AX-A-LEG1-DLC-WFS-D     PIC X(168).
034202                 30 S551AX-A-LEG1-DLC-WFS-DLC-SHE.
034203                    35 S551AX-A-LEG1-DLC-WFS-DS    PIC X(352).
034204                 30 S551AX-A-LEG1-DLC-KS-DLC.
034205                    35 S551AX-A-LEG1-DLC-KS-IKA    PIC X(68).
034206                    35 S551AX-A-LEG1-DLC-KS-IKAV   PIC X(68).
034207                    35 S551AX-A-LEG1-DLC-KS-GFA    PIC X(68).
034208                 30 S551AX-A-LEG1-DLC-KS-DLC-SHE.
034209                    35 S551AX-A-LEG1-DLC-KS-MEKS   PIC X(192).
034210                    35 S551AX-A-LEG1-DLC-KS-IKAS   PIC X(192).
034211                    35 S551AX-A-LEG1-DLC-KS-GFAS   PIC X(192).
034212                 30 S551AX-A-LEG1-DLC-RESERVE4     PIC X(155).
034213*          -- CONTAINERDATEN                             999834
034214*          -- 10 + 50*1700                             -  85010
034215*          -- REST                                     = 914824
034216           20 S551AX-A-LEG1-DLC-DAHINTER           PIC X(914824).
034217
034218*       -- die Baugruppenliste im Ausgabecontainer BGR3
034219        15 S551AX-A-BGR3-DATEN REDEFINES S551AX-A-CONTAINERDATEN.
034220           20 S551AX-A-BGR3-KOPF.
034221              25 S551AX-A-BGR3-LISTE-ART           PIC X(7).
034222              25 S551AN-A-BGR3-LISTE-ANZ           PIC 9(3).
034223           20 S551AX-A-BGR3-BGRP-ARRAY.
034224              25 S551AX-A-BGR3-BGRP-ZEILE OCCURS 50.
034225                 30 S551AX-A-BGR3-BGRP-NUMMER      PIC X(6).
034226                 30 S551AX-A-BGR3-SG               PIC X(30).
034227                 30 S551AX-A-BGR3-ERGEBNIS.
034228                    35 S551AX-A-BGR3-SYSKENNUNG    PIC X(3).
034229                    35 S551AX-A-BGR3-FEHLERNUMMER  PIC X(5).
034230                    35 S551AX-A-BGR3-TRZ           PIC X(2).
034231                    35 S551AX-A-BGR3-KLARTEXT      PIC X(199).
034232*          -- CONTAINERDATEN                             999834
034233*          -- 10 + 50*245                              -  12260
034234*          -- REST                                     = 987574
034235           20 S551AX-A-BGR3-DAHINTER               PIC X(987574).
034236
034237*       -- Containerdaten VS02 --------------------------
034238*       -- Satzaufbau für den variablen Antwort-Teil mit
034239*       -- bis zu 8 Schubladen
034240*       -- - Verarbeitsergebnis       1 Stelle
034241*       -- - Anzahl Transponder VKV1  2 Stellen
034242*       -- - Anzahl Transponder FAZIT 2 Stellen
034243*       -- - Anzahl Schubladen        3 Stellen
034244*       -- - pro Schublade         2268 Stellen
034245*       -- 8 + 8*2268                 = 18152
034246*       -------------------------------------------------
034247        15 S551AX-A-VS02-DATEN REDEFINES S551AX-A-CONTAINERDATEN.
034248          20 S551AX-A-VS02-LISTEN                  PIC X(18152).
034249*         -- die Schubladenliste im Container VS02
034250          20 S551AX-A-VS02-SCHUBLADENLISTE
034251                               REDEFINES S551AX-A-VS02-LISTEN.
034252            25 S551AX-A-VS02-SCHU-KOPF.
034253*            -- Bitweise Kodierung von Infos, gesetzt wenn:
034254*            -- Bit 0 (Hex 01): Anzahl ok-Transponder unpassend
034255*            -- Bit 1 (Hex 02): Keine Schließsatznummer zugeordnet
034256*            -- Bit 2 (Hex 04): Fahrzeug-PIN-Label ist zugeordnet
034257*            -- Bit 3-7: reserviert, gefüllt mit 0
034258             30 S551AX-A-VS02-S-VERARB-GESAMT      PIC X(1).
034259             30 S551AX-A-VS02-TSP-ANZAHL-VKV.
034260                35 S551AN-A-VS02-TSP-ANZAHL-VKV    PIC 9(2).
034261             30 S551AX-A-VS02-TSP-ANZAHL-FAZIT.
034262                35 S551AN-A-VS02-TSP-ANZAHL-FAZIT  PIC 9(2).
034263             30 S551AX-A-VS02-SCHU-ANZAHL.
034264                35 S551AN-A-VS02-SCHU-ANZAHL       PIC 9(3).
034265           25 S551AX-A-VS02-SCHU-ARRAY.
034266*            -- Schubladen, je 2268
034267             30 S551AX-A-VS02-SCHU-ZEILE OCCURS 8.
034268*               -- Voraussichtliche Nummer, 501-508 oder leer
034269                35 S551AX-A-VS02-S-BGRP-NUMMER     PIC X(3).
034270                35 S551AX-A-VS02-S-TRANSPOND-ID    PIC X(8).
034271                35 S551AX-A-VS02-SCHU-ERGEBNIS.
034272*                  -- INHALT = 'FAZ'
034273                   40 S551AX-A-VS02-FEHLER-SYSTEM  PIC X(3).
034274                   40 S551AN-A-VS02-FEHLER-NR      PIC 9(5).
034275*                  -- INHALT = ': '
034276                   40 S551AX-A-VS02-FEHLER-TRENN   PIC X(2).
034277                   40 S551AX-A-VS02-FEHLER-TEXT    PIC X(199).
034278                35 S551AX-A-VS02-S-TRANSPOND-DL    PIC X(2048).
034279          20 S551AX-A-VS02-LISTEN-DAHINTER         PIC X(981682).
034280
034281*       -- Containerdaten DT02 --------------------------
034282*       -- Satzaufbau für den variablen Antwort-Teil mit
034283*       -- bis zu 8 Transponder
034284*       -- - DL-Satz Transponder DL5  400 Stelle
034285*       -- - Anzahl Transponder VKV1    2 Stellen
034286*       -- - Anzahl Transponder DL4     3 Stellen
034287*       -- - pro Transponder          300 Stellen
034288*       -- 405 + 8*300                = 2805
034289*       -------------------------------------------------
034290        15 S551AX-A-DT02-DATEN REDEFINES S551AX-A-CONTAINERDATEN.
034291           20 S551AX-A-DT02-LISTEN                 PIC X(2805).
034292*          -- die Transponder im Container DT02
034293           20 S551AX-A-DT02-TRANSP-LISTE
034294                                  REDEFINES S551AX-A-DT02-LISTEN.
034295             25 S551AX-A-DT02-TRANSPOND-KOPF.
034296                30 S551AX-A-DT02-TRANSPOND-DL5     PIC X(400).
034297                30 S551AX-A-DT02-TSP-ANZAHL-VKV.
034298                   35 S551AN-A-DT02-TSP-ANZAHL-VKV PIC 9(2).
034299                30 S551AX-A-DT02-TSP-ANZAHL-DL4.
034300                   35 S551AN-A-DT02-TSP-ANZAHL-DL4 PIC 9(3).
034301             25 S551AX-A-DT02-TRANSP-ARRAY.
034302*               -- DL4-Transponder, je 300
034303                30 S551AX-A-DT02-TRANSP-ZEILE OCCURS 8.
034304*                  -- 501-508 oder leer
034305                   35 S551AX-A-DT02-TSP-BGRP-NUMMER  PIC X(3).
034306                   35 S551AX-A-DT02-TSP-TRANSPOND-ID PIC X(8).
034307                   35 S551AX-A-DT02-TSP-TRANSPOND-DL PIC X(289).
034308           20 S551AX-A-DT02-LISTEN-DAHINTER       PIC X(997029).
034309
034310*       -- Containerdaten TRA4 ---------------------------------
034311*       -- Satzaufbau für den variablen Antwort-Teil mit
034312*       -- bis zu 8 Transponder
034313*       -- - Verarbeitsergebnis            1 Stelle
034314*       -- - Anzahl Transponder VKV1       2 Stellen
034315*       -- - Anzahl Transponder FAZIT      2 Stellen
034316*       -- - Anzahl Transponder WFS Master 3 Stellen
034317*       -- - pro Transponder             220 Stellen
034318*       -- 8 + 8*220                       = 1768
034319*       --------------------------------------------------------
034320        15 S551AX-A-TRA4-DATEN REDEFINES S551AX-A-CONTAINERDATEN.
034321          20 S551AX-A-TRA4-LISTEN                  PIC X(1768).
034322*         -- die Transponder im Container TRA4
034323          20 S551AX-A-TRA4-TRANSP-LISTE
034324                                  REDEFINES S551AX-A-TRA4-LISTEN.
034325            25 S551AX-A-TRA4-TRANSPOND-KOPF.
034326*             -- Bitweise kodierung von Infos, gesetzt wenn:
034327*             --  0 (Hex 01): Anzahl ok-Transponder unpassend
034328*             --  1 (Hex 02): Keine Schliesssatznr. zugeordnet
034329*             --  2 (Hex 04): Fahrzeug-PIN-Label ist zugeordnet
034330*             --  3-7: reserviert, gefüllt mit 0
034331              30 S551AX-A-TRA4-T-VERARB-GESAMT     PIC X(1).
034332              30 S551AX-A-TRA4-TSP-ANZAHL-VKV.
034333                 35 S551AN-A-TRA4-TSP-ANZAHL-VKV   PIC 9(2).
034334              30 S551AX-A-TRA4-TSP-ANZAHL-FAZIT.
034335                 35 S551AN-A-TRA4-TSP-ANZAHL-FAZIT PIC 9(2).
034336              30 S551AX-A-TRA4-TSP-ANZAHL-WFS.
034337                 35 S551AN-A-TRA4-TSP-ANZAHL-WFS   PIC 9(3).
034338            25 S551AX-A-TRA4-TRANSP-ARRAY.
034339*             -- Transponder,  je 220
034340              30 S551AX-A-TRA4-TRANSP-ZEILE OCCURS 8.
034341*                -- Nummer, 501-508 oder leer
034342                 35 S551AX-A-TRA4-TSP-BGRP-NUMMER  PIC X(3).
034343                 35 S551AX-A-TRA4-TSP-TRANSPOND-ID PIC X(8).
034344                 35 S551AX-A-TRA4-TSP-ERGEBNIS.
034345*                   -- INHALT = 'FAZ'
034346                    40 S551AX-A-TRA4-FEHLER-SYSTEM PIC X(3).
034347                    40 S551AN-A-TRA4-FEHLER-NR     PIC 9(5).
034348*                   -- INHALT = ': '
034349                    40 S551AX-A-TRA4-FEHLER-TRENN  PIC X(2).
034350                    40 S551AX-A-TRA4-FEHLER-TEXT   PIC X(199).
034351          20 S551AX-A-TRA4-LISTEN-DAHINTER         PIC X(998066).
034352*       -- Fehlerinformation für alle Container
034353        15 S551AX-A-FEHLERINFORMATION
034354                               REDEFINES S551AX-A-CONTAINERDATEN.
034355           20 S551AX-A-FEH-ERGEBNIS.
034356              25 S551AX-A-FEH-SYSKENN              PIC X(3).
034357              25 S551AN-A-FEH-NUMMER               PIC 9(5).
034358              25 S551AX-A-FEH-TRZ                  PIC X(2).
034359              25 S551AX-A-FEH-KLARTEXT             PIC X(199).
034360           20 S551AX-A-FEH-REST1                   PIC X(999625).
034361
034362*    -- die Downloadcontainerliste im Ausgabecontainer VKV1
034363*    -- dieser Bereich ist im container variabel positioniert
034364 01  S551-A-VKV1-DLCLISTE.
034365     10 S551AX-A-VKV1-DLC-KOPF.
034366        15 S551AX-A-VKV1-DLC-MARKIERUNG            PIC X(7).
034367        15 S551AN-A-VKV1-DLC-ANZAHL                PIC 9(3).
034368     10 S551AX-A-VKV1-DLC-ARRAY.
034369        15 S551AX-A-VKV1-DLC-ZEILE OCCURS 115.
034370           20 S551AX-A-VKV1-DLC-BGRP-NUMMER        PIC X(6).
034371           20 S551AX-A-VKV1-DLC-DLC                PIC X(8192).
034372           20 S551AX-A-VKV1-DLC-VERICHCKSU         PIC X(32).
034373           20 S551AX-A-VKV1-DLC-RESERVE5           PIC X(50).
034375*  PROBA PCOPYEND
037190
037200*----------------------------------------------------------------
037210*
037220*----------------------------------------------------------------
037230 PROCEDURE DIVISION USING S549
037240                          S551-EINGABESATZ
037250                          S551-AUSGABESATZ.
037260
037270*----------------------------------------------------------------
037280* HAUPTSTEUERUNG
037290*----------------------------------------------------------------
037300 A00-STEUERUNG SECTION.
037310     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
037320     DISPLAY "++ DEBUG 2.0 EuA-Barcelona  FE549C "
037330     DISPLAY "++ Debug set in source 2025-12-11-14.01.21.558994"
037340     DISPLAY "++ ...Let the Trace be with you..."
037350     END-IF                                           *>++DELETE
037360     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
037370       DISPLAY "++25889-->A00-STEUERUNG SECTION.        "
037380     DISPLAY "++W549AX-V-ID-TRACE = "
037390        W549AX-V-ID-TRACE                             *>++DELETE
037400     DISPLAY "++W549AN-TRACE-LEVEL = "
037410        W549AN-TRACE-LEVEL                            *>++DELETE
037420     END-IF                                           *>++DELETE
037430
037440     PERFORM A10-VORLAUF
037450
037460     PERFORM A20-VERARBEITUNG
037470
037480     PERFORM A30-NACHLAUF
037490
037500     CONTINUE.
037510 A00-STEUERUNG-END.
037520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
037530       DISPLAY "++25889-->A00-STEUERUNG-END.            "
037540     DISPLAY "++W549AX-V-ID-TRACE = "
037550        W549AX-V-ID-TRACE                             *>++DELETE
037560     DISPLAY "++W549AN-TRACE-LEVEL = "
037570        W549AN-TRACE-LEVEL                            *>++DELETE
037580     END-IF                                           *>++DELETE
037590     EXIT.
037600
037610
037620*-----------------------------------------------------------------
037630* VORARBEITEN
037640*-----------------------------------------------------------------
037650 A10-VORLAUF SECTION.
037660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
037670       DISPLAY "++25889-->A10-VORLAUF SECTION.          "
037680     DISPLAY "++W549AX-V-ID-TRACE = "
037690        W549AX-V-ID-TRACE                             *>++DELETE
037700     DISPLAY "++W549AN-TRACE-LEVEL = "
037710        W549AN-TRACE-LEVEL                            *>++DELETE
037720     END-IF                                           *>++DELETE
037730
037740     INITIALIZE W1
037750
037760*V11 IR --> --------------------------------------------------
037770     MOVE SPACE                     TO W1AX-TRALOG-TEXT
037780     MOVE I1AN-NA                   TO W1AN-AUFB10
037790     STRING '00;A10-VORLAUF; 1.0. Anfang '
037800            ' I1AN-NA = '              W1AN-AUFB10
037810            '; S540AX-A-SCHREIBEN = '  S540AX-A-SCHREIBEN
037820     DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
037830     PERFORM Q92-TRALOG-ZEILE
037840*V11 <-- -------------------------------------------------
037850*    -- Eingabebereich in Arbeitsbereich übernehmen
037860     MOVE S549                     TO W549
037870
037880     MOVE ZERO                     TO W549AN-TEXT-RC
037890     MOVE K1AN-OK                  TO W549AN-TEXT-FEHLER-KLASSE
037900     SET U1AX-VERARB-OK            TO TRUE
037910
037920*    -- trace-logging
037930     PERFORM Q01-TRALOG-START
037940
037950     MOVE '01;A10-VORLAUF;Start FE549'
037960                                   TO W1AX-TRALOG-TEXT
037970     PERFORM Q92-TRALOG-ZEILE
037980
037990*    -- Umgebungsinformation, Instanzparameter
038000     PERFORM P01-INSTANZPARAMETER
038010
038020*    -- INITIALISIERUNG AUSKUNFT HINWEIS-TABELLE
038030*V11 MOVE SPACE TO TXVR-TAB
038040     INITIALIZE    TXVR-TAB
038050     MOVE ZERO  TO TXVRAN-I
038060     MOVE 20    TO TXVRAN-TAB-MAX
038070
038080*    -- INITIALISIERUNG AUSKUNFT TRANSPONDER-TABELLE
038090*V11 MOVE SPACE TO TXX4-TAB
038100     INITIALIZE    TXX4-TAB
038110     MOVE ZERO  TO TXX4AN-I
038120     MOVE 20    TO TXX4AN-TAB-MAX
038130
038140     CONTINUE.
038150 A10-VORLAUF-END.
038160     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
038170       DISPLAY "++25889-->A10-VORLAUF-END.              "
038180     DISPLAY "++W549AX-V-ID-TRACE = "
038190        W549AX-V-ID-TRACE                             *>++DELETE
038200     DISPLAY "++W549AN-TRACE-LEVEL = "
038210        W549AN-TRACE-LEVEL                            *>++DELETE
038220     END-IF                                           *>++DELETE
038230     EXIT.
038240
038250*-----------------------------------------------------------------
038260* VERARBEITUNG
038270*-----------------------------------------------------------------
038280 A20-VERARBEITUNG SECTION.
038290     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
038300       DISPLAY "++25889-->A20-VERARBEITUNG SECTION.     "
038310     DISPLAY "++W549AX-V-ID-TRACE = "
038320        W549AX-V-ID-TRACE                             *>++DELETE
038330     DISPLAY "++W549AN-TRACE-LEVEL = "
038340        W549AN-TRACE-LEVEL                            *>++DELETE
038350     END-IF                                           *>++DELETE
038360
038370     MOVE '00;A20-VERARBEITUNG;Beginn' TO W1AX-TRALOG-TEXT
038380     PERFORM Q92-TRALOG-ZEILE
038390
038400     EVALUATE W549AX-AKTION
038410       WHEN '01'
038420         PERFORM B01-VS02
038430       WHEN '02'
038440         PERFORM B02-DT02
038450       WHEN '03'
038460         PERFORM B03-TRA4
038470       WHEN OTHER
038480         SET U1AX-VERARB-FEHLER    TO TRUE
038490         MOVE K1AN-T1009           TO W549AN-TEXT-RC
038500         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
038510         MOVE 1                    TO W549AN-FEHLER-PARM-LEN
038520         STRING 'Falsche Aktion: '
038530                W549AX-AKTION
038540         DELIMITED BY SIZE       INTO W549AX-FEHLER-PARM-TEXT
038550         WITH POINTER                 W549AN-FEHLER-PARM-LEN
038560
038570         MOVE W549AX-FEHLER-PARM-TEXT  TO W1AX-TRALOG-TEXT
038580         PERFORM Q92-TRALOG-ZEILE
038590     END-EVALUATE
038600
038610     MOVE '99;A20-VERARBEITUNG;Ende  ' TO W1AX-TRALOG-TEXT
038620     PERFORM Q92-TRALOG-ZEILE
038630
038640     CONTINUE.
038650 A20-VERARBEITUNG-END.
038660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
038670       DISPLAY "++25889-->A20-VERARBEITUNG-END.         "
038680     DISPLAY "++W549AX-V-ID-TRACE = "
038690        W549AX-V-ID-TRACE                             *>++DELETE
038700     DISPLAY "++W549AN-TRACE-LEVEL = "
038710        W549AN-TRACE-LEVEL                            *>++DELETE
038720     END-IF                                           *>++DELETE
038730     EXIT.
038740
038750*-----------------------------------------------------------------
038760* Nacharbeiten
038770*-----------------------------------------------------------------
038780 A30-NACHLAUF SECTION.
038790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
038800       DISPLAY "++25889-->A30-NACHLAUF SECTION.         "
038810     DISPLAY "++W549AX-V-ID-TRACE = "
038820        W549AX-V-ID-TRACE                             *>++DELETE
038830     DISPLAY "++W549AN-TRACE-LEVEL = "
038840        W549AN-TRACE-LEVEL                            *>++DELETE
038850     END-IF                                           *>++DELETE
038860
038870*    -- Arbeitsbereich in Ausgabebereich übernehmen
038880     MOVE W549-AUS                 TO S549-AUS
038890
038900*    -- Programmende
038910     PERFORM Z90-PGM-EXIT
038920
038930     CONTINUE.
038940 A30-NACHLAUF-END.
038950     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
038960       DISPLAY "++25889-->A30-NACHLAUF-END.             "
038970     DISPLAY "++W549AX-V-ID-TRACE = "
038980        W549AX-V-ID-TRACE                             *>++DELETE
038990     DISPLAY "++W549AN-TRACE-LEVEL = "
039000        W549AN-TRACE-LEVEL                            *>++DELETE
039010     END-IF                                           *>++DELETE
039020     EXIT.
039030/
039040*-----------------------------------------------------------------
039050* Verarbeitung VS02 Registrierung von Fahrzeugschlüsseln
039060* Anfragetyp R, L, Z: Verarbeitung Transponder
039070* Anfragetyp S, A   : Verarbeitung Schließcode
039080*
039090* noch offen: Belegung VS02-S-VERARB-GESAMT bei
039100*             Fahrzeug-PIN-Label ist zugeordnet
039110*-----------------------------------------------------------------
039120 B01-VS02     SECTION.
039130     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
039140       DISPLAY "++25889-->B01-VS02     SECTION.         "
039150     DISPLAY "++W549AX-V-ID-TRACE = "
039160        W549AX-V-ID-TRACE                             *>++DELETE
039170     DISPLAY "++W549AN-TRACE-LEVEL = "
039180        W549AN-TRACE-LEVEL                            *>++DELETE
039190     END-IF                                           *>++DELETE
039200
039210     MOVE '00;B01-VS02;Beginn'     TO W1AX-TRALOG-TEXT
039220     PERFORM Q92-TRALOG-ZEILE
039230
039240     INITIALIZE S551AX-A-VS02-SCHU-KOPF
039250     INITIALIZE S551AX-A-VS02-SCHU-ARRAY
039260
039270     PERFORM C00-FZ-DATEN-PRUEFEN
039280
039290     IF U1AX-VERARB-OK
039300
039310       EVALUATE S551AX-E-VS02-ANFRAGETYP
039320*           -- Registrieren Transponder
039330         WHEN 'R' PERFORM C10-TRAN-REG-VS02
039340*           -- Löschen Transponder
039350         WHEN 'L' PERFORM C11-TRAN-LOE-VS02
039360*           -- Registrierung aufheben
039370         WHEN 'Z' PERFORM C12-TRAN-RAUF-VS02
039380*           -- Schließcode zum Fahrzeug zuordnen
039390         WHEN 'S' PERFORM C14-SCODE-ZUORD-VS02
039400*           -- Aufheben Zuordnung Schließcode zum Fahrzeug
039410         WHEN 'A' PERFORM C15-SCODE-AUFH-VS02
039420
039430         WHEN OTHER
039440*          -- Ungültiger Anfragetyp in VS02-Anfrage
039450           SET U1AX-VERARB-FEHLER  TO TRUE
039460           MOVE K1AN-T3058         TO W549AN-TEXT-RC
039470           MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
039480       END-EVALUATE
039490
039500*      -- unterschiedliche Belegung Gesamtergebnis
039510*      -- ...bei Transponderverarbeitung
039520       IF S551AX-E-VS02-ANFRAGETYP = 'R' OR 'L' OR 'Z'
039530         IF U1AX-VERARB-OK
039540*        -- wenn Anzahl reg. <> Anzahl gefordert = Bit 0 = '01'
039550           IF W1AN-ANZ-TRA-OK NOT EQUAL W1AN-ANZ-SCHU
039560             MOVE 1            TO S551AX-A-VS02-S-VERARB-GESAMT
039570           ELSE
039580             MOVE ZERO         TO S551AX-A-VS02-S-VERARB-GESAMT
039590           END-IF
039600
039610         END-IF
039620       ELSE
039630*V13 IR -->
039640         IF S551AX-E-VS02-ANFRAGETYP = 'A'
039650           IF U1AX-VERARB-FEHLER
039660
039670             PERFORM C17-SCODE-CHECK
039680
039690             IF SQLAX-SQLSTATE             = DB2-OK AND
039700                V208AX-GARNITUR-SERIE-NR  <= SPACE
039710*            -- Bit 1 (Hex 02): Keine Schließsatznummer zugeordnet
039720               MOVE 2            TO S551AX-A-VS02-S-VERARB-GESAMT
039730             ELSE
039740               MOVE ZERO         TO S551AX-A-VS02-S-VERARB-GESAMT
039750             END-IF
039760           ELSE
039770*          -- Bit 1 (Hex 02): Keine Schließsatznummer zugeordnet
039780             MOVE 2              TO S551AX-A-VS02-S-VERARB-GESAMT
039790           END-IF
039800         ELSE
039810*V13 <--
039820*      -- ...bei Schließcodeverarbeitung
039830           IF U1AX-VERARB-FEHLER
039840*          -- Bit 1 (Hex 02): Keine Schließsatznummer zugeordnet
039850             MOVE 2              TO S551AX-A-VS02-S-VERARB-GESAMT
039860           ELSE
039870             MOVE ZERO           TO S551AX-A-VS02-S-VERARB-GESAMT
039880           END-IF
039890*V13
039900         END-IF
039910       END-IF
039920*V11 IR -->
039930*      --  gleiche Belegung Schubladenfelder
039940*      IF S551AX-E-VS02-ANFRAGETYP = 'Z'
039950*         MOVE I1AN-NA     TO S551AN-E-VS02-SCHU-ANZAHL
039960*      END-IF
039970
039980*      --VS02Z Output-Parameter:
039990*      --'Anzahl Transponder regisriert in FAZIT' -
040000*      --wie viele Transponder sind trotz des VS02Z noch
040010*      --registriert - S551AN-A-VS02-TSP-ANZAHL-FAZIT
040020       IF S551AX-E-VS02-ANFRAGETYP = 'Z'
040030          PERFORM T-100-FEV2X3-TRA-FAZ
040040          IF W1AN-ANZ-TRA-2X3-FAZ  >= ZERO
040050            MOVE W1AN-ANZ-TRA-2X3-FAZ
040060                              TO S551AN-A-VS02-TSP-ANZAHL-FAZIT
040070          ELSE
040080            MOVE ZEROS        TO S551AN-A-VS02-TSP-ANZAHL-FAZIT
040090          END-IF
040100       ELSE
040110*V11 <--
040120*V11   -- für alle anderen Anfragen - unverändert:-
040130         MOVE W1AN-ANZ-TRA-OK TO S551AN-A-VS02-TSP-ANZAHL-FAZIT
040140       END-IF
040150*V11d -->
040160*      --VS02Z Output-Parameter:
040170*      --'Anzahl Transponder' -
040180*      -- Anzahl der Transponder, welche durch die VS02Z-Aktion
040190*      -- aufgehoben wurden
040200       IF S551AX-E-VS02-ANFRAGETYP     = 'Z'
040210         MOVE W1AN-ANZ-TRA-AUFGEHOBEN
040220           TO S551AX-A-VS02-SCHU-ANZAHL
040230       ELSE
040240**V11d <--
040250*V11   -- für alle anderen Anfragen - unverändert:-
040260         MOVE S551AN-E-VS02-SCHU-ANZAHL
040270                              TO S551AN-A-VS02-SCHU-ANZAHL
040280       END-IF
040290
040300*V11 --> --------------------------------------------------------
040310       MOVE SPACE                     TO W1AX-TRALOG-TEXT
040320       MOVE I1AN-NA                   TO W1AN-AUFB4
040330       MOVE S551AN-E-VS02-SCHU-ANZAHL TO W1AN-AUFB3
040340       STRING '13a. S551AX-E-VS02-ANFRAGETYP = '
040350                                         S551AX-E-VS02-ANFRAGETYP
040360              '; I1AN-NA = '            W1AN-AUFB4
040370              '; S551AN-E-VS02-SCHU-ANZAHL = '
040380                                        W1AN-AUFB3
040390              '; S551AX-E-VS02-SCHU-KOPF = '
040400                                        S551AX-E-VS02-SCHU-KOPF
040410              '; S551AX-A-VS02-SCHU-ANZAHL = '
040420                 S551AX-A-VS02-SCHU-ANZAHL
040430       DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
040440       PERFORM Q92-TRALOG-ZEILE
040450*V11 <-- --------------------------------------------------------
040460
040470       MOVE W1AN-ANZ-KEYFOB      TO S551AN-A-VS02-TSP-ANZAHL-VKV
040480
040490       IF S551AX-E-VS02-ANFRAGETYP = 'Z'
040500         COMPUTE W1AN-N2
040510               = (LENGTH OF S551AX-A-VS02-SCHU-ZEILE (1))
040520               * I1AN-NA
040530*V11a <--
040540       ELSE
040550         COMPUTE W1AN-N2
040560               = (LENGTH OF S551AX-A-VS02-SCHU-ZEILE (1))
040570               * S551AN-A-VS02-SCHU-ANZAHL
040580       END-IF
040590
040600*V11 --> --------------------------------------------------------
040610       MOVE SPACE                     TO W1AX-TRALOG-TEXT
040620       MOVE LENGTH OF S551AX-A-VS02-SCHU-ZEILE(1)  TO W1AN-AUFB9
040630       MOVE S551AN-A-VS02-SCHU-ANZAHL TO W1AN-AUFB3
040640       MOVE W1AN-N2                   TO W1AN-AUFB10
040650       STRING '13b. VS02Z Response Länge: '
040660                  ' W1AN-N2: '
040670                                         W1AN-AUFB10
040680              '; Länge 1. Zeile S551AX-A-VS02-SCHU-ZEILE (1): '
040690                              W1AN-AUFB9
040700              '; S551AN-A-VS02-SCHU-ANZAHL: '
040710                                         W1AN-AUFB3
040720       DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
040730       PERFORM Q92-TRALOG-ZEILE
040740*V11 <-- --------------------------------------------------------
040750       PERFORM C90-ABSCHLUSS-VS02
040760
040770     END-IF
040780
040790     PERFORM C70-AUSKUNFT
040800
040810     MOVE '00;B01-VS02;Ende'       TO W1AX-TRALOG-TEXT
040820     PERFORM Q92-TRALOG-ZEILE
040830
040840     CONTINUE.
040850 B01-VS02-END.
040860     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
040870       DISPLAY "++25889-->B01-VS02-END.                 "
040880     DISPLAY "++W549AX-V-ID-TRACE = "
040890        W549AX-V-ID-TRACE                             *>++DELETE
040900     DISPLAY "++W549AN-TRACE-LEVEL = "
040910        W549AN-TRACE-LEVEL                            *>++DELETE
040920     END-IF                                           *>++DELETE
040930     EXIT.
040940/
040950*-----------------------------------------------------------------
040960* Verarbeitung DT02
040970*-----------------------------------------------------------------
040980 B02-DT02     SECTION.
040990     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
041000       DISPLAY "++25889-->B02-DT02     SECTION.         "
041010     DISPLAY "++W549AX-V-ID-TRACE = "
041020        W549AX-V-ID-TRACE                             *>++DELETE
041030     DISPLAY "++W549AN-TRACE-LEVEL = "
041040        W549AN-TRACE-LEVEL                            *>++DELETE
041050     END-IF                                           *>++DELETE
041060
041070     MOVE '00;B02-DT02;Beginn'     TO W1AX-TRALOG-TEXT
041080     PERFORM Q92-TRALOG-ZEILE
041090
041100     INITIALIZE S551AX-A-DT02-TRANSPOND-KOPF
041110     INITIALIZE S551AX-A-DT02-TRANSP-ARRAY
041120
041130     IF S551AX-E-DT02-ANFRAGETYP = '4'
041140       CONTINUE
041150     ELSE
041160*       -- Ungültiger Anfragetyp in DT02-Anfrage
041170       SET U1AX-VERARB-FEHLER   TO TRUE
041180       MOVE K1AN-T3059          TO W549AN-TEXT-RC
041190       MOVE K1AN-FEHLER         TO W549AN-TEXT-FEHLER-KLASSE
041200     END-IF
041210
041220     PERFORM C00-FZ-DATEN-PRUEFEN
041230
041240     IF U1AX-VERARB-OK
041250*      -- Wert Key-Typ-ID=1150 (CONFIG-DATA-MASTER) ermitteln
041260       INITIALIZE B2VI-DCLFEV2VI
041270       INITIALIZE B2VI-I-DCLFEV2VI
041280
041290       MOVE S551AX-E-VIN          TO B2VIAX-VIN
041300       MOVE 1150                  TO B2VIAN-KEY-TYP-ID
041310
041320*      -- aktuellen Wert Config-Data-Master lesen
041330*      --  W1AN-ANZ-TRA-ANGEF
041340       PERFORM T-100-FEV2VI-SELECT
041350
041360       IF SQLAX-SQLSTATE = DB2-OK
041370         MOVE B2VIAX-DATEN-INHALT-TEXT (1:1)
041380                                   TO W1AN-ANZ-TRA-ANGEF
041390       ELSE
041400         SET U1AX-VERARB-FEHLER    TO TRUE
041410*        -- Config Data Master nicht gefunden
041420         MOVE K1AN-T2958           TO W549AN-TEXT-RC
041430         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
041440       END-IF
041450
041460       IF U1AX-VERARB-OK
041470         MOVE '29'                   TO S540AX-E-AKTION
041480*        -- Werte setzen, die immer gleich sind
041490         PERFORM C30-FE540-VOR-DT02
041500*
041510         IF U1AX-VERARB-OK
041520*          --  W1AN-ANZ-TRA-OK    = alle mit DL4
041530           MOVE ZERO               TO W1AN-ANZ-TRA-OK
041540                                      I1AN-TRA
041550*          -- Lesen akt. SKC0-ID-ZAHL aus VP-Tabelle
041560           INITIALIZE B0VP-DCLFEV0VP
041570                      B0VP-I-DCLFEV0VP
041580           MOVE S551AX-E-VIN       TO B0VPAX-VIN
041590           MOVE V208AX-WFS-MASTER  TO B0VPAX-BGRP
041600           MOVE 1000               TO B0VPAN-KEY-TYP-ID
041610
041620           PERFORM T-100-FEV0VP-SELECT
041630
041640           IF SQLAX-SQLSTATE = DB2-OK
041650             MOVE B0VPAN-KEY-TYP-ID-ZAHL
041660                                 TO W1AN-SKC0-KT-ID-ZAHL
041670           ELSE
041680*            -- Lesen akt. SKC0-ID-ZAHL aus VI-Tabelle
041690             INITIALIZE B2VI-DCLFEV2VI
041700             INITIALIZE B2VI-I-DCLFEV2VI
041710
041720             MOVE S551AX-E-VIN   TO B2VIAX-VIN
041730             MOVE 1000           TO B2VIAN-KEY-TYP-ID
041740
041750             PERFORM T-100-FEV2VI-SELECT
041760
041770             IF SQLAX-SQLSTATE = DB2-OK
041780               MOVE B2VIAN-KEY-TYP-ID-ZAHL
041790                                   TO W1AN-SKC0-KT-ID-ZAHL
041800             END-IF
041810           END-IF
041820
041830*          -- akt. Transp. zur VIN mit Status 8080/8082 lesen
041840*          -- und akt. SKC0-ID-ZAHL (VP)
041850           INITIALIZE B2X3-DCLFEV2X3
041860           INITIALIZE B2X3-I-DCLFEV2X3
041870
041880           MOVE S551AX-E-VIN       TO B2X3AX-VIN
041890           MOVE W1AN-SKC0-KT-ID-ZAHL
041900                                 TO B2X3AN-SKC0-KEY-TYP-ID-ZAHL
041910
041920           PERFORM T-100-OPEN-C-DT02
041930           PERFORM T-100-FETCH-C-DT02
041940
041950*-->V07 LP
041960*          IF SQLAX-SQLSTATE = DB2-OK
041970*            CONTINUE
041980*          ELSE
041990*            SET U1AX-VERARB-FEHLER TO TRUE
042000*            -- erst VS02-R Telegramm ausfuehren
042010*            MOVE K1AN-T3209       TO W549AN-TEXT-RC
042020*            MOVE K1AN-FEHLER      TO W549AN-TEXT-FEHLER-KLASSE
042030*          END-IF
042040*<--V07 LP
042050
042060           PERFORM UNTIL SQLAX-SQLSTATE NOT = DB2-OK
042070                      OR U1AX-VERARB-FEHLER
042080
042090             PERFORM C31-DT02-FE540C
042100*            -- W1AN-ANZ-TRA-OK
042110*            -- U1AX-VERARB-FEHLER
042120
042130             PERFORM T-100-FETCH-C-DT02
042140
042150           END-PERFORM
042160
042170           PERFORM T-100-CLOSE-C-DT02
042180
042190         END-IF
042200       END-IF
042210     END-IF
042220
042230     IF U1AX-VERARB-OK
042240*      -- Schreiben alle Transponder mit Status 8082
042250*      -- hier sollte nichts mehr schief gehen...
042260       PERFORM VARYING I1AN-TRA FROM 1 BY 1
042270                 UNTIL I1AN-TRA > W1AN-ANZ-TRA-OK
042280         PERFORM D95-WRITE-TRANSP-DT02
042290*        S551AX-A-DT02... pro Transponder gefüllt
042300       END-PERFORM
042310
042320       MOVE ALL SPACE            TO S551AX-A-DT02-TRANSPOND-DL5
042330
042340*      -- alle akt. Transp. mit 8080 aus X30 vor DT02
042350       MOVE W1AN-ANZ-TRA-ANGEF   TO S551AN-A-DT02-TSP-ANZAHL-VKV
042360       MOVE W1AN-ANZ-TRA-OK      TO S551AN-A-DT02-TSP-ANZAHL-DL4
042370
042380       COMPUTE W1AN-N2 =
042390                       (LENGTH OF S551AX-A-DT02-TRANSP-ZEILE (1))
042400                       * S551AN-A-DT02-TSP-ANZAHL-DL4
042410
042420       PERFORM C91-ABSCHLUSS-DT02
042430     ELSE
042440*      Fehler beim DL4 berechnen -> Eintrag in X40 machen
042450       PERFORM I26W-AK-TRANSPONDER
042460     END-IF
042470
042480     PERFORM C70-AUSKUNFT
042490
042500     MOVE '00;B02-DT02;Ende'       TO W1AX-TRALOG-TEXT
042510     PERFORM Q92-TRALOG-ZEILE
042520
042530     CONTINUE.
042540 B02-DT02-END.
042550     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
042560       DISPLAY "++25889-->B02-DT02-END.                 "
042570     DISPLAY "++W549AX-V-ID-TRACE = "
042580        W549AX-V-ID-TRACE                             *>++DELETE
042590     DISPLAY "++W549AN-TRACE-LEVEL = "
042600        W549AN-TRACE-LEVEL                            *>++DELETE
042610     END-IF                                           *>++DELETE
042620     EXIT.
042630/
042640*-----------------------------------------------------------------
042650* Verarbeitung TRA4
042660*
042670* Aufruf FE540C Verarbeitung je Transponder
042680*
042690* Es werden immer alle verarbeitet, Fehler pro Schublade ausgeben
042700* Gesamt-RC FE549 ist dann immer 0 und Fehlerklasse 9000
042710*
042720* Hat 1 Transponder einen Fehler, wird keiner auf aktiv gesetzt
042730* Ausnahme:
042740* bei einem Transponder mit "Markierung mit Auswirkung" alle
042750* geforderten aktiv setzen (Fehler aus Markierung 6801 oder 6801)
042760*  -> siehe C41-TRA4-FE540C
042770*-----------------------------------------------------------------
042780 B03-TRA4     SECTION.
042790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
042800       DISPLAY "++25889-->B03-TRA4     SECTION.         "
042810     DISPLAY "++W549AX-V-ID-TRACE = "
042820        W549AX-V-ID-TRACE                             *>++DELETE
042830     DISPLAY "++W549AN-TRACE-LEVEL = "
042840        W549AN-TRACE-LEVEL                            *>++DELETE
042850     END-IF                                           *>++DELETE
042860
042870     MOVE '00;B03-TRA4;Beginn'     TO W1AX-TRALOG-TEXT
042880     PERFORM Q92-TRALOG-ZEILE
042890
042900     INITIALIZE S551AX-A-TRA4-TRANSPOND-KOPF
042910     INITIALIZE S551AX-A-TRA4-TRANSP-ARRAY
042920
042930     IF S551AX-E-TRA4-WFS-ID-DATEN = SPACE
042940       MOVE K1AN-T2847             TO W549AN-TEXT-RC
042950       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
042960     END-IF
042970
042980     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
042990       PERFORM C00-FZ-DATEN-PRUEFEN
043000     END-IF
043010
043020     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043030*      -- Wert Key-Typ-ID=1150 (CONFIG-DATA-MASTER) ermitteln
043040       INITIALIZE B2VI-DCLFEV2VI
043050       INITIALIZE B2VI-I-DCLFEV2VI
043060
043070       MOVE S551AX-E-VIN          TO B2VIAX-VIN
043080       MOVE 1150                  TO B2VIAN-KEY-TYP-ID
043090
043100*      -- aktuellen Wert Config-Data-Master lesen
043110*      --  W1AN-ANZ-TRA-ANGEF
043120       PERFORM T-100-FEV2VI-SELECT
043130
043140       IF SQLAX-SQLSTATE = DB2-OK
043150         MOVE B2VIAX-DATEN-INHALT-TEXT (1:1)
043160                                   TO W1AN-ANZ-TRA-ANGEF
043170       ELSE
043180         SET U1AX-VERARB-FEHLER    TO TRUE
043190*        -- Config Data Master nicht gefunden
043200         MOVE K1AN-T2958           TO W549AN-TEXT-RC
043210         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
043220       END-IF
043230     END-IF
043240
043250*    -- Prüfen der WFS-Ident-Daten
043260     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043270       PERFORM D10-IDENT-DATEN-CHECK
043280     END-IF
043290
043300*    -- Zerlegen KeyFOB-Daten
043310     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043320       PERFORM D30-KEY-FOB-FE589
043330     END-IF
043340
043350*    -- KeyFOB-Daten in COBOL-Tabelle
043360     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043370       PERFORM D31-KEYFOB-IN-TAB
043380     END-IF
043390
043400*    -- Prüfen der gelieferten Transponder
043410     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043420       PERFORM D40-TRANSPONDER-PRUEFEN
043430     END-IF
043440
043450     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043460
043470       MOVE '30'                   TO S540AX-E-AKTION
043480*      -- Zähler auf 0
043490       MOVE ZERO                   TO W1AN-ANZ-TRA-OK
043500                                      I1AN-TRA
043510*      -- Werte setzen, die immer gleich sind
043520       PERFORM C40-FE540-VOR-TRA4
043530*
043540       PERFORM VARYING W1AN-CNT FROM 1 BY +1
043550       UNTIL W1AN-CNT                   > K1AN-TRAN-ANZAHL-MAX
043560
043570          IF W1AX-TRANS-EXST-FLG (W1AN-CNT) = 'J'
043580            PERFORM C41-TRA4-FE540C
043590*           - W1AN-ANZ-TRA-OK
043600*           - W1AN-ANZ-TRA-NOK
043610          END-IF
043620
043630       END-PERFORM
043640     END-IF
043650
043660     IF W549AN-TEXT-FEHLER-KLASSE  = K1AN-OK OR K1AN-HINWEIS
043670
043680       PERFORM T-100-FEV2X3-ANZ-TRA-REG
043690*      -- 1 Transponder mit Fehler = keinen aktivieren
043700       IF  W1AN-ANZ-TRA-NOK = ZERO
043710         PERFORM VARYING I1AN-TRA FROM 1 BY 1
043720                   UNTIL I1AN-TRA > W1AN-ANZ-TRA-OK
043730*          -- Schreiben Tra mit Status 8045
043740           PERFORM D96-WRITE-TRANSP-TRA4
043750*          S551AX-A-TRA4... pro Transponder gefüllt
043760         END-PERFORM
043770       END-IF
043780
043790*        -- Kopffelder Antworttelegramm setzen
043800*        -- Gesamtergebnis:
043810       MOVE '0'                   TO S551AX-A-TRA4-T-VERARB-GESAMT
043820*          -- wenn Anzahl Transponder aus Config-Data-Master nicht
043830*             gleich Anzahl aus ANGELERNTESCHLUESSEL aus IdentDate
043840       IF W1AN-ANZ-TRA-ANGEF NOT = S585AX-ANGELERNTESCHLUESSEL
043850         MOVE K1AN-T2871          TO W549AN-TEXT-RC
043860         MOVE K1AN-HINWEIS        TO W549AN-TEXT-FEHLER-KLASSE
043870         MOVE '1'                 TO S551AX-A-TRA4-T-VERARB-GESAMT
043880       END-IF
043890
043900       IF W1AN-ANZ-TRA-NOK   > ZERO
043910         MOVE '1'                 TO S551AX-A-TRA4-T-VERARB-GESAMT
043920       END-IF
043930*      - Anzahl angefordert = Wert aus Master-Config-Byte Key 1150
043940*      - Anzahl registriert =  Ermittlung der zum Fahrzeug aktuell
043950*        registrierten Anzahl Transponder (Status 8082/8045)
043960*      - Anzahl im Master   = ANGELERNTE aus WFS-Identdaten
043970*                             (hex 0-8 = num 0-8)
043980       MOVE W1AN-ANZ-TRA-ANGEF    TO S551AN-A-TRA4-TSP-ANZAHL-VKV
043990       MOVE W1AN-ANZ-TRA-X30-REG  TO
044000                                    S551AN-A-TRA4-TSP-ANZAHL-FAZIT
044010*      -- S585AX-ANGELERNTESCHLUESSEL ist PIC X(2) 01 - 08
044020       MOVE S585AX-ANGELERNTESCHLUESSEL
044030                                     TO W1AN-AUFB2
044040*      -- S551AN-A-TRA4-TSP-ANZAHL-WFS ist PIC 9(3)
044050       MOVE W1AN-AUFB2             TO S551AN-A-TRA4-TSP-ANZAHL-WFS
044060
044070       COMPUTE W1AN-N2 =
044080                       (LENGTH OF S551AX-A-TRA4-TRANSP-ZEILE (1))
044090                       * W1AN-TRAN-ANZAHL
044100
044110       PERFORM C92-ABSCHLUSS-TRA4
044120
044130     END-IF
044140
044150     PERFORM C70-AUSKUNFT
044160
044170     MOVE '00;B03-TRA4;Ende'       TO W1AX-TRALOG-TEXT
044180     PERFORM Q92-TRALOG-ZEILE
044190
044200     CONTINUE.
044210 B03-TRA4-END.
044220     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
044230       DISPLAY "++25889-->B03-TRA4-END.                 "
044240     DISPLAY "++W549AX-V-ID-TRACE = "
044250        W549AX-V-ID-TRACE                             *>++DELETE
044260     DISPLAY "++W549AN-TRACE-LEVEL = "
044270        W549AN-TRACE-LEVEL                            *>++DELETE
044280     END-IF                                           *>++DELETE
044290     EXIT.
044300/
044310*-----------------------------------------------------------------
044320* Eingangsprüfungen für alle
044330* Prüfung gegen die FZ VIN aus den Kopfdaten
044340* FZ muss in T08 sein, ZP8 muss leer sein
044350* - V208AX-TRANSPOND-FAM für Lesen T043 Lieferatendaten f. PSS
044360* TEXT-DRT-VERSION muss 8821 sein
044370* FZ muss in VD sein
044380*-----------------------------------------------------------------
044390 C00-FZ-DATEN-PRUEFEN SECTION.
044400     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
044410       DISPLAY "++25889-->C00-FZ-DATEN-PRUEFEN SECTION. "
044420     DISPLAY "++W549AX-V-ID-TRACE = "
044430        W549AX-V-ID-TRACE                             *>++DELETE
044440     DISPLAY "++W549AN-TRACE-LEVEL = "
044450        W549AN-TRACE-LEVEL                            *>++DELETE
044460     END-IF                                           *>++DELETE
044470
044480     MOVE '00;C00-FZ-DATEN-PRUEFEN;Beginn'
044490                                   TO W1AX-TRALOG-TEXT
044500     PERFORM Q92-TRALOG-ZEILE
044510
044520*    -- Lesen T08 zur VIN
044530     INITIALIZE V208-DCLFEV208
044540     MOVE HIGH-VALUE               TO V208-I-DCLFEV208
044550     MOVE S551AX-E-VIN             TO V208AX-VIN
044560     PERFORM T-100-FEV208-SELECT
044570
044580     IF SQLAX-SQLSTATE = DB2-OK
044590       MOVE 'VIN gefunden in FEV208 '
044600                                   TO W1AX-TRALOG-TEXT
044610       PERFORM Q92-TRALOG-ZEILE
044620       IF V208AN-TEXT-DRT-VERSION  = 8821
044630         CONTINUE
044640       ELSE
044650          MOVE 'VIN DRT Version nicht 8821'
044660                                   TO W1AX-TRALOG-TEXT
044670          PERFORM Q92-TRALOG-ZEILE
044680         SET U1AX-VERARB-FEHLER    TO TRUE
044690*        -- WEGFAHRSPERRE-TYP IST FÜR DIE VERARBEITUNG NICHT
044700*        -- ZULÄSSIG
044710         MOVE K1AN-T3009           TO W549AN-TEXT-RC
044720         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
044730       END-IF
044740
044750       IF V208AX-DATUM-ZP8   = SPACE
044760       OR V208AN-I-DATUM-ZP8 < 0
044770         CONTINUE
044780       ELSE
044790          MOVE 'FZ hat schon ZP8'
044800                                   TO W1AX-TRALOG-TEXT
044810          PERFORM Q92-TRALOG-ZEILE
044820         SET U1AX-VERARB-FEHLER    TO TRUE
044830*        -- Fahrzeug hat schon ZP8
044840         MOVE K1AN-T7737            TO W549AN-TEXT-RC
044850         MOVE K1AN-FEHLER           TO W549AN-TEXT-FEHLER-KLASSE
044860       END-IF
044870     ELSE
044880          MOVE 'VIN fehlt in DB'
044890                                   TO W1AX-TRALOG-TEXT
044900          PERFORM Q92-TRALOG-ZEILE
044910       SET U1AX-VERARB-FEHLER TO TRUE
044920*      -- VIN fehlt in Datenbank Fazit, FZ nicht bekannt
044930       MOVE K1AN-T2848             TO W549AN-TEXT-RC
044940       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
044950     END-IF
044960
044970     IF U1AX-VERARB-OK
044980*    -- LESEN AKTUELLES VKMS-FAHRZEUG VD-Tabelle
044990       INITIALIZE B2VD-DCLFEV2VD
045000       INITIALIZE B2VD-I-DCLFEV2VD
045010
045020       MOVE S551AX-E-VIN           TO B2VDAX-VIN
045030       PERFORM T-100-FEV2VD-SELECT
045040
045050       IF SQLAX-SQLSTATE = DB2-OK
045060         CONTINUE
045070       ELSE
045080          MOVE 'FZ nicht für VKMS vorbereitet'
045090                                   TO W1AX-TRALOG-TEXT
045100          PERFORM Q92-TRALOG-ZEILE
045110         SET U1AX-VERARB-FEHLER TO TRUE
045120*        -- FZ NICHT FÜR VKMS VORBEREITET
045130         MOVE K1AN-T2849           TO W549AN-TEXT-RC
045140         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
045150       END-IF
045160     END-IF
045170
045180     MOVE '00;C00-FZ-DATEN-PRUEFEN;Ende'
045190                                   TO W1AX-TRALOG-TEXT
045200     PERFORM Q92-TRALOG-ZEILE
045210
045220     CONTINUE.
045230 C00-FZ-DATEN-PRUEFEN-END.
045240     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
045250       DISPLAY "++25889-->C00-FZ-DATEN-PRUEFEN-END.     "
045260     DISPLAY "++W549AX-V-ID-TRACE = "
045270        W549AX-V-ID-TRACE                             *>++DELETE
045280     DISPLAY "++W549AN-TRACE-LEVEL = "
045290        W549AN-TRACE-LEVEL                            *>++DELETE
045300     END-IF                                           *>++DELETE
045310     EXIT.
045320/
045330*-----------------------------------------------------------------
045340* Plausi-Prüfungen für VS02
045350* Cryptbox gibt es nicht in Prod.
045360*-----------------------------------------------------------------
045370 C01-VS02R-PP       SECTION.
045380     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
045390       DISPLAY "++25889-->C01-VS02R-PP       SECTION.   "
045400     DISPLAY "++W549AX-V-ID-TRACE = "
045410        W549AX-V-ID-TRACE                             *>++DELETE
045420     DISPLAY "++W549AN-TRACE-LEVEL = "
045430        W549AN-TRACE-LEVEL                            *>++DELETE
045440     END-IF                                           *>++DELETE
045450
045460     MOVE '01;C01-VS02R-PP;Beginn' TO W1AX-TRALOG-TEXT
045470     PERFORM Q92-TRALOG-ZEILE
045480
045490     MOVE ZERO                     TO W549AN-TEXT-RC
045500     MOVE K1AN-OK                  TO W549AN-TEXT-FEHLER-KLASSE
045510
045520     MOVE S551AN-E-VS02-SCHU-ANZAHL
045530                                   TO W1AN-ANZ-SCHU
045540
045550     IF W1AN-ANZ-SCHU             < 1 OR  > 8
045560
045570       SET U1AX-VERARB-FEHLER      TO TRUE
045580*      -- Anzahl Transponder falsch
045590       MOVE K1AN-T2871             TO W549AN-TEXT-RC
045600       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
045610       STRING 'Anzahl Schubladen: '
045620               S551AN-E-VS02-SCHU-ANZAHL
045630       DELIMITED BY SIZE     INTO W549AX-FEHLER-PARM-TEXT
045640       WITH POINTER               W549AN-FEHLER-PARM-LEN
045650     END-IF
045660
045670     IF U1AX-VERARB-OK
045680
045690       PERFORM VARYING I1AN-TRA FROM 1 BY 1
045700       UNTIL I1AN-TRA > W1AN-ANZ-SCHU
045710
045720         MOVE ZERO       TO S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
045730
045740         IF S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
045750                                   = SPACE
045760*          -- TRANSPOND_ID darf nicht leer sein
045770           MOVE 'FAZ'  TO S551AX-A-VS02-FEHLER-SYSTEM (I1AN-TRA)
045780           MOVE K1AN-T3022
045790                          TO S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
045800           MOVE ':'    TO S551AX-A-VS02-FEHLER-TRENN  (I1AN-TRA)
045810*          -- Fehlertext umsetzen
045820           MOVE S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
045830                                   TO W1AN-FF3-FEHLERNUMMER
045840           PERFORM C80-FEH-TEXT-FE557
045850           MOVE S557AX-A-PROD-KLARTEXT
045860                         TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
045870         END-IF
045880
045890         IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = ZERO
045900
045910           IF S551AX-E-VS02-S-TRANSPOND-MEM (I1AN-TRA)
045920                                   = SPACE
045930             MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
045940                      TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
045950*            -- es sind nicht alle benötigten Felder gefüllt
045960             MOVE 'FAZ' TO S551AX-A-VS02-FEHLER-SYSTEM (I1AN-TRA)
045970             MOVE K1AN-T1002
045980                          TO S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
045990             MOVE ':'   TO S551AX-A-VS02-FEHLER-TRENN  (I1AN-TRA)
046000*            -- Fehlertext umsetzen
046010             MOVE S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
046020                                   TO W1AN-FF3-FEHLERNUMMER
046030             PERFORM C80-FEH-TEXT-FE557
046040             MOVE S557AX-A-PROD-KLARTEXT
046050                         TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
046060*            -- in XX4-Tabelle schreiben
046070             MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
046080                                   TO BXX4AX-TRANSPOND-ID
046090             MOVE S551AX-E-VS02-S-TRANSPOND-TYP (I1AN-TRA)
046100                                   TO BXX4AX-TRANSPOND-TYP
046110             MOVE K1AN-T1002       TO BXX4AN-TEXT-VERARB
046120             MOVE K1AN-FEHLER      TO BXX4AN-TEXT-FEHLER-KLASSE
046130             MOVE ZERO             TO BXX4AN-I-TEXT-FEHLER-KLASSE
046140             PERFORM I25W-AK-TRANSPONDER
046150           END-IF
046160         END-IF
046170
046180       END-PERFORM
046190*      -- Gesamt-RC ist hier immer o.k.
046200       MOVE ZERO                   TO W549AN-TEXT-RC
046210       MOVE K1AN-OK                TO W549AN-TEXT-FEHLER-KLASSE
046220     END-IF
046230
046240     IF U1AX-VERARB-OK
046250       MOVE ALL SPACE              TO W1AX-TRA-IN-ANFRAGE
046260       PERFORM VARYING I1AN-TRA FROM 1 BY 1
046270       UNTIL I1AN-TRA > W1AN-ANZ-SCHU
046280         MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
046290                                   TO W1AX-TRA-LIST (I1AN-TRA)
046300       END-PERFORM
046310       MOVE W1AX-TRA-LISTE         TO W1AX-TRA-IN-ANFRAGE
046320
046330*      -- Lesen akt. SKC0-ID-ZAHL aus VP-Tabelle
046340       INITIALIZE B0VP-DCLFEV0VP
046350                  B0VP-I-DCLFEV0VP
046360       MOVE S551AX-E-VIN       TO B0VPAX-VIN
046370       MOVE V208AX-WFS-MASTER  TO B0VPAX-BGRP
046380       MOVE 1000               TO B0VPAN-KEY-TYP-ID
046390
046400       PERFORM T-100-FEV0VP-SELECT
046410
046420       IF SQLAX-SQLSTATE = DB2-OK
046430         MOVE B0VPAN-KEY-TYP-ID-ZAHL
046440                               TO W1AN-SKC0-KT-ID-ZAHL
046450       ELSE
046460*        -- Lesen akt. SKC0-ID-ZAHL aus VI-Tabelle
046470         INITIALIZE B2VI-DCLFEV2VI
046480         INITIALIZE B2VI-I-DCLFEV2VI
046490
046500         MOVE S551AX-E-VIN          TO B2VIAX-VIN
046510         MOVE 1000                  TO B2VIAN-KEY-TYP-ID
046520
046530         PERFORM T-100-FEV2VI-SELECT
046540
046550         IF SQLAX-SQLSTATE = DB2-OK
046560           MOVE B2VIAN-KEY-TYP-ID-ZAHL
046570                               TO W1AN-SKC0-KT-ID-ZAHL
046580         END-IF
046590       END-IF
046600
046610       MOVE W1AN-SKC0-KT-ID-ZAHL
046620                               TO B2X3AN-SKC0-KEY-TYP-ID-ZAHL
046630
046640*      -- Anzahl bereits angelernter Transponder aus X30
046650*      -- die NICHT in der akt. Anfrage sind
046660*      -- zur aktuellen SKC0-KEY-TYP-ID-ZAHL
046670*             --> W1AX-TRA-IN-ANFRAGE
046680       MOVE S551AX-E-VIN         TO B2X3AX-VIN
046690       PERFORM T-100-FEV2X3-ANZ-TRA
046700*      -- W1AN-ANZ-TRA-X30-ANG
046710
046720     END-IF
046730
046740*    -- max. Anzahl anlernbarer Transponder zw. 1 und 8
046750     IF U1AX-VERARB-OK
046760*      -- Wert Key-Typ-ID=1150 (CONFIG-DATA-MASTER) ermitteln
046770       INITIALIZE B2VI-DCLFEV2VI
046780       INITIALIZE B2VI-I-DCLFEV2VI
046790
046800       MOVE S551AX-E-VIN          TO B2VIAX-VIN
046810       MOVE 1150                  TO B2VIAN-KEY-TYP-ID
046820
046830*      -- aktuellen Wert Config-Data-Master lesen
046840       PERFORM T-100-FEV2VI-SELECT
046850
046860       IF SQLAX-SQLSTATE = DB2-OK
046870         MOVE B2VIAX-DATEN-INHALT-TEXT (1:1)
046880                                 TO W1AX-WFS-CONFIGBYTE0
046890
046900         EVALUATE W1AX-WFS-CONFIGBYTE0
046910           WHEN '0' MOVE  0 TO W1AN-ANZ-KEYFOB
046920           WHEN '1' MOVE  1 TO W1AN-ANZ-KEYFOB
046930           WHEN '2' MOVE  2 TO W1AN-ANZ-KEYFOB
046940           WHEN '3' MOVE  3 TO W1AN-ANZ-KEYFOB
046950           WHEN '4' MOVE  4 TO W1AN-ANZ-KEYFOB
046960           WHEN '5' MOVE  5 TO W1AN-ANZ-KEYFOB
046970           WHEN '6' MOVE  6 TO W1AN-ANZ-KEYFOB
046980           WHEN '7' MOVE  7 TO W1AN-ANZ-KEYFOB
046990           WHEN '8' MOVE  8 TO W1AN-ANZ-KEYFOB
047000           WHEN OTHER
047010             SET U1AX-VERARB-FEHLER TO TRUE
047020*            -- Anzahl Transponder falsch
047030             MOVE K1AN-T2871       TO W549AN-TEXT-RC
047040             MOVE K1AN-FEHLER      TO W549AN-TEXT-FEHLER-KLASSE
047050             MOVE 1                TO W549AN-FEHLER-PARM-LEN
047060             STRING ' VI.WFSConfigByte[0]='
047070                      B2VIAX-DATEN-INHALT-TEXT (1:1)
047080             DELIMITED BY SIZE   INTO W549AX-FEHLER-PARM-TEXT
047090             WITH POINTER             W549AN-FEHLER-PARM-LEN
047100         END-EVALUATE
047110         MOVE W1AN-ANZ-TRA-X30-ANG TO W1AN-ANZ-TRA-MAX
047120         ADD W1AN-ANZ-SCHU         TO W1AN-ANZ-TRA-MAX
047130*        -- KeyFob-Anzahl+bereits angel.  > Inhalt ConfigByte
047140         IF W1AN-ANZ-TRA-MAX       > W1AN-ANZ-KEYFOB
047150           SET U1AX-VERARB-FEHLER  TO TRUE
047160*          -- Transponder-Anzahl ungleich Transponder-Anzahl in
047170*             WFS-Master
047180           MOVE K1AN-T3102         TO W549AN-TEXT-RC
047190           MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
047200           MOVE 1                  TO W549AN-FEHLER-PARM-LEN
047210           STRING ' Anzahl Schubladen VS02 '
047220                    W1AN-ANZ-TRA-MAX
047230                  ', Anzahl VI.KeyFOB '
047240                    W1AN-ANZ-KEYFOB
047250           DELIMITED BY SIZE   INTO W549AX-FEHLER-PARM-TEXT
047260           WITH POINTER             W549AN-FEHLER-PARM-LEN
047270         END-IF
047280       ELSE
047290         SET U1AX-VERARB-FEHLER    TO TRUE
047300*        -- Config Data Master nicht gefunden
047310         MOVE K1AN-T2958           TO W549AN-TEXT-RC
047320         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
047330       END-IF
047340     END-IF
047350
047360     MOVE '01;C01-VS02R-PP;Ende'   TO W1AX-TRALOG-TEXT
047370     PERFORM Q92-TRALOG-ZEILE
047380
047390     CONTINUE.
047400 C01-VS02R-PP-END.
047410     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
047420       DISPLAY "++25889-->C01-VS02R-PP-END.             "
047430     DISPLAY "++W549AX-V-ID-TRACE = "
047440        W549AX-V-ID-TRACE                             *>++DELETE
047450     DISPLAY "++W549AN-TRACE-LEVEL = "
047460        W549AN-TRACE-LEVEL                            *>++DELETE
047470     END-IF                                           *>++DELETE
047480     EXIT.
047490/
047500*-----------------------------------------------------------------
047510* Plausi-Prüfungen für VS02
047520* Cryptbox gibt es nicht in Prod.
047530*-----------------------------------------------------------------
047540 C01A-VS02LZ-PP     SECTION.
047550     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
047560       DISPLAY "++25889-->C01A-VS02LZ-PP     SECTION.   "
047570     DISPLAY "++W549AX-V-ID-TRACE = "
047580        W549AX-V-ID-TRACE                             *>++DELETE
047590     DISPLAY "++W549AN-TRACE-LEVEL = "
047600        W549AN-TRACE-LEVEL                            *>++DELETE
047610     END-IF                                           *>++DELETE
047620
047630     MOVE '01;C01A-VS02LZ-PP;Beginn' TO W1AX-TRALOG-TEXT
047640     PERFORM Q92-TRALOG-ZEILE
047650
047660     MOVE ZERO                     TO W549AN-TEXT-RC
047670     MOVE K1AN-OK                  TO W549AN-TEXT-FEHLER-KLASSE
047680
047690     MOVE S551AN-E-VS02-SCHU-ANZAHL
047700                                   TO W1AN-ANZ-SCHU
047710
047720*V11 --> --------------------------------------------------------
047730     MOVE SPACE                 TO W1AX-TRALOG-TEXT
047740     MOVE W1AN-ANZ-SCHU         TO W1AN-AUFB3
047750     STRING '14.a C01A-VS02LZ-PP: '
047760            ' W1AN-ANZ-SCHU = '    W1AN-AUFB3
047770     DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
047780     PERFORM Q92-TRALOG-ZEILE
047790*V11 <-- --------------------------------------------------------
047800
047810*    IF W1AN-ANZ-SCHU             < 1 OR  > 8  --V06
047820     IF W1AN-ANZ-SCHU             > 8
047830       SET U1AX-VERARB-FEHLER      TO TRUE
047840*      -- Anzahl Transponder falsch
047850       MOVE K1AN-T2871             TO W549AN-TEXT-RC
047860       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
047870       STRING 'Anzahl Schubladen: '
047880               S551AN-E-VS02-SCHU-ANZAHL
047890       DELIMITED BY SIZE     INTO W549AX-FEHLER-PARM-TEXT
047900       WITH POINTER               W549AN-FEHLER-PARM-LEN
047910     END-IF
047920*--> V06
047930     IF U1AX-VERARB-OK
047940       IF W1AN-ANZ-SCHU = ZERO
047950         PERFORM VARYING I1AN-TRA FROM 1 BY 1
047960                           UNTIL I1AN-TRA > 8
047970           IF S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
047980                              NOT = SPACE
047990             SET U1AX-VERARB-FEHLER  TO TRUE
048000*            -- TRANSPOND_ID muss leer sein wenn Anzahl = 0
048010             MOVE K1AN-T2871         TO W549AN-TEXT-RC
048020             MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
048030             STRING 'Anzahl Schubladen = 0 aber Trans. vorh '
048040                DELIMITED BY SIZE  INTO W549AX-FEHLER-PARM-TEXT
048050                WITH POINTER            W549AN-FEHLER-PARM-LEN
048060             END-STRING
048070           END-IF
048080
048090         END-PERFORM
048100       END-IF
048110     END-IF
048120*<-- V06
048130
048140     IF U1AX-VERARB-OK
048150*V11 --> --------------------------------------------------------
048160       MOVE SPACE                     TO W1AX-TRALOG-TEXT
048170       MOVE I1AN-NA                   TO W1AN-AUFB10
048180       STRING '1.Check Fehler, ANFRAGETYP = VS02'
048190                        S551AX-E-VS02-ANFRAGETYP
048200              ', S551AX-E-VS02-S-TRANSPOND-ID (1) = '
048210               S551AX-E-VS02-S-TRANSPOND-ID (1)
048220              '; I1AN-NA = '             W1AN-AUFB10
048230       DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
048240       PERFORM Q92-TRALOG-ZEILE
048250*V11 <-- --------------------------------------------------------
048260*V11 IR
048270*      SET U1AX-VS02Z-FEHLER-N     TO TRUE
048280
048290       PERFORM VARYING I1AN-TRA FROM 1 BY 1
048300       UNTIL I1AN-TRA > W1AN-ANZ-SCHU
048310
048320         MOVE ZERO       TO S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
048330
048340         IF S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
048350                                  <= SPACE
048360*V11                               = SPACE
048370*V11 --> --------------------------------------------------------
048380           MOVE SPACE                 TO W1AX-TRALOG-TEXT
048390           MOVE I1AN-TRA              TO W1AN-AUFB4
048400           STRING '2.Ohne Transponder ID T3022, I1AN-TRA: '
048410                               W1AN-AUFB4
048420           DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
048430           PERFORM Q92-TRALOG-ZEILE
048440*V11 <-- --------------------------------------------------------
048450*          -- TRANSPOND_ID darf nicht leer sein
048460           MOVE 'FAZ'  TO S551AX-A-VS02-FEHLER-SYSTEM (I1AN-TRA)
048470           MOVE K1AN-T3022
048480                          TO S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
048490           MOVE ':'    TO S551AX-A-VS02-FEHLER-TRENN  (I1AN-TRA)
048500*          -- Fehlertext umsetzen
048510           MOVE S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
048520                                      TO W1AN-FF3-FEHLERNUMMER
048530*V11 --> --------------------------------------------------------
048540           MOVE SPACE                  TO W1AX-TRALOG-TEXT
048550           MOVE W1AN-FF3-FEHLERNUMMER  TO W1AN-AUFB9
048560           STRING '3.FehlerNr W1AN-FF3-FEHLERNUMMER: '
048570                               W1AN-AUFB9
048580           DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
048590           PERFORM Q92-TRALOG-ZEILE
048600*V11 <-- --------------------------------------------------------
048610           PERFORM C80-FEH-TEXT-FE557
048620           MOVE S557AX-A-PROD-KLARTEXT
048630                         TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
048640*V11 --> --------------------------------------------------------
048650           MOVE SPACE                  TO W1AX-TRALOG-TEXT
048660           MOVE W1AN-FF3-FEHLERNUMMER  TO W1AN-AUFB9
048670           STRING '4.FehlerText S557AX-A-PROD-KLARTEXT: '
048680                            S557AX-A-PROD-KLARTEXT
048690           DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
048700           PERFORM Q92-TRALOG-ZEILE
048710*V11 <-- --------------------------------------------------------
048720*V11C IR
048730*          SET U1AX-VS02Z-FEHLER-Y     TO TRUE
048740         END-IF
048750
048760       END-PERFORM
048770*      -- Gesamt-RC ist hier immer o.k.
048780       MOVE ZERO                   TO W549AN-TEXT-RC
048790       MOVE K1AN-OK                TO W549AN-TEXT-FEHLER-KLASSE
048800
048810     END-IF
048820
048830*V11 --> --------------------------------------------------------
048840     MOVE SPACE                        TO W1AX-TRALOG-TEXT
048850     MOVE S551AN-A-VS02-FEHLER-NR(1)   TO W1AN-AUFB9
048860     STRING 'S551AN-A-VS02-FEHLER-NR(1): ' W1AN-AUFB9
048870     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
048880     PERFORM Q92-TRALOG-ZEILE
048890
048900     MOVE SPACE                        TO W1AX-TRALOG-TEXT
048910     MOVE S551AN-A-VS02-FEHLER-NR(2)   TO W1AN-AUFB9
048920     STRING 'S551AN-A-VS02-FEHLER-NR(2): ' W1AN-AUFB9
048930     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
048940     PERFORM Q92-TRALOG-ZEILE
048950
048960     MOVE SPACE                        TO W1AX-TRALOG-TEXT
048970     MOVE S551AN-A-VS02-FEHLER-NR(3)   TO W1AN-AUFB9
048980     STRING 'S551AN-A-VS02-FEHLER-NR(3): ' W1AN-AUFB9
048990     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
049000     PERFORM Q92-TRALOG-ZEILE
049010
049020     MOVE SPACE                        TO W1AX-TRALOG-TEXT
049030     MOVE S551AN-A-VS02-FEHLER-NR(4)   TO W1AN-AUFB9
049040     STRING 'S551AN-A-VS02-FEHLER-NR(4): ' W1AN-AUFB9
049050     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
049060     PERFORM Q92-TRALOG-ZEILE
049070
049080     MOVE SPACE                        TO W1AX-TRALOG-TEXT
049090     MOVE S551AN-A-VS02-FEHLER-NR(5)   TO W1AN-AUFB9
049100     STRING 'S551AN-A-VS02-FEHLER-NR(5): ' W1AN-AUFB9
049110     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
049120     PERFORM Q92-TRALOG-ZEILE
049130
049140     MOVE SPACE                        TO W1AX-TRALOG-TEXT
049150     MOVE S551AN-A-VS02-FEHLER-NR(6)   TO W1AN-AUFB9
049160     STRING 'S551AN-A-VS02-FEHLER-NR(6): ' W1AN-AUFB9
049170     DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
049180     PERFORM Q92-TRALOG-ZEILE
049190
049200*V11 <-- --------------------------------------------------------
049210
049220*    -- max. Anzahl anlernbarer Transponder zw. 1 und 8
049230     IF U1AX-VERARB-OK
049240*      -- Wert Key-Typ-ID=1150 (CONFIG-DATA-MASTER) ermitteln
049250       INITIALIZE B2VI-DCLFEV2VI
049260       INITIALIZE B2VI-I-DCLFEV2VI
049270
049280       MOVE S551AX-E-VIN          TO B2VIAX-VIN
049290       MOVE 1150                  TO B2VIAN-KEY-TYP-ID
049300
049310*      -- aktuellen Wert Config-Data-Master lesen
049320       PERFORM T-100-FEV2VI-SELECT
049330
049340       IF SQLAX-SQLSTATE = DB2-OK
049350         MOVE B2VIAX-DATEN-INHALT-TEXT (1:1)
049360                                 TO W1AX-WFS-CONFIGBYTE0
049370
049380         EVALUATE W1AX-WFS-CONFIGBYTE0
049390           WHEN '0' MOVE  0 TO W1AN-ANZ-KEYFOB
049400           WHEN '1' MOVE  1 TO W1AN-ANZ-KEYFOB
049410           WHEN '2' MOVE  2 TO W1AN-ANZ-KEYFOB
049420           WHEN '3' MOVE  3 TO W1AN-ANZ-KEYFOB
049430           WHEN '4' MOVE  4 TO W1AN-ANZ-KEYFOB
049440           WHEN '5' MOVE  5 TO W1AN-ANZ-KEYFOB
049450           WHEN '6' MOVE  6 TO W1AN-ANZ-KEYFOB
049460           WHEN '7' MOVE  7 TO W1AN-ANZ-KEYFOB
049470           WHEN '8' MOVE  8 TO W1AN-ANZ-KEYFOB
049480           WHEN OTHER
049490             SET U1AX-VERARB-FEHLER TO TRUE
049500*            -- Anzahl Transponder falsch
049510             MOVE K1AN-T2871       TO W549AN-TEXT-RC
049520             MOVE K1AN-FEHLER      TO W549AN-TEXT-FEHLER-KLASSE
049530             MOVE 1                TO W549AN-FEHLER-PARM-LEN
049540             STRING ' VI.WFSConfigByte[0]='
049550                      B2VIAX-DATEN-INHALT-TEXT (1:1)
049560             DELIMITED BY SIZE   INTO W549AX-FEHLER-PARM-TEXT
049570             WITH POINTER             W549AN-FEHLER-PARM-LEN
049580         END-EVALUATE
049590
049600
049610*        -- KeyFob-Anzahl  > Inhalt ConfigByte
049620         IF W1AN-ANZ-SCHU          > W1AN-ANZ-KEYFOB
049630           SET U1AX-VERARB-FEHLER  TO TRUE
049640*          -- Transponder-Anzahl ungleich Transponder-Anzahl in
049650*          -- WFS-Master
049660           MOVE K1AN-T3102         TO W549AN-TEXT-RC
049670           MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
049680           MOVE 1                  TO W549AN-FEHLER-PARM-LEN
049690           STRING ' Anzahl Schubladen VS02 '
049700                    W1AN-ANZ-SCHU
049710                  ', Anzahl VI.KeyFOB '
049720                    W1AN-ANZ-KEYFOB
049730           DELIMITED BY SIZE   INTO W549AX-FEHLER-PARM-TEXT
049740           WITH POINTER             W549AN-FEHLER-PARM-LEN
049750         END-IF
049760       ELSE
049770         SET U1AX-VERARB-FEHLER    TO TRUE
049780*        -- Config Data Master nicht gefunden
049790         MOVE K1AN-T2958           TO W549AN-TEXT-RC
049800         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
049810       END-IF
049820     END-IF
049830
049840     MOVE '01;C01A-VS02LZ-PP    ;Ende'   TO W1AX-TRALOG-TEXT
049850     PERFORM Q92-TRALOG-ZEILE
049860
049870     CONTINUE.
049880 C01A-VS02LZ-PP-END.
049890     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
049900       DISPLAY "++25889-->C01A-VS02LZ-PP-END.           "
049910     DISPLAY "++W549AX-V-ID-TRACE = "
049920        W549AX-V-ID-TRACE                             *>++DELETE
049930     DISPLAY "++W549AN-TRACE-LEVEL = "
049940        W549AN-TRACE-LEVEL                            *>++DELETE
049950     END-IF                                           *>++DELETE
049960     EXIT.
049970/
049980*-----------------------------------------------------------------
049990* Transponder registrieren
050000* - für alle gelieferten Transponder lt. S551AN-E-VS02-SCHU-ANZAHL
050010*-----------------------------------------------------------------
050020 C10-TRAN-REG-VS02  SECTION.
050030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
050040       DISPLAY "++25889-->C10-TRAN-REG-VS02  SECTION.   "
050050     DISPLAY "++W549AX-V-ID-TRACE = "
050060        W549AX-V-ID-TRACE                             *>++DELETE
050070     DISPLAY "++W549AN-TRACE-LEVEL = "
050080        W549AN-TRACE-LEVEL                            *>++DELETE
050090     END-IF                                           *>++DELETE
050100
050110     MOVE '01;C10-TRAN-REG-VS02;Beginn'
050120                                   TO W1AX-TRALOG-TEXT
050130     PERFORM Q92-TRALOG-ZEILE
050140
050150     IF U1AX-VERARB-OK
050160       PERFORM C01-VS02R-PP
050170     END-IF
050180
050190     IF U1AX-VERARB-OK
050200       INITIALIZE S540
050210
050220*      -- Werte setzen, die immer gleich sind
050230*      -I1AN-TRAein
050240       MOVE '25'                     TO S540AX-E-AKTION
050250       PERFORM C25-FE540-VOR-VS02
050260*      -- W1AN-ANZ-TRA-OK mit 0 vorbelegen
050270
050280*      -- BGRP bestimmen
050290       PERFORM C28-TRA-BGRP
050300*      -- W1AN-TRA-BGRP
050310*      -- W1AX-BGRP-ZAEHLEN
050320
050330       PERFORM VARYING I1AN-TRA FROM 1 BY 1
050340       UNTIL I1AN-TRA  > W1AN-ANZ-SCHU
050350
050360         PERFORM C27-VS02R-FE540C
050370*        - U1AX-VERARB-OK oder U1AX-VERARB-FEHLER
050380
050390*        -- Transponder registrieren,
050400*        -- schreiben der Werte aus FE540C
050410         IF S540AN-A-TEXT-FEHLER-KLASSE = K1AN-OK
050420                                      OR K1AN-HINWEIS
050430           IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = ZERO
050440
050450             ADD 1                  TO W1AN-ANZ-TRA-OK
050460
050470*            -- 8080 = REGISTRIERT FÜR DOWNLOAD 4
050480             MOVE K1AN-8080-DL4-REG TO W1AN-TEXT-TRANSP-STATUS
050490*            -- hier die neue BRGP
050500             MOVE W1AN-TRA-BGRP     TO BXX3AX-BGRP
050510             MOVE ZERO              TO BXX3AN-I-BGRP
050520             PERFORM D90-WRITE-TRANSP-VS02
050530           ELSE
050540*            -- WENN FEHLER AUFGETRETEN HAT, DANN BGRP AUS FE540
050550             MOVE S540AX-A-BGRP
050560                    TO S551AX-A-VS02-S-BGRP-NUMMER (I1AN-TRA)
050570*            -- Transponder-ID muss ausgegeben werden
050580             MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
050590                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
050600           END-IF
050610         ELSE
050620*          -- WENN FEHLER AUFGETRETEN HAT, DANN BGRP AUS FE540
050630           MOVE S540AX-A-BGRP
050640                    TO S551AX-A-VS02-S-BGRP-NUMMER (I1AN-TRA)
050650*          -- Transponder-ID muss ausgegeben werden
050660           MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
050670                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
050680         END-IF
050690
050700       END-PERFORM
050710
050720     END-IF
050730
050740     MOVE '01;C10-TRAN-REG-VS02;Ende'
050750                                   TO W1AX-TRALOG-TEXT
050760     PERFORM Q92-TRALOG-ZEILE
050770
050780     CONTINUE.
050790 C10-TRAN-REG-VS02-END.
050800     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
050810       DISPLAY "++25889-->C10-TRAN-REG-VS02-END.        "
050820     DISPLAY "++W549AX-V-ID-TRACE = "
050830        W549AX-V-ID-TRACE                             *>++DELETE
050840     DISPLAY "++W549AN-TRACE-LEVEL = "
050850        W549AN-TRACE-LEVEL                            *>++DELETE
050860     END-IF                                           *>++DELETE
050870     EXIT.
050880/
050890*-----------------------------------------------------------------
050900* Transponder löschen
050910*-----------------------------------------------------------------
050920 C11-TRAN-LOE-VS02  SECTION.
050930     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
050940       DISPLAY "++25889-->C11-TRAN-LOE-VS02  SECTION.   "
050950     DISPLAY "++W549AX-V-ID-TRACE = "
050960        W549AX-V-ID-TRACE                             *>++DELETE
050970     DISPLAY "++W549AN-TRACE-LEVEL = "
050980        W549AN-TRACE-LEVEL                            *>++DELETE
050990     END-IF                                           *>++DELETE
051000
051010     MOVE '01;C11-TRAN-LOE-VS02;Beginn'  TO W1AX-TRALOG-TEXT
051020     PERFORM Q92-TRALOG-ZEILE
051030
051040     PERFORM C01A-VS02LZ-PP
051050
051060     IF U1AX-VERARB-OK
051070       INITIALIZE S540
051080*      -- Schalter für VS02-L/Z
051090       MOVE 'J'                      TO S540AX-E-KT-PLUS
051100*    -- Werte setzen, die immer gleich sind
051110*    -- Allgemein
051120       MOVE '23'                   TO S540AX-E-AKTION
051130       PERFORM C25-FE540-VOR-VS02
051140*      -- W1AN-TRA-BGRP mit 500 vorbelegen
051150*      -- W1AN-ANZ-TRA-OK mit 0 vorbelegen
051160
051170       PERFORM VARYING I1AN-TRA FROM 1 BY 1
051180       UNTIL I1AN-TRA  > W1AN-ANZ-SCHU
051190
051200         ADD 1                     TO W1AN-TRA-BGRP
051210         ADD 1                     TO W1AN-ANZ-TRA-OK
051220
051230         PERFORM C29-VS02-FE540C
051240*        -- U1AX-VERARB-OK oder U1AX-VERARB-FEHLER
051250
051260*        -- Transponder löschen, schreiben der Werte aus FE540C
051270         IF S540AN-A-TEXT-FEHLER-KLASSE = K1AN-OK
051280                                      OR K1AN-HINWEIS
051290
051300           IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = ZERO
051310*            -- 8043 = verschrottet
051320             MOVE K1AN-8043-VERSCHROTTET
051330                                   TO W1AN-TEXT-TRANSP-STATUS
051340*            -- hier muss es die BGRP aus FE540 sein
051350             MOVE S540AX-A-BGRP    TO BXX3AX-BGRP
051360             MOVE ZERO             TO BXX3AN-I-BGRP
051370             PERFORM D90-WRITE-TRANSP-VS02
051380*            -- Transponder für alle Marken sperren
051390*            -- in D92 prüfen, ob schreiben Mark. J/N
051400             PERFORM D92-WRITE-TRANSP-MARK
051410           ELSE
051420*            -- fehlerhafte zählen nicht
051430             SUBTRACT 1            FROM W1AN-TRA-BGRP
051440             SUBTRACT 1            FROM W1AN-ANZ-TRA-OK
051450*            -- aber Transponder-ID muss ausgegeben werden
051460             MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
051470                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
051480           END-IF
051490         ELSE
051500*          -- fehlerhafte zählen nicht
051510           SUBTRACT 1              FROM W1AN-TRA-BGRP
051520           SUBTRACT 1              FROM W1AN-ANZ-TRA-OK
051530*          -- aber Transponder-ID muss ausgegeben werden
051540           MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
051550                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
051560         END-IF
051570
051580       END-PERFORM
051590     END-IF
051600
051610*    -- alte Transponder zur VIN, die nicht in der Anfrage sind,
051620*    -- deaktivieren
051630     IF W549AN-TEXT-FEHLER-KLASSE   = K1AN-OK
051640                                      OR K1AN-HINWEIS
051650       IF S540AX-A-SCHREIBEN = 'J'
051660         MOVE K1AN-8043-VERSCHROTTET
051670                                   TO W1AN-STATUS
051680         PERFORM D91-INAKTIV-SETZEN
051690       END-IF
051700     END-IF
051710
051720     MOVE '01;C11-TRAN-LOE-VS02;Ende'  TO W1AX-TRALOG-TEXT
051730     PERFORM Q92-TRALOG-ZEILE
051740
051750     CONTINUE.
051760 C11-TRAN-LOE-VS02-END.
051770     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
051780       DISPLAY "++25889-->C11-TRAN-LOE-VS02-END.        "
051790     DISPLAY "++W549AX-V-ID-TRACE = "
051800        W549AX-V-ID-TRACE                             *>++DELETE
051810     DISPLAY "++W549AN-TRACE-LEVEL = "
051820        W549AN-TRACE-LEVEL                            *>++DELETE
051830     END-IF                                           *>++DELETE
051840     EXIT.
051850*-----------------------------------------------------------------
051860* Transponder Registrierung aufheben
051870*-----------------------------------------------------------------
051880 C12-TRAN-RAUF-VS02 SECTION.
051890     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
051900       DISPLAY "++25889-->C12-TRAN-RAUF-VS02 SECTION.   "
051910     DISPLAY "++W549AX-V-ID-TRACE = "
051920        W549AX-V-ID-TRACE                             *>++DELETE
051930     DISPLAY "++W549AN-TRACE-LEVEL = "
051940        W549AN-TRACE-LEVEL                            *>++DELETE
051950     END-IF                                           *>++DELETE
051960*
051970     MOVE '01;C12-TRAN-RAUF-VS02;Beginn'  TO W1AX-TRALOG-TEXT
051980     PERFORM Q92-TRALOG-ZEILE
051990
052000     PERFORM C01A-VS02LZ-PP
052010*V11 IR
052020     INITIALIZE S540
052030     MOVE ZERO TO W1AN-ANZ-TRA-AUFGEHOBEN
052040     IF U1AX-VERARB-OK
052050*V11 --> --------------------------------------------------------
052060       MOVE SPACE                 TO W1AX-TRALOG-TEXT
052070       MOVE S551AN-E-VS02-SCHU-ANZAHL
052080                                      TO W1AN-AUFB4
052090       STRING '7a. Nach C01A-VS02LZ-PP,'
052100              ' S551AN-E-VS02-SCHU-ANZAHL = '
052110                                         W1AN-AUFB4
052120              '. Wenn Input Anzahl Schubladen = 0, dann'
052130              ' "J" -> S540AX-A-SCHREIBEN '
052140              '; S540AX-A-SCHREIBEN = '
052150                                     S540AX-A-SCHREIBEN
052160       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
052170       PERFORM Q92-TRALOG-ZEILE
052180*V11 <-- --------------------------------------------------------
052190       IF S551AN-E-VS02-SCHU-ANZAHL = ZERO
052200          MOVE 'J' TO S540AX-A-SCHREIBEN
052210*V11b IR -->
052220*        -- Schalter für KeyTypen erhöhen
052230         MOVE 'J'                   TO S540AX-E-KT-PLUS
052240
052250*V11 --> --------------------------------------------------------
052260         MOVE SPACE                 TO W1AX-TRALOG-TEXT
052270         STRING '7b. S540AX-A-SCHREIBEN = '
052280                              S540AX-A-SCHREIBEN
052290         DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
052300         PERFORM Q92-TRALOG-ZEILE
052310*V11 <-- --------------------------------------------------------
052320       ELSE
052330         INITIALIZE S540
052340*V11 --> --------------------------------------------------------
052350         MOVE SPACE                 TO W1AX-TRALOG-TEXT
052360         STRING '7c. S540AX-A-SCHREIBEN = '
052370                              S540AX-A-SCHREIBEN
052380         DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
052390         PERFORM Q92-TRALOG-ZEILE
052400*V11 <-- --------------------------------------------------------
052410*        -- Schalter für VS02-L/Z (KeyTypen erhöhen)
052420         MOVE 'J'                   TO S540AX-E-KT-PLUS
052430
052440*        -- Werte setzen, die immer gleich sind
052450*        -- Allgemein
052460         MOVE '27'                  TO S540AX-E-AKTION
052470         PERFORM C25-FE540-VOR-VS02
052480*        -- W1AN-TRA-BGRP mit 500 vorbelegen
052490*        -- W1AN-ANZ-TRA-OK mit 0 vorbelegen
052500*V11a IR
052510         MOVE 'J'                   TO S540AX-A-SCHREIBEN
052520
052530         PERFORM VARYING I1AN-TRA FROM 1 BY 1
052540         UNTIL I1AN-TRA > W1AN-ANZ-SCHU
052550*V11 --> --------------------------------------------------------
052560           MOVE SPACE                     TO W1AX-TRALOG-TEXT
052570           MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
052580                                          TO W1AN-AUFB10
052590           MOVE I1AN-TRA                  TO W1AN-AUFB4
052600           STRING '10.S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA) = '
052610                      S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
052620                  '; S551AN-A-VS02-FEHLER-NR  (I1AN-TRA) = '
052630                                            W1AN-AUFB10
052640                '; I1AN-TRA = '             W1AN-AUFB4
052650           DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
052660           PERFORM Q92-TRALOG-ZEILE
052670*V11 <-- --------------------------------------------------------
052680
052690           ADD 1                   TO W1AN-TRA-BGRP
052700           ADD 1                   TO W1AN-ANZ-TRA-OK
052710
052720           PERFORM C29-VS02-FE540C
052730*V11 --> --------------------------------------------------------
052740           MOVE SPACE                 TO W1AX-TRALOG-TEXT
052750           MOVE S540AN-A-TEXT-FEHLER-KLASSE
052760                                        TO W1AN-AUFB9
052770           STRING '2a.nach FE540C; '
052780                  ' S540AN-A-TEXT-FEHLER-KLASSE: '
052790                                     W1AN-AUFB9
052800           DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
052810           PERFORM Q92-TRALOG-ZEILE
052820*V11 <-- --------------------------------------------------------
052830*         -- U1AX-VERARB-OK oder U1AX-VERARB-FEHLER
052840*         -- Transponder Reg. aufheben, schreiben Werte aus FE540C
052850           IF S540AN-A-TEXT-FEHLER-KLASSE = K1AN-OK
052860                                          OR K1AN-HINWEIS
052870*V11 IR --> ------------------------------------------------------
052880             MOVE SPACE                 TO W1AX-TRALOG-TEXT
052890             MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
052900                                        TO W1AN-AUFB9
052910             MOVE I1AN-TRA              TO W1AN-AUFB4
052920             STRING '2b.nach FE540C, Fehler: '
052930                  ' S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)= '
052940                    S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
052950                  '; S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = '
052960                                           W1AN-AUFB9
052970                    '; I1AN-TRA = '        W1AN-AUFB4
052980                    '; S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)='
052990                       S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
053000                  ';S540AX-E-KT-PLUS = '  S540AX-E-KT-PLUS
053010             DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
053020             PERFORM Q92-TRALOG-ZEILE
053030*V11 <-- --------------------------------------------------------
053040             IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = ZERO
053050*              -- 8086 = Registrierung aufgehoben
053060               MOVE K1AN-8086-AUFGEHOBEN TO
053070                                      W1AN-TEXT-TRANSP-STATUS
053080*              -- hier muss es die BGRP aus FE540 sein
053090               MOVE S540AX-A-BGRP  TO BXX3AX-BGRP
053100               MOVE ZERO           TO BXX3AN-I-BGRP
053110*V11 --> ----------------------------------------------------
053120               MOVE SPACE                 TO W1AX-TRALOG-TEXT
053130               MOVE I1AN-TRA              TO W1AN-AUFB4
053140               MOVE S540AN-A-TRANSPOND-STATUS
053150                                          TO W1AN-AUFB9
053160               STRING '12a.vor D90-WRITE-TRANSP-VS02 '
053170                  ' BXX3AX-TRANSPOND-ID = '  BXX3AX-TRANSPOND-ID
053180                  '; I1AN-TRA = '            W1AN-AUFB4
053190                  '; S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)='
053200                     S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
053210                  '; S540AN-A-TRANSPOND-STATUS = '
053220                     W1AN-AUFB9
053230                  '; BXX3AX-TRANSPOND-TYP = '
053240                     BXX3AX-TRANSPOND-TYP
053250                  ': BXX3AX-BGRP = '         BXX3AX-BGRP
053260                  '; S540AX-E-KT-PLUS = '  S540AX-E-KT-PLUS
053270               DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
053280               PERFORM Q92-TRALOG-ZEILE
053290*V11 <-- ------------------------------------------------------
053300               PERFORM D90-WRITE-TRANSP-VS02
053310               IF S540AX-A-SCHREIBEN = 'J'
053320                 ADD 1 TO W1AN-ANZ-TRA-AUFGEHOBEN
053330               END-IF
053340             ELSE
053350*              -- fehlerhafte zählen nicht
053360               SUBTRACT 1          FROM W1AN-TRA-BGRP
053370               SUBTRACT 1          FROM W1AN-ANZ-TRA-OK
053380*            -- aber Transponder-ID muss ausgegeben werden
053390               MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
053400                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
053410             END-IF
053420           ELSE
053430*V11C --> IR
053440*            IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = K1AN-T2872
053450*              SET U1AX-VS02Z-FEHLER-Y    TO TRUE
053460*            END-IF
053470*V11C <--
053480*            -- fehlerhafte zählen nicht
053490             SUBTRACT 1            FROM W1AN-TRA-BGRP
053500             SUBTRACT 1            FROM W1AN-ANZ-TRA-OK
053510*            -- aber Transponder-ID muss ausgegeben werden
053520             MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
053530                    TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
053540*V11 --> --------------------------------------------------------
053550             MOVE SPACE                 TO W1AX-TRALOG-TEXT
053560             MOVE W1AN-TRA-BGRP         TO W1AN-AUFB9
053570             MOVE W1AN-ANZ-TRA-OK       TO W1AN-AUFB4
053580             MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
053590                                        TO W1AN-AUFB10
053600             STRING '2c.nach FE540C; '
053610                  ' S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)= '
053620                    S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
053630                  '; S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = '
053640                     S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
053650                  ' W1AN-TRA-BGRP = '      W1AN-AUFB9
053660                  '; W1AN-ANZ-TRA-OK = '   W1AN-AUFB4
053670                  '; S540AX-E-KT-PLUS = '  S540AX-E-KT-PLUS
053680             DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
053690             PERFORM Q92-TRALOG-ZEILE
053700*V11 <-- --------------------------------------------------------
053710           END-IF
053720         END-PERFORM
053730       END-IF
053740     END-IF
053750
053760*V11 --> --------------------------------------------------------
053770     MOVE SPACE                 TO W1AX-TRALOG-TEXT
053780     MOVE W549AN-TEXT-FEHLER-KLASSE TO W1AN-AUFB9
053790     MOVE I1AN-NA                   TO W1AN-AUFB10
053800     if W1AN-AUFB9                  = K1AN-OK OR K1AN-HINWEIS
053810       STRING '5a.vor D91B-AUFGEH-SETZEN '
053820            ' W549AN-TEXT-FEHLER-KLASSE = ' W1AN-AUFB9
053830           '; Aufruf muss bei J in S540AX-A-SCHREIBEN stattfinden'
053840            '; S540AX-A-SCHREIBEN = '  S540AX-A-SCHREIBEN
053850            '; I1AN-NA = '             W1AN-AUFB10
053860       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
053870     else
053880       STRING '5b.vor D91B-AUFGEH-SETZEN '
053890            ' W549AN-TEXT-FEHLER-KLASSE = ' W1AN-AUFB9
053900            '; Kein Aufruf D91B-AUFGEH-SETZEN! '
053910            '  S540AX-A-SCHREIBEN = '       S540AX-A-SCHREIBEN
053920            '; I1AN-NA = '                  W1AN-AUFB10
053930       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
053940     end-if
053950
053960     PERFORM Q92-TRALOG-ZEILE
053970*V11 <-- --------------------------------------------------------
053980*    -- alte Transponder zur VIN, die nicht in der Anfrage sind,
053990*    -- reg. aufheben
054000     IF W549AN-TEXT-FEHLER-KLASSE   = K1AN-OK
054010                                      OR K1AN-HINWEIS
054020       IF S540AX-A-SCHREIBEN = 'J'
054030*V11  IR
054040*         AND U1AX-VS02Z-FEHLER-N
054050
054060*V11 --> --------------------------------------------------------
054070         MOVE SPACE                 TO W1AX-TRALOG-TEXT
054080         MOVE I1AN-NA                   TO W1AN-AUFB10
054090         STRING '8a. D91B-AUFGEH-SETZEN '
054100            ' S540AX-A-SCHREIBEN = '   S540AX-A-SCHREIBEN
054110            ' I1AN-NA = '                  W1AN-AUFB10
054120         DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
054130         PERFORM Q92-TRALOG-ZEILE
054140*V11 <-- --------------------------------------------------------
054150         PERFORM D91B-AUFGEH-SETZEN
054160       END-IF
054170     END-IF
054180
054190*V11 --> --------------------------------------------------------
054200     MOVE SPACE                 TO W1AX-TRALOG-TEXT
054210     MOVE I1AN-NA                   TO W1AN-AUFB10
054220     STRING '8b.nach D91B-AUFGEH-SETZEN '
054230            ' I1AN-NA = '                  W1AN-AUFB10
054240     DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
054250     PERFORM Q92-TRALOG-ZEILE
054260*V11 <-- --------------------------------------------------------
054270     IF W549AN-TEXT-FEHLER-KLASSE   = K1AN-OK
054280                                      OR K1AN-HINWEIS
054290       IF S540AX-A-SCHREIBEN = 'J'
054300         PERFORM C16-SMARTCARD-ZUORDN-AUFH
054310       END-IF
054320     END-IF
054330
054340     MOVE '01;C12-TRAN-RAUF-VS02;Ende'  TO W1AX-TRALOG-TEXT
054350     PERFORM Q92-TRALOG-ZEILE
054360
054370     CONTINUE.
054380 C12-TRAN-RAUF-VS02-END.
054390     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
054400       DISPLAY "++25889-->C12-TRAN-RAUF-VS02-END.       "
054410     DISPLAY "++W549AX-V-ID-TRACE = "
054420        W549AX-V-ID-TRACE                             *>++DELETE
054430     DISPLAY "++W549AN-TRACE-LEVEL = "
054440        W549AN-TRACE-LEVEL                            *>++DELETE
054450     END-IF                                           *>++DELETE
054460     EXIT.
054470*-----------------------------------------------------------------
054480* Zuordnung Schließcode zum Fahrzeug
054490*-----------------------------------------------------------------
054500 C14-SCODE-ZUORD-VS02 SECTION.
054510     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
054520       DISPLAY "++25889-->C14-SCODE-ZUORD-VS02 SECTION. "
054530     DISPLAY "++W549AX-V-ID-TRACE = "
054540        W549AX-V-ID-TRACE                             *>++DELETE
054550     DISPLAY "++W549AN-TRACE-LEVEL = "
054560        W549AN-TRACE-LEVEL                            *>++DELETE
054570     END-IF                                           *>++DELETE
054580
054590     MOVE '01;C14-SCODE-ZUORD-VS02;Beginn' TO W1AX-TRALOG-TEXT
054600     PERFORM Q92-TRALOG-ZEILE
054610
054620     IF S551AX-E-VS02-SCHLIESSSATZ-ID = SPACE
054630       SET U1AX-VERARB-FEHLER      TO TRUE
054640*      -- Schließsatz-Identifikation darf nicht leer sein
054650       MOVE K1AN-T3109             TO W549AN-TEXT-RC
054660       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
054670     END-IF
054680
054690*    -- Prüfen, was im S551AX-E-VS02-SCHLIESSSATZ-ID steht
054700     IF U1AX-VERARB-OK
054710       PERFORM C50-SCHLIESSSATZ-ID-PRUEFEN
054720*      -- S540AX-E-SCHLIESS-SATZ oder
054730*      -- S540AX-E-PIN-LABEL-GARN-SNR gefüllt
054740     END-IF
054750
054760     IF U1AX-VERARB-OK
054770*      -- Werte setzen, die immer gleich sind
054780*      -- Allgemein
054790       MOVE '22'                     TO S540AX-E-AKTION
054800       PERFORM C26-VS02S-A-FE540C
054810
054820*     -- Schließsatz-Zuordnung zur Fahrzeug-Baugruppe ablegen
054830*        SCHREIBEN NEUE SCHLIESS-SATZ-NR BGRP=007 IN T05
054840       IF U1AX-VERARB-OK
054850         IF S540AX-A-SCHREIBEN = 'J'
054860           PERFORM D97-WRITE-BGRP-LOEKZ-N
054870         END-IF
054880       END-IF
054890
054900*     -- Neue Garnitur-Seriennummer zum Fahrzeug ablegen
054910*        SCHREIBEN NEUE GARNITUR-SERIE-NR IN T08
054920       IF U1AX-VERARB-OK
054930         IF S540AX-A-SCHREIBEN = 'J'
054940           PERFORM D97-WRITE-FZ-ZUORD
054950         END-IF
054960       END-IF
054970     END-IF
054980
054990     MOVE '01;C14-SCODE-ZUORD-VS02;Ende'  TO W1AX-TRALOG-TEXT
055000     PERFORM Q92-TRALOG-ZEILE
055010
055020     CONTINUE.
055030 C14-SCODE-ZUORD-VS02-END.
055040     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
055050       DISPLAY "++25889-->C14-SCODE-ZUORD-VS02-END.     "
055060     DISPLAY "++W549AX-V-ID-TRACE = "
055070        W549AX-V-ID-TRACE                             *>++DELETE
055080     DISPLAY "++W549AN-TRACE-LEVEL = "
055090        W549AN-TRACE-LEVEL                            *>++DELETE
055100     END-IF                                           *>++DELETE
055110     EXIT.
055120/
055130*-----------------------------------------------------------------
055140* Aufheben der Zuordnung Schließcode zum Fahrzeug
055150*-----------------------------------------------------------------
055160 C15-SCODE-AUFH-VS02 SECTION.
055170     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
055180       DISPLAY "++25889-->C15-SCODE-AUFH-VS02 SECTION.  "
055190     DISPLAY "++W549AX-V-ID-TRACE = "
055200        W549AX-V-ID-TRACE                             *>++DELETE
055210     DISPLAY "++W549AN-TRACE-LEVEL = "
055220        W549AN-TRACE-LEVEL                            *>++DELETE
055230     END-IF                                           *>++DELETE
055240*
055250     MOVE '01;C15-SCODE-AUFH-VS02;Beginn' TO W1AX-TRALOG-TEXT
055260     PERFORM Q92-TRALOG-ZEILE
055270*V13 IR
055280     INITIALIZE   S540
055290*V13 IR -->
055300*    -- Ausbau der SCHLIESSSATZ-ID- Prüfung
055310*    IF S551AX-E-VS02-SCHLIESSSATZ-ID = SPACE
055320*      SET U1AX-VERARB-FEHLER      TO TRUE
055330**     -- Schließsatz-Identifikation darf nicht leer sein
055340*      MOVE K1AN-T3109             TO W549AN-TEXT-RC
055350*      MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
055360*    END-IF
055370*V13 <--
055380
055390*    -- Prüfen, was im S551AX-E-VS02-SCHLIESSSATZ-ID steht
055400     IF U1AX-VERARB-OK
055410*V13 IR
055420       IF S551AX-E-VS02-SCHLIESSSATZ-ID > SPACE
055430         PERFORM C50-SCHLIESSSATZ-ID-PRUEFEN
055440       END-IF
055450
055460*      -- S540AX-E-SCHLIESS-SATZ oder
055470*      -- S540AX-E-PIN-LABEL-GARN-SNR gefüllt
055480     END-IF
055490
055500     IF U1AX-VERARB-OK
055510*      -- Werte setzen, die immer gleich sind
055520*      -- Allgemein
055530       MOVE '28'                     TO S540AX-E-AKTION
055540       PERFORM C26-VS02S-A-FE540C
055550     END-IF
055560
055570*   -- Schließsatz-Zuordnung zur Fahrzeug-Baugruppe ablegen
055580*      SCHREIBEN NEUE SCHLIESS-SATZ-NR BGRP=007 IN T05
055590     IF U1AX-VERARB-OK
055600*V13 --> --------------------------------------------------------
055610       MOVE SPACE                 TO W1AX-TRALOG-TEXT
055620       STRING '1. Direkt nach dem Aufruf FE540C, '
055630              ' S540AX-A-SCHREIBEN = '
055640                                     S540AX-A-SCHREIBEN
055650       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
055660       PERFORM Q92-TRALOG-ZEILE
055670*V13 <-- --------------------------------------------------------
055680
055690       IF S540AX-A-SCHREIBEN = 'J'
055700         PERFORM D98-WRITE-BGRP-LOEKZ-J
055710       END-IF
055720     END-IF
055730
055740*   -- Leere Garnitur-Seriennummer zum Fahrzeug ablegen
055750*      SCHREIBEN leere GARNITUR-SERIE-NR IN T08
055760     IF U1AX-VERARB-OK
055770*V13 --> --------------------------------------------------------
055780       MOVE SPACE                 TO W1AX-TRALOG-TEXT
055790*      MOVE S551AN-E-VS02-SCHU-ANZAHL
055800*                                 TO W1AN-AUFB4
055810       STRING '3. FEV005 Schreiben oder nicht '
055820              ' S540AX-A-SCHREIBEN = '
055830                                     S540AX-A-SCHREIBEN
055840       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
055850       PERFORM Q92-TRALOG-ZEILE
055860*V13 <-- --------------------------------------------------------
055870       IF S540AX-A-SCHREIBEN = 'J'
055880         PERFORM D96A-WRITE-FZ-AUFHEB
055890       END-IF
055900     END-IF
055910
055920     MOVE '01;C15-SCODE-AUFH-VS02;Ende'  TO W1AX-TRALOG-TEXT
055930     PERFORM Q92-TRALOG-ZEILE
055940
055950     CONTINUE.
055960 C15-SCODE-AUFH-VS02-END.
055970     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
055980       DISPLAY "++25889-->C15-SCODE-AUFH-VS02-END.      "
055990     DISPLAY "++W549AX-V-ID-TRACE = "
056000        W549AX-V-ID-TRACE                             *>++DELETE
056010     DISPLAY "++W549AN-TRACE-LEVEL = "
056020        W549AN-TRACE-LEVEL                            *>++DELETE
056030     END-IF                                           *>++DELETE
056040     EXIT.
056050/
056060*-----------------------------------------------------------------
056070* Zuordnung SmartCard zum FZ aufheben
056080* Wenn es eine SmartCard zum FZ gibt, wird hier die Zuordnung
056090* aufgehoben
056100*-----------------------------------------------------------------
056110 C16-SMARTCARD-ZUORDN-AUFH SECTION.
056120     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
056130       DISPLAY "++25889-->C16-SMARTCARD-ZUORDN-AUFH SECT"
056140     DISPLAY "++W549AX-V-ID-TRACE = "
056150        W549AX-V-ID-TRACE                             *>++DELETE
056160     DISPLAY "++W549AN-TRACE-LEVEL = "
056170        W549AN-TRACE-LEVEL                            *>++DELETE
056180     END-IF                                           *>++DELETE
056190*
056200     MOVE '01;C16-SMARTCARD-ZUORDN-AUFH;Beginn'
056210                                         TO W1AX-TRALOG-TEXT
056220     PERFORM Q92-TRALOG-ZEILE
056230
056240*    Lesen SmartCard-Tabelle FE01TXA0
056250     INITIALIZE    B0XA-DCLFEV0XA
056260                   B0XA-I-DCLFEV0XA
056270     MOVE S551AX-E-VIN            TO B0XAAX-VIN
056280
056290*    OPEN CURSOR TO GET ALL SC ASSIGNED TO GIVEN VIN
056300     PERFORM T-100-FEV0XA-OPEN
056310     PERFORM T-100-FEV0XA-FETCH
056320
056330     PERFORM UNTIL SQLSTATE NOT EQUAL DB2-OK
056340*       --   Deactivating SC
056350        INITIALIZE    BXXA-DCLFEVXXA
056360                      BXXA-I-DCLFEVXXA
056370        MOVE B0XA-DCLFEV0XA       TO BXXA-DCLFEVXXA
056380        MOVE B0XA-I-DCLFEV0XA     TO BXXA-I-DCLFEVXXA
056390*       --   Deactivating SC
056400        MOVE W549AX-LOG-UTC-V-ID  TO BXXAAX-UTC-V-ID
056410        MOVE 5384                 TO BXXAAN-TEXT-SMARTCARD-STATUS
056420        PERFORM T-100-FEVXXA-INSERT
056430
056440        PERFORM T-100-FEV0XA-FETCH
056450     END-PERFORM
056460
056470*    IF SQLAX-SQLSTATE = DB2-OK
056480*       -- Schreiben FE01TXA0 mit Status 5384 Registr. aufg.
056490*       --   gelesen Werte zuweisen
056500*       MOVE B0XA-DCLFEV0XA       TO BXXA-DCLFEVXXA
056510*       MOVE B0XA-I-DCLFEV0XA     TO BXXA-I-DCLFEVXXA
056520*       --   neue Werte zuweisen
056530*       MOVE W549AX-LOG-UTC-V-ID  TO BXXAAX-UTC-V-ID
056540*       MOVE 5384                 TO BXXAAN-TEXT-SMARTCARD-STATUS
056550*       PERFORM T-100-FEVXXA-INSERT
056560*       !!! keine Abfrage SQLSTATE da keine Rückmeldung möglich
056570*    END-IF
056580
056590*    -- hier SmartCard Auskunft schreiben falls nötig
056600
056610     MOVE '01;C16-SMARTCARD-ZUORDN-AUFH;Ende'
056620                                         TO W1AX-TRALOG-TEXT
056630     PERFORM Q92-TRALOG-ZEILE
056640
056650     CONTINUE.
056660 C16-SMARTCARD-ZUORDN-AUFH-END.
056670     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
056680       DISPLAY "++25889-->C16-SMARTCARD-ZUORDN-AUFH-END."
056690     DISPLAY "++W549AX-V-ID-TRACE = "
056700        W549AX-V-ID-TRACE                             *>++DELETE
056710     DISPLAY "++W549AN-TRACE-LEVEL = "
056720        W549AN-TRACE-LEVEL                            *>++DELETE
056730     END-IF                                           *>++DELETE
056740     EXIT.
056750/
056760*V13 IR Neue Section
056770*-----------------------------------------------------------------
056780* Prüfung, ob Schließcode (GARNITUR-SERIE-NR) zu VIN vorhanden ist
056790*-----------------------------------------------------------------
056800 C17-SCODE-CHECK SECTION.
056810     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
056820       DISPLAY "++25889-->C17-SCODE-CHECK SECTION.      "
056830     DISPLAY "++W549AX-V-ID-TRACE = "
056840        W549AX-V-ID-TRACE                             *>++DELETE
056850     DISPLAY "++W549AN-TRACE-LEVEL = "
056860        W549AN-TRACE-LEVEL                            *>++DELETE
056870     END-IF                                           *>++DELETE
056880*
056890     MOVE '01;C17-SCODE-CHECK;Beginn'
056900                                         TO W1AX-TRALOG-TEXT
056910     PERFORM Q92-TRALOG-ZEILE
056920
056930*    -- Lesen T08 zur VIN
056940     INITIALIZE V208-DCLFEV208
056950     MOVE HIGH-VALUE               TO V208-I-DCLFEV208
056960     MOVE S551AX-E-VIN             TO V208AX-VIN
056970
056980     PERFORM T-100-FEV208-SELECT
056990
057000     MOVE '01;C17-SCODE-CHECK;Ende'
057010                                         TO W1AX-TRALOG-TEXT
057020     PERFORM Q92-TRALOG-ZEILE
057030
057040     CONTINUE.
057050 C17-SCODE-CHECK-END.
057060     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
057070       DISPLAY "++25889-->C17-SCODE-CHECK-END.          "
057080     DISPLAY "++W549AX-V-ID-TRACE = "
057090        W549AX-V-ID-TRACE                             *>++DELETE
057100     DISPLAY "++W549AN-TRACE-LEVEL = "
057110        W549AN-TRACE-LEVEL                            *>++DELETE
057120     END-IF                                           *>++DELETE
057130     EXIT.
057140/
057150*-----------------------------------------------------------------
057160* Werte, die bei jedem Aufruf gleich sind und 1 x gesetzt werden
057170* Initialize der ganzen Struktur schon vorher, weil Aktion gesetzt
057180*-----------------------------------------------------------------
057190 C25-FE540-VOR-VS02  SECTION.
057200     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
057210       DISPLAY "++25889-->C25-FE540-VOR-VS02  SECTION.  "
057220     DISPLAY "++W549AX-V-ID-TRACE = "
057230        W549AX-V-ID-TRACE                             *>++DELETE
057240     DISPLAY "++W549AN-TRACE-LEVEL = "
057250        W549AN-TRACE-LEVEL                            *>++DELETE
057260     END-IF                                           *>++DELETE
057270*
057280     MOVE '01;C25-FE540-VOR-VS02;Beginn' TO W1AX-TRALOG-TEXT
057290     PERFORM Q92-TRALOG-ZEILE
057300
057310     MOVE W549AX-LOG-UTC-V-ID      TO S540AX-E-LOG-UTC-V-ID
057320     MOVE W549AX-LOG-V-ID          TO S540AX-E-LOG-V-ID
057330     MOVE 'C'                      TO S540AX-E-STELLE6-STDMODUL
057340     MOVE 'D'                      TO S540AX-E-STELLE6-CMODUL
057350     MOVE S551AX-E-SPRACH-KZ       TO S540AN-E-SPRACH-KZ
057360     MOVE ZERO                     TO S540AN-E-DISPLAYLEVEL
057370     MOVE W549AN-TRACE-LEVEL       TO S540AN-E-TRACELEVEL
057380     MOVE W549AX-V-ID-TRACE        TO S540AX-E-V-ID-TRACE
057390     MOVE SPACE                    TO S540AX-E-RESERVE-1
057400*    -- Fahrzeug
057410     MOVE S551AX-E-VIN             TO S540AX-E-VIN
057420*    -- Transponder
057430     MOVE W1AN-ANZ-SCHU            TO S540AX-E-ANZAHL-TRANSPOND
057440
057450     MOVE 500                      TO W1AN-TRA-BGRP
057460     ADD W1AN-ANZ-TRA-X30-ANG      TO W1AN-TRA-BGRP
057470     MOVE ZERO                     TO W1AN-ANZ-TRA-OK
057480
057490     MOVE '01;C25-FE540-VOR-VS02;Ende'    TO W1AX-TRALOG-TEXT
057500     PERFORM Q92-TRALOG-ZEILE
057510
057520     CONTINUE.
057530 C25-FE540-VOR-VS02-END.
057540     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
057550       DISPLAY "++25889-->C25-FE540-VOR-VS02-END.       "
057560     DISPLAY "++W549AX-V-ID-TRACE = "
057570        W549AX-V-ID-TRACE                             *>++DELETE
057580     DISPLAY "++W549AN-TRACE-LEVEL = "
057590        W549AN-TRACE-LEVEL                            *>++DELETE
057600     END-IF                                           *>++DELETE
057610     EXIT.
057620/
057630*-----------------------------------------------------------------
057640* Aufruf FE540C für VS02-S/A Schliesscode
057650* Schliesssatz und Pin-Label werden in C50-SCHLIESSSATZ-ID-PRUEFEN
057660* geprüft und gefüllt
057670*-----------------------------------------------------------------
057680 C26-VS02S-A-FE540C  SECTION.
057690     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
057700       DISPLAY "++25889-->C26-VS02S-A-FE540C  SECTION.  "
057710     DISPLAY "++W549AX-V-ID-TRACE = "
057720        W549AX-V-ID-TRACE                             *>++DELETE
057730     DISPLAY "++W549AN-TRACE-LEVEL = "
057740        W549AN-TRACE-LEVEL                            *>++DELETE
057750     END-IF                                           *>++DELETE
057760*
057770     MOVE '01;C26-VS02S-A-FE540C;Beginn' TO W1AX-TRALOG-TEXT
057780     PERFORM Q92-TRALOG-ZEILE
057790
057800     MOVE W549AX-LOG-UTC-V-ID      TO S540AX-E-LOG-UTC-V-ID
057810     MOVE W549AX-LOG-V-ID          TO S540AX-E-LOG-V-ID
057820     MOVE 'C'                      TO S540AX-E-STELLE6-STDMODUL
057830     MOVE 'D'                      TO S540AX-E-STELLE6-CMODUL
057840     MOVE S551AX-E-SPRACH-KZ       TO S540AN-E-SPRACH-KZ
057850     MOVE ZERO                     TO S540AN-E-DISPLAYLEVEL
057860     MOVE W549AN-TRACE-LEVEL       TO S540AN-E-TRACELEVEL
057870     MOVE W549AX-V-ID-TRACE        TO S540AX-E-V-ID-TRACE
057880     MOVE SPACE                    TO S540AX-E-RESERVE-1
057890*    -- Fahrzeug
057900     MOVE S551AX-E-VIN             TO S540AX-E-VIN
057910
057920     INITIALIZE S540A-E-FRAESE
057930     INITIALIZE S540AX-E-TRANSPONDER
057940     INITIALIZE S540AX-E-BEMERKUNG
057950     MOVE SPACE                    TO S540AX-E-RESERVE-2
057960
057970     CALL FE540C USING S540
057980
057990*    -- FE540-Returnwerte werden in den -WRITE-Sections übernommen
058000     EVALUATE S540AN-A-TEXT-FEHLER-KLASSE
058010     WHEN K1AN-OK
058020     WHEN K1AN-HINWEIS
058030       MOVE S540AN-A-TEXT-RC       TO W549AN-TEXT-RC
058040       MOVE S540AN-A-TEXT-FEHLER-KLASSE
058050                                   TO W549AN-TEXT-FEHLER-KLASSE
058060     WHEN OTHER
058070       SET  U1AX-VERARB-FEHLER     TO TRUE
058080       MOVE S540AN-A-TEXT-RC       TO W549AN-TEXT-RC
058090       MOVE S540AN-A-TEXT-FEHLER-KLASSE
058100                                   TO W549AN-TEXT-FEHLER-KLASSE
058110       MOVE S540AX-A-BESCHREIBUNG  TO W549AX-BESCHREIBUNG
058120       MOVE S540AX-A-FEHLER-PARM   TO W549AX-FEHLER-PARM
058130*      -- Fehlertext umsetzen
058140       MOVE S540AN-A-TEXT-RC       TO W1AN-FF3-FEHLERNUMMER
058150       PERFORM C80-FEH-TEXT-FE557
058160       MOVE S557AX-A-PROD-KLARTEXT
058170                         TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
058180     END-EVALUATE
058190
058200     MOVE '01;C26-VS02S-A-FE540C;Ende'    TO W1AX-TRALOG-TEXT
058210     PERFORM Q92-TRALOG-ZEILE
058220
058230     CONTINUE.
058240 C26-VS02S-A-FE540C-END.
058250     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
058260       DISPLAY "++25889-->C26-VS02S-A-FE540C-END.       "
058270     DISPLAY "++W549AX-V-ID-TRACE = "
058280        W549AX-V-ID-TRACE                             *>++DELETE
058290     DISPLAY "++W549AN-TRACE-LEVEL = "
058300        W549AN-TRACE-LEVEL                            *>++DELETE
058310     END-IF                                           *>++DELETE
058320     EXIT.
058330/
058340*-----------------------------------------------------------------
058350* Aufruf FE540C für VS02-Telegramm
058360*-----------------------------------------------------------------
058370 C27-VS02R-FE540C SECTION.
058380     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
058390       DISPLAY "++25889-->C27-VS02R-FE540C SECTION.     "
058400     DISPLAY "++W549AX-V-ID-TRACE = "
058410        W549AX-V-ID-TRACE                             *>++DELETE
058420     DISPLAY "++W549AN-TRACE-LEVEL = "
058430        W549AN-TRACE-LEVEL                            *>++DELETE
058440     END-IF                                           *>++DELETE
058450
058460     MOVE '01;C27-VS02R-FE540C;Beginn' TO W1AX-TRALOG-TEXT
058470     PERFORM Q92-TRALOG-ZEILE
058480
058490*    -- FRAESE  - entfällt, Fräse nicht in Prod
058500*       Werte trotzdem übernehmen...
058510     MOVE S551AX-E-VS02-S-CRYPTBOX-ID (I1AN-TRA)
058520                                   TO S540AX-E-TESTER-ID
058530     MOVE S551AX-E-VS02-S-CRYPTBOX-HOST (I1AN-TRA)
058540                                   TO S540AX-E-AGENT-HOSTNAME
058550     MOVE S551AX-E-VS02-S-CRYPTBOX-CHALL (I1AN-TRA)
058560                                   TO S540AX-E-CHALLENGE
058570     MOVE S551AX-E-VS02-S-CRYPTBOX-SIGN (I1AN-TRA)
058580                                   TO S540AX-E-SIGNATURE
058590     MOVE S551AX-E-VS02-S-CRYPTBOX-ZAHL (I1AN-TRA)
058600                                   TO S540AX-E-ID-ZAHL
058610
058620*    -- TRANSPONDER
058630     MOVE S551AX-E-VS02-S-TRANSPOND-TYP (I1AN-TRA)
058640                                   TO S540AX-E-TRANSPOND-TYP
058650     MOVE S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
058660                                   TO S540AX-E-TRANSPOND-ID
058670     MOVE S551AX-E-VS02-S-TRANSPOND-MEM (I1AN-TRA)
058680                                   TO S540AX-E-USER-MEMORY
058690
058700*    -- ...oder festlegen anhand bereits vorhandener BGRPen
058710     PERFORM C28A-TRA-BGRP
058720*    -- W1AN-TRA-BGRP
058730
058740     MOVE W1AN-TRA-BGRP            TO S540AX-E-TRANSPOND-BGRP
058750
058760     MOVE S551AX-E-VS02-SCHLIESSSATZ-ID
058770                                   TO S540AX-E-PIN-LABEL-GARN-SNR
058780     INITIALIZE                       S540AX-E-BEMERKUNG
058790     MOVE SPACE                    TO S540AX-E-RESERVE-2
058800
058810     IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA)= ZERO
058820
058830       CALL FE540C USING S540
058840
058850*    -- FE540-Returnwerte werden in den -WRITE-Sections
058860*       übernommen, diese hier:
058870*    -- Schalter für KT erhöhen übernehmen aus FE540C
058880       MOVE S540AX-A-KT-PLUS         TO S540AX-E-KT-PLUS
058890*    -- FRAESE  - entfällt, Fräse nicht in Prod
058900*    -- Auskunftstabellen
058910*    -- AK Hinweis
058920       MOVE S540AN-A-TXVR-ANZAHL     TO TXVRAN-I
058930       MOVE S540-A-TXVRAX-BEREICH    TO TXVRAX-BEREICH
058940*      -- AK Transponder
058950       MOVE S540AN-A-TXX4-ANZAHL     TO TXX4AN-I
058960       MOVE S540-A-TXX4AX-BEREICH    TO TXX4AX-BEREICH
058970
058980*      -- Fehler und Hinweise übernehmen pro Schublade
058990       MOVE 'FAZ'       TO S551AX-A-VS02-FEHLER-SYSTEM (I1AN-TRA)
059000       MOVE S540AN-A-TEXT-RC TO S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
059010       MOVE ':'         TO S551AX-A-VS02-FEHLER-TRENN  (I1AN-TRA)
059020*      -- Fehlertext umsetzen s.u.
059030       MOVE SPACE       TO S551AX-A-VS02-FEHLER-TEXT   (I1AN-TRA)
059040
059050       IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) > ZERO
059060*        -- Fehlertext aufbereiten
059070         MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
059080                                     TO W1AN-FF3-FEHLERNUMMER
059090         PERFORM C80-FEH-TEXT-FE557
059100         MOVE S557AX-A-PROD-KLARTEXT
059110                           TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
059120       END-IF
059130
059140*      -- Gesamt-RC ist hier immer o.k.
059150       MOVE ZERO                     TO W549AN-TEXT-RC
059160       MOVE K1AN-OK                  TO W549AN-TEXT-FEHLER-KLASSE
059170     END-IF
059180
059190     MOVE '01;C27-VS02R-FE540C;Ende  ' TO W1AX-TRALOG-TEXT
059200     PERFORM Q92-TRALOG-ZEILE
059210
059220     CONTINUE.
059230 C27-VS02R-FE540C-END.
059240     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
059250       DISPLAY "++25889-->C27-VS02R-FE540C-END.         "
059260     DISPLAY "++W549AX-V-ID-TRACE = "
059270        W549AX-V-ID-TRACE                             *>++DELETE
059280     DISPLAY "++W549AN-TRACE-LEVEL = "
059290        W549AN-TRACE-LEVEL                            *>++DELETE
059300     END-IF                                           *>++DELETE
059310     EXIT.
059320/
059330*-----------------------------------------------------------------
059340* Ermitteln der BGRP für den aktuellen Transponder
059350* Betrachtet werden alle Transponder in der akt. Anfrage sowie
059360* alle, die bereits in FAZIT.X30 vorhanden sind
059370* Ausgabe: W1AN-TRA-BGRP
059380*
059390* Kriterien:
059400*  - Aktueller X30-Eintrag muss zur SKC0-KEY-TYP-ID-ZAHL aus der
059410*    VP-Tabelle zum FZ passen (ermittelt in C01-VS02R-PP)
059420*    -> W1AN-SKC0-KT-ID-ZAHL
059430*  - Status muss 8080, 8082 oder 8045 sein
059440*
059450* Die vorhandenen Transpnder werden in die interne Tabelle TB-TAB
059460* gestellt, die zuvor mit den möglichen BGRP 501-508 und der
059470* Transponder-ID '--------' = leer initialisiert wurde
059480*
059490* a) noch kein Transponder zum FZ zugeordnet
059500*    - BGRP = fortlaufende Nummer gem. Schublade/int. Tabelle
059510*      es wird die nächste freie BGRP = '--------' zugeordnet
059520* b) es sind bereits Transponder zum FZ zugeordnet
059530*  1. ein weiterer wird registriert, keine bereits zugeord-
059540*     neten sind in der Anfrage
059550*     - bereits vorh. BGRP ermitteln, nächste freie verwenden
059560*  2. ein weiterer TRA wird registriert, bereits zugeordnete TRA
059570*     sind auch in der Anfrage
059580*     - vorh. TRA   : BGRP aus X30 ermitteln und verwenden
059590*     - weiterer TRA: nächste freie BGRP ermitteln
059600*  3. es gibt bereits Transponder zum FZ, aber die BGRP sind
059610*     nicht lückenlos aufsteigend zugeordnet
059620*     - alle Transponder mit den BGRP lesen und nächste freie
059630*       bestimmen für zusätzl. TRA, für vorh. die aus X30
059640*-----------------------------------------------------------------
059650 C28-TRA-BGRP    SECTION.
059660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
059670       DISPLAY "++25889-->C28-TRA-BGRP    SECTION.      "
059680     DISPLAY "++W549AX-V-ID-TRACE = "
059690        W549AX-V-ID-TRACE                             *>++DELETE
059700     DISPLAY "++W549AN-TRACE-LEVEL = "
059710        W549AN-TRACE-LEVEL                            *>++DELETE
059720     END-IF                                           *>++DELETE
059730
059740     MOVE '01;C28-TRA-BGRP;Beginn' TO W1AX-TRALOG-TEXT
059750     PERFORM Q92-TRALOG-ZEILE
059760
059770*    -- Hilfstabelle initialisieren
059780*       Transponder-IDs mit ------ und BGRP mit forl.Nummern 50x
059790     MOVE 500                   TO W1AN-TAB-BGRP
059800     PERFORM VARYING W1AN-TB-TAB-IX FROM 1 BY 1
059810       UNTIL W1AN-TB-TAB-IX > 8
059820
059830       MOVE '--------'
059840                TO W1AX-TB-TAB-TRANSPOND-ID (W1AN-TB-TAB-IX)
059850
059860       ADD 1                    TO W1AN-TAB-BGRP
059870       MOVE W1AN-TAB-BGRP
059880                TO W1AN-TB-TAB-BGRP (W1AN-TB-TAB-IX)
059890
059900     END-PERFORM
059910
059920     INITIALIZE B2X3-DCLFEV2X3
059930                B2X3-I-DCLFEV2X3
059940
059950     MOVE S551AX-E-VIN         TO B2X3AX-VIN
059960     MOVE W1AN-SKC0-KT-ID-ZAHL TO B2X3AN-SKC0-KEY-TYP-ID-ZAHL
059970
059980     PERFORM T-100-FEV2X3-CUR-OPEN
059990     PERFORM T-100-FEV2X3-CUR-FETCH
060000
060010     PERFORM UNTIL SQLSTATE NOT EQUAL DB2-OK
060020
060030       MOVE ZERO                 TO W1AN-TB-TAB-IX
060040       MOVE 500                  TO W1AN-TAB-BGRP
060050
060060       PERFORM UNTIL W1AN-TAB-BGRP  = B2X3AX-BGRP
060070                  OR W1AN-TB-TAB-IX > 8
060080
060090         ADD 1                  TO W1AN-TB-TAB-IX
060100         ADD 1                  TO W1AN-TAB-BGRP
060110
060120         IF W1AN-TAB-BGRP  = B2X3AX-BGRP
060130           MOVE B2X3AX-TRANSPOND-ID
060140                  TO W1AX-TB-TAB-TRANSPOND-ID  (W1AN-TB-TAB-IX)
060150           MOVE B2X3AX-BGRP  TO W1AN-TB-TAB-BGRP(W1AN-TB-TAB-IX)
060160         ELSE
060170           MOVE W1AN-TAB-BGRP
060180                             TO W1AN-TB-TAB-BGRP(W1AN-TB-TAB-IX)
060190         END-IF
060200
060210       END-PERFORM
060220
060230       PERFORM T-100-FEV2X3-CUR-FETCH
060240     END-PERFORM
060250     PERFORM T-100-FEV2X3-CUR-CLOSE
060260
060270     MOVE '01;C28-TRA-BGRP;Ende  ' TO W1AX-TRALOG-TEXT
060280     PERFORM Q92-TRALOG-ZEILE
060290
060300     CONTINUE.
060310 C28-TRA-BGRP-END.
060320     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
060330       DISPLAY "++25889-->C28-TRA-BGRP-END.             "
060340     DISPLAY "++W549AX-V-ID-TRACE = "
060350        W549AX-V-ID-TRACE                             *>++DELETE
060360     DISPLAY "++W549AN-TRACE-LEVEL = "
060370        W549AN-TRACE-LEVEL                            *>++DELETE
060380     END-IF                                           *>++DELETE
060390     EXIT.
060400/
060410*-----------------------------------------------------------------
060420* Festlegen der TRA-BGRP
060430* Tabelle TB-TAB absuchen
060440* 1. Schleife: Transponder suchen, die bereits zugeordnet sind
060450*    Die haben einen Eintrag in X30 = in der TB-TAB
060460*    und bekommen diese BGRP wieder zugeordnet
060470* 2. Schleife: BGRP für neuen Transponder vergeben
060480*    Einträge in TB-TAB mit Transponder-ID '--------'
060490*    -> BGRP ist die für den neuen Transponder
060500*       Transponder-ID in TB-TAB schreiben
060510*-----------------------------------------------------------------
060520 C28A-TRA-BGRP    SECTION.
060530     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
060540       DISPLAY "++25889-->C28A-TRA-BGRP    SECTION.     "
060550     DISPLAY "++W549AX-V-ID-TRACE = "
060560        W549AX-V-ID-TRACE                             *>++DELETE
060570     DISPLAY "++W549AN-TRACE-LEVEL = "
060580        W549AN-TRACE-LEVEL                            *>++DELETE
060590     END-IF                                           *>++DELETE
060600
060610     MOVE '01;C28A-TRA-BGRP;Beginn' TO W1AX-TRALOG-TEXT
060620     PERFORM Q92-TRALOG-ZEILE
060630
060640     MOVE 'N'                      TO W1AX-BGRP-GEFUNDEN
060650
060660     PERFORM VARYING W1AN-TB-TAB-IX FROM 1 BY 1
060670             UNTIL W1AN-TB-TAB-IX > 8
060680             OR W1AX-BGRP-GEFUNDEN = 'J'
060690
060700       IF W1AX-TB-TAB-TRANSPOND-ID  (W1AN-TB-TAB-IX)
060710              EQUAL S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
060720         MOVE W1AN-TB-TAB-BGRP(W1AN-TB-TAB-IX)
060730                                  TO W1AN-TRA-BGRP
060740         MOVE 'J'                 TO W1AX-BGRP-GEFUNDEN
060750       END-IF
060760
060770     END-PERFORM
060780
060790     IF W1AX-BGRP-GEFUNDEN = 'N'
060800       PERFORM VARYING W1AN-TB-TAB-IX FROM 1 BY 1
060810               UNTIL W1AN-TB-TAB-IX > 8
060820               OR W1AX-BGRP-GEFUNDEN = 'J'
060830
060840         IF W1AX-TB-TAB-TRANSPOND-ID  (W1AN-TB-TAB-IX)
060850                               EQUAL '--------'
060860           MOVE W1AN-TB-TAB-BGRP(W1AN-TB-TAB-IX)
060870                            TO W1AN-TRA-BGRP
060880           MOVE S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
060890                  TO W1AX-TB-TAB-TRANSPOND-ID (W1AN-TB-TAB-IX)
060900           MOVE 'J'                 TO W1AX-BGRP-GEFUNDEN
060910         END-IF
060920
060930       END-PERFORM
060940
060950     END-IF
060960
060970     MOVE '01;C28A-TRA-BGRP;Ende  ' TO W1AX-TRALOG-TEXT
060980     PERFORM Q92-TRALOG-ZEILE
060990
061000     CONTINUE.
061010 C28A-TRA-BGRP-END.
061020     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
061030       DISPLAY "++25889-->C28A-TRA-BGRP-END.            "
061040     DISPLAY "++W549AX-V-ID-TRACE = "
061050        W549AX-V-ID-TRACE                             *>++DELETE
061060     DISPLAY "++W549AN-TRACE-LEVEL = "
061070        W549AN-TRACE-LEVEL                            *>++DELETE
061080     END-IF                                           *>++DELETE
061090     EXIT.
061100/
061110*-----------------------------------------------------------------
061120* Aufruf FE540C für VS02-Telegramm
061130*-----------------------------------------------------------------
061140 C29-VS02-FE540C SECTION.
061150     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
061160       DISPLAY "++25889-->C29-VS02-FE540C SECTION.      "
061170     DISPLAY "++W549AX-V-ID-TRACE = "
061180        W549AX-V-ID-TRACE                             *>++DELETE
061190     DISPLAY "++W549AN-TRACE-LEVEL = "
061200        W549AN-TRACE-LEVEL                            *>++DELETE
061210     END-IF                                           *>++DELETE
061220
061230     MOVE '01;C29-VS02-FE540C;Beginn' TO W1AX-TRALOG-TEXT
061240     PERFORM Q92-TRALOG-ZEILE
061250
061260*    -- FRAESE  - entfällt, Fräse nicht in Prod
061270*       Werte trotzdem übernehmen...
061280     MOVE S551AX-E-VS02-S-CRYPTBOX-ID (I1AN-TRA)
061290                                   TO S540AX-E-TESTER-ID
061300     MOVE S551AX-E-VS02-S-CRYPTBOX-HOST (I1AN-TRA)
061310                                   TO S540AX-E-AGENT-HOSTNAME
061320     MOVE S551AX-E-VS02-S-CRYPTBOX-CHALL (I1AN-TRA)
061330                                   TO S540AX-E-CHALLENGE
061340     MOVE S551AX-E-VS02-S-CRYPTBOX-SIGN (I1AN-TRA)
061350                                   TO S540AX-E-SIGNATURE
061360     MOVE S551AX-E-VS02-S-CRYPTBOX-ZAHL (I1AN-TRA)
061370                                   TO S540AX-E-ID-ZAHL
061380
061390*    -- TRANSPONDER
061400     MOVE S551AX-E-VS02-S-TRANSPOND-TYP (I1AN-TRA)
061410                                   TO S540AX-E-TRANSPOND-TYP
061420     MOVE S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
061430                                   TO S540AX-E-TRANSPOND-ID
061440     MOVE S551AX-E-VS02-S-TRANSPOND-MEM (I1AN-TRA)
061450                                   TO S540AX-E-USER-MEMORY
061460
061470     MOVE W1AN-TRA-BGRP            TO S540AX-E-TRANSPOND-BGRP
061480
061490     MOVE S551AX-E-VS02-SCHLIESSSATZ-ID
061500                                   TO S540AX-E-PIN-LABEL-GARN-SNR
061510     INITIALIZE                       S540AX-E-BEMERKUNG
061520     MOVE SPACE                    TO S540AX-E-RESERVE-2
061530
061540*V11 --> --------------------------------------------------------
061550     MOVE SPACE                    TO W1AX-TRALOG-TEXT
061560     MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
061570                                   TO W1AN-AUFB9
061580     MOVE I1AN-TRA                 TO W1AN-AUFB4
061590     if S551AN-A-VS02-FEHLER-NR (I1AN-TRA) = ZERO
061600       STRING '1a. Aufruf FE540C, Kein Fehler: '
061610            '  I1AN-TRA = ' W1AN-AUFB4
061620            '; S551AN-A-VS02-FEHLER-NR = ' W1AN-AUFB9
061630            '; S551AX-E-VS02-S-TRANSPOND-ID = '
061640               S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
061650            '; S551AX-E-VS02-S-TRANSPOND-TYP = '
061660               S551AX-E-VS02-S-TRANSPOND-TYP (I1AN-TRA)
061670       DELIMITED BY SIZE           INTO W1AX-TRALOG-TEXT
061680     else
061690       STRING '1b. Kein Aufruf FE540C wg. Fehler: '
061700            '  I1AN-TRA = ' W1AN-AUFB4
061710            '; S551AN-A-VS02-FEHLER-NR = ' W1AN-AUFB9
061720            '; S551AX-E-VS02-S-TRANSPOND-TYP = '
061730               S551AX-E-VS02-S-TRANSPOND-TYP (I1AN-TRA)
061740            '; S551AX-E-VS02-S-TRANSPOND-ID = '
061750               S551AX-E-VS02-S-TRANSPOND-ID  (I1AN-TRA)
061760       DELIMITED BY SIZE           INTO W1AX-TRALOG-TEXT
061770     end-if
061780     PERFORM Q92-TRALOG-ZEILE
061790*V11 <-- --------------------------------------------------------
061800     IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA)= ZERO
061810*V11 IR --> ------------------------------------------------------
061820       MOVE SPACE                         TO W1AX-TRALOG-TEXT
061830       MOVE 'Aufruf FE540C findet statt!' TO W1AX-TRALOG-TEXT
061840       PERFORM Q92-TRALOG-ZEILE
061850*V11 <-- --------------------------------------------------------
061860
061870       CALL FE540C USING S540
061880
061890*    -- FE540-Returnwerte werden in den -WRITE-Sections
061900*       übernommen, diese hier:
061910*    -- Schalter für KT erhöhen übernehmen aus FE540C
061920       MOVE S540AX-A-KT-PLUS         TO S540AX-E-KT-PLUS
061930*    -- FRAESE  - entfällt, Fräse nicht in Prod
061940*    -- Auskunftstabellen
061950*    -- AK Hinweis
061960       MOVE S540AN-A-TXVR-ANZAHL     TO TXVRAN-I
061970       MOVE S540-A-TXVRAX-BEREICH    TO TXVRAX-BEREICH
061980*      -- AK Transponder
061990       MOVE S540AN-A-TXX4-ANZAHL     TO TXX4AN-I
062000       MOVE S540-A-TXX4AX-BEREICH    TO TXX4AX-BEREICH
062010
062020*      -- Fehler und Hinweise übernehmen pro Schublade
062030       MOVE 'FAZ'       TO S551AX-A-VS02-FEHLER-SYSTEM (I1AN-TRA)
062040       MOVE S540AN-A-TEXT-RC TO S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
062050       MOVE ':'         TO S551AX-A-VS02-FEHLER-TRENN  (I1AN-TRA)
062060*      -- Fehlertext umsetzen s.u.
062070       MOVE SPACE       TO S551AX-A-VS02-FEHLER-TEXT   (I1AN-TRA)
062080
062090       IF S551AN-A-VS02-FEHLER-NR (I1AN-TRA) > ZERO
062100*        -- Fehlertext aufbereiten
062110         MOVE S551AN-A-VS02-FEHLER-NR (I1AN-TRA)
062120                                     TO W1AN-FF3-FEHLERNUMMER
062130         PERFORM C80-FEH-TEXT-FE557
062140         MOVE S557AX-A-PROD-KLARTEXT
062150                           TO S551AX-A-VS02-FEHLER-TEXT (I1AN-TRA)
062160       END-IF
062170
062180*      -- Gesamt-RC ist hier immer o.k.
062190       MOVE ZERO                     TO W549AN-TEXT-RC
062200       MOVE K1AN-OK                  TO W549AN-TEXT-FEHLER-KLASSE
062210     END-IF
062220
062230     MOVE '01;C29-VS02-FE540C;Ende  ' TO W1AX-TRALOG-TEXT
062240     PERFORM Q92-TRALOG-ZEILE
062250
062260     CONTINUE.
062270 C29-VS02-FE540C-END.
062280     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
062290       DISPLAY "++25889-->C29-VS02-FE540C-END.          "
062300     DISPLAY "++W549AX-V-ID-TRACE = "
062310        W549AX-V-ID-TRACE                             *>++DELETE
062320     DISPLAY "++W549AN-TRACE-LEVEL = "
062330        W549AN-TRACE-LEVEL                            *>++DELETE
062340     END-IF                                           *>++DELETE
062350     EXIT.
062360/
062370*-----------------------------------------------------------------
062380* Werte, die bei jedem Aufruf gleich sind und 1 x gesetzt werden
062390* Initialize der ganzen Struktur schon vorher, weil Aktion gesetzt
062400*-----------------------------------------------------------------
062410 C30-FE540-VOR-DT02  SECTION.
062420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
062430       DISPLAY "++25889-->C30-FE540-VOR-DT02  SECTION.  "
062440     DISPLAY "++W549AX-V-ID-TRACE = "
062450        W549AX-V-ID-TRACE                             *>++DELETE
062460     DISPLAY "++W549AN-TRACE-LEVEL = "
062470        W549AN-TRACE-LEVEL                            *>++DELETE
062480     END-IF                                           *>++DELETE
062490*
062500     MOVE '01;C30-FE540-VOR-DT02;Beginn' TO W1AX-TRALOG-TEXT
062510     PERFORM Q92-TRALOG-ZEILE
062520
062530     MOVE W549AX-LOG-V-ID          TO S540AX-E-LOG-V-ID
062540     MOVE 'C'                      TO S540AX-E-STELLE6-STDMODUL
062550     MOVE 'D'                      TO S540AX-E-STELLE6-CMODUL
062560     MOVE S551AX-E-SPRACH-KZ       TO S540AN-E-SPRACH-KZ
062570     MOVE ZERO                     TO S540AN-E-DISPLAYLEVEL
062580     MOVE W549AN-TRACE-LEVEL       TO S540AN-E-TRACELEVEL
062590     MOVE W549AX-V-ID-TRACE        TO S540AX-E-V-ID-TRACE
062600     MOVE SPACE                    TO S540AX-E-RESERVE-1
062610*    -- Fahrzeug
062620     MOVE S551AX-E-VIN             TO S540AX-E-VIN
062630*    -- Fräse gibt es nicht in Produktion
062640     MOVE SPACE                    TO S540AX-E-TESTER-ID
062650                                      S540AX-E-AGENT-HOSTNAME
062660                                      S540AX-E-CHALLENGE
062670                                      S540AX-E-SIGNATURE
062680                                      S540AX-E-ID-ZAHL
062690
062700     MOVE W1AN-ANZ-TRA-ANGEF       TO S540AX-E-ANZAHL-TRANSPOND
062710
062720     MOVE SPACE                    TO S540AX-E-USER-MEMORY
062730     MOVE SPACE                    TO S540AX-E-TRANSPOND-BGRP
062740*    -- SONSTIGE
062750
062760     MOVE ZERO                     TO W1AN-ANZ-TRA-OK
062770     MOVE 500                      TO W1AN-TRA-BGRP
062780
062790     MOVE '01;C30-FE540-VOR-DT02;Ende'    TO W1AX-TRALOG-TEXT
062800     PERFORM Q92-TRALOG-ZEILE
062810
062820     CONTINUE.
062830 C30-FE540-VOR-DT02-END.
062840     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
062850       DISPLAY "++25889-->C30-FE540-VOR-DT02-END.       "
062860     DISPLAY "++W549AX-V-ID-TRACE = "
062870        W549AX-V-ID-TRACE                             *>++DELETE
062880     DISPLAY "++W549AN-TRACE-LEVEL = "
062890        W549AN-TRACE-LEVEL                            *>++DELETE
062900     END-IF                                           *>++DELETE
062910     EXIT.
062920/
062930*-----------------------------------------------------------------
062940* Aufruf FE540C für DT02-Telegramm
062950* Eingabe: der gelesen Transponder aus X30
062960*          BGRP des Transponder (W1AN-TRA-BGRP: 500 +x)
062970*          UTC-V-ID aus VS02-R
062980*           (das ist die aus der X30, wird für FE560 gebraucht)
062990* Fehlertext aufbereiten nicht nötig, da es kein FEHLER-TEXT-
063000* Antwortfeld gibt
063010*-----------------------------------------------------------------
063020 C31-DT02-FE540C SECTION.
063030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
063040       DISPLAY "++25889-->C31-DT02-FE540C SECTION.      "
063050     DISPLAY "++W549AX-V-ID-TRACE = "
063060        W549AX-V-ID-TRACE                             *>++DELETE
063070     DISPLAY "++W549AN-TRACE-LEVEL = "
063080        W549AN-TRACE-LEVEL                            *>++DELETE
063090     END-IF                                           *>++DELETE
063100
063110     MOVE '01;C31-DT02-FE540C;Beginn'
063120                                   TO W1AX-TRALOG-TEXT
063130     PERFORM Q92-TRALOG-ZEILE
063140
063150     MOVE B2X3AX-TRANSPOND-ID      TO S540AX-E-TRANSPOND-ID
063160     ADD  1                        TO W1AN-TRA-BGRP
063170     MOVE W1AN-TRA-BGRP            TO S540AX-E-TRANSPOND-BGRP
063180     MOVE B2X3AX-UTC-V-ID          TO S540AX-E-LOG-UTC-V-ID
063190
063200     CALL FE540C USING S540
063210
063220     EVALUATE S540AN-A-TEXT-FEHLER-KLASSE
063230     WHEN K1AN-OK
063240     WHEN K1AN-HINWEIS
063250       SET U1AX-VERARB-OK          TO TRUE
063260       ADD 1                       TO W1AN-ANZ-TRA-OK
063270*      -- Sammeln X30-Daten + DL4s interner Tabelle
063280       ADD 1                       TO I1AN-TRA
063290       MOVE S540AX-A-SCHREIBEN
063300                      TO W1AX-TRANSP-SCHREIBEN      (I1AN-TRA)
063310       MOVE S540AX-E-TRANSPOND-ID
063320                      TO W1AX-TRANSPOND-ID          (I1AN-TRA)
063330       MOVE S540AX-A-TRANSPOND-TYP
063340                      TO W1AX-TRANSPOND-TYP         (I1AN-TRA)
063350       MOVE S540AN-A-TRANSPOND-STATUS
063360                      TO W1AN-TRANSPOND-STATUS      (I1AN-TRA)
063370       MOVE S540AX-A-BGRP
063380                      TO W1AX-TRANSPOND-BGRP        (I1AN-TRA)
063390       MOVE S540AX-A-TRANSPOND-FAM
063400                      TO W1AX-TRANSPOND-FAM         (I1AN-TRA)
063410       MOVE S540AX-A-USER-MEMORY
063420                      TO W1AX-USER-MEMORY           (I1AN-TRA)
063430       MOVE S540AN-A-SKC0-KEY-TYP-ID
063440                      TO W1AN-SKC0-KEY-TYP-ID       (I1AN-TRA)
063450       MOVE S540AN-A-SKC0-KEY-TYP-ID-ZAHL
063460                      TO W1AN-SKC0-KEY-TYP-ID-ZAHL  (I1AN-TRA)
063470       MOVE S540AN-A-TRANSPOND-ID-ZAHL
063480                      TO W1AN-TRANSPOND-ID-ZAHL     (I1AN-TRA)
063490       MOVE S540AX-A-TRANSPOND-ID-ZAHL-HEX
063500                      TO W1AX-TRANSPOND-ID-ZAHL-HEX (I1AN-TRA)
063510       MOVE S540AN-A-PSS-FZ-ID-ZAHL
063520                      TO W1AN-PSS-FZ-ID-ZAHL        (I1AN-TRA)
063530       MOVE S540AX-A-PSS-KRYPTOREGION
063540                      TO W1AX-PSS-KRYPTOREGION      (I1AN-TRA)
063550       MOVE S540AX-A-PSS-BGRP
063560                      TO W1AX-PSS-BGRP              (I1AN-TRA)
063570       MOVE S540AN-A-PSS-KEY-TYP-ID
063580                      TO W1AN-PSS-KEY-TYP-ID        (I1AN-TRA)
063590       MOVE S540AN-A-PSS-KEY-TYP-ID-ZAHL
063600                      TO W1AN-PSS-KEY-TYP-ID-ZAHL   (I1AN-TRA)
063610       MOVE S540AN-A-PSS-VKMS-KEY-AUF-VER
063620                      TO W1AN-PSS-VKMS-KEY-AUF-VER  (I1AN-TRA)
063630       MOVE S540AX-A-PSS-VIN
063640                      TO W1AX-PSS-VIN               (I1AN-TRA)
063650       INITIALIZE W1AX-TRANSPOND-DL4 (I1AN-TRA)
063660       MOVE S540AN-A-TRANSP-DL4-LEN
063670                      TO W1AN-TRANSP-DL4-LEN        (I1AN-TRA)
063680       MOVE S540AX-A-TRANSP-DL4-TEXT
063690                      TO W1AX-TRANSP-DL4-TEXT       (I1AN-TRA)
063700
063710     WHEN OTHER
063720       SET U1AX-VERARB-FEHLER      TO TRUE
063730       MOVE S540AN-A-TEXT-RC       TO W549AN-TEXT-RC
063740       MOVE S540AN-A-TEXT-FEHLER-KLASSE
063750                                   TO W549AN-TEXT-FEHLER-KLASSE
063760       MOVE S540AX-A-BESCHREIBUNG  TO W549AX-BESCHREIBUNG
063770       MOVE S540AX-A-FEHLER-PARM   TO W549AX-FEHLER-PARM
063780       MOVE S540AN-A-TEXT-RC       TO W1AN-FF3-FEHLERNUMMER
063790     END-EVALUATE
063800
063810*    -- Auskunftstabellen
063820*    -- AK Hinweis
063830     MOVE S540AN-A-TXVR-ANZAHL     TO TXVRAN-I
063840     MOVE S540-A-TXVRAX-BEREICH    TO TXVRAX-BEREICH
063850*    -- AK Transponder
063860     MOVE S540AN-A-TXX4-ANZAHL     TO TXX4AN-I
063870     MOVE S540-A-TXX4AX-BEREICH    TO TXX4AX-BEREICH
063880
063890     MOVE '01;C31-DT02-FE540C;Ende  ' TO W1AX-TRALOG-TEXT
063900     PERFORM Q92-TRALOG-ZEILE
063910
063920     CONTINUE.
063930 C31-DT02-FE540C-END.
063940     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
063950       DISPLAY "++25889-->C31-DT02-FE540C-END.          "
063960     DISPLAY "++W549AX-V-ID-TRACE = "
063970        W549AX-V-ID-TRACE                             *>++DELETE
063980     DISPLAY "++W549AN-TRACE-LEVEL = "
063990        W549AN-TRACE-LEVEL                            *>++DELETE
064000     END-IF                                           *>++DELETE
064010     EXIT.
064020/
064030*-----------------------------------------------------------------
064040* Werte einmalig setzen
064050*-----------------------------------------------------------------
064060 C40-FE540-VOR-TRA4          SECTION.
064070     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
064080       DISPLAY "++25889-->C40-FE540-VOR-TRA4          SE"
064090     DISPLAY "++W549AX-V-ID-TRACE = "
064100        W549AX-V-ID-TRACE                             *>++DELETE
064110     DISPLAY "++W549AN-TRACE-LEVEL = "
064120        W549AN-TRACE-LEVEL                            *>++DELETE
064130     END-IF                                           *>++DELETE
064140
064150     MOVE '01;C40-FE540-VOR-TRA4;Beginn'
064160                                   TO W1AX-TRALOG-TEXT
064170     PERFORM Q92-TRALOG-ZEILE
064180
064190     MOVE W549AX-LOG-V-ID          TO S540AX-E-LOG-V-ID
064200     MOVE 'C'                      TO S540AX-E-STELLE6-STDMODUL
064210     MOVE 'D'                      TO S540AX-E-STELLE6-CMODUL
064220     MOVE S551AX-E-SPRACH-KZ       TO S540AN-E-SPRACH-KZ
064230     MOVE ZERO                     TO S540AN-E-DISPLAYLEVEL
064240     MOVE W549AN-TRACE-LEVEL       TO S540AN-E-TRACELEVEL
064250     MOVE W549AX-V-ID-TRACE        TO S540AX-E-V-ID-TRACE
064260     MOVE SPACE                    TO S540AX-E-RESERVE-1
064270*    -- Fahrzeug
064280     MOVE S551AX-E-VIN             TO S540AX-E-VIN
064290*    -- Fräse gibt es nicht in Produktion
064300     MOVE SPACE                    TO S540AX-E-TESTER-ID
064310                                      S540AX-E-AGENT-HOSTNAME
064320                                      S540AX-E-CHALLENGE
064330                                      S540AX-E-SIGNATURE
064340                                      S540AX-E-ID-ZAHL
064350
064360     MOVE W1AN-ANZ-TRA-ANGEF       TO S540AX-E-ANZAHL-TRANSPOND
064370
064380     MOVE SPACE                    TO S540AX-E-USER-MEMORY
064390*    -- SONSTIGE
064400
064410     MOVE ZERO                     TO W1AN-ANZ-TRA-OK
064420     MOVE ZERO                     TO W1AN-ANZ-TRA-NOK
064430
064440     MOVE '01;C40-FE540-VOR-TRA4;Ende  ' TO W1AX-TRALOG-TEXT
064450     PERFORM Q92-TRALOG-ZEILE
064460
064470     CONTINUE.
064480 C40-FE540-VOR-TRA4-END.
064490     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
064500       DISPLAY "++25889-->C40-FE540-VOR-TRA4-END.       "
064510     DISPLAY "++W549AX-V-ID-TRACE = "
064520        W549AX-V-ID-TRACE                             *>++DELETE
064530     DISPLAY "++W549AN-TRACE-LEVEL = "
064540        W549AN-TRACE-LEVEL                            *>++DELETE
064550     END-IF                                           *>++DELETE
064560     EXIT.
064570/
064580*-----------------------------------------------------------------
064590* Aufruf in B03- in einer Schleife über alle gelieferten Transpon-
064600* der aus dem KeyFobTable der WFS-Identifikationsdaten
064610*
064620* - W1AN-ANZ-TRA-OK
064630* - W1AN-ANZ-TRA-NOK
064640*-----------------------------------------------------------------
064650 C41-TRA4-FE540C             SECTION.
064660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
064670       DISPLAY "++25889-->C41-TRA4-FE540C             SE"
064680     DISPLAY "++W549AX-V-ID-TRACE = "
064690        W549AX-V-ID-TRACE                             *>++DELETE
064700     DISPLAY "++W549AN-TRACE-LEVEL = "
064710        W549AN-TRACE-LEVEL                            *>++DELETE
064720     END-IF                                           *>++DELETE
064730
064740     MOVE '01;C41-TRA4-FE540C;Beginn'
064750                                   TO W1AX-TRALOG-TEXT
064760     PERFORM Q92-TRALOG-ZEILE
064770
064780     MOVE W1AX-TRA-TRANSPONDERID(W1AN-CNT)
064790                              TO S540AX-E-TRANSPOND-ID
064800     MOVE W1AX-TRA-BGRP         (W1AN-CNT)
064810                              TO S540AX-E-TRANSPOND-BGRP
064820     MOVE W1AN-TRA-ID-ZAHL      (W1AN-CNT)
064830                              TO S540AX-E-TRANSPOND-ID-ZAHL
064840
064850     CALL FE540C USING S540
064860
064870     EVALUATE S540AN-A-TEXT-FEHLER-KLASSE
064880       WHEN K1AN-OK
064890       WHEN K1AN-HINWEIS
064900         SET U1AX-VERARB-OK        TO TRUE
064910
064920       WHEN OTHER
064930         SET U1AX-VERARB-FEHLER  TO TRUE
064940     END-EVALUATE
064950
064960     IF U1AX-VERARB-OK
064970       ADD 1                       TO W1AN-ANZ-TRA-OK
064980*      -- Sammeln X30-Daten + DL4s interner Tabelle
064990       ADD 1                       TO I1AN-TRA
065000       MOVE S540AX-A-SCHREIBEN
065010                      TO W1AX-TRANSP-SCHREIBEN      (I1AN-TRA)
065020       MOVE S540AX-E-TRANSPOND-ID
065030                      TO W1AX-TRANSPOND-ID          (I1AN-TRA)
065040       MOVE S540AX-A-TRANSPOND-TYP
065050                      TO W1AX-TRANSPOND-TYP         (I1AN-TRA)
065060       MOVE S540AN-A-TRANSPOND-STATUS
065070                      TO W1AN-TRANSPOND-STATUS      (I1AN-TRA)
065080       MOVE S540AX-A-BGRP
065090                      TO W1AX-TRANSPOND-BGRP        (I1AN-TRA)
065100       MOVE S540AX-A-TRANSPOND-FAM
065110                      TO W1AX-TRANSPOND-FAM         (I1AN-TRA)
065120       MOVE S540AX-A-USER-MEMORY
065130                      TO W1AX-USER-MEMORY           (I1AN-TRA)
065140       MOVE S540AN-A-SKC0-KEY-TYP-ID
065150                      TO W1AN-SKC0-KEY-TYP-ID       (I1AN-TRA)
065160       MOVE S540AN-A-SKC0-KEY-TYP-ID-ZAHL
065170                      TO W1AN-SKC0-KEY-TYP-ID-ZAHL  (I1AN-TRA)
065180       MOVE S540AN-A-TRANSPOND-ID-ZAHL
065190                      TO W1AN-TRANSPOND-ID-ZAHL     (I1AN-TRA)
065200       MOVE S540AX-A-TRANSPOND-ID-ZAHL-HEX
065210                      TO W1AX-TRANSPOND-ID-ZAHL-HEX (I1AN-TRA)
065220       MOVE S540AN-A-PSS-FZ-ID-ZAHL
065230                      TO W1AN-PSS-FZ-ID-ZAHL        (I1AN-TRA)
065240       MOVE S540AX-A-PSS-KRYPTOREGION
065250                      TO W1AX-PSS-KRYPTOREGION      (I1AN-TRA)
065260       MOVE S540AX-A-PSS-BGRP
065270                      TO W1AX-PSS-BGRP              (I1AN-TRA)
065280       MOVE S540AN-A-PSS-KEY-TYP-ID
065290                      TO W1AN-PSS-KEY-TYP-ID        (I1AN-TRA)
065300       MOVE S540AN-A-PSS-KEY-TYP-ID-ZAHL
065310                      TO W1AN-PSS-KEY-TYP-ID-ZAHL   (I1AN-TRA)
065320       MOVE S540AN-A-PSS-VKMS-KEY-AUF-VER
065330                      TO W1AN-PSS-VKMS-KEY-AUF-VER  (I1AN-TRA)
065340       MOVE S540AX-A-PSS-VIN
065350                      TO W1AX-PSS-VIN               (I1AN-TRA)
065360       INITIALIZE W1AX-TRANSPOND-DL4 (I1AN-TRA)
065370       MOVE S540AN-A-TRANSP-DL4-LEN
065380                      TO W1AN-TRANSP-DL4-LEN        (I1AN-TRA)
065390       MOVE S540AX-A-TRANSP-DL4-TEXT
065400                      TO W1AX-TRANSP-DL4-TEXT       (I1AN-TRA)
065410       MOVE S540AN-A-TEXT-RC
065420                      TO W1AN-FEHLER-NR             (I1AN-TRA)
065430
065440     ELSE
065450       ADD 1                       TO W1AN-ANZ-TRA-NOK
065460       ADD 1                       TO I1AN-TRA
065470       MOVE S540AX-A-BGRP
065480                    TO S551AX-A-TRA4-TSP-BGRP-NUMMER  (I1AN-TRA)
065490       MOVE S540AX-E-TRANSPOND-ID
065500                    TO S551AX-A-TRA4-TSP-TRANSPOND-ID (I1AN-TRA)
065510       MOVE S540AN-A-TEXT-RC
065520                    TO S551AN-A-TRA4-FEHLER-NR        (I1AN-TRA)
065530       MOVE 'FAZ'      TO S551AX-A-TRA4-FEHLER-SYSTEM (I1AN-TRA)
065540       MOVE ': '       TO S551AX-A-TRA4-FEHLER-TRENN  (I1AN-TRA)
065550     END-IF
065560
065570*    -- Auskunftstabellen
065580*    -- AK Hinweis
065590     MOVE S540AN-A-TXVR-ANZAHL     TO TXVRAN-I
065600     MOVE S540-A-TXVRAX-BEREICH    TO TXVRAX-BEREICH
065610*    -- AK Transponder
065620     MOVE S540AN-A-TXX4-ANZAHL     TO TXX4AN-I
065630     MOVE S540-A-TXX4AX-BEREICH    TO TXX4AX-BEREICH
065640
065650*    -- Fehlertext umsetzen, falls nötig
065660     IF S551AN-A-TRA4-FEHLER-NR (I1AN-TRA) > ZERO
065670       MOVE S551AN-A-TRA4-FEHLER-NR (I1AN-TRA)
065680                                   TO W1AN-FF3-FEHLERNUMMER
065690       PERFORM C80-FEH-TEXT-FE557
065700       MOVE S557AX-A-PROD-KLARTEXT
065710                           TO S551AX-A-TRA4-FEHLER-TEXT (I1AN-TRA)
065720     END-IF
065730
065740     MOVE '01;C41-TRA4-FE540C;Ende  ' TO W1AX-TRALOG-TEXT
065750     PERFORM Q92-TRALOG-ZEILE
065760
065770     CONTINUE.
065780 C41-TRA4-FE540C-END.
065790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
065800       DISPLAY "++25889-->C41-TRA4-FE540C-END.          "
065810     DISPLAY "++W549AX-V-ID-TRACE = "
065820        W549AX-V-ID-TRACE                             *>++DELETE
065830     DISPLAY "++W549AN-TRACE-LEVEL = "
065840        W549AN-TRACE-LEVEL                            *>++DELETE
065850     END-IF                                           *>++DELETE
065860     EXIT.
065870/
065880*-----------------------------------------------------------------
065890* Prüfen, was im Feld SCHLIESSSATZ-ID steht
065900* 11 Zeichen = FZ-PIN-Label
065910* 23 Zeichen = Garnitur-Seriennummer
065920* Einfache Prüfung:
065930* ist das 12 Zeichen leer, muss es die Garn.-SN sein
065940*-----------------------------------------------------------------
065950 C50-SCHLIESSSATZ-ID-PRUEFEN SECTION.
065960     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
065970       DISPLAY "++25889-->C50-SCHLIESSSATZ-ID-PRUEFEN SE"
065980     DISPLAY "++W549AX-V-ID-TRACE = "
065990        W549AX-V-ID-TRACE                             *>++DELETE
066000     DISPLAY "++W549AN-TRACE-LEVEL = "
066010        W549AN-TRACE-LEVEL                            *>++DELETE
066020     END-IF                                           *>++DELETE
066030
066040     IF S551AX-E-VS02-SCHLIESSSATZ-ID (12:1) = SPACE
066050       MOVE S551AX-E-VS02-SCHLIESSSATZ-ID
066060                                   TO S540AX-E-SCHLIESS-SATZ
066070       MOVE SPACE                  TO S540AX-E-PIN-LABEL-GARN-SNR
066080     ELSE
066090       MOVE S551AX-E-VS02-SCHLIESSSATZ-ID
066100                                   TO S540AX-E-PIN-LABEL-GARN-SNR
066110       MOVE SPACE                  TO S540AX-E-SCHLIESS-SATZ
066120     END-IF
066130
066140     CONTINUE.
066150 C50-SCHLIESSSATZ-ID-PRUEFEN-E.
066160     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
066170       DISPLAY "++25889-->C50-SCHLIESSSATZ-ID-PRUEFEN-E."
066180     DISPLAY "++W549AX-V-ID-TRACE = "
066190        W549AX-V-ID-TRACE                             *>++DELETE
066200     DISPLAY "++W549AN-TRACE-LEVEL = "
066210        W549AN-TRACE-LEVEL                            *>++DELETE
066220     END-IF                                           *>++DELETE
066230     EXIT.
066240/
066250*-----------------------------------------------------------------
066260* Auskunft schreiben
066270* VKMS-Auskunft FEVXVQ und VKMS-AK-MQFEVXVT macht FE551
066280*-----------------------------------------------------------------
066290 C70-AUSKUNFT           SECTION.
066300     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
066310       DISPLAY "++25889-->C70-AUSKUNFT           SECTION"
066320     DISPLAY "++W549AX-V-ID-TRACE = "
066330        W549AX-V-ID-TRACE                             *>++DELETE
066340     DISPLAY "++W549AN-TRACE-LEVEL = "
066350        W549AN-TRACE-LEVEL                            *>++DELETE
066360     END-IF                                           *>++DELETE
066370
066380     MOVE '01;C70-AUSKUNFT;Beginn' TO W1AX-TRALOG-TEXT
066390     PERFORM Q92-TRALOG-ZEILE
066400
066410*    -- gesammelte AK-Hinweis ausgeben
066420     PERFORM I20-AK-HINWEIS
066430
066440*    -- GESAMMELTE AK-TRANSPONDER AUSGEBEN
066450     IF TXX4AN-I             > ZERO
066460       PERFORM I25-AK-TRANSPONDER
066470     END-IF
066480
066490     MOVE '01;C70-AUSKUNFT;Ende  ' TO W1AX-TRALOG-TEXT
066500     PERFORM Q92-TRALOG-ZEILE
066510
066520     CONTINUE.
066530 C70-AUSKUNFT-END.
066540     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
066550       DISPLAY "++25889-->C70-AUSKUNFT-END.             "
066560     DISPLAY "++W549AX-V-ID-TRACE = "
066570        W549AX-V-ID-TRACE                             *>++DELETE
066580     DISPLAY "++W549AN-TRACE-LEVEL = "
066590        W549AN-TRACE-LEVEL                            *>++DELETE
066600     END-IF                                           *>++DELETE
066610     EXIT.
066620/
066630*-----------------------------------------------------------------
066640* Fehlertext aufbereiten mit FE557
066650*-----------------------------------------------------------------
066660 C80-FEH-TEXT-FE557     SECTION.
066670     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
066680       DISPLAY "++25889-->C80-FEH-TEXT-FE557     SECTION"
066690     DISPLAY "++W549AX-V-ID-TRACE = "
066700        W549AX-V-ID-TRACE                             *>++DELETE
066710     DISPLAY "++W549AN-TRACE-LEVEL = "
066720        W549AN-TRACE-LEVEL                            *>++DELETE
066730     END-IF                                           *>++DELETE
066740
066750*    -- Fehler aufbereiten
066760     INITIALIZE S557-EIN
066770     MOVE '01'                      TO S557AX-AKTION
066780     MOVE S540AX-E-STELLE6-STDMODUL TO S557AX-STELLE6-STDMODUL
066790     MOVE S540AX-E-STELLE6-CMODUL   TO S557AX-STELLE6-CMODUL
066800     MOVE S551AX-E-SPRACH-KZ        TO S557AN-SPRACH-KZ
066810     MOVE 0                         TO S557AN-MELDUNG-KLASSE
066820     MOVE W1AN-FF3-FEHLERNUMMER     TO S557AN-E-TEXT-RC
066830     MOVE K1AN-FEHLER               TO S557AN-E-TEXT-FEHLER-KLASSE
066840     MOVE W1AX-FF3-FEHLER-PARM      TO S557AX-E-FEHLER-PARM
066850
066860     MOVE W1AN-FF3-VAR-TAB-ANZAHL   TO S557AN-E-VAR-TAB-ANZAHL
066870     PERFORM VARYING I1AN-VARTAB FROM 1 BY 1
066880             UNTIL   I1AN-VARTAB > W1AN-FF3-VAR-TAB-ANZAHL
066890             OR      I1AN-VARTAB > 5
066900
066910       MOVE W1AX-FF3-VAR-NAME (I1AN-VARTAB)
066920                               TO S557AX-E-VAR-NAME (I1AN-VARTAB)
066930       MOVE W1AN-FF3-VAR-LEN (I1AN-VARTAB)
066940                               TO S557AN-E-VAR-LEN  (I1AN-VARTAB)
066950       MOVE W1AX-FF3-VAR-TEXT (I1AN-VARTAB)
066960                               TO S557AX-E-VAR-TEXT (I1AN-VARTAB)
066970     END-PERFORM
066980
066990     CALL FE557C USING S557
067000
067010     CONTINUE.
067020 C80-FEH-TEXT-FE557-END.
067030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067040       DISPLAY "++25889-->C80-FEH-TEXT-FE557-END.       "
067050     DISPLAY "++W549AX-V-ID-TRACE = "
067060        W549AX-V-ID-TRACE                             *>++DELETE
067070     DISPLAY "++W549AN-TRACE-LEVEL = "
067080        W549AN-TRACE-LEVEL                            *>++DELETE
067090     END-IF                                           *>++DELETE
067100     EXIT.
067110/
067120*-----------------------------------------------------------------
067130* Abschluss VS02-Telegramm, Länge Antwort berechnen
067140* W1AN-N2 wird vor dem Aufruf berechnet
067150* Ergebnis: S551AN-A-LAENGE
067160*-----------------------------------------------------------------
067170 C90-ABSCHLUSS-VS02 SECTION.
067180     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067190       DISPLAY "++25889-->C90-ABSCHLUSS-VS02 SECTION.   "
067200     DISPLAY "++W549AX-V-ID-TRACE = "
067210        W549AX-V-ID-TRACE                             *>++DELETE
067220     DISPLAY "++W549AN-TRACE-LEVEL = "
067230        W549AN-TRACE-LEVEL                            *>++DELETE
067240     END-IF                                           *>++DELETE
067250
067260     MOVE '01;C90-ABSCHLUSS-VS02;Beginn' TO W1AX-TRALOG-TEXT
067270     PERFORM Q92-TRALOG-ZEILE
067280
067290     MOVE LENGTH OF S551AX-A-KOPF  TO W1AN-N1
067300     ADD  LENGTH OF S551AX-A-AUFTRAGS-ID
067310                                   TO W1AN-N1
067320     ADD  LENGTH OF S551AX-A-CONTAINER
067330                                   TO W1AN-N1
067340     ADD  LENGTH OF S551AX-A-VS02-SCHU-KOPF
067350                                   TO W1AN-N1
067360
067370     ADD  W1AN-N2                  TO W1AN-N1
067380     MOVE W1AN-N1                  TO S551AN-A-LAENGE
067390
067400     MOVE '01;C90-ABSCHLUSS-VS02;Ende  ' TO W1AX-TRALOG-TEXT
067410     PERFORM Q92-TRALOG-ZEILE
067420
067430     CONTINUE.
067440 C90-ABSCHLUSS-VS02-END.
067450     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067460       DISPLAY "++25889-->C90-ABSCHLUSS-VS02-END.       "
067470     DISPLAY "++W549AX-V-ID-TRACE = "
067480        W549AX-V-ID-TRACE                             *>++DELETE
067490     DISPLAY "++W549AN-TRACE-LEVEL = "
067500        W549AN-TRACE-LEVEL                            *>++DELETE
067510     END-IF                                           *>++DELETE
067520     EXIT.
067530/
067540*-----------------------------------------------------------------
067550* Abschluss DT02-Telegramm, Länge Antwort berechnen
067560* W1AN-N2 wird vor dem Aufruf berechnet
067570* Ergebnis: S551AN-A-LAENGE
067580*-----------------------------------------------------------------
067590 C91-ABSCHLUSS-DT02 SECTION.
067600     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067610       DISPLAY "++25889-->C91-ABSCHLUSS-DT02 SECTION.   "
067620     DISPLAY "++W549AX-V-ID-TRACE = "
067630        W549AX-V-ID-TRACE                             *>++DELETE
067640     DISPLAY "++W549AN-TRACE-LEVEL = "
067650        W549AN-TRACE-LEVEL                            *>++DELETE
067660     END-IF                                           *>++DELETE
067670
067680     MOVE LENGTH OF S551AX-A-KOPF  TO W1AN-N1
067690     ADD  LENGTH OF S551AX-A-AUFTRAGS-ID
067700                                   TO W1AN-N1
067710     ADD  LENGTH OF S551AX-A-CONTAINER
067720                                   TO W1AN-N1
067730     ADD  LENGTH OF S551AX-A-DT02-TRANSPOND-KOPF
067740                                   TO W1AN-N1
067750
067760     ADD  W1AN-N2                  TO W1AN-N1
067770     MOVE W1AN-N1                  TO S551AN-A-LAENGE
067780
067790     CONTINUE.
067800 C91-ABSCHLUSS-DT02-END.
067810     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067820       DISPLAY "++25889-->C91-ABSCHLUSS-DT02-END.       "
067830     DISPLAY "++W549AX-V-ID-TRACE = "
067840        W549AX-V-ID-TRACE                             *>++DELETE
067850     DISPLAY "++W549AN-TRACE-LEVEL = "
067860        W549AN-TRACE-LEVEL                            *>++DELETE
067870     END-IF                                           *>++DELETE
067880     EXIT.
067890/
067900*-----------------------------------------------------------------
067910* Abschluss TRA4-Telegramm, Länge Antwort berechnen
067920* W1AN-N2 wird vor dem Aufruf berechnet
067930* Ergebnis: S551AN-A-LAENGE
067940*-----------------------------------------------------------------
067950 C92-ABSCHLUSS-TRA4 SECTION.
067960     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
067970       DISPLAY "++25889-->C92-ABSCHLUSS-TRA4 SECTION.   "
067980     DISPLAY "++W549AX-V-ID-TRACE = "
067990        W549AX-V-ID-TRACE                             *>++DELETE
068000     DISPLAY "++W549AN-TRACE-LEVEL = "
068010        W549AN-TRACE-LEVEL                            *>++DELETE
068020     END-IF                                           *>++DELETE
068030
068040     MOVE LENGTH OF S551AX-A-KOPF  TO W1AN-N1
068050     ADD  LENGTH OF S551AX-A-AUFTRAGS-ID
068060                                   TO W1AN-N1
068070     ADD  LENGTH OF S551AX-A-CONTAINER
068080                                   TO W1AN-N1
068090     ADD  LENGTH OF S551AX-A-TRA4-TRANSPOND-KOPF
068100                                   TO W1AN-N1
068110
068120     ADD  W1AN-N2                  TO W1AN-N1
068130     MOVE W1AN-N1                  TO S551AN-A-LAENGE
068140
068150     CONTINUE.
068160 C92-ABSCHLUSS-TRA4-END.
068170     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
068180       DISPLAY "++25889-->C92-ABSCHLUSS-TRA4-END.       "
068190     DISPLAY "++W549AX-V-ID-TRACE = "
068200        W549AX-V-ID-TRACE                             *>++DELETE
068210     DISPLAY "++W549AN-TRACE-LEVEL = "
068220        W549AN-TRACE-LEVEL                            *>++DELETE
068230     END-IF                                           *>++DELETE
068240     EXIT.
068250/
068260*-----------------------------------------------------------------
068270* Prüfung/Aufbereitung der WFS-Ident-Daten
068280*-----------------------------------------------------------------
068290 D10-IDENT-DATEN-CHECK  SECTION.
068300     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
068310       DISPLAY "++25889-->D10-IDENT-DATEN-CHECK  SECTION"
068320     DISPLAY "++W549AX-V-ID-TRACE = "
068330        W549AX-V-ID-TRACE                             *>++DELETE
068340     DISPLAY "++W549AN-TRACE-LEVEL = "
068350        W549AN-TRACE-LEVEL                            *>++DELETE
068360     END-IF                                           *>++DELETE
068370
068380     MOVE '01;D10-IDENT-DATEN-CHECK;Beginn'
068390                                   TO W1AX-TRALOG-TEXT
068400     PERFORM Q92-TRALOG-ZEILE
068410
068420     MOVE S551AX-E-TRA4-WFS-ID-DATEN
068430                                   TO S585AX-WFSIDENTDATA
068440
068450     PERFORM D60-WFS-SIG-KEY-BILDEN
068460*    -- Ausgabe S585AX-WFSSIGKEY
068470*    -- konnte kein SIGKEY gebildet werden, Fehler ...
068480     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
068490*      -- Start-SKC kann leer bleiben, wie bei FE532B Tester
068500       MOVE SPACES                 TO S585AX-STARTSKCLDATEN
068510
068520       CALL FE585D USING S585-WFSIDENTDATA
068530                         S585-WFSSIGKEY
068540                         S585-STARTSKCLDATEN
068550
068560                         S585-VERSIONWFSIDENTDATEN
068570                         S585-TRAININGSCNT
068580                         S585-FAZITID
068590                         S585-TRANSPONDERVERSION
068600                         S585-TRANSPONDERID
068610                         S585-BATTERYSTATUS
068620                         S585-TRAININGCOUNTER
068630                         S585-MAC
068640                         S585-KEYFOBSTATUS
068650                         S585-CHALLENGEVERSION
068660                         S585-CHALLENGE
068670                         S585-VIN
068680                         S585-STATUSKONFIGVERSION
068690                         S585-LEBENSZUSTAND
068700                         S585-PKLASSE
068710                         S585-ANGELERNTESCHLUESSEL
068720                         S585-ANZULERNENSCHLUESSEL
068730                         S585-LOGINKL15ANRESTZEIT
068740                         S585-STATUSDEBUGSERVICE
068750                         S585-RESERVE-1
068760                         S585-STATUSKOMMVERSION
068770                         S585-STATUSKLEMMAKTIV
068780                         S585-IMMOBILIZERSTATUS
068790                         S585-MSG1LE4STATUS
068800                         S585-MSG2LE3STATUS
068810                         S585-MSG3LE2STATUS
068820                         S585-MSG4LE1STATUS
068830                         S585-GSGSTATUS
068840                         S585-ELVSTATUS
068850                         S585-VTSSTATUS
068860                         S585-PARKSPERRESTATUS
068870                         S585-RESERVE-2
068880                         S585-VERSIONTIMESTAMP
068890                         S585-LETZTEVKMSDLD
068900                         S585-LETZTELOGIN
068910                         S585-LETZTERSCHLUESSELDLD
068920                         S585-KEYFOBTABLEVERSION
068930                         S585-KEYFOBTABLE
068940                         S585-RESERVE-3
068950                         S585-FAZITCHALLENGE
068960                         S585-WFSIDENTDATENMAC
068970                         S585-WFSIDENTDATENMACCALC
068980                         S585-ERROR
068990
069000       IF S585AX-ERROR = '0000'
069010*      S585AX-TC ist in HEX, 4 Byte, umrechnen in dezimal
069020*      weil in Tabelle X30 als PIC S9(9) COMP abgelegt
069030         MOVE S585AX-TRAININGCOUNTER TO W1AX-EIN-HEXWERT
069040         PERFORM O20-HEX-TO-DECIMAL
069050         MOVE W1AN-ERGEBNIS-DEC      TO W1AN-S585TC-NUM
069060
069070         PERFORM D20-WFS-AUSWERTEN
069080       ELSE
069090         EVALUATE S585AX-ERROR
069100*             -- WFS-TYP nicht definiert
069110           WHEN '0008' MOVE K1AN-T2858 TO W549AN-TEXT-RC
069120*             -- Länge Start-SKC falsch
069130           WHEN '0011' MOVE K1AN-T2860 TO W549AN-TEXT-RC
069140*               -- Neu/Gebraucht falsch
069150           WHEN '0013' MOVE K1AN-T2861 TO W549AN-TEXT-RC
069160*               -- Steuergerät falsch
069170           WHEN '0016' MOVE K1AN-T2862 TO W549AN-TEXT-RC
069180*               -- ERR_TXT_LAENGE_IKA
069190           WHEN '0070' MOVE K1AN-T1802 TO W549AN-TEXT-RC
069200*               -- ERR_TXT_LAENGE_WFS_IDENT_DATA
069210           WHEN '0114' MOVE K1AN-T2783 TO W549AN-TEXT-RC
069220*               -- ERR_TXT_WFS_IDENT_DATA_MAC
069230           WHEN '0115' MOVE K1AN-T2784 TO W549AN-TEXT-RC
069240*               -- ERR_TXT_LAENGE_VKMS_KEY_1009
069250           WHEN '0116' MOVE K1AN-T2785 TO W549AN-TEXT-RC
069260*               -- ERR_TXT_VERSION_WFS_IDENT_DATA
069270           WHEN '0117' MOVE K1AN-T2786 TO W549AN-TEXT-RC
069280
069290           WHEN OTHER
069300             MOVE K1AN-T2863       TO W549AN-TEXT-RC
069310             MOVE 1                TO W549AN-FEHLER-PARM-LEN
069320             STRING 'Unbekannter Fehler aus ' FE585D ' '
069330                    S585AX-ERROR
069340                 DELIMITED BY SIZE INTO W549AX-FEHLER-PARM-TEXT
069350                 WITH POINTER           W549AN-FEHLER-PARM-LEN
069360         END-EVALUATE
069370         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
069380       END-IF
069390
069400     END-IF
069410
069420     MOVE '01;D10-IDENT-DATEN-CHECK;Ende'
069430                                   TO W1AX-TRALOG-TEXT
069440     PERFORM Q92-TRALOG-ZEILE
069450
069460     CONTINUE.
069470 D10-IDENT-DATEN-CHECK-END.
069480     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
069490       DISPLAY "++25889-->D10-IDENT-DATEN-CHECK-END.    "
069500     DISPLAY "++W549AX-V-ID-TRACE = "
069510        W549AX-V-ID-TRACE                             *>++DELETE
069520     DISPLAY "++W549AN-TRACE-LEVEL = "
069530        W549AN-TRACE-LEVEL                            *>++DELETE
069540     END-IF                                           *>++DELETE
069550     EXIT.
069560/
069570*-----------------------------------------------------------------
069580* Auswertung der WFS-Identifikationsdaten
069590*-----------------------------------------------------------------
069600 D20-WFS-AUSWERTEN      SECTION.
069610     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
069620       DISPLAY "++25889-->D20-WFS-AUSWERTEN      SECTION"
069630     DISPLAY "++W549AX-V-ID-TRACE = "
069640        W549AX-V-ID-TRACE                             *>++DELETE
069650     DISPLAY "++W549AN-TRACE-LEVEL = "
069660        W549AN-TRACE-LEVEL                            *>++DELETE
069670     END-IF                                           *>++DELETE
069680
069690     MOVE '01;D20-WFS-AUSWERTEN;Beginn'
069700                                   TO W1AX-TRALOG-TEXT
069710     PERFORM Q92-TRALOG-ZEILE
069720
069730     EVALUATE S585AX-LEBENSZUSTAND
069740       WHEN '02'
069750       WHEN '03'
069760       WHEN '04'
069770*        -- LZ=02, 03 oder 04 => Verarbeitung
069780         CONTINUE
069790       WHEN '01'
069800       WHEN '08'
069810*        -- Fehler: Aktion VKMS lernen durchführen
069820         MOVE K1AN-T2850           TO W549AN-TEXT-RC
069830         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
069840       WHEN OTHER
069850*        -- Fehler: Lebenszustand ungültig
069860         MOVE K1AN-T2877           TO W549AN-TEXT-RC
069870         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
069880     END-EVALUATE
069890
069900*    -- VIN muss = Anfrage-VIN sein
069910     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
069920       IF S585AX-VIN NOT = S551AX-E-VIN
069930         MOVE K1AN-T2876           TO W549AN-TEXT-RC
069940         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
069950       END-IF
069960     END-IF
069970
069980     MOVE '00;D20-S585AX-TRANSPONDERID : '  TO W1AX-TRALOG-TEXT
069990     MOVE S585AX-TRANSPONDERID    TO W1AX-TRALOG-TEXT (31:08)
070000     PERFORM Q92-TRALOG-ZEILE
070010
070020*    -- S585AX-MAC prüfen
070030     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
070040
070050       IF S585AX-TRANSPONDERID    =  SPACE        OR
070060          S585AX-TRANSPONDERID    =  '00000000'
070070          CONTINUE
070080       ELSE
070090          PERFORM E10-MAC-PRUEFEN
070100       END-IF
070110
070120     END-IF
070130
070140     MOVE '01;D20-WFS-AUSWERTEN;Ende'
070150                                   TO W1AX-TRALOG-TEXT
070160     PERFORM Q92-TRALOG-ZEILE
070170
070180     CONTINUE.
070190 D20-WFS-AUSWERTEN-END.
070200     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
070210       DISPLAY "++25889-->D20-WFS-AUSWERTEN-END.        "
070220     DISPLAY "++W549AX-V-ID-TRACE = "
070230        W549AX-V-ID-TRACE                             *>++DELETE
070240     DISPLAY "++W549AN-TRACE-LEVEL = "
070250        W549AN-TRACE-LEVEL                            *>++DELETE
070260     END-IF                                           *>++DELETE
070270     EXIT.
070280/
070290*-----------------------------------------------------------------
070300* FE589  KeyTable zu zerlegen
070310*-----------------------------------------------------------------
070320 D30-KEY-FOB-FE589      SECTION.
070330     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
070340       DISPLAY "++25889-->D30-KEY-FOB-FE589      SECTION"
070350     DISPLAY "++W549AX-V-ID-TRACE = "
070360        W549AX-V-ID-TRACE                             *>++DELETE
070370     DISPLAY "++W549AN-TRACE-LEVEL = "
070380        W549AN-TRACE-LEVEL                            *>++DELETE
070390     END-IF                                           *>++DELETE
070400
070410     MOVE '01;D30-KEY-FOB-FE589;Beginn'
070420                                   TO W1AX-TRALOG-TEXT
070430     PERFORM Q92-TRALOG-ZEILE
070440
070450     MOVE S585AX-KEYFOBTABLEVERSION TO S589AX-KEYFOBTABLEVERSION
070460     MOVE S585AX-KEYFOBTABLE        TO S589AX-KEYFOBTABLE
070470
070480     CALL FE589D USING S589-KEYFOBTABLEVERSION
070490                       S589-KEYFOBTABLE
070500                       S589-STATUS-1
070510                       S589-TRANSPONDERID-1
070520                       S589-TRAININGCOUNTER-1
070530                       S589-SCHLUESSELTYP-1
070540                       S589-RESERVE-1
070550                       S589-STATUS-2
070560                       S589-TRANSPONDERID-2
070570                       S589-TRAININGCOUNTER-2
070580                       S589-SCHLUESSELTYP-2
070590                       S589-RESERVE-2
070600                       S589-STATUS-3
070610                       S589-TRANSPONDERID-3
070620                       S589-TRAININGCOUNTER-3
070630                       S589-SCHLUESSELTYP-3
070640                       S589-RESERVE-3
070650                       S589-STATUS-4
070660                       S589-TRANSPONDERID-4
070670                       S589-TRAININGCOUNTER-4
070680                       S589-SCHLUESSELTYP-4
070690                       S589-RESERVE-4
070700                       S589-STATUS-5
070710                       S589-TRANSPONDERID-5
070720                       S589-TRAININGCOUNTER-5
070730                       S589-SCHLUESSELTYP-5
070740                       S589-RESERVE-5
070750                       S589-STATUS-6
070760                       S589-TRANSPONDERID-6
070770                       S589-TRAININGCOUNTER-6
070780                       S589-SCHLUESSELTYP-6
070790                       S589-RESERVE-6
070800                       S589-STATUS-7
070810                       S589-TRANSPONDERID-7
070820                       S589-TRAININGCOUNTER-7
070830                       S589-SCHLUESSELTYP-7
070840                       S589-RESERVE-7
070850                       S589-STATUS-8
070860                       S589-TRANSPONDERID-8
070870                       S589-TRAININGCOUNTER-8
070880                       S589-SCHLUESSELTYP-8
070890                       S589-RESERVE-8
070900                       S589-ERROR
070910
070920     IF S589AX-ERROR = '0000'
070930       CONTINUE
070940     ELSE
070950       EVALUATE S589AX-ERROR
070960*             -- WFS-TYP nicht definiert
070970         WHEN '0008' MOVE K1AN-T2858 TO W549AN-TEXT-RC
070980*             -- Länge Start-SKC falsch
070990         WHEN '0011' MOVE K1AN-T2860 TO W549AN-TEXT-RC
071000*             -- Neu/Gebraucht falsch
071010         WHEN '0013' MOVE K1AN-T2861 TO W549AN-TEXT-RC
071020*             -- Steuergerät falsch
071030         WHEN '0016' MOVE K1AN-T2862 TO W549AN-TEXT-RC
071040*             -- ERR_TXT_LAENGE_IKA
071050         WHEN '0070' MOVE K1AN-T1802 TO W549AN-TEXT-RC
071060*             -- Länge Key-FOB-Table falsch
071070         WHEN '0123' MOVE K1AN-T2792 TO W549AN-TEXT-RC
071080*             -- Key-FOB-Table Version unbekannt
071090         WHEN '0124' MOVE K1AN-T2793 TO W549AN-TEXT-RC
071100*             -- Länge Key-FOB-Table-Version falsch
071110         WHEN '0134' MOVE K1AN-T2800 TO W549AN-TEXT-RC
071120
071130         WHEN OTHER
071140           MOVE K1AN-T2863           TO W549AN-TEXT-RC
071150           MOVE 1                    TO W549AN-FEHLER-PARM-LEN
071160           STRING 'Unbekannter Fehler aus ' FE589D ' '
071170                  S589AX-ERROR
071180               DELIMITED BY SIZE   INTO W549AX-FEHLER-PARM-TEXT
071190               WITH POINTER             W549AN-FEHLER-PARM-LEN
071200       END-EVALUATE
071210       MOVE K1AN-FEHLER              TO W549AN-TEXT-FEHLER-KLASSE
071220     END-IF
071230
071240     MOVE '01;D30-KEY-FOB-FE589;Ende'
071250                                   TO W1AX-TRALOG-TEXT
071260     PERFORM Q92-TRALOG-ZEILE
071270
071280     CONTINUE.
071290 D30-KEY-FOB-FE589-END.
071300     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
071310       DISPLAY "++25889-->D30-KEY-FOB-FE589-END.        "
071320     DISPLAY "++W549AX-V-ID-TRACE = "
071330        W549AX-V-ID-TRACE                             *>++DELETE
071340     DISPLAY "++W549AN-TRACE-LEVEL = "
071350        W549AN-TRACE-LEVEL                            *>++DELETE
071360     END-IF                                           *>++DELETE
071370     EXIT.
071380/
071390*-----------------------------------------------------------------
071400* Die einzelnen KeyFOBs in eine Tabelle übernehmen.
071410*-----------------------------------------------------------------
071420 D31-KEYFOB-IN-TAB      SECTION.
071430     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
071440       DISPLAY "++25889-->D31-KEYFOB-IN-TAB      SECTION"
071450     DISPLAY "++W549AX-V-ID-TRACE = "
071460        W549AX-V-ID-TRACE                             *>++DELETE
071470     DISPLAY "++W549AN-TRACE-LEVEL = "
071480        W549AN-TRACE-LEVEL                            *>++DELETE
071490     END-IF                                           *>++DELETE
071500
071510     MOVE '01;D31-KEYFOB-IN-TAB;Beginn'
071520                                   TO W1AX-TRALOG-TEXT
071530     PERFORM Q92-TRALOG-ZEILE
071540
071550*    --  Transponder/Schlüssel 1 ---------------------------------
071560     MOVE S589AX-STATUS-1          TO W1AX-TRA-KEY-FOB-STATUS (1)
071570     MOVE S589AX-TRANSPONDERID-1   TO W1AX-TRA-TRANSPONDERID  (1)
071580     MOVE S589AX-TRAININGCOUNTER-1 TO W1AN-TRA-ID-ZAHL-HEX    (1)
071590     MOVE S589AX-TRAININGCOUNTER-1 TO W1AX-EIN-HEXWERT
071600     PERFORM O20-HEX-TO-DECIMAL
071610     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (1)
071620
071630     MOVE S589AX-SCHLUESSELTYP-1   TO BBCB-SOURCE-TEXT
071640     MOVE LENGTH OF S589AX-SCHLUESSELTYP-1
071650                                   TO BBCB-TEXT-LEN
071660     PERFORM O10-XCTOBIN
071670     IF CSN-RETURN-CODE = ZERO
071680       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
071690                                   TO W1AX-TRA-SCHLUESSELTYP (1)
071700     ELSE
071710       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (1)
071720       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (1)
071730     END-IF
071740
071750     MOVE 1                        TO W1AN-TRA-LFDNR (1)
071760     MOVE K1AX-BGRP501             TO W1AX-TRA-BGRP  (1)
071770*    --  Transponder/Schlüssel 2 ---------------------------------
071780     MOVE S589AX-STATUS-2          TO W1AX-TRA-KEY-FOB-STATUS (2)
071790     MOVE S589AX-TRANSPONDERID-2   TO W1AX-TRA-TRANSPONDERID  (2)
071800     MOVE S589AX-TRAININGCOUNTER-2 TO W1AN-TRA-ID-ZAHL-HEX    (2)
071810     MOVE S589AX-TRAININGCOUNTER-2 TO W1AX-EIN-HEXWERT
071820     PERFORM O20-HEX-TO-DECIMAL
071830     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (2)
071840
071850     MOVE S589AX-SCHLUESSELTYP-2   TO BBCB-SOURCE-TEXT
071860     MOVE LENGTH OF S589AX-SCHLUESSELTYP-2
071870                                   TO BBCB-TEXT-LEN
071880     PERFORM O10-XCTOBIN
071890     IF CSN-RETURN-CODE = ZERO
071900       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
071910                                   TO W1AX-TRA-SCHLUESSELTYP (2)
071920     ELSE
071930       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (2)
071940       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (2)
071950     END-IF
071960
071970     MOVE 2                        TO W1AN-TRA-LFDNR (2)
071980     MOVE K1AX-BGRP502             TO W1AX-TRA-BGRP  (2)
071990*    --  Transponder/Schlüssel 3 ---------------------------------
072000     MOVE S589AX-STATUS-3          TO W1AX-TRA-KEY-FOB-STATUS (3)
072010     MOVE S589AX-TRANSPONDERID-3   TO W1AX-TRA-TRANSPONDERID  (3)
072020     MOVE S589AX-TRAININGCOUNTER-3 TO W1AN-TRA-ID-ZAHL-HEX    (3)
072030     MOVE S589AX-TRAININGCOUNTER-3 TO W1AX-EIN-HEXWERT
072040     PERFORM O20-HEX-TO-DECIMAL
072050     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (3)
072060
072070     MOVE S589AX-SCHLUESSELTYP-3   TO BBCB-SOURCE-TEXT
072080     MOVE LENGTH OF S589AX-SCHLUESSELTYP-3
072090                                   TO BBCB-TEXT-LEN
072100     PERFORM O10-XCTOBIN
072110     IF CSN-RETURN-CODE = ZERO
072120       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
072130                                   TO W1AX-TRA-SCHLUESSELTYP (3)
072140     ELSE
072150       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (3)
072160       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (3)
072170     END-IF
072180
072190     MOVE 3                        TO W1AN-TRA-LFDNR (3)
072200     MOVE K1AX-BGRP503             TO W1AX-TRA-BGRP  (3)
072210*    --  Transponder/Schlüssel 4 ---------------------------------
072220     MOVE S589AX-STATUS-4          TO W1AX-TRA-KEY-FOB-STATUS (4)
072230     MOVE S589AX-TRANSPONDERID-4   TO W1AX-TRA-TRANSPONDERID  (4)
072240     MOVE S589AX-TRAININGCOUNTER-4 TO W1AN-TRA-ID-ZAHL-HEX    (4)
072250     MOVE S589AX-TRAININGCOUNTER-4 TO W1AX-EIN-HEXWERT
072260     PERFORM O20-HEX-TO-DECIMAL
072270     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (4)
072280
072290     MOVE S589AX-SCHLUESSELTYP-4   TO BBCB-SOURCE-TEXT
072300     MOVE LENGTH OF S589AX-SCHLUESSELTYP-4
072310                                   TO BBCB-TEXT-LEN
072320     PERFORM O10-XCTOBIN
072330     IF CSN-RETURN-CODE = ZERO
072340       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
072350                                   TO W1AX-TRA-SCHLUESSELTYP (4)
072360     ELSE
072370       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (4)
072380       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (4)
072390     END-IF
072400
072410     MOVE 4                        TO W1AN-TRA-LFDNR (4)
072420     MOVE K1AX-BGRP504             TO W1AX-TRA-BGRP  (4)
072430*    --  Transponder/Schlüssel 5 ---------------------------------
072440     MOVE S589AX-STATUS-5          TO W1AX-TRA-KEY-FOB-STATUS (5)
072450     MOVE S589AX-TRANSPONDERID-5   TO W1AX-TRA-TRANSPONDERID  (5)
072460     MOVE S589AX-TRAININGCOUNTER-5 TO W1AN-TRA-ID-ZAHL-HEX    (5)
072470     MOVE S589AX-TRAININGCOUNTER-5 TO W1AX-EIN-HEXWERT
072480     PERFORM O20-HEX-TO-DECIMAL
072490     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (5)
072500
072510     MOVE S589AX-SCHLUESSELTYP-5   TO BBCB-SOURCE-TEXT
072520     MOVE LENGTH OF S589AX-SCHLUESSELTYP-5
072530                                   TO BBCB-TEXT-LEN
072540     PERFORM O10-XCTOBIN
072550     IF CSN-RETURN-CODE = ZERO
072560       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
072570                                   TO W1AX-TRA-SCHLUESSELTYP (5)
072580     ELSE
072590       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (5)
072600       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (5)
072610     END-IF
072620
072630     MOVE 5                        TO W1AN-TRA-LFDNR (5)
072640     MOVE K1AX-BGRP505             TO W1AX-TRA-BGRP  (5)
072650*    --  Transponder/Schlüssel 6 ---------------------------------
072660     MOVE S589AX-STATUS-6          TO W1AX-TRA-KEY-FOB-STATUS (6)
072670     MOVE S589AX-TRANSPONDERID-6   TO W1AX-TRA-TRANSPONDERID  (6)
072680     MOVE S589AX-TRAININGCOUNTER-6 TO W1AN-TRA-ID-ZAHL-HEX    (6)
072690     MOVE S589AX-TRAININGCOUNTER-6 TO W1AX-EIN-HEXWERT
072700     PERFORM O20-HEX-TO-DECIMAL
072710     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (6)
072720
072730     MOVE S589AX-SCHLUESSELTYP-6   TO BBCB-SOURCE-TEXT
072740     MOVE LENGTH OF S589AX-SCHLUESSELTYP-6
072750                                   TO BBCB-TEXT-LEN
072760     PERFORM O10-XCTOBIN
072770     IF CSN-RETURN-CODE = ZERO
072780       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
072790                                   TO W1AX-TRA-SCHLUESSELTYP (6)
072800     ELSE
072810       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (6)
072820       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (6)
072830     END-IF
072840
072850     MOVE 6                        TO W1AN-TRA-LFDNR (6)
072860     MOVE K1AX-BGRP506             TO W1AX-TRA-BGRP  (6)
072870*    --  Transponder/Schlüssel 7 ---------------------------------
072880     MOVE S589AX-STATUS-7          TO W1AX-TRA-KEY-FOB-STATUS (7)
072890     MOVE S589AX-TRANSPONDERID-7   TO W1AX-TRA-TRANSPONDERID  (7)
072900     MOVE S589AX-TRAININGCOUNTER-7 TO W1AN-TRA-ID-ZAHL-HEX    (7)
072910     MOVE S589AX-TRAININGCOUNTER-7 TO W1AX-EIN-HEXWERT
072920     PERFORM O20-HEX-TO-DECIMAL
072930     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (7)
072940
072950     MOVE S589AX-SCHLUESSELTYP-7   TO BBCB-SOURCE-TEXT
072960
072970     MOVE LENGTH OF S589AX-SCHLUESSELTYP-7
072980                                   TO BBCB-TEXT-LEN
072990     PERFORM O10-XCTOBIN
073000     IF CSN-RETURN-CODE = ZERO
073010       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
073020                                   TO W1AX-TRA-SCHLUESSELTYP (7)
073030     ELSE
073040       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (7)
073050       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (7)
073060     END-IF
073070
073080     MOVE 7                        TO W1AN-TRA-LFDNR (7)
073090     MOVE K1AX-BGRP507             TO W1AX-TRA-BGRP  (7)
073100*    --  Transponder/Schlüssel 8 ---------------------------------
073110     MOVE S589AX-STATUS-8          TO W1AX-TRA-KEY-FOB-STATUS (8)
073120     MOVE S589AX-TRANSPONDERID-8   TO W1AX-TRA-TRANSPONDERID  (8)
073130     MOVE S589AX-TRAININGCOUNTER-8 TO W1AN-TRA-ID-ZAHL-HEX    (8)
073140     MOVE S589AX-TRAININGCOUNTER-8 TO W1AX-EIN-HEXWERT
073150     PERFORM O20-HEX-TO-DECIMAL
073160     MOVE W1AN-ERGEBNIS-DEC        TO W1AN-TRA-ID-ZAHL        (8)
073170
073180     MOVE S589AX-SCHLUESSELTYP-8   TO BBCB-SOURCE-TEXT
073190     MOVE LENGTH OF S589AX-SCHLUESSELTYP-8
073200                                   TO BBCB-TEXT-LEN
073210     PERFORM O10-XCTOBIN
073220     IF CSN-RETURN-CODE = ZERO
073230       MOVE BBCB-TARGET-TEXT(1:BBCB-TEXT-LEN)
073240                                   TO W1AX-TRA-SCHLUESSELTYP (8)
073250     ELSE
073260       MOVE W1AN-TEXT-RC           TO W1AN-TRA-TEXT-RC (8)
073270       MOVE W1AN-TEXT-FEHLER-KLASSE TO W1AN-TRA-FEHLER-KLASSE (8)
073280     END-IF
073290
073300     MOVE 8                        TO W1AN-TRA-LFDNR (8)
073310     MOVE K1AX-BGRP508             TO W1AX-TRA-BGRP  (8)
073320
073330     MOVE '01;D31-KEYFOB-IN-TAB;Ende'
073340                                   TO W1AX-TRALOG-TEXT
073350     PERFORM Q92-TRALOG-ZEILE
073360
073370     CONTINUE.
073380 D31-KEYFOB-IN-TAB-END.
073390     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
073400       DISPLAY "++25889-->D31-KEYFOB-IN-TAB-END.        "
073410     DISPLAY "++W549AX-V-ID-TRACE = "
073420        W549AX-V-ID-TRACE                             *>++DELETE
073430     DISPLAY "++W549AN-TRACE-LEVEL = "
073440        W549AN-TRACE-LEVEL                            *>++DELETE
073450     END-IF                                           *>++DELETE
073460     EXIT.
073470/
073480*-----------------------------------------------------------------
073490* Prüfen und zählen der gelieferten Transponder
073500*-----------------------------------------------------------------
073510 D40-TRANSPONDER-PRUEFEN SECTION.
073520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
073530       DISPLAY "++25889-->D40-TRANSPONDER-PRUEFEN SECTIO"
073540     DISPLAY "++W549AX-V-ID-TRACE = "
073550        W549AX-V-ID-TRACE                             *>++DELETE
073560     DISPLAY "++W549AN-TRACE-LEVEL = "
073570        W549AN-TRACE-LEVEL                            *>++DELETE
073580     END-IF                                           *>++DELETE
073590
073600     MOVE '01;D40-TRANSPONDER-PRUEFEN;Beginn'
073610                                   TO W1AX-TRALOG-TEXT
073620     PERFORM Q92-TRALOG-ZEILE
073630
073640     MOVE SPACE TO W1AX-TRANSP-EXST-TBL
073650     MOVE 0 TO W1AN-TRAN-ANZAHL
073660
073670*    -- Prüfen leere KeySlots in Identifikationsdaten
073680
073690     PERFORM VARYING W1AN-CNT FROM 1 BY +1
073700     UNTIL W1AN-CNT                  > K1AN-TRAN-ANZAHL-MAX
073710        OR W1AN-TEXT-FEHLER-KLASSE   > K1AN-HINWEIS
073720
073730       MOVE 0                TO W1AN-KEYFOB-ENDE
073740
073750*-- Prüfung 1:
073760*      -- Position in KeyFobTable ist leer, wenn keine
073770*      -- Transponder-ID vorliegt = Status muss 00 sein
073780*      -- Nach einem leeren Transponder kommt nix mehr
073790       IF W1AX-TRA-TRANSPONDERID (W1AN-CNT) = '00000000'
073800         IF W1AX-TRA-KEY-FOB-STATUS (W1AN-CNT) = '00'
073810           MOVE 1              TO W1AN-KEYFOB-ENDE
073820         ELSE
073830*          -- Transponder nicht gefüllt, aber Status <> 00
073840           MOVE K1AN-T2935  TO W549AN-TEXT-RC
073850           MOVE K1AN-FEHLER TO W549AN-TEXT-FEHLER-KLASSE
073860         end-if
073870       END-IF
073880
073890       IF (W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS)
073900       AND W1AN-KEYFOB-ENDE = 0
073910*-- Prüfung 2:
073920*         Status Bit-7 muss 1 sein
073930         IF W1AX-TRA-KEY-FOB-STATUS (W1AN-CNT) (1:1)
073940          = ('8' OR '9' OR 'A' OR 'B' OR 'C' OR 'D' OR 'E' OR 'F')
073950           CONTINUE
073960         ELSE
073970*          -- Transp.status in den WFS-Identdaten fehlerhaft
073980           MOVE K1AN-T2870    TO W549AN-TEXT-RC
073990           MOVE K1AN-FEHLER   TO W549AN-TEXT-FEHLER-KLASSE
074000         END-IF
074010       END-IF
074020
074030       IF (W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS)
074040         IF W1AN-KEYFOB-ENDE = 0
074050*      -- Transponder-ID ist nicht leer:
074060           ADD  1            TO W1AN-TRAN-ANZAHL
074070           MOVE 'J'          TO W1AX-TRANS-EXST-FLG (W1AN-CNT)
074080         ELSE
074090           MOVE 'N'          TO W1AX-TRANS-EXST-FLG (W1AN-CNT)
074100         END-IF
074110       END-IF
074120
074130     END-PERFORM
074140
074150     MOVE '00;D40 W1AX-TRANSP-EXST-TBL: '  TO W1AX-TRALOG-TEXT
074160     MOVE W1AX-TRANSP-EXST-TBL   TO W1AX-TRALOG-TEXT (30:08)
074170     PERFORM Q92-TRALOG-ZEILE
074180
074190     IF (W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS)
074200       IF W1AN-TRAN-ANZAHL = 0
074210*    -- Kein Transponder existiert. Alle 8 Felder sind leer.
074220         MOVE K1AN-T3378  TO W549AN-TEXT-RC
074230         MOVE K1AN-FEHLER TO W549AN-TEXT-FEHLER-KLASSE
074240       END-IF
074250     END-IF
074260
074270     MOVE '01;D40-TRANSPONDER-PRUEFEN;Ende'
074280                                   TO W1AX-TRALOG-TEXT
074290     PERFORM Q92-TRALOG-ZEILE
074300
074310     CONTINUE.
074320 D40-TRANSPONDER-PRUEFEN-END.
074330     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
074340       DISPLAY "++25889-->D40-TRANSPONDER-PRUEFEN-END.  "
074350     DISPLAY "++W549AX-V-ID-TRACE = "
074360        W549AX-V-ID-TRACE                             *>++DELETE
074370     DISPLAY "++W549AN-TRACE-LEVEL = "
074380        W549AN-TRACE-LEVEL                            *>++DELETE
074390     END-IF                                           *>++DELETE
074400     EXIT.
074410/
074420*-----------------------------------------------------------------
074430* Schlüsselrekonstruktion: Wert Key-Typ-ID=1009 ermitteln
074440*-----------------------------------------------------------------
074450 D60-WFS-SIG-KEY-BILDEN SECTION.
074460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
074470       DISPLAY "++25889-->D60-WFS-SIG-KEY-BILDEN SECTION"
074480     DISPLAY "++W549AX-V-ID-TRACE = "
074490        W549AX-V-ID-TRACE                             *>++DELETE
074500     DISPLAY "++W549AN-TRACE-LEVEL = "
074510        W549AN-TRACE-LEVEL                            *>++DELETE
074520     END-IF                                           *>++DELETE
074530
074540     MOVE '01;D60-WFS-SIG-KEY-BILDEN;Beginn'
074550                                   TO W1AX-TRALOG-TEXT
074560     PERFORM Q92-TRALOG-ZEILE
074570
074580*       W1AN-DISPLAYLEVEL setzen?? Y1 statt 21
074590     MOVE '21'                     TO S560AX-AKTION
074600     MOVE PROBA-ID (1:6)           TO S560AX-USER-ID
074610     MOVE S551AX-E-SPRACH-KZ       TO S560AN-SPRACH-KZ
074620     MOVE S551AX-E-VIN             TO S560AX-VIN
074630     MOVE V208AX-WFS-MASTER        TO S560AX-BGRP
074640
074650*    -- Lesen FEV2VN
074660     INITIALIZE B2VN-DCLFEV2VN
074670     MOVE S551AX-E-VIN             TO B2VNAX-VIN
074680     MOVE V208AX-WFS-MASTER        TO B2VNAX-BGRP
074690
074700     PERFORM T-100-FEV2VN-SELECT
074710
074720     IF SQLSTATE = DB2-OK
074730       MOVE B2VNAX-UTC-V-ID        TO S560AX-DLC-UTC-V-ID
074740       MOVE 1009                   TO S560AN-KEY-TYP-ID
074750     ELSE
074760*      -- Wenn kein DLC vorhanden
074770       MOVE SPACE                  TO S560AX-DLC-UTC-V-ID
074780       MOVE 1009                   TO S560AN-KEY-TYP-ID
074790     END-IF
074800
074810     PERFORM E50-SCHL-REKON
074820
074830*    -- WFSSIGKEY füllen
074840     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
074850       MOVE W1AX-KEY-WERT (1:32)   TO S585AX-WFSSIGKEY
074860     END-IF
074870
074880     MOVE '01;D60-WFS-SIG-KEY-BILDEN;Ende'
074890                                   TO W1AX-TRALOG-TEXT
074900     PERFORM Q92-TRALOG-ZEILE
074910
074920     CONTINUE.
074930 D60-WFS-SIG-KEY-BILDEN-END.
074940     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
074950       DISPLAY "++25889-->D60-WFS-SIG-KEY-BILDEN-END.   "
074960     DISPLAY "++W549AX-V-ID-TRACE = "
074970        W549AX-V-ID-TRACE                             *>++DELETE
074980     DISPLAY "++W549AN-TRACE-LEVEL = "
074990        W549AN-TRACE-LEVEL                            *>++DELETE
075000     END-IF                                           *>++DELETE
075010     EXIT.
075020/
075030*V11 IR neue Section
075040*-----------------------------------------------------------------
075050* In FE01TVI0 und FEV01TVM die KEY-TYP-ID-ZAHL um 1 erhöhen
075060*
075070* Suchen alle KEY-TYP-IDs zur VIN in VI per Cursor
075080*   prüfen gefundene KeyTypID mit FEV3V2, ob abhängig von SKCO
075090*   Treffer: KeyTypId in VI um 1 erhöhen
075100*-----------------------------------------------------------------
075110 D61-KT-PLUS SECTION.
075120     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
075130       DISPLAY "++25889-->D61-KT-PLUS SECTION.          "
075140     DISPLAY "++W549AX-V-ID-TRACE = "
075150        W549AX-V-ID-TRACE                             *>++DELETE
075160     DISPLAY "++W549AN-TRACE-LEVEL = "
075170        W549AN-TRACE-LEVEL                            *>++DELETE
075180     END-IF                                           *>++DELETE
075190
075200     MOVE '00;D61-KT-PLUS;BEGINN'    TO W1AX-TRALOG-TEXT
075210     PERFORM Q92-TRALOG-ZEILE
075220
075230*    -- nur 1 x pro FZ machen, d.h. hier gleich merken, dass
075240*    -- der Aufruf schonmal erfolgt ist
075250*    MOVE 'N'                      TO W540AX-E-KT-PLUS
075260
075270*    -- FE01TVI0 VKMS Fz-Key-Typ
075280     INITIALIZE B2VI-DCLFEV2VI
075290                B2VI-I-DCLFEV2VI
075300     MOVE S551AX-E-VIN               TO B2VIAX-VIN
075310     PERFORM T-100-FEV2VI-OPEN
075320     PERFORM T-100-FEV2VI-FETCH
075330
075340     PERFORM UNTIL SQLSTATE NOT = DB2-OK
075350
075360       MOVE B2VIAN-KEY-TYP-ID        TO B3V2AN-KEY-TYP-ID
075370*      -- Prüfen, ob von KT 1000 abhängig
075380       PERFORM T-100-FEV3V2-SELECT
075390       IF SQLAX-SQLSTATE           = DB2-OK
075400         MOVE B2VI-DCLFEV2VI         TO BXVI-DCLFEVXVI
075410         MOVE B2VI-I-DCLFEV2VI       TO BXVI-I-DCLFEVXVI
075420*        -- neue Werte setzen
075430         MOVE W549AX-LOG-UTC-V-ID    TO BXVIAX-UTC-V-ID
075440         ADD 1                       TO BXVIAN-KEY-TYP-ID-ZAHL
075450         PERFORM T-100-FEVXVI-INSERT
075460       END-IF
075470       PERFORM T-100-FEV2VI-FETCH
075480
075490     END-PERFORM
075500
075510     PERFORM T-100-FEV2VI-CLOSE
075520
075530*    -- FE01TVM0 VKMS Fz-Baugruppe-Key-Typ
075540     INITIALIZE B2VM-DCLFEV2VM
075550                B2VM-I-DCLFEV2VM
075560     MOVE S551AX-E-VIN               TO B2VMAX-VIN
075570     PERFORM T-100-FEV2VM-OPEN
075580     PERFORM T-100-FEV2VM-FETCH
075590
075600     PERFORM UNTIL SQLSTATE NOT = DB2-OK
075610
075620       MOVE B2VMAN-KEY-TYP-ID        TO B3V2AN-KEY-TYP-ID
075630*      -- Prüfen, ob von KT 1000 abhängig
075640       PERFORM T-100-FEV3V2-SELECT
075650       IF SQLAX-SQLSTATE           = DB2-OK
075660         MOVE B2VM-DCLFEV2VM         TO BXVM-DCLFEVXVM
075670         MOVE B2VM-I-DCLFEV2VM       TO BXVM-I-DCLFEVXVM
075680*        -- neue Werte setzen
075690         MOVE W549AX-LOG-UTC-V-ID    TO BXVMAX-UTC-V-ID
075700         ADD 1                       TO BXVMAN-KEY-TYP-ID-ZAHL
075710         PERFORM T-100-FEVXVM-INSERT
075720       END-IF
075730       PERFORM T-100-FEV2VM-FETCH
075740     END-PERFORM
075750
075760     PERFORM T-100-FEV2VM-CLOSE
075770
075780     MOVE '00;D61-KT-PLUS;ENDE  '    TO W1AX-TRALOG-TEXT
075790     PERFORM Q92-TRALOG-ZEILE
075800
075810     CONTINUE.
075820 D61-KT-PLUS-END.
075830     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
075840       DISPLAY "++25889-->D61-KT-PLUS-END.              "
075850     DISPLAY "++W549AX-V-ID-TRACE = "
075860        W549AX-V-ID-TRACE                             *>++DELETE
075870     DISPLAY "++W549AN-TRACE-LEVEL = "
075880        W549AN-TRACE-LEVEL                            *>++DELETE
075890     END-IF                                           *>++DELETE
075900     EXIT.
075910/
075920*-----------------------------------------------------------------
075930* Transponder schreiben
075940* mit Status W1AN-TEXT-TRANSP-STATUS
075950*-----------------------------------------------------------------
075960 D90-WRITE-TRANSP-VS02 SECTION.
075970     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
075980       DISPLAY "++25889-->D90-WRITE-TRANSP-VS02 SECTION."
075990     DISPLAY "++W549AX-V-ID-TRACE = "
076000        W549AX-V-ID-TRACE                             *>++DELETE
076010     DISPLAY "++W549AN-TRACE-LEVEL = "
076020        W549AN-TRACE-LEVEL                            *>++DELETE
076030     END-IF                                           *>++DELETE
076040
076050     MOVE '00;D90-WRITE-TRANSP-VS02;Beginn ' TO W1AX-TRALOG-TEXT
076060     PERFORM Q92-TRALOG-ZEILE
076070
076080     MOVE W549AX-LOG-UTC-V-ID      TO BXX3AX-UTC-V-ID
076090     MOVE S551AX-E-VIN             TO BXX3AX-VIN
076100     MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
076110                                   TO BXX3AX-TRANSPOND-ID
076120     MOVE S540AX-A-TRANSPOND-TYP   TO BXX3AX-TRANSPOND-TYP
076130     MOVE W1AN-TEXT-TRANSP-STATUS
076140                                 TO BXX3AN-TEXT-TRANSPOND-STATUS
076150*    -- Werte aus FE540 übernehmen
076160     MOVE S540AN-A-SKC0-KEY-TYP-ID TO BXX3AN-SKC0-KEY-TYP-ID
076170     MOVE ZERO                     TO BXX3AN-I-SKC0-KEY-TYP-ID
076180
076190     MOVE S540AN-A-SKC0-KEY-TYP-ID-ZAHL
076200                                  TO BXX3AN-SKC0-KEY-TYP-ID-ZAHL
076210     MOVE ZERO                    TO BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL
076220
076230     MOVE S540AN-A-TRANSPOND-ID-ZAHL
076240                                   TO BXX3AN-TRANSPOND-ID-ZAHL
076250     MOVE S540AN-A-PSS-FZ-ID-ZAHL  TO BXX3AN-PSS-FZ-ID-ZAHL
076260     MOVE S540AX-A-PSS-KRYPTOREGION
076270                                   TO BXX3AX-PSS-KRYPTOREGION
076280     MOVE S540AX-A-PSS-BGRP        TO BXX3AX-PSS-BGRP
076290     MOVE S540AN-A-PSS-KEY-TYP-ID  TO BXX3AN-PSS-KEY-TYP-ID
076300     MOVE S540AN-A-PSS-KEY-TYP-ID-ZAHL
076310                                   TO BXX3AN-PSS-KEY-TYP-ID-ZAHL
076320     MOVE S540AN-A-PSS-VKMS-KEY-AUF-VER
076330                                 TO BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
076340     MOVE S540AX-A-PSS-VIN         TO BXX3AX-PSS-VIN
076350
076360*V11 --> ----------------------------------------------------
076370     MOVE SPACE                 TO W1AX-TRALOG-TEXT
076380     MOVE I1AN-TRA              TO W1AN-AUFB4
076390     STRING '12c. vor D90-WRITE-TRANSP-VS02 '
076400          '; I1AN-TRA = '            W1AN-AUFB4
076410          '; S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)='
076420             S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
076430          '; BXX3AX-TRANSPOND-ID = ' BXX3AX-TRANSPOND-ID
076440          '; S540AX-A-SCHREIBEN = '  S540AX-A-SCHREIBEN
076450     DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
076460     PERFORM Q92-TRALOG-ZEILE
076470*V11 <-- ------------------------------------------------------
076480
076490     IF S540AX-A-SCHREIBEN = 'J'
076500       PERFORM T-100-FEVXX3-INSERT
076510     ELSE
076520       MOVE DB2-OK                 TO SQLSTATE
076530     END-IF
076540
076550     IF SQLSTATE = DB2-OK
076560       MOVE BXX3AX-BGRP
076570                       TO S551AX-A-VS02-S-BGRP-NUMMER  (I1AN-TRA)
076580       MOVE BXX3AX-TRANSPOND-ID
076590                       TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
076600       MOVE 'FAZ'      TO S551AX-A-VS02-FEHLER-SYSTEM  (I1AN-TRA)
076610       MOVE S540AN-A-TEXT-RC
076620                       TO S551AN-A-VS02-FEHLER-NR      (I1AN-TRA)
076630       MOVE ':'        TO S551AX-A-VS02-FEHLER-TRENN   (I1AN-TRA)
076640       MOVE SPACE      TO S551AX-A-VS02-FEHLER-TEXT    (I1AN-TRA)
076650       MOVE SPACE      TO S551AX-A-VS02-S-TRANSPOND-DL (I1AN-TRA)
076660     ELSE
076670       MOVE BXX3AX-BGRP
076680                       TO S551AX-A-VS02-S-BGRP-NUMMER  (I1AN-TRA)
076690       MOVE BXX3AX-TRANSPOND-ID
076700                       TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-TRA)
076710       MOVE 'FAZ'      TO S551AX-A-VS02-FEHLER-SYSTEM  (I1AN-TRA)
076720       MOVE S540AN-A-TEXT-RC
076730                       TO S551AN-A-VS02-FEHLER-NR      (I1AN-TRA)
076740       MOVE ':'        TO S551AX-A-VS02-FEHLER-TRENN   (I1AN-TRA)
076750       MOVE SPACE      TO S551AX-A-VS02-FEHLER-TEXT    (I1AN-TRA)
076760       MOVE SPACE      TO S551AX-A-VS02-S-TRANSPOND-DL (I1AN-TRA)
076770     END-IF
076780
076790     MOVE '00;D90-WRITE-TRANSP-VS02;Ende   ' TO W1AX-TRALOG-TEXT
076800     PERFORM Q92-TRALOG-ZEILE
076810
076820     CONTINUE.
076830 D90-WRITE-TRANSP-VS02-END.
076840     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
076850       DISPLAY "++25889-->D90-WRITE-TRANSP-VS02-END.    "
076860     DISPLAY "++W549AX-V-ID-TRACE = "
076870        W549AX-V-ID-TRACE                             *>++DELETE
076880     DISPLAY "++W549AN-TRACE-LEVEL = "
076890        W549AN-TRACE-LEVEL                            *>++DELETE
076900     END-IF                                           *>++DELETE
076910     EXIT.
076920/
076930*-----------------------------------------------------------------
076940* Nach "Transponder löschen"
076950* werden alle Transponder, die nicht in der Anfrage dabei sind,
076960* inaktiv gesetzt, ausser Transponder mit Status:
076970*    --  8043=Verschrottet
076980*    --  8086=Zuordnung aufgehoben
076990*    --  2937=Inaktiv
077000* Dazu Lesen der X30 aktuell zur VIN und den gefundenen Transp.
077010* mit allen aus der Schubladenliste vergleichen. Ist der Transp.
077020* aus der X30 nicht in der Liste, deaktivieren und nächsten aus
077030* X30 lesen.
077040*-----------------------------------------------------------------
077050 D91-INAKTIV-SETZEN SECTION.
077060     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
077070       DISPLAY "++25889-->D91-INAKTIV-SETZEN SECTION.   "
077080     DISPLAY "++W549AX-V-ID-TRACE = "
077090        W549AX-V-ID-TRACE                             *>++DELETE
077100     DISPLAY "++W549AN-TRACE-LEVEL = "
077110        W549AN-TRACE-LEVEL                            *>++DELETE
077120     END-IF                                           *>++DELETE
077130
077140     MOVE '00;D91-INAKTIV-SETZEN;Beginn ' TO W1AX-TRALOG-TEXT
077150     PERFORM Q92-TRALOG-ZEILE
077160
077170     INITIALIZE B2X3-DCLFEV2X3
077180     INITIALIZE B2X3-I-DCLFEV2X3
077190
077200     MOVE S551AX-E-VIN             TO B2X3AX-VIN
077210
077220*    -- Lesen FEV2X3 zur VIN
077230     PERFORM T-100-FEV2X3-OPEN
077240     PERFORM T-100-FEV2X3-FETCH
077250
077260     PERFORM UNTIL SQLSTATE NOT EQUAL DB2-OK
077270       SET U1AX-TRAN-NICHT-IN-ANF  TO TRUE
077280
077290       PERFORM VARYING I1AN-TRA FROM 1 BY 1
077300       UNTIL I1AN-TRA  > W1AN-ANZ-SCHU
077310          OR U1AX-TRAN-IN-ANF
077320         IF B2X3AX-TRANSPOND-ID =
077330                        S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
077340           SET U1AX-TRAN-IN-ANF    TO TRUE
077350         ELSE
077360           SET U1AX-TRAN-NICHT-IN-ANF
077370                                   TO TRUE
077380         END-IF
077390
077400       END-PERFORM
077410
077420       IF U1AX-TRAN-NICHT-IN-ANF
077430
077440         IF B2X3AN-TEXT-TRANSPOND-STATUS
077450                                   = K1AN-8043-VERSCHROTTET
077460         OR B2X3AN-TEXT-TRANSPOND-STATUS
077470                                   = K1AN-8086-AUFGEHOBEN
077480         OR B2X3AN-TEXT-TRANSPOND-STATUS
077490                                   = K1AN-2937-INAKTIV
077500         OR B2X3AN-TEXT-TRANSPOND-STATUS
077510                                   = W1AN-STATUS
077520           CONTINUE
077530         ELSE
077540           PERFORM D91A-WRITE-INAKTIV
077550         END-IF
077560       END-IF
077570
077580*      -- nächster
077590       PERFORM T-100-FEV2X3-FETCH
077600
077610     END-PERFORM
077620
077630     PERFORM T-100-FEV2X3-CLOSE
077640
077650     MOVE '00;D91-INAKTIV-SETZEN;Ende   ' TO W1AX-TRALOG-TEXT
077660     PERFORM Q92-TRALOG-ZEILE
077670
077680     CONTINUE.
077690 D91-INAKTIV-SETZEN-END.
077700     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
077710       DISPLAY "++25889-->D91-INAKTIV-SETZEN-END.       "
077720     DISPLAY "++W549AX-V-ID-TRACE = "
077730        W549AX-V-ID-TRACE                             *>++DELETE
077740     DISPLAY "++W549AN-TRACE-LEVEL = "
077750        W549AN-TRACE-LEVEL                            *>++DELETE
077760     END-IF                                           *>++DELETE
077770     EXIT.
077780*-----------------------------------------------------------------
077790*
077800*-----------------------------------------------------------------
077810 D91A-WRITE-INAKTIV SECTION.
077820     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
077830       DISPLAY "++25889-->D91A-WRITE-INAKTIV SECTION.   "
077840     DISPLAY "++W549AX-V-ID-TRACE = "
077850        W549AX-V-ID-TRACE                             *>++DELETE
077860     DISPLAY "++W549AN-TRACE-LEVEL = "
077870        W549AN-TRACE-LEVEL                            *>++DELETE
077880     END-IF                                           *>++DELETE
077890
077900     MOVE '00;D91A-WRITE-INAKTIV;Beginn ' TO W1AX-TRALOG-TEXT
077910     PERFORM Q92-TRALOG-ZEILE
077920
077930     INITIALIZE BXX3-DCLFEVXX3
077940     INITIALIZE BXX3-I-DCLFEVXX3
077950*    -- Insert FEVXX3 vorbereiten für inaktiv
077960     MOVE W549AX-LOG-UTC-V-ID      TO BXX3AX-UTC-V-ID
077970     MOVE S551AX-E-VIN             TO BXX3AX-VIN
077980     MOVE B2X3AX-TRANSPOND-ID      TO BXX3AX-TRANSPOND-ID
077990     MOVE B2X3AX-TRANSPOND-TYP     TO BXX3AX-TRANSPOND-TYP
078000
078010     IF S551AX-E-VS02-ANFRAGETYP   = 'Z'
078020       MOVE K1AN-8086-AUFGEHOBEN   TO BXX3AN-TEXT-TRANSPOND-STATUS
078030     ELSE
078040       MOVE K1AN-2937-INAKTIV      TO BXX3AN-TEXT-TRANSPOND-STATUS
078050     END-IF
078060
078070     MOVE B2X3AX-BGRP              TO BXX3AX-BGRP
078080     MOVE B2X3AN-I-BGRP            TO BXX3AN-I-BGRP
078090     MOVE B2X3AN-SKC0-KEY-TYP-ID   TO BXX3AN-SKC0-KEY-TYP-ID
078100     MOVE B2X3AN-I-SKC0-KEY-TYP-ID TO BXX3AN-I-SKC0-KEY-TYP-ID
078110     MOVE B2X3AN-SKC0-KEY-TYP-ID-ZAHL
078120                                   TO BXX3AN-SKC0-KEY-TYP-ID-ZAHL
078130     MOVE B2X3AN-I-SKC0-KEY-TYP-ID-ZAHL
078140                                 TO BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL
078150
078160     MOVE B2X3AN-TRANSPOND-ID-ZAHL TO BXX3AN-TRANSPOND-ID-ZAHL
078170     MOVE B2X3AN-PSS-FZ-ID-ZAHL    TO BXX3AN-PSS-FZ-ID-ZAHL
078180     MOVE B2X3AX-PSS-KRYPTOREGION  TO BXX3AX-PSS-KRYPTOREGION
078190     MOVE B2X3AX-PSS-BGRP          TO BXX3AX-PSS-BGRP
078200     MOVE B2X3AN-PSS-KEY-TYP-ID    TO BXX3AN-PSS-KEY-TYP-ID
078210     MOVE B2X3AN-PSS-KEY-TYP-ID-ZAHL
078220                                   TO BXX3AN-PSS-KEY-TYP-ID-ZAHL
078230     MOVE B2X3AN-PSS-VKMS-KEY-AUFBAU-VER
078240                                TO BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
078250     MOVE B2X3AX-PSS-VIN           TO BXX3AX-PSS-VIN
078260*    -- schreiben
078270     PERFORM T-100-FEVXX3-INSERT
078280
078290     MOVE '00;D91A-WRITE-INAKTIV;Ende'
078300                                   TO W1AX-TRALOG-TEXT
078310     PERFORM Q92-TRALOG-ZEILE
078320
078330     CONTINUE.
078340 D91A-WRITE-INAKTIV-END.
078350     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
078360       DISPLAY "++25889-->D91A-WRITE-INAKTIV-END.       "
078370     DISPLAY "++W549AX-V-ID-TRACE = "
078380        W549AX-V-ID-TRACE                             *>++DELETE
078390     DISPLAY "++W549AN-TRACE-LEVEL = "
078400        W549AN-TRACE-LEVEL                            *>++DELETE
078410     END-IF                                           *>++DELETE
078420     EXIT.
078430/
078440*-----------------------------------------------------------------
078450* Nach "Transponder Registrierung aufheben"
078460* wird für alle Transponder, die nicht in der Anfrage dabei sind,
078470* die Reg. aufgehoben, ausser Transponder mit Status:
078480*    --  8043=Verschrottet
078490*    --  8086=Zuordnung aufgehoben
078500* Dazu Lesen der X30 aktuell zur VIN und den gefundenen Transp.
078510* mit allen aus der Schubladenliste vergleichen. Ist der Transp.
078520* aus der X30 nicht in der Liste, deaktivieren und nächsten aus
078530* X30 lesen.
078540*-----------------------------------------------------------------
078550 D91B-AUFGEH-SETZEN SECTION.
078560     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
078570       DISPLAY "++25889-->D91B-AUFGEH-SETZEN SECTION.   "
078580     DISPLAY "++W549AX-V-ID-TRACE = "
078590        W549AX-V-ID-TRACE                             *>++DELETE
078600     DISPLAY "++W549AN-TRACE-LEVEL = "
078610        W549AN-TRACE-LEVEL                            *>++DELETE
078620     END-IF                                           *>++DELETE
078630
078640     MOVE '00;D91B-AUFGEH-SETZEN;Beginn ' TO W1AX-TRALOG-TEXT
078650     PERFORM Q92-TRALOG-ZEILE
078660
078670*V11b IR -->
078680*    -- Lesen X30 zur VIN, wenn 1 Transp. mit 8082 / 8045
078690*       dann KeyTypen erhöhen
078700     IF S540AX-E-KT-PLUS = 'J'
078710       PERFORM T-100-FEV2X3-CNT-TRA
078720     END-IF
078730
078740     SET U1AX-D92C-AUFHEB-N  TO TRUE
078750*V11b <--
078760
078770*    -- Lesen akt. SKC0-ID-ZAHL aus VP-Tabelle
078780     INITIALIZE B0VP-DCLFEV0VP
078790                B0VP-I-DCLFEV0VP
078800     MOVE S551AX-E-VIN       TO B0VPAX-VIN
078810     MOVE V208AX-WFS-MASTER  TO B0VPAX-BGRP
078820     MOVE 1000               TO B0VPAN-KEY-TYP-ID
078830
078840     PERFORM T-100-FEV0VP-SELECT
078850
078860     INITIALIZE B2X3-DCLFEV2X3
078870     INITIALIZE B2X3-I-DCLFEV2X3
078880
078890     MOVE S551AX-E-VIN             TO B2X3AX-VIN
078900     MOVE B0VPAN-KEY-TYP-ID-ZAHL
078910                                   TO B2X3AN-SKC0-KEY-TYP-ID-ZAHL
078920*V11 --> --------------------------------------------------------
078930     MOVE SPACE                       TO W1AX-TRALOG-TEXT
078940     MOVE B2X3AN-SKC0-KEY-TYP-ID-ZAHL TO W1AN-AUFB10
078950     STRING '11a. D91B-AUFGEH-SETZEN '
078960            ' B2X3AN-SKC0-KEY-TYP-ID-ZAHL = '
078970              W1AN-AUFB10
078980            '; B2X3AX-VIN = '
078990               B2X3AX-VIN
079000     DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
079010     PERFORM Q92-TRALOG-ZEILE
079020*V11 <-- --------------------------------------------------------
079030*    -- Lesen FEV2X3 zur VIN
079040     PERFORM T-100-FEV2X3-OPEN
079050     PERFORM T-100-FEV2X3-FETCH
079060
079070*--> V08
079080     MOVE ZERO TO I1AN-NA
079090*V11 IF W1AN-ANZ-TRA-OK NOT > ZERO
079100*V11    MOVE ZERO TO W1AN-ANZ-SCHU
079110*V11 END-IF
079120     IF W1AN-ANZ-SCHU >= ZERO
079130        MOVE W1AN-ANZ-SCHU TO I1AN-NA
079140     END-IF
079150*<-- V08
079160*V11 --> --------------------------------------------------------
079170         MOVE SPACE                     TO W1AX-TRALOG-TEXT
079180         MOVE W1AN-ANZ-TRA-OK           TO W1AN-AUFB3
079190         MOVE W1AN-ANZ-SCHU             TO W1AN-AUFB4
079200         MOVE I1AN-NA                   TO W1AN-AUFB9
079210         STRING '9.d. D91B-AUFGEH-SETZEN: '
079220              '; W1AN-ANZ-TRA-OK = '       W1AN-AUFB3
079230              '; W1AN-ANZ-SCHU = '         W1AN-AUFB4
079240              '; I1AN-NA = '               W1AN-AUFB9
079250         DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
079260         PERFORM Q92-TRALOG-ZEILE
079270*V11 <-- --------------------------------------------------------
079280     PERFORM UNTIL SQLAX-SQLSTATE NOT = DB2-OK
079290       SET U1AX-TRAN-NICHT-IN-ANF  TO TRUE
079300
079310       PERFORM VARYING I1AN-TRA FROM 1 BY 1
079320       UNTIL I1AN-TRA  > W1AN-ANZ-SCHU
079330          OR U1AX-TRAN-IN-ANF
079340*V11 --> --------------------------------------------------------
079350         MOVE SPACE                     TO W1AX-TRALOG-TEXT
079360         MOVE S551AN-A-VS02-FEHLER-NR  (I1AN-TRA)
079370                                        TO W1AN-AUFB10
079380         MOVE I1AN-TRA                  TO W1AN-AUFB4
079390         MOVE W1AN-ANZ-SCHU             TO W1AN-AUFB10-V2
079400         MOVE B2X3AN-TEXT-TRANSPOND-STATUS
079410                                        TO W1AN-AUFB9
079420         STRING '9.S551AN-A-VS02-FEHLER-NR  (I1AN-TRA) = '
079430                                          W1AN-AUFB10
079440              '; I1AN-TRA = '             W1AN-AUFB4
079450              '; W1AN-ANZ-SCHU = '        W1AN-AUFB10-V2
079460              '; B2X3AX-TRANSPOND-ID = ' B2X3AX-TRANSPOND-ID
079470              '; S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA) = '
079480                 S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
079490              '; B2X3AN-TEXT-TRANSPOND-STATUS = '
079500                 W1AN-AUFB9
079510         DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
079520         PERFORM Q92-TRALOG-ZEILE
079530*V11 <-- --------------------------------------------------------
079540         IF B2X3AX-TRANSPOND-ID =
079550                        S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
079560           SET U1AX-TRAN-IN-ANF    TO TRUE
079570*V11 --> --------------------------------------------------------
079580           MOVE SPACE                     TO W1AX-TRALOG-TEXT
079590           STRING '9.a Transponder ' B2X3AX-TRANSPOND-ID
079600              ' in Anforderung'
079610           DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
079620           PERFORM Q92-TRALOG-ZEILE
079630*V11 <-- --------------------------------------------------------
079640         ELSE
079650           SET U1AX-TRAN-NICHT-IN-ANF
079660                                   TO TRUE
079670*V11 --> --------------------------------------------------------
079680           MOVE SPACE                     TO W1AX-TRALOG-TEXT
079690           STRING '9.b Transponder ' B2X3AX-TRANSPOND-ID
079700              ' nicht im Anforderung '
079710           DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
079720           PERFORM Q92-TRALOG-ZEILE
079730*V11 <-- --------------------------------------------------------
079740         END-IF
079750
079760       END-PERFORM
079770
079780       IF U1AX-TRAN-NICHT-IN-ANF
079790
079800         IF B2X3AN-TEXT-TRANSPOND-STATUS
079810                                   = K1AN-8043-VERSCHROTTET
079820         OR B2X3AN-TEXT-TRANSPOND-STATUS
079830                                   = K1AN-8086-AUFGEHOBEN
079840           CONTINUE
079850         ELSE
079860           ADD 1 TO I1AN-NA
079870           ADD 1 TO W1AN-ANZ-TRA-OK
079880           MOVE B2X3AX-BGRP
079890                TO S551AX-A-VS02-S-BGRP-NUMMER  (I1AN-NA)
079900           MOVE B2X3AX-TRANSPOND-ID
079910                TO S551AX-A-VS02-S-TRANSPOND-ID (I1AN-NA)
079920           MOVE 'FAZ'  TO S551AX-A-VS02-FEHLER-SYSTEM  (I1AN-NA)
079930*V11 IR
079940*          MOVE S540AN-A-TEXT-RC
079950           MOVE ZEROS
079960                       TO S551AN-A-VS02-FEHLER-NR      (I1AN-NA)
079970           MOVE ':'    TO S551AX-A-VS02-FEHLER-TRENN   (I1AN-NA)
079980           MOVE SPACE  TO S551AX-A-VS02-FEHLER-TEXT    (I1AN-NA)
079990           MOVE SPACE  TO S551AX-A-VS02-S-TRANSPOND-DL (I1AN-NA)
080000
080010*V11 --> --------------------------------------------------------
080020           MOVE SPACE                     TO W1AX-TRALOG-TEXT
080030           MOVE S551AN-A-VS02-FEHLER-NR (I1AN-NA)
080040                                          TO W1AN-AUFB10
080050           MOVE I1AN-NA                   TO W1AN-AUFB4
080060           MOVE W1AN-ANZ-TRA-OK           TO W1AN-AUFB10-V2
080070           MOVE B2X3AN-TEXT-TRANSPOND-STATUS
080080                                          TO W1AN-AUFB9
080090           STRING '9.c aufheben: '
080100                  ' S551AX-A-VS02-S-TRANSPOND-ID (I1AN-NA) = '
080110                       S551AX-A-VS02-S-TRANSPOND-ID (I1AN-NA)
080120              '; I1AN-NA = '                 W1AN-AUFB4
080130              '; W1AN-ANZ-TRA-OK = '         W1AN-AUFB10-V2
080140              '; S551AN-A-VS02-FEHLER-NR (I1AN-NA) = '
080150                                             W1AN-AUFB10
080160              '; B2X3AN-TEXT-TRANSPOND-STATUS = '
080170                                             W1AN-AUFB9
080180           DELIMITED BY SIZE            INTO W1AX-TRALOG-TEXT
080190           PERFORM Q92-TRALOG-ZEILE
080200*V11 <-- --------------------------------------------------------
080210
080220*V11b IR -->
080230           SET U1AX-D92C-AUFHEB-Y         TO TRUE
080240
080250           PERFORM D91C-WRITE-AUFGEH
080260           ADD 1 TO W1AN-ANZ-TRA-AUFGEHOBEN
080270         END-IF
080280       END-IF
080290
080300*      -- nächster
080310       PERFORM T-100-FEV2X3-FETCH
080320
080330     END-PERFORM
080340
080350     PERFORM T-100-FEV2X3-CLOSE
080360
080370*V11b IR -->
080380*ab hier weiter !!!
080390*    -- Lesen X30 zur VIN, wenn 1 Transp. mit 8082 / 8045
080400*    -- dann KeyTypen erhöhen
080410*    -- In FE01TVI0 und FEV01TVM die KEY-TYP-ID-ZAHL um 1 erhöhen
080420*    -- nur 1x machen. Wenn über FE540B gemacht, dann nicht mehr
080430     IF S540AX-E-KT-PLUS        = 'J'    AND
080440        W1AN-ANZ-TRA-X30        > ZERO   AND
080450        U1AX-D92C-AUFHEB-Y
080460
080470       PERFORM D61-KT-PLUS
080480     END-IF
080490
080500     MOVE '00;D91B-AUFGEH-SETZEN;Ende   ' TO W1AX-TRALOG-TEXT
080510     PERFORM Q92-TRALOG-ZEILE
080520
080530     CONTINUE.
080540 D91B-AUFGEH-SETZEN-END.
080550     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
080560       DISPLAY "++25889-->D91B-AUFGEH-SETZEN-END.       "
080570     DISPLAY "++W549AX-V-ID-TRACE = "
080580        W549AX-V-ID-TRACE                             *>++DELETE
080590     DISPLAY "++W549AN-TRACE-LEVEL = "
080600        W549AN-TRACE-LEVEL                            *>++DELETE
080610     END-IF                                           *>++DELETE
080620     EXIT.
080630*-----------------------------------------------------------------
080640*
080650*-----------------------------------------------------------------
080660 D91C-WRITE-AUFGEH  SECTION.
080670     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
080680       DISPLAY "++25889-->D91C-WRITE-AUFGEH  SECTION.   "
080690     DISPLAY "++W549AX-V-ID-TRACE = "
080700        W549AX-V-ID-TRACE                             *>++DELETE
080710     DISPLAY "++W549AN-TRACE-LEVEL = "
080720        W549AN-TRACE-LEVEL                            *>++DELETE
080730     END-IF                                           *>++DELETE
080740
080750     MOVE '00;D91C-WRITE-AUFGEH;Beginn ' TO W1AX-TRALOG-TEXT
080760     PERFORM Q92-TRALOG-ZEILE
080770
080780     INITIALIZE BXX3-DCLFEVXX3
080790     INITIALIZE BXX3-I-DCLFEVXX3
080800*    -- Insert FEVXX3 vorbereiten für inaktiv
080810     MOVE W549AX-LOG-UTC-V-ID      TO BXX3AX-UTC-V-ID
080820     MOVE S551AX-E-VIN             TO BXX3AX-VIN
080830     MOVE B2X3AX-TRANSPOND-ID      TO BXX3AX-TRANSPOND-ID
080840     MOVE B2X3AX-TRANSPOND-TYP     TO BXX3AX-TRANSPOND-TYP
080850     MOVE K1AN-8086-AUFGEHOBEN     TO BXX3AN-TEXT-TRANSPOND-STATUS
080860     MOVE B2X3AX-BGRP              TO BXX3AX-BGRP
080870     MOVE B2X3AN-I-BGRP            TO BXX3AN-I-BGRP
080880     MOVE B2X3AN-SKC0-KEY-TYP-ID   TO BXX3AN-SKC0-KEY-TYP-ID
080890     MOVE B2X3AN-I-SKC0-KEY-TYP-ID TO BXX3AN-I-SKC0-KEY-TYP-ID
080900     MOVE B2X3AN-SKC0-KEY-TYP-ID-ZAHL
080910                                   TO BXX3AN-SKC0-KEY-TYP-ID-ZAHL
080920     MOVE B2X3AN-I-SKC0-KEY-TYP-ID-ZAHL
080930                                 TO BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL
080940
080950     MOVE B2X3AN-TRANSPOND-ID-ZAHL TO BXX3AN-TRANSPOND-ID-ZAHL
080960     MOVE B2X3AN-PSS-FZ-ID-ZAHL    TO BXX3AN-PSS-FZ-ID-ZAHL
080970     MOVE B2X3AX-PSS-KRYPTOREGION  TO BXX3AX-PSS-KRYPTOREGION
080980     MOVE B2X3AX-PSS-BGRP          TO BXX3AX-PSS-BGRP
080990     MOVE B2X3AN-PSS-KEY-TYP-ID    TO BXX3AN-PSS-KEY-TYP-ID
081000     MOVE B2X3AN-PSS-KEY-TYP-ID-ZAHL
081010                                   TO BXX3AN-PSS-KEY-TYP-ID-ZAHL
081020     MOVE B2X3AN-PSS-VKMS-KEY-AUFBAU-VER
081030                                TO BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
081040     MOVE B2X3AX-PSS-VIN           TO BXX3AX-PSS-VIN
081050*    -- schreiben
081060     PERFORM T-100-FEVXX3-INSERT
081070
081080     MOVE '00;D91C-WRITE-AUFGEH;Ende'
081090                                   TO W1AX-TRALOG-TEXT
081100     PERFORM Q92-TRALOG-ZEILE
081110
081120     CONTINUE.
081130 D91C-WRITE-AUFGEH-END.
081140     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
081150       DISPLAY "++25889-->D91C-WRITE-AUFGEH-END.        "
081160     DISPLAY "++W549AX-V-ID-TRACE = "
081170        W549AX-V-ID-TRACE                             *>++DELETE
081180     DISPLAY "++W549AN-TRACE-LEVEL = "
081190        W549AN-TRACE-LEVEL                            *>++DELETE
081200     END-IF                                           *>++DELETE
081210     EXIT.
081220/
081230*-----------------------------------------------------------------
081240* FAZIT-TRANSPONDER-MARKIERUNG
081250* Prüfen, ob Markierungsgrund bereits vorliegt
081260*  - wenn nein, schreiben
081270*  - wenn ja, nicht schreiben
081280* Transponder-Markierung 8519 (Transponder in Produktion gelöscht)
081290* für alle Marken setzen
081300* Schreiben Markierung mit FE378
081310*-----------------------------------------------------------------
081320 D92-WRITE-TRANSP-MARK SECTION.
081330     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
081340       DISPLAY "++25889-->D92-WRITE-TRANSP-MARK SECTION."
081350     DISPLAY "++W549AX-V-ID-TRACE = "
081360        W549AX-V-ID-TRACE                             *>++DELETE
081370     DISPLAY "++W549AN-TRACE-LEVEL = "
081380        W549AN-TRACE-LEVEL                            *>++DELETE
081390     END-IF                                           *>++DELETE
081400
081410     MOVE '00;D92-WRITE-TRANSP-MARK;Beginn ' TO W1AX-TRALOG-TEXT
081420     PERFORM Q92-TRALOG-ZEILE
081430
081440     INITIALIZE S378
081450
081460     MOVE 'N'                      TO S378AX-VGL-KZ
081470     MOVE W549AX-LOG-V-ID          TO S378AX-V-ID
081480     MOVE S551AX-E-VS02-S-TRANSPOND-ID (I1AN-TRA)
081490                                   TO S378AX-TRANSPOND-ID
081500     MOVE S540AX-A-TRANSPOND-FAM   TO S378AX-TRANSPOND-FAM
081510*    -- MARKIERUNG Transponder in Produktion gelöscht
081520     MOVE K1AN-MARKIERUNG-8519     TO S378AN-TEXT-MARKIERUNG
081530     MOVE SPACE                    TO S378AX-LKZ2
081540                                      S378AX-MARKE
081550     MOVE 'FE549C'                 TO S378AX-USER-ID-MELDUNG
081560     MOVE SPACE                    TO S378AX-INAKTIV-VON
081570                                      S378AX-INAKTIV-BIS
081580                                      S378AX-VORGANGSNR
081590     MOVE 'N'                      TO S378AX-LOESCH-KZ
081600     MOVE -1                       TO S378AN-I-INAKTIV-VON
081610                                      S378AN-I-INAKTIV-BIS
081620
081630     MOVE S378AX-TRANSPOND-ID      TO B04HAX-TRANSPOND-ID
081640     MOVE S378AN-TEXT-MARKIERUNG   TO B04HAN-TEXT-MARKIERUNG
081650*    -- Lesen T4H mit Transp.-ID, TEXT_MARKIERUNG=8519
081660     PERFORM T-100-FEV04H-SELECT
081670
081680     IF SQLAX-SQLSTATE = DB2-OK
081690      AND B04HAX-LOESCH-KZ = 'N'
081700       MOVE K1AN-OK                TO W549AN-TEXT-FEHLER-KLASSE
081710     ELSE
081720       PERFORM D93-TRANSPOND-MARKIERUNG
081730*      -- FE333AN-TEXT-RC in S551AN-A-VS02-FEHLER-NR
081740
081750*      -- LESEN ALLE VORHANDENEN MARKEN UND SETZEN DER MARKIERUNG
081760       INITIALIZE B045-DCLFEV045
081770       PERFORM T-100-FEV045-OPEN
081780       PERFORM T-100-FEV045-FETCH
081790       PERFORM UNTIL SQLAX-SQLSTATE NOT = DB2-OK
081800
081810         MOVE B045AX-WFS-MARKE       TO S378AX-MARKE
081820*        -- SETZEN DER MARKIERUNG
081830         CALL FE378C USING S378
081840
081850         MOVE S378AN-TEXT-RC         TO W549AN-TEXT-RC
081860         MOVE S378AN-TEXT-FEHLER-KLASSE
081870                                     TO W549AN-TEXT-FEHLER-KLASSE
081880         MOVE S378AX-BESCHREIBUNG    TO W549AX-BESCHREIBUNG
081890         MOVE S378AX-FEHLER-PARM     TO W549AX-FEHLER-PARM
081900         MOVE S378AX-SQLCA           TO SQL-SQLCA
081910
081920         EVALUATE SQLAX-SQLSTATE
081930           WHEN DB2-OK CONTINUE
081940           WHEN OTHER
081950             PERFORM Z80-DB2-FEHLER
081960         END-EVALUATE
081970
081980         PERFORM T-100-FEV045-FETCH
081990       END-PERFORM
082000       PERFORM T-100-FEV045-CLOSE
082010     END-IF
082020
082030     MOVE '00;D92-WRITE-TRANSP-MARK;Ende'
082040                                   TO W1AX-TRALOG-TEXT
082050     PERFORM Q92-TRALOG-ZEILE
082060
082070     CONTINUE.
082080 D92-WRITE-TRANSP-MARK-END.
082090     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
082100       DISPLAY "++25889-->D92-WRITE-TRANSP-MARK-END.    "
082110     DISPLAY "++W549AX-V-ID-TRACE = "
082120        W549AX-V-ID-TRACE                             *>++DELETE
082130     DISPLAY "++W549AN-TRACE-LEVEL = "
082140        W549AN-TRACE-LEVEL                            *>++DELETE
082150     END-IF                                           *>++DELETE
082160     EXIT.
082170/
082180*-----------------------------------------------------------------
082190* MARKIERUNGEN ERMITTELN FÜR DIE Transponder-ID
082200* EINGABE: S540AX-E-TRANSPOND-ID
082210*          S540AX-A-TRANSPOND-FAM
082220*          S540AX-A-WFS-MARKE
082230* AUSGABE: AK-TRANSPONDER
082240*-----------------------------------------------------------------
082250 D93-TRANSPOND-MARKIERUNG SECTION.
082260     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
082270       DISPLAY "++25889-->D93-TRANSPOND-MARKIERUNG SECTI"
082280     DISPLAY "++W549AX-V-ID-TRACE = "
082290        W549AX-V-ID-TRACE                             *>++DELETE
082300     DISPLAY "++W549AN-TRACE-LEVEL = "
082310        W549AN-TRACE-LEVEL                            *>++DELETE
082320     END-IF                                           *>++DELETE
082330
082340     MOVE '00;D93-TRANSPOND-MARKIERUNG;Beginn '
082350                                   TO W1AX-TRALOG-TEXT
082360     PERFORM Q92-TRALOG-ZEILE
082370
082380     INITIALIZE SP333-BEREICH1
082390
082400     MOVE '05'                     TO SP333AX-AKTION
082410     MOVE S540AX-E-TRANSPOND-ID    TO SP333AX-TRANSPOND-ID
082420     MOVE S540AX-A-TRANSPOND-FAM   TO SP333AX-TRANSPOND-FAM
082430     MOVE S540AX-A-WFS-MARKE       TO SP333AX-TRANSPOND-FZ-MARKE
082440
082450     CALL FE333C USING SP333-BEREICH1
082460                       SP333-BEREICH2-STD
082470
082480     IF SP333AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
082490       CONTINUE
082500     ELSE
082510*      -- Fehler aus Mark.Prf. soll nicht zurückgeg. werden
082520       MOVE ZERO                 TO S551AN-A-VS02-FEHLER-NR
082530                                                    (I1AN-TRA)
082540     END-IF
082550
082560     IF SP333AN-TEXT-FEHLER-KLASSE = K1AN-SYSTEM
082570       PERFORM Z90-PGM-EXIT
082580     END-IF
082590
082600*    -- ÜBERNEHMEN MARKIERUNGSINFORMATIONEN IN AK-TRANSPONDER
082610*    -- nur fuer Beobachtungen
082620     PERFORM VARYING I1AN-1 FROM 1 BY 1
082630               UNTIL I1AN-1 > SP333AN-TRC-ANZAHL
082640       IF SP333A8-TRC-NACH-AUSK-TRAN    (I1AN-1)
082650*        -- den Text-RC für Auskunft Transponder vormerken
082660         MOVE SP333AN-TRC-TEXT-RC(I1AN-1)
082670                                   TO W1AN-TEXT-RC
082680         MOVE SP333AN-TRC-TEXT-FEHLER-KLASSE (I1AN-1)
082690                                   TO W1AN-TEXT-FEHLER-KLASSE
082700         PERFORM D93A-TAB-AK-TRANSP
082710       END-IF
082720     END-PERFORM
082730
082740     MOVE '00;D93-TRANSPOND-MARKIERUNG;Ende'
082750                                   TO W1AX-TRALOG-TEXT
082760     PERFORM Q92-TRALOG-ZEILE
082770
082780     CONTINUE.
082790 D93-TRANSPOND-MARKIERUNG-END.
082800     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
082810       DISPLAY "++25889-->D93-TRANSPOND-MARKIERUNG-END. "
082820     DISPLAY "++W549AX-V-ID-TRACE = "
082830        W549AX-V-ID-TRACE                             *>++DELETE
082840     DISPLAY "++W549AN-TRACE-LEVEL = "
082850        W549AN-TRACE-LEVEL                            *>++DELETE
082860     END-IF                                           *>++DELETE
082870     EXIT.
082880/
082890*-----------------------------------------------------------------
082900* Transponder schreiben
082910* mit den Werten aus der W1AX-TRANSP-TAB
082920* und Status 8082 DOWNLOAD 4 ERZEUGT
082930* wenn Status bereits 8082=Wiederholanfr.
082940*             ID-Zahl aus X30 statt ADD 1
082950*             nicht mehr schreiben
082960*-----------------------------------------------------------------
082970 D93A-TAB-AK-TRANSP    SECTION.
082980     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
082990       DISPLAY "++25889-->D93A-TAB-AK-TRANSP    SECTION."
083000     DISPLAY "++W549AX-V-ID-TRACE = "
083010        W549AX-V-ID-TRACE                             *>++DELETE
083020     DISPLAY "++W549AN-TRACE-LEVEL = "
083030        W549AN-TRACE-LEVEL                            *>++DELETE
083040     END-IF                                           *>++DELETE
083050
083060     ADD 1 TO TXX4AN-I
083070
083080     IF TXX4AN-I                   > TXX4AN-TAB-MAX
083090*      -- PROGRAMMFEHLER
083100*      -- aber nicht nach aussen melden
083110       MOVE SPACE                TO W1AX-TRALOG-TEXT
083120       MOVE TXX4AN-TAB-MAX       TO W1AN-AUFB4
083130       STRING ' D93A-TAB-AK-TRANSP - Tabellenüberlauf'
083140              ' mehr als ' W1AN-AUFB4 ' Elemente'
083150              ' beim Eintrag in VKMS AK-Transponder (FE01TX40)'
083160       DELIMITED BY SIZE       INTO W1AX-TRALOG-TEXT
083170       PERFORM Q92-TRALOG-ZEILE
083180     ELSE
083190*      -- TRANSPOND-ID UND -TYP AUS EINGABE, DA NUR EINER MÖGLICH
083200       MOVE S540AX-E-TRANSPOND-ID  TO
083210                                    TXX4AX-TRANSPOND-ID (TXX4AN-I)
083220       MOVE S540AX-E-TRANSPOND-TYP TO
083230                                    TXX4AX-TRANSPOND-TYP(TXX4AN-I)
083240       MOVE W1AN-TEXT-RC           TO TXX4AN-TEXT-VERARB(TXX4AN-I)
083250       MOVE W1AN-TEXT-FEHLER-KLASSE
083260                            TO TXX4AN-TEXT-FEHLER-KLASSE(TXX4AN-I)
083270     END-IF
083280
083290     CONTINUE.
083300 D93A-TAB-AK-TRANSP-END.
083310     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
083320       DISPLAY "++25889-->D93A-TAB-AK-TRANSP-END.       "
083330     DISPLAY "++W549AX-V-ID-TRACE = "
083340        W549AX-V-ID-TRACE                             *>++DELETE
083350     DISPLAY "++W549AN-TRACE-LEVEL = "
083360        W549AN-TRACE-LEVEL                            *>++DELETE
083370     END-IF                                           *>++DELETE
083380     EXIT.
083390/
083400*-----------------------------------------------------------------
083410* Transponder schreiben
083420* mit den Werten aus der W1AX-TRANSP-TAB
083430* und Status 8082 DOWNLOAD 4 ERZEUGT
083440* wenn Status bereits 8082=Wiederholanfr.
083450*             ID-Zahl aus X30 statt ADD 1
083460*             nicht mehr schreiben
083470*-----------------------------------------------------------------
083480 D95-WRITE-TRANSP-DT02 SECTION.
083490     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
083500       DISPLAY "++25889-->D95-WRITE-TRANSP-DT02 SECTION."
083510     DISPLAY "++W549AX-V-ID-TRACE = "
083520        W549AX-V-ID-TRACE                             *>++DELETE
083530     DISPLAY "++W549AN-TRACE-LEVEL = "
083540        W549AN-TRACE-LEVEL                            *>++DELETE
083550     END-IF                                           *>++DELETE
083560
083570     MOVE '00;D95-WRITE-TRANSP-DT02;Beginn ' TO W1AX-TRALOG-TEXT
083580     PERFORM Q92-TRALOG-ZEILE
083590
083600*    -- Indikatoren auf 0 setzen
083610     INITIALIZE BXX3-I-DCLFEVXX3
083620
083630     MOVE W549AX-LOG-UTC-V-ID      TO BXX3AX-UTC-V-ID
083640     MOVE S551AX-E-VIN             TO BXX3AX-VIN
083650*    -- Werte aus den Hilfsfeldern (aus FE540) übernehmen
083660     MOVE W1AX-TRANSPOND-ID (I1AN-TRA)
083670                                   TO BXX3AX-TRANSPOND-ID
083680     MOVE W1AX-TRANSPOND-TYP (I1AN-TRA)
083690                                   TO BXX3AX-TRANSPOND-TYP
083700     MOVE W1AX-TRANSPOND-BGRP (I1AN-TRA)
083710                                   TO BXX3AX-BGRP
083720     MOVE W1AN-SKC0-KEY-TYP-ID  (I1AN-TRA)
083730                                   TO BXX3AN-SKC0-KEY-TYP-ID
083740     MOVE W1AN-SKC0-KEY-TYP-ID-ZAHL (I1AN-TRA)
083750                                   TO BXX3AN-SKC0-KEY-TYP-ID-ZAHL
083760     MOVE W1AN-TRANSPOND-ID-ZAHL (I1AN-TRA)
083770                                   TO BXX3AN-TRANSPOND-ID-ZAHL
083780     MOVE W1AN-PSS-FZ-ID-ZAHL (I1AN-TRA)
083790                                   TO BXX3AN-PSS-FZ-ID-ZAHL
083800     MOVE W1AX-PSS-KRYPTOREGION (I1AN-TRA)
083810                                   TO BXX3AX-PSS-KRYPTOREGION
083820     MOVE W1AX-PSS-BGRP (I1AN-TRA) TO BXX3AX-PSS-BGRP
083830     MOVE W1AN-PSS-KEY-TYP-ID (I1AN-TRA)
083840                                   TO BXX3AN-PSS-KEY-TYP-ID
083850     MOVE W1AN-PSS-KEY-TYP-ID-ZAHL (I1AN-TRA)
083860                                   TO BXX3AN-PSS-KEY-TYP-ID-ZAHL
083870     MOVE W1AN-PSS-VKMS-KEY-AUF-VER (I1AN-TRA)
083880                                 TO BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
083890     MOVE W1AX-PSS-VIN  (I1AN-TRA) TO BXX3AX-PSS-VIN
083900
083910     IF W1AX-TRANSP-SCHREIBEN (I1AN-TRA) = 'J'
083920       MOVE 8082                   TO BXX3AN-TEXT-TRANSPOND-STATUS
083930*      -- Die ID-ZAHL ist noch 0 (vom 8080) und wird hier jetzt
083940*      -- um 1 erhöht, weil ja der DL4 erzeugt wurde
083950       ADD 1                       TO BXX3AN-TRANSPOND-ID-ZAHL
083960       PERFORM T-100-FEVXX3-INSERT
083970     ELSE
083980       MOVE DB2-OK                 TO SQLSTATE
083990     END-IF
084000
084010     IF SQLSTATE = DB2-OK
084020       MOVE W1AX-TRANSPOND-BGRP (I1AN-TRA)
084030                    TO S551AX-A-DT02-TSP-BGRP-NUMMER  (I1AN-TRA)
084040       MOVE W1AX-TRANSPOND-ID (I1AN-TRA)
084050                    TO S551AX-A-DT02-TSP-TRANSPOND-ID (I1AN-TRA)
084060       MOVE W1AX-TRANSP-DL4-TEXT (I1AN-TRA)
084070                       (1:W1AN-TRANSP-DL4-LEN (I1AN-TRA))
084080                    TO S551AX-A-DT02-TSP-TRANSPOND-DL (I1AN-TRA)
084090     END-IF
084100
084110     MOVE '00;D95-WRITE-TRANSP-DT02;Ende   ' TO W1AX-TRALOG-TEXT
084120     PERFORM Q92-TRALOG-ZEILE
084130
084140     CONTINUE.
084150 D95-WRITE-TRANSP-DT02-END.
084160     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
084170       DISPLAY "++25889-->D95-WRITE-TRANSP-DT02-END.    "
084180     DISPLAY "++W549AX-V-ID-TRACE = "
084190        W549AX-V-ID-TRACE                             *>++DELETE
084200     DISPLAY "++W549AN-TRACE-LEVEL = "
084210        W549AN-TRACE-LEVEL                            *>++DELETE
084220     END-IF                                           *>++DELETE
084230     EXIT.
084240/
084250*-----------------------------------------------------------------
084260* Transponder schreiben
084270* mit den Werten aus der W1AX-TRANSP-TAB
084280* und Status 8045 AKTIV
084290*-----------------------------------------------------------------
084300 D96-WRITE-TRANSP-TRA4 SECTION.
084310     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
084320       DISPLAY "++25889-->D96-WRITE-TRANSP-TRA4 SECTION."
084330     DISPLAY "++W549AX-V-ID-TRACE = "
084340        W549AX-V-ID-TRACE                             *>++DELETE
084350     DISPLAY "++W549AN-TRACE-LEVEL = "
084360        W549AN-TRACE-LEVEL                            *>++DELETE
084370     END-IF                                           *>++DELETE
084380
084390     MOVE '00;D96-WRITE-TRANSP-TRA4;Beginn ' TO W1AX-TRALOG-TEXT
084400     PERFORM Q92-TRALOG-ZEILE
084410
084420*    -- Indikatoren auf 0 setzen
084430     INITIALIZE BXX3-I-DCLFEVXX3
084440
084450     MOVE W549AX-LOG-UTC-V-ID      TO BXX3AX-UTC-V-ID
084460     MOVE S551AX-E-VIN             TO BXX3AX-VIN
084470*    -- Werte aus den Hilfsfeldern (aus FE540) übernehmen
084480     MOVE W1AX-TRANSPOND-ID (I1AN-TRA)
084490                                   TO BXX3AX-TRANSPOND-ID
084500     MOVE W1AX-TRANSPOND-TYP (I1AN-TRA)
084510                                   TO BXX3AX-TRANSPOND-TYP
084520     MOVE W1AX-TRANSPOND-BGRP (I1AN-TRA)
084530                                   TO BXX3AX-BGRP
084540     MOVE W1AN-SKC0-KEY-TYP-ID  (I1AN-TRA)
084550                                   TO BXX3AN-SKC0-KEY-TYP-ID
084560     MOVE W1AN-SKC0-KEY-TYP-ID-ZAHL (I1AN-TRA)
084570                                   TO BXX3AN-SKC0-KEY-TYP-ID-ZAHL
084580     MOVE W1AN-TRANSPOND-ID-ZAHL (I1AN-TRA)
084590                                   TO BXX3AN-TRANSPOND-ID-ZAHL
084600     MOVE W1AN-PSS-FZ-ID-ZAHL (I1AN-TRA)
084610                                   TO BXX3AN-PSS-FZ-ID-ZAHL
084620     MOVE W1AX-PSS-KRYPTOREGION (I1AN-TRA)
084630                                   TO BXX3AX-PSS-KRYPTOREGION
084640     MOVE W1AX-PSS-BGRP (I1AN-TRA) TO BXX3AX-PSS-BGRP
084650     MOVE W1AN-PSS-KEY-TYP-ID (I1AN-TRA)
084660                                   TO BXX3AN-PSS-KEY-TYP-ID
084670     MOVE W1AN-PSS-KEY-TYP-ID-ZAHL (I1AN-TRA)
084680                                   TO BXX3AN-PSS-KEY-TYP-ID-ZAHL
084690     MOVE W1AN-PSS-VKMS-KEY-AUF-VER (I1AN-TRA)
084700                                 TO BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
084710     MOVE W1AX-PSS-VIN  (I1AN-TRA) TO BXX3AX-PSS-VIN
084720
084730     IF W1AX-TRANSP-SCHREIBEN (I1AN-TRA) = 'J'
084740       MOVE 8045                   TO BXX3AN-TEXT-TRANSPOND-STATUS
084750       PERFORM T-100-FEVXX3-INSERT
084760     ELSE
084770       MOVE DB2-OK                 TO SQLSTATE
084780     END-IF
084790
084800     IF SQLSTATE = DB2-OK
084810       MOVE W1AX-TRANSPOND-BGRP  (I1AN-TRA)
084820                    TO S551AX-A-TRA4-TSP-BGRP-NUMMER  (I1AN-TRA)
084830       MOVE W1AX-TRANSPOND-ID (I1AN-TRA)
084840                    TO S551AX-A-TRA4-TSP-TRANSPOND-ID (I1AN-TRA)
084850       MOVE W1AN-FEHLER-NR       (I1AN-TRA)
084860                       TO S551AN-A-TRA4-FEHLER-NR     (I1AN-TRA)
084870       MOVE W1AX-FEHLER-TEXT     (I1AN-TRA)
084880                       TO S551AX-A-TRA4-FEHLER-TEXT   (I1AN-TRA)
084890       MOVE 'FAZ'      TO S551AX-A-TRA4-FEHLER-SYSTEM (I1AN-TRA)
084900       MOVE ': '       TO S551AX-A-TRA4-FEHLER-TRENN  (I1AN-TRA)
084910     END-IF
084920
084930     MOVE '00;D96-WRITE-TRANSP-TRA4;Ende   ' TO W1AX-TRALOG-TEXT
084940     PERFORM Q92-TRALOG-ZEILE
084950
084960     CONTINUE.
084970 D96-WRITE-TRANSP-TRA4-END.
084980     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
084990       DISPLAY "++25889-->D96-WRITE-TRANSP-TRA4-END.    "
085000     DISPLAY "++W549AX-V-ID-TRACE = "
085010        W549AX-V-ID-TRACE                             *>++DELETE
085020     DISPLAY "++W549AN-TRACE-LEVEL = "
085030        W549AN-TRACE-LEVEL                            *>++DELETE
085040     END-IF                                           *>++DELETE
085050     EXIT.
085060/
085070*-----------------------------------------------------------------
085080* FAZIT-FAHRZEUG SCHREIBEN
085090* mit neuer Garnitur-Serie-Nr
085100*-----------------------------------------------------------------
085110 D97-WRITE-FZ-ZUORD SECTION.
085120     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
085130       DISPLAY "++25889-->D97-WRITE-FZ-ZUORD SECTION.   "
085140     DISPLAY "++W549AX-V-ID-TRACE = "
085150        W549AX-V-ID-TRACE                             *>++DELETE
085160     DISPLAY "++W549AN-TRACE-LEVEL = "
085170        W549AN-TRACE-LEVEL                            *>++DELETE
085180     END-IF                                           *>++DELETE
085190
085200     MOVE '00;D97-WRITE-FZ-ZUORD;Beginn' TO W1AX-TRALOG-TEXT
085210     PERFORM Q92-TRALOG-ZEILE
085220
085230     INITIALIZE S778-DATEN
085240     MOVE 'N'                    TO S778AX-VGL-KZ
085250*      -- FZ-Daten aus FE540B = alte Werte
085260     MOVE S540-A-FAHRZEUG        TO S778-DCLFE01T08
085270     MOVE S540-A-I-FAHRZEUG      TO S778-I-DCLFE01T08
085280*      -- neue Werte
085290     IF S540AX-E-SCHLIESS-SATZ = SPACE
085300       MOVE S540AX-E-PIN-LABEL-GARN-SNR
085310                                   TO S778AX-GARNITUR-SERIE-NR
085320     ELSE
085330       MOVE S540AX-E-SCHLIESS-SATZ TO S778AX-GARNITUR-SERIE-NR
085340     END-IF
085350
085360*    -- wenn Satz zur VIN mit der Garn-SN, o.k., sonst schreiben
085370     INITIALIZE V208-DCLFEV208
085380     MOVE HIGH-VALUE               TO V208-I-DCLFEV208
085390     MOVE S551AX-E-VIN             TO V208AX-VIN
085400     PERFORM T-100-FEV208-SELECT
085410
085420     IF SQLAX-SQLSTATE = DB2-OK
085430       IF V208AX-GARNITUR-SERIE-NR = S778AX-GARNITUR-SERIE-NR
085440         MOVE 'N'                  TO W1AX-FE778-CALL
085450       ELSE
085460         MOVE 'J'                  TO W1AX-FE778-CALL
085470       END-IF
085480     ELSE
085490       MOVE 'J'                    TO W1AX-FE778-CALL
085500     END-IF
085510
085520     IF W1AX-FE778-CALL = 'J'
085530       CALL FE778C USING S778-DATEN
085540
085550       MOVE S778AX-SQLCA           TO SQL-SQLCA
085560
085570       EVALUATE SQLAX-SQLSTATE
085580         WHEN DB2-OK
085590           CONTINUE
085600         WHEN OTHER
085610           MOVE S778AN-TEXT-RC     TO  W549AN-TEXT-RC
085620           MOVE S778AN-TEXT-FEHLER-KLASSE
085630                                   TO W549AN-TEXT-FEHLER-KLASSE
085640           MOVE S778AX-BESCHREIBUNG
085650                                   TO W549AX-BESCHREIBUNG
085660           MOVE S778AX-FEHLER-PARM TO W549AX-FEHLER-PARM
085670           PERFORM Z80-DB2-FEHLER
085680       END-EVALUATE
085690     END-IF
085700
085710     MOVE '00;D97-WRITE-FZ-ZUORD;Ende  ' TO W1AX-TRALOG-TEXT
085720     PERFORM Q92-TRALOG-ZEILE
085730
085740     CONTINUE.
085750 D97-WRITE-FZ-ZUORD-END.
085760     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
085770       DISPLAY "++25889-->D97-WRITE-FZ-ZUORD-END.       "
085780     DISPLAY "++W549AX-V-ID-TRACE = "
085790        W549AX-V-ID-TRACE                             *>++DELETE
085800     DISPLAY "++W549AN-TRACE-LEVEL = "
085810        W549AN-TRACE-LEVEL                            *>++DELETE
085820     END-IF                                           *>++DELETE
085830     EXIT.
085840/
085850*-----------------------------------------------------------------
085860* FAZIT-FAHRZEUG SCHREIBEN
085870* mit leere Garnitur-Serie-Nr
085880*-----------------------------------------------------------------
085890 D96A-WRITE-FZ-AUFHEB SECTION.
085900     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
085910       DISPLAY "++25889-->D96A-WRITE-FZ-AUFHEB SECTION. "
085920     DISPLAY "++W549AX-V-ID-TRACE = "
085930        W549AX-V-ID-TRACE                             *>++DELETE
085940     DISPLAY "++W549AN-TRACE-LEVEL = "
085950        W549AN-TRACE-LEVEL                            *>++DELETE
085960     END-IF                                           *>++DELETE
085970
085980     MOVE '00;D96A-WRITE-FZ-AUFHEB;Beginn'
085990                                 TO W1AX-TRALOG-TEXT
086000     PERFORM Q92-TRALOG-ZEILE
086010
086020     INITIALIZE S778-DATEN
086030     MOVE 'N'                    TO S778AX-VGL-KZ
086040*      -- FZ-Daten aus FE540B = alte Werte
086050     MOVE S540-A-FAHRZEUG        TO S778-DCLFE01T08
086060     MOVE S540-A-I-FAHRZEUG      TO S778-I-DCLFE01T08
086070*      -- neue Werte
086080     MOVE SPACE                  TO S778AX-GARNITUR-SERIE-NR
086090
086100*    -- wenn Satz zur VIN mit der Garn-SN, o.k., sonst schreiben
086110     INITIALIZE V208-DCLFEV208
086120     MOVE HIGH-VALUE               TO V208-I-DCLFEV208
086130     MOVE S551AX-E-VIN             TO V208AX-VIN
086140     PERFORM T-100-FEV208-SELECT
086150
086160     IF SQLAX-SQLSTATE = DB2-OK
086170       IF V208AX-GARNITUR-SERIE-NR = SPACE
086180         CONTINUE
086190       ELSE
086200         CALL FE778C USING S778-DATEN
086210
086220         MOVE S778AX-SQLCA           TO SQL-SQLCA
086230
086240         EVALUATE SQLAX-SQLSTATE
086250           WHEN DB2-OK
086260             CONTINUE
086270           WHEN OTHER
086280             MOVE S778AN-TEXT-RC     TO W549AN-TEXT-RC
086290             MOVE S778AN-TEXT-FEHLER-KLASSE
086300                                     TO W549AN-TEXT-FEHLER-KLASSE
086310             MOVE S778AX-BESCHREIBUNG
086320                                     TO W549AX-BESCHREIBUNG
086330             MOVE S778AX-FEHLER-PARM TO W549AX-FEHLER-PARM
086340             PERFORM Z80-DB2-FEHLER
086350         END-EVALUATE
086360       END-IF
086370     END-IF
086380
086390     MOVE '00;D96A-WRITE-FZ-AUFHEB;Ende  '
086400                                 TO W1AX-TRALOG-TEXT
086410     PERFORM Q92-TRALOG-ZEILE
086420
086430     CONTINUE.
086440 D96A-WRITE-FZ-AUFHEB-END.
086450     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
086460       DISPLAY "++25889-->D96A-WRITE-FZ-AUFHEB-END.     "
086470     DISPLAY "++W549AX-V-ID-TRACE = "
086480        W549AX-V-ID-TRACE                             *>++DELETE
086490     DISPLAY "++W549AN-TRACE-LEVEL = "
086500        W549AN-TRACE-LEVEL                            *>++DELETE
086510     END-IF                                           *>++DELETE
086520     EXIT.
086530/
086540*-----------------------------------------------------------------
086550* schreiben FE01T05 Fz-Baugruppe
086560*-----------------------------------------------------------------
086570 D97-WRITE-BGRP-LOEKZ-N SECTION.
086580     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
086590       DISPLAY "++25889-->D97-WRITE-BGRP-LOEKZ-N SECTION"
086600     DISPLAY "++W549AX-V-ID-TRACE = "
086610        W549AX-V-ID-TRACE                             *>++DELETE
086620     DISPLAY "++W549AN-TRACE-LEVEL = "
086630        W549AN-TRACE-LEVEL                            *>++DELETE
086640     END-IF                                           *>++DELETE
086650
086660     MOVE '00;D97-WRITE-BGRP-LOEKZ-N;Beginn'
086670                                 TO W1AX-TRALOG-TEXT
086680     PERFORM Q92-TRALOG-ZEILE
086690
086700     INITIALIZE S775-DATEN
086710
086720     MOVE 'N'                    TO S775AX-VGL-KZ
086730
086740     MOVE W549AX-LOG-V-ID        TO S775AX-V-ID
086750     MOVE '007'                  TO S775AX-BGRP
086760     MOVE S551AX-E-VIN           TO S775AX-VIN
086770     MOVE '007'                  TO S775AX-BGRP-FAM
086780     MOVE S540AX-A-SCHLIESS-SATZ-NEU
086790                                 TO S775AX-BGRP-INHALT
086800     MOVE 'N'                    TO S775AX-LOESCH-KZ
086810     MOVE -1                     TO S775AN-I-PIN
086820     MOVE -1                     TO S775AN-I-SKC
086830     MOVE -1                     TO S775AN-I-IKA
086840     MOVE -1                     TO S775AN-I-KOMP-S-TYP
086850     MOVE -1                     TO S775AN-I-TEXT-IKA-ART
086860     MOVE -1                     TO S775AN-I-TEXT-MEK-ART
086870
086880     INITIALIZE B205-DCLFEV205
086890                B205-I-DCLFEV205
086900
086910     MOVE S775AX-VIN               TO B205AX-VIN
086920     MOVE S775AX-BGRP              TO B205AX-BGRP
086930     MOVE S775AX-BGRP-FAM          TO B205AX-BGRP-FAM
086940*    -- Lesen zur BGRP=007
086950     PERFORM T-100-FEV205-SELECT
086960
086970     IF SQLAX-SQLSTATE = DB2-OK
086980       IF B205AX-BGRP-INHALT       = S775AX-BGRP-INHALT
086990
087000         IF B205AX-LOESCH-KZ = 'N'
087010           MOVE 'N'                TO W1AX-FE775-CALL
087020         ELSE
087030           MOVE 'J'                TO W1AX-FE775-CALL
087040         END-IF
087050
087060       ELSE
087070         MOVE 'N'                  TO W1AX-FE775-CALL
087080       END-IF
087090
087100     ELSE
087110       MOVE 'J'                TO W1AX-FE775-CALL
087120     END-IF
087130
087140     IF W1AX-FE775-CALL            = 'J'
087150       CALL FE775C USING S775-DATEN
087160
087170       MOVE S775AX-SQLCA         TO SQL-SQLCA
087180
087190       EVALUATE SQLAX-SQLSTATE
087200         WHEN DB2-OK
087210           CONTINUE
087220         WHEN OTHER
087230           MOVE S775AN-TEXT-RC   TO W549AN-TEXT-RC
087240           MOVE S775AN-TEXT-FEHLER-KLASSE
087250                                 TO W549AN-TEXT-FEHLER-KLASSE
087260           MOVE S775AX-BESCHREIBUNG
087270                                 TO W549AX-BESCHREIBUNG
087280           MOVE S775AX-FEHLER-PARM
087290                                 TO W549AX-FEHLER-PARM
087300           PERFORM Z80-DB2-FEHLER
087310       END-EVALUATE
087320     END-IF
087330
087340     MOVE '00;D97-WRITE-BGRP-LOEKZ-N;Ende  '
087350                                 TO W1AX-TRALOG-TEXT
087360     PERFORM Q92-TRALOG-ZEILE
087370
087380     CONTINUE.
087390 D97-WRITE-BGRP-LOEKZ-N-END.
087400     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
087410       DISPLAY "++25889-->D97-WRITE-BGRP-LOEKZ-N-END.   "
087420     DISPLAY "++W549AX-V-ID-TRACE = "
087430        W549AX-V-ID-TRACE                             *>++DELETE
087440     DISPLAY "++W549AN-TRACE-LEVEL = "
087450        W549AN-TRACE-LEVEL                            *>++DELETE
087460     END-IF                                           *>++DELETE
087470     EXIT.
087480/
087490*-----------------------------------------------------------------
087500* schreiben FE01T05 Fz-Baugruppe
087510*-----------------------------------------------------------------
087520 D98-WRITE-BGRP-LOEKZ-J SECTION.
087530     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
087540       DISPLAY "++25889-->D98-WRITE-BGRP-LOEKZ-J SECTION"
087550     DISPLAY "++W549AX-V-ID-TRACE = "
087560        W549AX-V-ID-TRACE                             *>++DELETE
087570     DISPLAY "++W549AN-TRACE-LEVEL = "
087580        W549AN-TRACE-LEVEL                            *>++DELETE
087590     END-IF                                           *>++DELETE
087600
087610     MOVE '00;D98-WRITE-BGRP-LOEKZ-J;Beginn'
087620                                 TO W1AX-TRALOG-TEXT
087630     PERFORM Q92-TRALOG-ZEILE
087640
087650     INITIALIZE S775-DATEN
087660
087670     MOVE 'N'                    TO S775AX-VGL-KZ
087680
087690     MOVE W549AX-LOG-V-ID        TO S775AX-V-ID
087700     MOVE '007'                  TO S775AX-BGRP
087710     MOVE S551AX-E-VIN           TO S775AX-VIN
087720     MOVE '007'                  TO S775AX-BGRP-FAM
087730     MOVE S540AX-A-SCHLIESS-SATZ-NEU
087740                                 TO S775AX-BGRP-INHALT
087750     MOVE 'J'                    TO S775AX-LOESCH-KZ
087760     MOVE -1                     TO S775AN-I-PIN
087770     MOVE -1                     TO S775AN-I-SKC
087780     MOVE -1                     TO S775AN-I-IKA
087790     MOVE -1                     TO S775AN-I-KOMP-S-TYP
087800     MOVE -1                     TO S775AN-I-TEXT-IKA-ART
087810     MOVE -1                     TO S775AN-I-TEXT-MEK-ART
087820
087830     INITIALIZE B205-DCLFEV205
087840                B205-I-DCLFEV205
087850
087860     MOVE S775AX-VIN               TO B205AX-VIN
087870     MOVE S775AX-BGRP              TO B205AX-BGRP
087880     MOVE S775AX-BGRP-FAM          TO B205AX-BGRP-FAM
087890
087900*    -- Lesen zur BGRP=007
087910     PERFORM T-100-FEV205-SELECT
087920
087930     IF SQLAX-SQLSTATE = DB2-OK
087940
087950*V13 --> --------------------------------------------------------
087960       MOVE SPACE                 TO W1AX-TRALOG-TEXT
087970*      MOVE S551AN-E-VS02-SCHU-ANZAHL
087980*                                 TO W1AN-AUFB4
087990       STRING '2. T-100-FEV205-SELEC mt RC DB2-OK'
088000              '; B205AX-BGRP-INHALT = ' B205AX-BGRP-INHALT
088010              '; S775AX-BGRP-INHALT = ' S775AX-BGRP-INHALT
088020              '; B205AX-LOESCH-KZ = '   B205AX-LOESCH-KZ
088030              '; S775AX-BGRP-INHALT = ' S775AX-BGRP-INHALT
088040       DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
088050       PERFORM Q92-TRALOG-ZEILE
088060*V13 <-- --------------------------------------------------------
088070
088080       IF B205AX-BGRP-INHALT       = S775AX-BGRP-INHALT
088090         IF B205AX-LOESCH-KZ       = 'J'
088100           MOVE 'N'                TO W1AX-FE775-CALL
088110         ELSE
088120           MOVE 'J'                TO W1AX-FE775-CALL
088130         END-IF
088140       ELSE
088150*V13 IR -->
088160         IF S551AX-E-VS02-SCHLIESSSATZ-ID  <= SPACE
088170           IF B205AX-LOESCH-KZ       = 'J'
088180             MOVE 'N'                TO W1AX-FE775-CALL
088190           ELSE
088200*            --beim leeren Schließsatzcode ist S775AX-BGRP-INHALT
088210*            --mit der gelesenen zu BGRP 007 V005.BGRP-Inhalt
088220*            --befüllen
088230             MOVE B205AX-BGRP-INHALT TO S775AX-BGRP-INHALT
088240             MOVE 'J'                TO W1AX-FE775-CALL
088250           END-IF
088260         ELSE
088270*V13 <--
088280           MOVE 'N'                  TO W1AX-FE775-CALL
088290         END-IF
088300       END-IF
088310     ELSE
088320       MOVE 'N'                    TO W1AX-FE775-CALL
088330     END-IF
088340
088350*V13 --> --------------------------------------------------------
088360     MOVE SPACE                 TO W1AX-TRALOG-TEXT
088370*    MOVE S551AN-E-VS02-SCHU-ANZAHL
088380*                               TO W1AN-AUFB4
088390     STRING '3. Aufruf FE775, Schreiben in FEV005 ja or nein '
088400            ' W1AX-FE775-CALL = '     W1AX-FE775-CALL
088410            '; S775AX-VIN = '         S775AX-VIN
088420            '; S775AX-BGRP-INHALT = ' S775AX-BGRP-INHALT
088430            '; S775AX-VGL-KZ = '      S775AX-VGL-KZ
088440     DELIMITED BY SIZE        INTO W1AX-TRALOG-TEXT
088450     PERFORM Q92-TRALOG-ZEILE
088460*V13 <-- --------------------------------------------------------
088470     IF W1AX-FE775-CALL            = 'J'
088480       CALL FE775C USING S775-DATEN
088490
088500       MOVE S775AX-SQLCA         TO SQL-SQLCA
088510
088520       EVALUATE SQLAX-SQLSTATE
088530         WHEN DB2-OK
088540           CONTINUE
088550         WHEN OTHER
088560           MOVE S775AN-TEXT-RC   TO W549AN-TEXT-RC
088570           MOVE S775AN-TEXT-FEHLER-KLASSE
088580                                 TO W549AN-TEXT-FEHLER-KLASSE
088590           MOVE S775AX-BESCHREIBUNG
088600                                 TO W549AX-BESCHREIBUNG
088610           MOVE S775AX-FEHLER-PARM
088620                                 TO W549AX-FEHLER-PARM
088630           PERFORM Z80-DB2-FEHLER
088640       END-EVALUATE
088650     END-IF
088660
088670     MOVE '00;D98-WRITE-BGRP-LOEKZ-J;Ende  '
088680                                 TO W1AX-TRALOG-TEXT
088690     PERFORM Q92-TRALOG-ZEILE
088700
088710     CONTINUE.
088720 D98-WRITE-BGRP-LOEKZ-J-END.
088730     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
088740       DISPLAY "++25889-->D98-WRITE-BGRP-LOEKZ-J-END.   "
088750     DISPLAY "++W549AX-V-ID-TRACE = "
088760        W549AX-V-ID-TRACE                             *>++DELETE
088770     DISPLAY "++W549AN-TRACE-LEVEL = "
088780        W549AN-TRACE-LEVEL                            *>++DELETE
088790     END-IF                                           *>++DELETE
088800     EXIT.
088810/
088820*-----------------------------------------------------------------
088830* MAC aus den WFS-Identdaten prüfen
088840* bei allen Aktionen
088850* Aufruf aus D10-WFS-AUSWERTEN
088860*-----------------------------------------------------------------
088870 E10-MAC-PRUEFEN SECTION.
088880     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
088890       DISPLAY "++25889-->E10-MAC-PRUEFEN SECTION.      "
088900     DISPLAY "++W549AX-V-ID-TRACE = "
088910        W549AX-V-ID-TRACE                             *>++DELETE
088920     DISPLAY "++W549AN-TRACE-LEVEL = "
088930        W549AN-TRACE-LEVEL                            *>++DELETE
088940     END-IF                                           *>++DELETE
088950
088960     MOVE '00;E10-MAC-PRUEFEN;Beginn'
088970                                 TO W1AX-TRALOG-TEXT
088980     PERFORM Q92-TRALOG-ZEILE
088990
089000     MOVE '00;E10-S585AX-TRAININGCOUNT : '  TO W1AX-TRALOG-TEXT
089010     MOVE S585AX-TRAININGCOUNTER  TO W1AX-TRALOG-TEXT (31:04)
089020     PERFORM Q92-TRALOG-ZEILE
089030
089040     MOVE '00;E10-S585AX-TRANSPONDERID : '  TO W1AX-TRALOG-TEXT
089050     MOVE S585AX-TRANSPONDERID    TO W1AX-TRALOG-TEXT (31:08)
089060     PERFORM Q92-TRALOG-ZEILE
089070
089080     MOVE '00;E10-V208AX-TRANSPOND-FAM : '  TO W1AX-TRALOG-TEXT
089090     MOVE V208AX-TRANSPOND-FAM    TO W1AX-TRALOG-TEXT (31:10)
089100     PERFORM Q92-TRALOG-ZEILE
089110
089120     IF S585AX-TRAININGCOUNTER = '0000'
089130*      -- SKC0 lesen aus 043
089140       PERFORM E40-TRANSPOND-LIEF
089150       MOVE B043AX-SKC               TO S587AX-PSS
089160     ELSE
089170       PERFORM E20-PSS-WERT
089180       MOVE W1AX-PSS-AKT             TO S587AX-PSS
089190     END-IF
089200
089210     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
089220       MOVE S585AX-TRANSPONDERVERSION  TO S587AX-VERSION
089230       MOVE S585AX-TRANSPONDERID       TO S587AX-TRANSPONDERID
089240       MOVE S585AX-BATTERYSTATUS       TO S587AX-BATTERYSTATUS
089250       MOVE S585AX-TRAININGCOUNTER     TO S587AX-TRAININGCOUNTER
089260       MOVE S585AX-MAC                 TO S587AX-MAC
089270*      -- Ausgabestruktur initialisieren
089280       MOVE ALL SPACES                 TO S587AX-MACCALC
089290                                          S587AX-ERROR
089300
089310       CALL FE587D USING S587-PSS
089320                         S587-VERSION
089330                         S587-TRANSPONDERID
089340                         S587-BATTERYSTATUS
089350                         S587-TRAININGCOUNTER
089360                         S587-MAC
089370                         S587-MACCALC
089380                         S587-ERROR
089390
089400       EVALUATE S587AX-ERROR
089410         WHEN '0000'
089420           CONTINUE
089430       WHEN '0120'
089440*        -- Länge MAC nicht korrekt
089450         MOVE K1AN-T2939         TO W549AN-TEXT-RC
089460         MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
089470       WHEN '0121'
089480*        -- GetStat MAC nicht korrekt
089490         MOVE K1AN-T2940         TO W549AN-TEXT-RC
089500         MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
089510       WHEN OTHER
089520*        -- Unbekannter Fehler aus C-Modul
089530         MOVE K1AN-T2863         TO W549AN-TEXT-RC
089540         MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
089550       END-EVALUATE
089560
089570       MOVE '00;E10-MAC-S587AX-ERROR     : '  TO W1AX-TRALOG-TEXT
089580       MOVE S587AX-ERROR            TO W1AX-TRALOG-TEXT (31:04)
089590       PERFORM Q92-TRALOG-ZEILE
089600
089610     END-IF
089620
089630     MOVE '00;E10-MAC-PRUEFEN;Ende'
089640                                 TO W1AX-TRALOG-TEXT
089650     PERFORM Q92-TRALOG-ZEILE
089660
089670     CONTINUE.
089680 E10-MAC-PRUEFEN-END.
089690     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
089700       DISPLAY "++25889-->E10-MAC-PRUEFEN-END.          "
089710     DISPLAY "++W549AX-V-ID-TRACE = "
089720        W549AX-V-ID-TRACE                             *>++DELETE
089730     DISPLAY "++W549AN-TRACE-LEVEL = "
089740        W549AN-TRACE-LEVEL                            *>++DELETE
089750     END-IF                                           *>++DELETE
089760     EXIT.
089770/
089780*-----------------------------------------------------------------
089790* PSS: Wert PSS ermitteln über FE553
089800* - W1AX-583-PSSAKT
089810* - W1AX-583-PSSNEU
089820*
089830*-----------------------------------------------------------------
089840 E20-PSS-WERT   SECTION.
089850     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
089860       DISPLAY "++25889-->E20-PSS-WERT   SECTION.       "
089870     DISPLAY "++W549AX-V-ID-TRACE = "
089880        W549AX-V-ID-TRACE                             *>++DELETE
089890     DISPLAY "++W549AN-TRACE-LEVEL = "
089900        W549AN-TRACE-LEVEL                            *>++DELETE
089910     END-IF                                           *>++DELETE
089920
089930     MOVE '00;E20-PSS-WERT;Begin' TO W1AX-TRALOG-TEXT
089940     PERFORM Q92-TRALOG-ZEILE
089950
089960     PERFORM E30-LESEN-PSS-DATEN
089970
089980     IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
089990       MOVE '02'                      TO W1AX-553-AKTION
090000       MOVE ZERO                      TO W1AN-553-DISPLAYLEVEL
090010       MOVE K1AX-DOMAENE-VKM          TO W1AX-553-DOMAENE
090020       MOVE 1                         TO W1AN-553-STGINDIVI
090030       MOVE 16                        TO W1AN-553-BYTELEN
090040       MOVE W1AX-IPA-610-STAGE        TO W1AX-553-IPA-610-STAGE
090050       MOVE W1AX-IPA-620-VERSION      TO W1AX-553-IPA-620-VERSION
090060       MOVE B0X3AX-PSS-BGRP           TO W1AX-553-BGRP
090070       MOVE B0X3AN-PSS-KEY-TYP-ID     TO W1AN-553-KEYTYPE-ID
090080       MOVE B0X3AN-PSS-KEY-TYP-ID-ZAHL
090090                                      TO W1AN-553-TYPANLERNZAEHLER
090100       MOVE B0X3AN-PSS-FZ-ID-ZAHL     TO W1AN-553-FZ-ID-ZAHL
090110       MOVE B0X3AX-PSS-KRYPTOREGION   TO W1AX-553-KRYPTOREGION
090120       MOVE B0X3AN-PSS-VKMS-KEY-AUFBAU-VER
090130                                      TO W1AN-553-AUFVERS-REIN
090140       MOVE B0X3AX-PSS-VIN            TO W1AX-553-VIN
090150*      -- ...
090160       PERFORM O30-UPRO-FE553
090170
090180       IF W549AN-TEXT-FEHLER-KLASSE = K1AN-OK OR K1AN-HINWEIS
090190         MOVE W1AX-553-PSS-WERT (1:W1AN-553-PSS-LEN)
090200                                      TO W1AX-PSS-AKT
090210       END-IF
090220     END-IF
090230
090240     MOVE '00;E20-PSS-WERT;Ende' TO W1AX-TRALOG-TEXT
090250     PERFORM Q92-TRALOG-ZEILE
090260
090270     CONTINUE.
090280 E20-PSS-WERT-END.
090290     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
090300       DISPLAY "++25889-->E20-PSS-WERT-END.             "
090310     DISPLAY "++W549AX-V-ID-TRACE = "
090320        W549AX-V-ID-TRACE                             *>++DELETE
090330     DISPLAY "++W549AN-TRACE-LEVEL = "
090340        W549AN-TRACE-LEVEL                            *>++DELETE
090350     END-IF                                           *>++DELETE
090360     EXIT.
090370/
090380*-----------------------------------------------------------------
090390*
090400*-----------------------------------------------------------------
090410 E30-LESEN-PSS-DATEN SECTION.
090420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
090430       DISPLAY "++25889-->E30-LESEN-PSS-DATEN SECTION.  "
090440     DISPLAY "++W549AX-V-ID-TRACE = "
090450        W549AX-V-ID-TRACE                             *>++DELETE
090460     DISPLAY "++W549AN-TRACE-LEVEL = "
090470        W549AN-TRACE-LEVEL                            *>++DELETE
090480     END-IF                                           *>++DELETE
090490
090500     MOVE '00;E30-LESEN-PSS-DATEN;Begin'
090510                                 TO W1AX-TRALOG-TEXT
090520     PERFORM Q92-TRALOG-ZEILE
090530
090540*    -- Ist Transponder dem Fzg zugeordnet?
090550     MOVE S585AX-VIN             TO B2X3AX-VIN
090560     MOVE S585AX-TRANSPONDERID   TO B2X3AX-TRANSPOND-ID
090570*    -- Lesen FEV2X3
090580     PERFORM T-100-FEV2X3-SEL-2
090590
090600     IF SQLAX-SQLSTATE = DB2-OK
090610
090620       PERFORM E40-TRANSPOND-LIEF
090630
090640       IF W549AN-TEXT-FEHLER-KLASSE =
090650                                    K1AN-OK OR K1AN-HINWEIS
090660         INITIALIZE B0X3-DCLFEV0X3
090670         INITIALIZE B0X3-I-DCLFEV0X3
090680
090690         MOVE S585AX-TRANSPONDERID TO B0X3AX-TRANSPOND-ID
090700         MOVE B043AX-TRANSPOND-TYP TO B0X3AX-TRANSPOND-TYP
090710
090720         PERFORM T-100-FEV0X3-SEL4PSS
090730
090740       END-IF
090750     ELSE
090760*      -- Transponder ist VIN nicht zugeordnet
090770       MOVE K1AN-T2205      TO W549AN-TEXT-RC
090780       MOVE K1AN-FEHLER     TO W549AN-TEXT-FEHLER-KLASSE
090790       STRING 'Transponder='
090800              S585AX-TRANSPONDERID
090810              ' ist einem anderen Fzg zugeordnet2'
090820         DELIMITED BY SIZE     INTO W549AX-FEHLER-PARM-TEXT
090830         WITH POINTER               W549AN-FEHLER-PARM-LEN
090840     END-IF
090850
090860     MOVE '00;E30-LESEN-PSS-DATEN;Ende'
090870                                  TO W1AX-TRALOG-TEXT
090880     PERFORM Q92-TRALOG-ZEILE
090890
090900     CONTINUE.
090910 E30-LESEN-PSS-DATEN-END.
090920     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
090930       DISPLAY "++25889-->E30-LESEN-PSS-DATEN-END.      "
090940     DISPLAY "++W549AX-V-ID-TRACE = "
090950        W549AX-V-ID-TRACE                             *>++DELETE
090960     DISPLAY "++W549AN-TRACE-LEVEL = "
090970        W549AN-TRACE-LEVEL                            *>++DELETE
090980     END-IF                                           *>++DELETE
090990     EXIT.
091000/
091010*-----------------------------------------------------------------
091020* ERMITTELN LIEFERANTENDATEN ZU TRANSPONDER
091030* - B043AX-TRANSPOND-TYP
091040*-----------------------------------------------------------------
091050 E40-TRANSPOND-LIEF SECTION.
091060     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
091070       DISPLAY "++25889-->E40-TRANSPOND-LIEF SECTION.   "
091080     DISPLAY "++W549AX-V-ID-TRACE = "
091090        W549AX-V-ID-TRACE                             *>++DELETE
091100     DISPLAY "++W549AN-TRACE-LEVEL = "
091110        W549AN-TRACE-LEVEL                            *>++DELETE
091120     END-IF                                           *>++DELETE
091130
091140     MOVE '00;E40-TRANSPOND-LIEF;Begin'
091150                                 TO W1AX-TRALOG-TEXT
091160     PERFORM Q92-TRALOG-ZEILE
091170
091180     INITIALIZE B043-DCLFEV043
091190
091200     MOVE S585AX-TRANSPONDERID    TO B043AX-TRANSPOND-ID
091210     MOVE V208AX-TRANSPOND-FAM    TO B043AX-TRANSPOND-FAM
091220
091230     PERFORM T-100-FEV043-SELECT
091240
091250     IF SQLAX-SQLSTATE = DB2-OK
091260       CONTINUE
091270     ELSE
091280*      -- Transponder nicht in Lieferantendaten
091290       INITIALIZE                     W549AX-FEHLER-PARM-TEXT
091300       MOVE 1                      TO W549AN-FEHLER-PARM-LEN
091310       MOVE K1AN-T1150             TO W549AN-TEXT-RC
091320       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
091330       STRING 'Transponder-ID='
091340              S585AX-TRANSPONDERID
091350         DELIMITED BY SIZE       INTO W549AX-FEHLER-PARM-TEXT
091360         WITH POINTER                 W549AN-FEHLER-PARM-LEN
091370     END-IF
091380
091390     MOVE '00;E40-TRANSPOND-LIEF;Ende'
091400                                  TO W1AX-TRALOG-TEXT
091410     PERFORM Q92-TRALOG-ZEILE
091420
091430     CONTINUE.
091440 E40-TRANSPOND-LIEF-END.
091450     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
091460       DISPLAY "++25889-->E40-TRANSPOND-LIEF-END.       "
091470     DISPLAY "++W549AX-V-ID-TRACE = "
091480        W549AX-V-ID-TRACE                             *>++DELETE
091490     DISPLAY "++W549AN-TRACE-LEVEL = "
091500        W549AN-TRACE-LEVEL                            *>++DELETE
091510     END-IF                                           *>++DELETE
091520     EXIT.
091530/
091540*-----------------------------------------------------------------
091550* Schlüsselrekonstruktion: Aufruf FE560B
091560*-----------------------------------------------------------------
091570 E50-SCHL-REKON SECTION.
091580     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
091590       DISPLAY "++25889-->E50-SCHL-REKON SECTION.       "
091600     DISPLAY "++W549AX-V-ID-TRACE = "
091610        W549AX-V-ID-TRACE                             *>++DELETE
091620     DISPLAY "++W549AN-TRACE-LEVEL = "
091630        W549AN-TRACE-LEVEL                            *>++DELETE
091640     END-IF                                           *>++DELETE
091650
091660     MOVE '00;E50-SCHL-REKON;Begin'
091670                                 TO W1AX-TRALOG-TEXT
091680     PERFORM Q92-TRALOG-ZEILE
091690
091700*    -- Indikatoren
091710     MOVE ZERO                     TO S560AN-I-AKTION
091720                                      S560AN-I-USER-ID
091730                                      S560AN-I-SPRACH-KZ
091740                                      S560AN-I-VIN
091750                                      S560AN-I-BGRP
091760                                      S560AN-I-KEY-TYP-ID
091770                                      S560AN-I-DLC-UTC-V-ID
091780
091790     CALL FE560C USING S560AX-AKTION
091800                       S560AX-USER-ID
091810                       S560AN-SPRACH-KZ
091820
091830                       S560AX-VIN
091840                       S560AX-BGRP
091850                       S560AN-KEY-TYP-ID
091860                       S560AX-DLC-UTC-V-ID
091870
091880                       S560AX-SCHLUESSELWERT-BIN
091890                       S560AX-SCHLUESSELWERT-CHAR
091900
091910                       S560AN-TEXT-RC
091920                       S560AN-TEXT-FEHLER-KLASSE
091930                       S560AX-BESCHREIBUNG
091940                       S560AX-FEHLER-PARM
091950
091960                       S560AN-I-AKTION
091970                       S560AN-I-USER-ID
091980                       S560AN-I-SPRACH-KZ
091990                       S560AN-I-VIN
092000                       S560AN-I-BGRP
092010                       S560AN-I-KEY-TYP-ID
092020                       S560AN-I-DLC-UTC-V-ID
092030                       S560AN-I-SCHLUESSELWERT-BIN
092040                       S560AN-I-SCHLUESSELWERT-CHAR
092050                       S560AN-I-TEXT-RC
092060                       S560AN-I-TEXT-FEHLER-KLASSE
092070                       S560AN-I-BESCHREIBUNG
092080                       S560AN-I-FEHLER-PARM
092090
092100     EVALUATE S560AN-TEXT-FEHLER-KLASSE
092110        WHEN K1AN-OK
092120        WHEN K1AN-HINWEIS
092130*          -- Nutzdaten
092140*          -- in HEX ...
092150           MOVE S560AN-TEXT-RC        TO W549AN-TEXT-RC
092160           MOVE S560AN-TEXT-FEHLER-KLASSE
092170                                      TO W549AN-TEXT-FEHLER-KLASSE
092180           MOVE S560AN-SCHLUESSELWERT-CHAR-LEN
092190                                      TO W1AN-KEY-LEN
092200           MOVE S560AX-SCHLUESSELWERT-CHAR-TX
092210                                      TO W1AX-KEY-WERT
092220
092230         WHEN K1AN-FEHLER
092240
092250           MOVE S560AN-TEXT-RC        TO W549AN-TEXT-RC
092260           MOVE S560AN-TEXT-FEHLER-KLASSE
092270                                      TO W549AN-TEXT-FEHLER-KLASSE
092280           MOVE S560AX-FEHLER-PARM    TO W549AX-FEHLER-PARM
092290
092300         WHEN OTHER
092310           MOVE S560AN-TEXT-RC        TO W549AN-TEXT-RC
092320           MOVE S560AN-TEXT-FEHLER-KLASSE
092330                                      TO W549AN-TEXT-FEHLER-KLASSE
092340           MOVE S560AX-BESCHREIBUNG   TO W549AX-BESCHREIBUNG
092350           MOVE S560AX-FEHLER-PARM    TO W549AX-FEHLER-PARM
092360
092370           PERFORM Z90-PGM-EXIT
092380     END-EVALUATE
092390
092400     MOVE '00;E50-SCHL-REKON;Ende'
092410                                  TO W1AX-TRALOG-TEXT
092420     PERFORM Q92-TRALOG-ZEILE
092430
092440     CONTINUE.
092450 E50-SCHL-REKON-END.
092460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
092470       DISPLAY "++25889-->E50-SCHL-REKON-END.           "
092480     DISPLAY "++W549AX-V-ID-TRACE = "
092490        W549AX-V-ID-TRACE                             *>++DELETE
092500     DISPLAY "++W549AN-TRACE-LEVEL = "
092510        W549AN-TRACE-LEVEL                            *>++DELETE
092520     END-IF                                           *>++DELETE
092530     EXIT.
092540/
092550*-----------------------------------------------------------------
092560* AUSKUNFT HINWEIS SCHREIBEN
092570*-----------------------------------------------------------------
092580 I20-AK-HINWEIS SECTION.
092590     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
092600       DISPLAY "++25889-->I20-AK-HINWEIS SECTION.       "
092610     DISPLAY "++W549AX-V-ID-TRACE = "
092620        W549AX-V-ID-TRACE                             *>++DELETE
092630     DISPLAY "++W549AN-TRACE-LEVEL = "
092640        W549AN-TRACE-LEVEL                            *>++DELETE
092650     END-IF                                           *>++DELETE
092660
092670*    -- vorhandene Werte merken...
092680     MOVE W549AN-TEXT-RC           TO W1AN-TEXT-RC
092690     MOVE W549AN-TEXT-FEHLER-KLASSE
092700                                   TO W1AN-TEXT-FEHLER-KLASSE
092710
092720*    -- GESAMMELTE TEXT-RC
092730     PERFORM VARYING I1AN-1 FROM 1 BY 1
092740               UNTIL I1AN-1 > TXVRAN-I
092750       MOVE TXVRAN-TEXT-VERARB(I1AN-1)
092760                                   TO W549AN-TEXT-RC
092770       MOVE TXVRAN-TEXT-FEHLER-KLASSE(I1AN-1)
092780                                   TO W549AN-TEXT-FEHLER-KLASSE
092790       PERFORM I20W-AK-HINWEIS
092800     END-PERFORM
092810
092820*    -- ... und wieder zurückschreiben
092830     MOVE W1AN-TEXT-RC             TO W549AN-TEXT-RC
092840     MOVE W1AN-TEXT-FEHLER-KLASSE
092850                                   TO W549AN-TEXT-FEHLER-KLASSE
092860
092870*    -- SONDERFALL: EIN EINTRAG MUSS WEGEN DER VIN DA SEIN
092880*    -- - DANN MIT DEM ALLGEMEINEN ERGEBNIS
092890     IF TXVRAN-I                   = ZERO
092900       PERFORM I20W-AK-HINWEIS
092910     END-IF
092920
092930     CONTINUE.
092940 I20-AK-HINWEIS-END.
092950     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
092960       DISPLAY "++25889-->I20-AK-HINWEIS-END.           "
092970     DISPLAY "++W549AX-V-ID-TRACE = "
092980        W549AX-V-ID-TRACE                             *>++DELETE
092990     DISPLAY "++W549AN-TRACE-LEVEL = "
093000        W549AN-TRACE-LEVEL                            *>++DELETE
093010     END-IF                                           *>++DELETE
093020     EXIT.
093030/
093040*-----------------------------------------------------------------
093050* ...
093060*-----------------------------------------------------------------
093070 I20W-AK-HINWEIS SECTION.
093080     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
093090       DISPLAY "++25889-->I20W-AK-HINWEIS SECTION.      "
093100     DISPLAY "++W549AX-V-ID-TRACE = "
093110        W549AX-V-ID-TRACE                             *>++DELETE
093120     DISPLAY "++W549AN-TRACE-LEVEL = "
093130        W549AN-TRACE-LEVEL                            *>++DELETE
093140     END-IF                                           *>++DELETE
093150
093160     MOVE W549AX-LOG-UTC-V-ID      TO BXVRAX-UTC-V-ID
093170     MOVE S551AX-E-VIN             TO BXVRAX-VIN
093180     MOVE W549AN-TEXT-RC           TO BXVRAN-TEXT-VERARB
093190     MOVE W549AN-TEXT-FEHLER-KLASSE
093200                                   TO BXVRAN-TEXT-FEHLER-KLASSE
093210
093220     EXEC SQL
093230       INSERT INTO FEVXVR
093240              ( UTC_V_ID
093250              , VIN
093260              , TEXT_VERARB
093270              , TEXT_FEHLER_KLASSE
093280              )
093290       VALUES ( :BXVRAX-UTC-V-ID
093300               ,:BXVRAX-VIN
093310               ,:BXVRAN-TEXT-VERARB
093320               ,:BXVRAN-TEXT-FEHLER-KLASSE
093330              )
093340     END-EXEC
093350     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
093360     DISPLAY "++EXEC SQL                                         "
093370     DISPLAY "++ INSERT INTO FEVXVR                              "
093380     DISPLAY "++ ( UTC_V_ID                                      "
093390     DISPLAY "++ , VIN                                           "
093400     DISPLAY "++ , TEXT_VERARB                                   "
093410     DISPLAY "++ , TEXT_FEHLER_KLASSE                            "
093420     DISPLAY "++ )                                               "
093430     DISPLAY "++ VALUES ( " BXVRAX-UTC-V-ID "                    "
093440     DISPLAY "++ ," BXVRAX-VIN "                                 "
093450     DISPLAY "++ ," BXVRAN-TEXT-VERARB "                         "
093460     DISPLAY "++ ," BXVRAN-TEXT-FEHLER-KLASSE "                  "
093470     DISPLAY "++ )                                               "
093480     DISPLAY "++END-EXEC                                         "
093490     DISPLAY "++SQLCODE --> " SQLCODE
093500     END-IF                                           *>++DELETE
093510
093520     IF SQLSTATE NOT = DB2-OK AND DB2-DUP-KEY
093530       MOVE 'I20W-AK-HINWEIS'      TO W549AX-SECTION
093540       PERFORM Z80-DB2-FEHLER
093550     END-IF
093560
093570     CONTINUE.
093580 I20W-AK-HINWEIS-END.
093590     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
093600       DISPLAY "++25889-->I20W-AK-HINWEIS-END.          "
093610     DISPLAY "++W549AX-V-ID-TRACE = "
093620        W549AX-V-ID-TRACE                             *>++DELETE
093630     DISPLAY "++W549AN-TRACE-LEVEL = "
093640        W549AN-TRACE-LEVEL                            *>++DELETE
093650     END-IF                                           *>++DELETE
093660     EXIT.
093670/
093680*-----------------------------------------------------------------
093690* AUSKUNFT AK-TRANSPONDER SCHREIBEN
093700*-----------------------------------------------------------------
093710 I25-AK-TRANSPONDER    SECTION.
093720     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
093730       DISPLAY "++25889-->I25-AK-TRANSPONDER    SECTION."
093740     DISPLAY "++W549AX-V-ID-TRACE = "
093750        W549AX-V-ID-TRACE                             *>++DELETE
093760     DISPLAY "++W549AN-TRACE-LEVEL = "
093770        W549AN-TRACE-LEVEL                            *>++DELETE
093780     END-IF                                           *>++DELETE
093790
093800*    -- GESAMMELTE TEXT-RC
093810     PERFORM VARYING I1AN-1 FROM 1 BY 1
093820               UNTIL I1AN-1 > TXX4AN-I
093830
093840       MOVE SPACE                  TO BXX4AX-TRANSPOND-ID
093850*      -- TRANSPOND-ID UND -TYP AUS EINGABE, DA NUR EINER MÖGLICH
093860       MOVE TXX4AX-TRANSPOND-ID (TXX4AN-I)
093870                                   TO BXX4AX-TRANSPOND-ID
093880       MOVE TXX4AX-TRANSPOND-TYP(TXX4AN-I)
093890                                   TO BXX4AX-TRANSPOND-TYP
093900       MOVE TXX4AN-TEXT-VERARB(I1AN-1)
093910                                   TO BXX4AN-TEXT-VERARB
093920       MOVE TXX4AN-TEXT-FEHLER-KLASSE(I1AN-1)
093930                                   TO BXX4AN-TEXT-FEHLER-KLASSE
093940       MOVE ZERO                   TO BXX4AN-I-TEXT-FEHLER-KLASSE
093950
093960       IF BXX4AX-TRANSPOND-ID      = SPACE
093970       OR BXX4AX-TRANSPOND-ID      = '00000000'
093980         CONTINUE
093990       ELSE
094000         PERFORM I25W-AK-TRANSPONDER
094010       END-IF
094020
094030     END-PERFORM
094040
094050     CONTINUE.
094060 I25-AK-TRANSPONDER-END.
094070     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
094080       DISPLAY "++25889-->I25-AK-TRANSPONDER-END.       "
094090     DISPLAY "++W549AX-V-ID-TRACE = "
094100        W549AX-V-ID-TRACE                             *>++DELETE
094110     DISPLAY "++W549AN-TRACE-LEVEL = "
094120        W549AN-TRACE-LEVEL                            *>++DELETE
094130     END-IF                                           *>++DELETE
094140     EXIT.
094150/
094160*-----------------------------------------------------------------
094170* Auskunft Transponder schreiben
094180*-----------------------------------------------------------------
094190 I25W-AK-TRANSPONDER SECTION.
094200     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
094210       DISPLAY "++25889-->I25W-AK-TRANSPONDER SECTION.  "
094220     DISPLAY "++W549AX-V-ID-TRACE = "
094230        W549AX-V-ID-TRACE                             *>++DELETE
094240     DISPLAY "++W549AN-TRACE-LEVEL = "
094250        W549AN-TRACE-LEVEL                            *>++DELETE
094260     END-IF                                           *>++DELETE
094270
094280     MOVE W549AX-LOG-UTC-V-ID      TO BXX4AX-UTC-V-ID
094290
094300     EXEC SQL
094310       INSERT INTO FEVXX4
094320              ( UTC_V_ID
094330              , TRANSPOND_ID
094340              , TRANSPOND_TYP
094350              , TEXT_VERARB
094360              , TEXT_FEHLER_KLASSE
094370              )
094380       VALUES ( :BXX4AX-UTC-V-ID
094390               ,:BXX4AX-TRANSPOND-ID
094400               ,:BXX4AX-TRANSPOND-TYP
094410               ,:BXX4AN-TEXT-VERARB
094420               ,:BXX4AN-TEXT-FEHLER-KLASSE
094430                  :BXX4AN-I-TEXT-FEHLER-KLASSE
094440              )
094450     END-EXEC
094460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
094470     DISPLAY "++EXEC SQL                                         "
094480     DISPLAY "++ INSERT INTO FEVXX4                              "
094490     DISPLAY "++ ( UTC_V_ID                                      "
094500     DISPLAY "++ , TRANSPOND_ID                                  "
094510     DISPLAY "++ , TRANSPOND_TYP                                 "
094520     DISPLAY "++ , TEXT_VERARB                                   "
094530     DISPLAY "++ , TEXT_FEHLER_KLASSE                            "
094540     DISPLAY "++ )                                               "
094550     DISPLAY "++ VALUES ( " BXX4AX-UTC-V-ID "                    "
094560     DISPLAY "++ ," BXX4AX-TRANSPOND-ID "                        "
094570     DISPLAY "++ ," BXX4AX-TRANSPOND-TYP "                       "
094580     DISPLAY "++ ," BXX4AN-TEXT-VERARB "                         "
094590     DISPLAY "++ ," BXX4AN-TEXT-FEHLER-KLASSE "                  "
094600     DISPLAY "++ " BXX4AN-I-TEXT-FEHLER-KLASSE "                 "
094610     DISPLAY "++ )                                               "
094620     DISPLAY "++END-EXEC                                         "
094630     DISPLAY "++SQLCODE --> " SQLCODE
094640     END-IF                                           *>++DELETE
094650
094660     IF SQLSTATE NOT = DB2-OK AND DB2-DUP-KEY
094670       MOVE 'I25W-AK-TRANSPONDER'  TO W549AX-SECTION
094680       PERFORM Z80-DB2-FEHLER
094690     END-IF
094700
094710     CONTINUE.
094720 I25W-AK-TRANSPONDER-END.
094730     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
094740       DISPLAY "++25889-->I25W-AK-TRANSPONDER-END.      "
094750     DISPLAY "++W549AX-V-ID-TRACE = "
094760        W549AX-V-ID-TRACE                             *>++DELETE
094770     DISPLAY "++W549AN-TRACE-LEVEL = "
094780        W549AN-TRACE-LEVEL                            *>++DELETE
094790     END-IF                                           *>++DELETE
094800     EXIT.
094810/
094820*-----------------------------------------------------------------
094830* Auskunft Transponder schreiben bei Fehler in DT02
094840*-----------------------------------------------------------------
094850 I26W-AK-TRANSPONDER SECTION.
094860     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
094870       DISPLAY "++25889-->I26W-AK-TRANSPONDER SECTION.  "
094880     DISPLAY "++W549AX-V-ID-TRACE = "
094890        W549AX-V-ID-TRACE                             *>++DELETE
094900     DISPLAY "++W549AN-TRACE-LEVEL = "
094910        W549AN-TRACE-LEVEL                            *>++DELETE
094920     END-IF                                           *>++DELETE
094930
094940     MOVE W549AX-LOG-UTC-V-ID      TO BXX4AX-UTC-V-ID
094950*    -- Felder des aktuellen Transponders
094960     MOVE S540AX-E-TRANSPOND-ID    TO BXX4AX-TRANSPOND-ID
094970
094980     MOVE B2X3AX-TRANSPOND-TYP     TO BXX4AX-TRANSPOND-TYP
094990
095000     MOVE W549AN-TEXT-RC           TO BXX4AN-TEXT-VERARB
095010
095020     MOVE W549AN-TEXT-FEHLER-KLASSE
095030                                   TO BXX4AN-TEXT-FEHLER-KLASSE
095040     MOVE ZERO                     TO BXX4AN-I-TEXT-FEHLER-KLASSE
095050
095060
095070     EXEC SQL
095080       INSERT INTO FEVXX4
095090              ( UTC_V_ID
095100              , TRANSPOND_ID
095110              , TRANSPOND_TYP
095120              , TEXT_VERARB
095130              , TEXT_FEHLER_KLASSE
095140              )
095150       VALUES ( :BXX4AX-UTC-V-ID
095160               ,:BXX4AX-TRANSPOND-ID
095170               ,:BXX4AX-TRANSPOND-TYP
095180               ,:BXX4AN-TEXT-VERARB
095190               ,:BXX4AN-TEXT-FEHLER-KLASSE
095200                  :BXX4AN-I-TEXT-FEHLER-KLASSE
095210              )
095220     END-EXEC
095230     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
095240     DISPLAY "++EXEC SQL                                         "
095250     DISPLAY "++ INSERT INTO FEVXX4                              "
095260     DISPLAY "++ ( UTC_V_ID                                      "
095270     DISPLAY "++ , TRANSPOND_ID                                  "
095280     DISPLAY "++ , TRANSPOND_TYP                                 "
095290     DISPLAY "++ , TEXT_VERARB                                   "
095300     DISPLAY "++ , TEXT_FEHLER_KLASSE                            "
095310     DISPLAY "++ )                                               "
095320     DISPLAY "++ VALUES ( " BXX4AX-UTC-V-ID "                    "
095330     DISPLAY "++ ," BXX4AX-TRANSPOND-ID "                        "
095340     DISPLAY "++ ," BXX4AX-TRANSPOND-TYP "                       "
095350     DISPLAY "++ ," BXX4AN-TEXT-VERARB "                         "
095360     DISPLAY "++ ," BXX4AN-TEXT-FEHLER-KLASSE "                  "
095370     DISPLAY "++ " BXX4AN-I-TEXT-FEHLER-KLASSE "                 "
095380     DISPLAY "++ )                                               "
095390     DISPLAY "++END-EXEC                                         "
095400     DISPLAY "++SQLCODE --> " SQLCODE
095410     END-IF                                           *>++DELETE
095420
095430     IF SQLSTATE NOT = DB2-OK AND DB2-DUP-KEY
095440       MOVE 'I26W-AK-TRANSPONDER'  TO W549AX-SECTION
095450       PERFORM Z80-DB2-FEHLER
095460     END-IF
095470
095480     CONTINUE.
095490 I26W-AK-TRANSPONDER-END.
095500     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
095510       DISPLAY "++25889-->I26W-AK-TRANSPONDER-END.      "
095520     DISPLAY "++W549AX-V-ID-TRACE = "
095530        W549AX-V-ID-TRACE                             *>++DELETE
095540     DISPLAY "++W549AN-TRACE-LEVEL = "
095550        W549AN-TRACE-LEVEL                            *>++DELETE
095560     END-IF                                           *>++DELETE
095570     EXIT.
095580/
095590*-----------------------------------------------------------------
095600* in Character dargestellte Hexadezimalwerte
095610* in ihre Binärwerte umsetzen
095620* ungültige Eingabezeichen -> komplettes Ergebnis 0
095630*-----------------------------------------------------------------
095640 O10-XCTOBIN SECTION.
095650     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
095660       DISPLAY "++25889-->O10-XCTOBIN SECTION.          "
095670     DISPLAY "++W549AX-V-ID-TRACE = "
095680        W549AX-V-ID-TRACE                             *>++DELETE
095690     DISPLAY "++W549AN-TRACE-LEVEL = "
095700        W549AN-TRACE-LEVEL                            *>++DELETE
095710     END-IF                                           *>++DELETE
095720
095730     INITIALIZE CSN-STATUS
095740     MOVE K1AN-OK                   TO CSN-TEXT-FEHKL
095750     MOVE 99999                     TO CSN-RETURN-CODE
095760                                       CSN-REASON-CODE
095770     MOVE 0                         TO CSN-EXIT-DATA-LEN
095780     MOVE ' '                       TO CSN-EXIT-DATA
095790     MOVE FUNCTION UPPER-CASE (BBCB-SOURCE-TEXT)
095800                                    TO BBCB-SOURCE-TEXT
095810     MOVE LOW-VALUE                 TO BBCB-TARGET-TEXT
095820     MOVE '0123456789ABCDEF'        TO BBCB-CODE-TABLE
095830
095840     CALL CSNBXCB  USING CSN-RETURN-CODE
095850                         CSN-REASON-CODE
095860                         CSN-EXIT-DATA-LEN
095870                         CSN-EXIT-DATA
095880                         BBCB-TEXT-LEN
095890                         BBCB-SOURCE-TEXT
095900                         BBCB-TARGET-TEXT
095910                         BBCB-CODE-TABLE
095920
095930     IF CSN-RETURN-CODE = 0
095940*      -- OK-ERGEBNIS
095950       CONTINUE
095960     ELSE
095970*      -- Fehler in IBM-Routine CSNBXCB Datenkonvertierung
095980       MOVE K1AN-T1763          TO W1AN-TEXT-RC
095990       MOVE K1AN-FEHLER         TO W1AN-TEXT-FEHLER-KLASSE
096000     END-IF
096010
096020     CONTINUE.
096030 O10-XCTOBIN-END.
096040     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
096050       DISPLAY "++25889-->O10-XCTOBIN-END.              "
096060     DISPLAY "++W549AX-V-ID-TRACE = "
096070        W549AX-V-ID-TRACE                             *>++DELETE
096080     DISPLAY "++W549AN-TRACE-LEVEL = "
096090        W549AN-TRACE-LEVEL                            *>++DELETE
096100     END-IF                                           *>++DELETE
096110     EXIT.
096120/
096130*-----------------------------------------------------------------
096140* HEX-Zahl in Dezimal-Zahl umrechenen
096150*  W1AX-EIN-HEXWERT  = Eingabewert in HEXPIC X(n)
096160*  W1AN-ERGEBNIS-DEC = Ergebnis in dezimal PIC S9(9) COMP
096170*
096180*  Länge des Eingabewertes muss = Größe W1AX-EIN-HEX-TAB sein
096190*  Festlegen in W1...05 HEX2DEC.
096200*
096210*  Zu konvertierenden Wert in W1AX-EIN-HEXWERT zuweisen
096220*  Abarbeiten byte-weise von hinten nach vorne
096230*  jede Stelle mit 16 hoch x multiplizieren (x = 0-n)
096240*  und zusammenzählen.
096250*
096260*-----------------------------------------------------------------
096270 O20-HEX-TO-DECIMAL   SECTION.
096280     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
096290       DISPLAY "++25889-->O20-HEX-TO-DECIMAL   SECTION. "
096300     DISPLAY "++W549AX-V-ID-TRACE = "
096310        W549AX-V-ID-TRACE                             *>++DELETE
096320     DISPLAY "++W549AN-TRACE-LEVEL = "
096330        W549AN-TRACE-LEVEL                            *>++DELETE
096340     END-IF                                           *>++DELETE
096350
096360     MOVE FUNCTION UPPER-CASE(W1AX-EIN-HEXWERT)
096370                                      TO W1AX-EIN-HEXWERT
096380
096390     MOVE ZERO       TO W1AN-ERGEBNIS-DEC
096400     MOVE ZERO       TO I-EXPO
096410
096420     PERFORM VARYING I-CNT FROM 4 BY -1
096430     UNTIL I-CNT < 1
096440
096450       EVALUATE W1AX-EIN-HEX-BYTE (I-CNT)
096460         WHEN '0' MOVE  0 TO W1AN-NUM-X
096470         WHEN '1' MOVE  1 TO W1AN-NUM-X
096480         WHEN '2' MOVE  2 TO W1AN-NUM-X
096490         WHEN '3' MOVE  3 TO W1AN-NUM-X
096500         WHEN '4' MOVE  4 TO W1AN-NUM-X
096510         WHEN '5' MOVE  5 TO W1AN-NUM-X
096520         WHEN '6' MOVE  6 TO W1AN-NUM-X
096530         WHEN '7' MOVE  7 TO W1AN-NUM-X
096540         WHEN '8' MOVE  8 TO W1AN-NUM-X
096550         WHEN '9' MOVE  9 TO W1AN-NUM-X
096560         WHEN 'A' MOVE 10 TO W1AN-NUM-X
096570         WHEN 'B' MOVE 11 TO W1AN-NUM-X
096580         WHEN 'C' MOVE 12 TO W1AN-NUM-X
096590         WHEN 'D' MOVE 13 TO W1AN-NUM-X
096600         WHEN 'E' MOVE 14 TO W1AN-NUM-X
096610         WHEN 'F' MOVE 15 TO W1AN-NUM-X
096620         WHEN OTHER CONTINUE
096630       END-EVALUATE
096640
096650       COMPUTE W1AN-ZW-DECIMAL = W1AN-NUM-X * (16 ** I-EXPO)
096660
096670       ADD W1AN-ZW-DECIMAL     TO W1AN-ERGEBNIS-DEC
096680       ADD 1                   TO I-EXPO
096690
096700     END-PERFORM
096710
096720     CONTINUE.
096730 O20-HEX-TO-DECIMAL-END.
096740     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
096750       DISPLAY "++25889-->O20-HEX-TO-DECIMAL-END.       "
096760     DISPLAY "++W549AX-V-ID-TRACE = "
096770        W549AX-V-ID-TRACE                             *>++DELETE
096780     DISPLAY "++W549AN-TRACE-LEVEL = "
096790        W549AN-TRACE-LEVEL                            *>++DELETE
096800     END-IF                                           *>++DELETE
096810     EXIT.
096820/
096830*-----------------------------------------------------------------
096840* FE553B/C VKMS Symmetrischen Schlüssel ableiten vom Masterkey
096850*-----------------------------------------------------------------
096860 O30-UPRO-FE553       SECTION.
096870     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
096880       DISPLAY "++25889-->O30-UPRO-FE553       SECTION. "
096890     DISPLAY "++W549AX-V-ID-TRACE = "
096900        W549AX-V-ID-TRACE                             *>++DELETE
096910     DISPLAY "++W549AN-TRACE-LEVEL = "
096920        W549AN-TRACE-LEVEL                            *>++DELETE
096930     END-IF                                           *>++DELETE
096940
096950     MOVE '00;O30-UPRO-FE553;Beginn'
096960                                   TO W1AX-TRALOG-TEXT
096970     PERFORM Q92-TRALOG-ZEILE
096980
096990*    -------------------------------------------------------------
097000*    -- VKMS Symmetrischen Schlüssel ableiten vom Masterkey
097010*    -------------------------------------------------------------
097020*    -- Eingabe-Parameter
097030     MOVE W1AX-553-AKTION           TO S553AX-AKTION
097040     MOVE W1AN-553-DISPLAYLEVEL     TO S553AN-DISPLAYLEVEL
097050     MOVE 'C'                       TO S553AX-STELLE6-STDMODUL
097060     MOVE 'D'                       TO S553AX-STELLE6-CMODUL
097070     MOVE ZERO                      TO S553AN-DISPLAYLEVEL
097080     MOVE W1AX-553-VIN              TO S553AX-VIN
097090     MOVE W1AX-553-KRYPTOREGION     TO S553AX-KRYPTOREGION
097100     MOVE W1AX-553-DOMAENE          TO S553AX-DOMAENE
097110     MOVE W1AX-553-BGRP             TO S553AX-BGRP
097120     MOVE W1AN-553-KEYTYPE-ID       TO S553AN-KEYTYPE-ID
097130     MOVE W1AN-553-FZ-ID-ZAHL       TO S553AN-FZ-ID-ZAHL
097140     MOVE W1AN-553-TYPANLERNZAEHLER TO S553AN-TYPANLERNZAEHLER
097150     MOVE W1AN-553-STGINDIVI        TO S553AN-STGINDIVI
097160     MOVE W1AN-553-BYTELEN          TO S553AN-BYTELEN
097170     MOVE W1AN-553-AUFVERS-REIN     TO S553AN-AUFVERS-REIN
097180     MOVE W1AX-553-IPA-610-STAGE    TO S553AX-IPA-610-STAGE
097190     MOVE W1AX-553-IPA-620-VERSION  TO S553AX-IPA-620-VERSION
097200*    -- Ausgabe-Parameter
097210     MOVE ZERO                      TO S553AN-KEY-LEN
097220     MOVE SPACE                     TO S553AX-KEY-WERT
097230*    -- ...
097240     CALL FE553C USING S553
097250
097260     EVALUATE S553AN-TEXT-FEHLER-KLASSE
097270       WHEN K1AN-OK
097280       WHEN K1AN-HINWEIS
097290*        -- Nutzdaten (bereitgestellt in BIN)
097300*        -- in HEX ... aufbereiten
097310         MOVE S553AN-KEY-LEN         TO BBCB-TEXT-LEN
097320         MOVE S553AX-KEY-WERT        TO BBCB-SOURCE-TEXT
097330         PERFORM O40-BINTOXC
097340
097350         IF CSN-RETURN-CODE = ZERO
097360           MOVE BBCB-TEXT-LEN          TO W1AN-553-PSS-LEN
097370           MOVE BBCB-TARGET-TEXT(1:32) TO W1AX-553-PSS-WERT
097380         END-IF
097390
097400       WHEN K1AN-FEHLER
097410
097420         MOVE S553AN-TEXT-RC        TO W549AN-TEXT-RC
097430         MOVE S553AN-TEXT-FEHLER-KLASSE
097440                                    TO W549AN-TEXT-FEHLER-KLASSE
097450         MOVE S553AX-FEHLER-PARM    TO W549AX-FEHLER-PARM
097460
097470       WHEN OTHER
097480         MOVE S553AN-TEXT-RC        TO W549AN-TEXT-RC
097490         MOVE S553AN-TEXT-FEHLER-KLASSE
097500                                    TO W549AN-TEXT-FEHLER-KLASSE
097510         MOVE S553AX-BESCHREIBUNG   TO W549AX-BESCHREIBUNG
097520         MOVE S553AX-FEHLER-PARM    TO W549AX-FEHLER-PARM
097530
097540         PERFORM Z90-PGM-EXIT
097550     END-EVALUATE
097560
097570     MOVE '00;O30-UPRO-FE553;Ende'
097580                                   TO W1AX-TRALOG-TEXT
097590     PERFORM Q92-TRALOG-ZEILE
097600
097610     CONTINUE.
097620 O30-UPRO-FE553-END.
097630     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
097640       DISPLAY "++25889-->O30-UPRO-FE553-END.           "
097650     DISPLAY "++W549AX-V-ID-TRACE = "
097660        W549AX-V-ID-TRACE                             *>++DELETE
097670     DISPLAY "++W549AN-TRACE-LEVEL = "
097680        W549AN-TRACE-LEVEL                            *>++DELETE
097690     END-IF                                           *>++DELETE
097700     EXIT.
097710/
097720*-----------------------------------------------------------------
097730* Binärwerte umsetzen nach
097740* in Character dargestellte Hexadezimalwerte
097750*-----------------------------------------------------------------
097760 O40-BINTOXC SECTION.
097770     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
097780       DISPLAY "++25889-->O40-BINTOXC SECTION.          "
097790     DISPLAY "++W549AX-V-ID-TRACE = "
097800        W549AX-V-ID-TRACE                             *>++DELETE
097810     DISPLAY "++W549AN-TRACE-LEVEL = "
097820        W549AN-TRACE-LEVEL                            *>++DELETE
097830     END-IF                                           *>++DELETE
097840
097850     MOVE '00;O40-BINTOXC;Beginn' TO W1AX-TRALOG-TEXT
097860
097870     PERFORM Q92-TRALOG-ZEILE
097880
097890     MOVE 99999                    TO CSN-RETURN-CODE
097900     MOVE 99999                    TO CSN-REASON-CODE
097910
097920     MOVE 0                        TO CSN-EXIT-DATA-LEN
097930     MOVE ' '                      TO CSN-EXIT-DATA
097940     MOVE ' '                      TO BBCB-TARGET-TEXT
097950     MOVE '0123456789ABCDEF'       TO BBCB-CODE-TABLE
097960
097970     COMPUTE W1AN-N1 = (LENGTH OF BBCB-TARGET-TEXT) / 2
097980     IF BBCB-TEXT-LEN  > 0
097990                  AND <= W1AN-N1
098000
098010       CALL CSNBXBC USING CSN-RETURN-CODE
098020                          CSN-REASON-CODE
098030                          CSN-EXIT-DATA-LEN
098040                          CSN-EXIT-DATA
098050                          BBCB-TEXT-LEN
098060                          BBCB-SOURCE-TEXT
098070                          BBCB-TARGET-TEXT
098080                          BBCB-CODE-TABLE
098090     ELSE
098100       MOVE 0                      TO CSN-RETURN-CODE
098110       MOVE 0                      TO CSN-REASON-CODE
098120       MOVE ALL '?'                TO BBCB-TARGET-TEXT
098130       MOVE LENGTH OF BBCB-TARGET-TEXT
098140                                   TO BBCB-TEXT-LEN
098150       MOVE K1AN-T1009             TO W549AN-TEXT-RC
098160       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
098170       MOVE 1                      TO W549AN-FEHLER-PARM-LEN
098180       STRING PROBA-ID (1:8)
098190              'O40-BINTOXC '
098200              'TEXT-LEN ist zu klein oder zu gross'
098210         DELIMITED BY SIZE       INTO W549AX-FEHLER-PARM-TEXT
098220         WITH POINTER                  W549AN-FEHLER-PARM-LEN
098230     END-IF
098240
098250     IF CSN-RETURN-CODE = 0
098260*      -- OK-Ergebnis
098270       CONTINUE
098280     ELSE
098290       MOVE CSN-RETURN-CODE        TO W1AN-AUFB2
098300       MOVE CSN-REASON-CODE        TO W1AN-AUFB9
098310*      -- Fehler aus IBM-Routine CSNBXBC Character/Nibble Conver
098320       MOVE K1AN-T1506             TO W549AN-TEXT-RC
098330       MOVE K1AN-FEHLER            TO W549AN-TEXT-FEHLER-KLASSE
098340       MOVE 1                      TO W549AN-FEHLER-PARM-LEN
098350       STRING PROBA-ID (1:8)
098360              'CSNBXCB-RC = '
098370              W1AN-AUFB2 ' - ' W1AN-AUFB9
098380         DELIMITED BY SIZE       INTO W549AX-FEHLER-PARM-TEXT
098390         WITH POINTER                 W549AN-FEHLER-PARM-LEN
098400     END-IF
098410
098420     CONTINUE.
098430
098440     MOVE '00;O40-BINTOXC;Ende'    TO W1AX-TRALOG-TEXT
098450     PERFORM Q92-TRALOG-ZEILE
098460
098470     CONTINUE.
098480 O40-BINTOXC-END.
098490     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
098500       DISPLAY "++25889-->O40-BINTOXC-END.              "
098510     DISPLAY "++W549AX-V-ID-TRACE = "
098520        W549AX-V-ID-TRACE                             *>++DELETE
098530     DISPLAY "++W549AN-TRACE-LEVEL = "
098540        W549AN-TRACE-LEVEL                            *>++DELETE
098550     END-IF                                           *>++DELETE
098560     EXIT.
098570/
098580*-----------------------------------------------------------------
098590* Instanzparameter
098600*-----------------------------------------------------------------
098610 P01-INSTANZPARAMETER SECTION.
098620     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
098630       DISPLAY "++25889-->P01-INSTANZPARAMETER SECTION. "
098640     DISPLAY "++W549AX-V-ID-TRACE = "
098650        W549AX-V-ID-TRACE                             *>++DELETE
098660     DISPLAY "++W549AN-TRACE-LEVEL = "
098670        W549AN-TRACE-LEVEL                            *>++DELETE
098680     END-IF                                           *>++DELETE
098690
098700     MOVE '00;P01-INSTANZPARAMETER;Beginn'
098710                                   TO W1AX-TRALOG-TEXT
098720     PERFORM Q92-TRALOG-ZEILE
098730
098740*    -- W1AX-IPA-610-STAGE        : stage
098750*                                   T Test
098760*                                   Q ...
098770*                                   P
098780*    -- W1AX-IPA-620-VERSION      : version
098790
098800     EXEC SQL
098810       SELECT  A.INSTANZ
098820              ,B.WERT
098830              ,C.WERT
098840       INTO    :W1AX-IPA-INSTANZ
098850              ,:W1AX-IPA-610-WERT
098860                 :W1AN-IPA-I-610WERT
098870              ,:W1AX-IPA-620-WERT
098880                 :W1AN-IPA-I-620WERT
098890
098900       FROM            FEV03D A
098910
098920       LEFT OUTER JOIN FEV03F B
098930       ON  B.INSTANZ   = A.INSTANZ
098940       AND B.PARAMETER = 610
098950       AND B.AKTIV_KZ  = 'J'
098960
098970       LEFT OUTER JOIN FEV03F C
098980       ON  C.INSTANZ   = A.INSTANZ
098990       AND C.PARAMETER = 620
099000       AND C.AKTIV_KZ  = 'J'
099010
099020       WITH UR
099030     END-EXEC
099040     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
099050     DISPLAY "++EXEC SQL                                         "
099060     DISPLAY "++ SELECT A.INSTANZ                                "
099070     DISPLAY "++ ,B.WERT                                         "
099080     DISPLAY "++ ,C.WERT                                         "
099090     DISPLAY "++ INTO " W1AX-IPA-INSTANZ "                       "
099100     DISPLAY "++ ," W1AX-IPA-610-WERT "                          "
099110     DISPLAY "++ " W1AN-IPA-I-610WERT "                          "
099120     DISPLAY "++ ," W1AX-IPA-620-WERT "                          "
099130     DISPLAY "++ " W1AN-IPA-I-620WERT "                          "
099140     DISPLAY "++                                                 "
099150     DISPLAY "++ FROM FEV03D A                                   "
099160     DISPLAY "++                                                 "
099170     DISPLAY "++ LEFT OUTER JOIN FEV03F B                        "
099180     DISPLAY "++ ON B.INSTANZ = A.INSTANZ                        "
099190     DISPLAY "++ AND B.PARAMETER = 610                           "
099200     DISPLAY "++ AND B.AKTIV_KZ = 'J'                            "
099210     DISPLAY "++                                                 "
099220     DISPLAY "++ LEFT OUTER JOIN FEV03F C                        "
099230     DISPLAY "++ ON C.INSTANZ = A.INSTANZ                        "
099240     DISPLAY "++ AND C.PARAMETER = 620                           "
099250     DISPLAY "++ AND C.AKTIV_KZ = 'J'                            "
099260     DISPLAY "++                                                 "
099270     DISPLAY "++ WITH UR                                         "
099280     DISPLAY "++END-EXEC                                         "
099290     DISPLAY "++SQLCODE --> " SQLCODE
099300     END-IF                                           *>++DELETE
099310
099320     MOVE SQLCA                    TO SQL-SQLCA
099330
099340     EVALUATE SQLAX-SQLSTATE
099350       WHEN DB2-OK
099360         IF W1AN-IPA-I-610WERT     = 0
099370           MOVE W1AX-IPA-610-WERT  TO W1AX-IPA-610-STAGE
099380           IF W1AN-IPA-I-620WERT   = 0
099390             MOVE W1AX-IPA-620-WERT TO W1AX-IPA-620-VERSION
099400           ELSE
099410*            -- INSTANZPARAMETER 620 NICHT GEF
099420             MOVE K1AN-T1498       TO W549AN-TEXT-RC
099430             MOVE K1AN-FEHLER      TO W549AN-TEXT-FEHLER-KLASSE
099440           END-IF
099450         ELSE
099460*          -- INSTANZPARAMETER 610 NICHT GEF
099470           MOVE K1AN-T1499         TO W549AN-TEXT-RC
099480           MOVE K1AN-FEHLER        TO W549AN-TEXT-FEHLER-KLASSE
099490         END-IF
099500       WHEN DB2-NOT-FOUND
099510*        -- INSTANZPARAMETER 610 NICHT GEF
099520         MOVE K1AN-T1499           TO W549AN-TEXT-RC
099530         MOVE K1AN-FEHLER          TO W549AN-TEXT-FEHLER-KLASSE
099540       WHEN OTHER
099550         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
099560         MOVE 'P01-INSTANZPARAMETER' TO W549AX-SECTION
099570         PERFORM Z80-DB2-FEHLER
099580     END-EVALUATE
099590
099600     MOVE '00;P01-INSTANZPARAMETER;Ende'
099610                                   TO W1AX-TRALOG-TEXT
099620     PERFORM Q92-TRALOG-ZEILE
099630
099640     CONTINUE.
099650 P01-INSTANZPARAMETER-END.
099660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
099670       DISPLAY "++25889-->P01-INSTANZPARAMETER-END.     "
099680     DISPLAY "++W549AX-V-ID-TRACE = "
099690        W549AX-V-ID-TRACE                             *>++DELETE
099700     DISPLAY "++W549AN-TRACE-LEVEL = "
099710        W549AN-TRACE-LEVEL                            *>++DELETE
099720     END-IF                                           *>++DELETE
099730     EXIT.
099740
099750*-----------------------------------------------------------------
099760* TRACE-LOGGING, Struktur füllen wenns eingeschaltet ist
099770*-----------------------------------------------------------------
099780 Q01-TRALOG-START SECTION.
099790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
099800       DISPLAY "++25889-->Q01-TRALOG-START SECTION.     "
099810     DISPLAY "++W549AX-V-ID-TRACE = "
099820        W549AX-V-ID-TRACE                             *>++DELETE
099830     DISPLAY "++W549AN-TRACE-LEVEL = "
099840        W549AN-TRACE-LEVEL                            *>++DELETE
099850     END-IF                                           *>++DELETE
099860
099870     IF W549AN-TRACE-LEVEL > 0
099880*      -- gleichbleibendes für die INSERTs wird hier gefüllt
099890       INITIALIZE BX12-DCLFEVX12
099900       MOVE W549AX-V-ID-TRACE       TO BX12AX-V-ID-TRACE
099910       MOVE BX12AX-V-ID-TRACE(26:1) TO BX12AX-INSTANZ
099920       MOVE PROBA-ID (1:6)          TO BX12AX-MODUL-NAME
099930     END-IF
099940
099950     CONTINUE.
099960 Q01-TRALOG-START-E.
099970     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
099980       DISPLAY "++25889-->Q01-TRALOG-START-E.           "
099990     DISPLAY "++W549AX-V-ID-TRACE = "
100000        W549AX-V-ID-TRACE                             *>++DELETE
100010     DISPLAY "++W549AN-TRACE-LEVEL = "
100020        W549AN-TRACE-LEVEL                            *>++DELETE
100030     END-IF                                           *>++DELETE
100040     EXIT.
100050/
100060*-----------------------------------------------------------------
100070* TRACE-LOGGING, Zeile schreiben wenn (Level 2) eingeschaltet
100080*-----------------------------------------------------------------
100090 Q92-TRALOG-ZEILE SECTION.
100100     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
100110       DISPLAY "++25889-->Q92-TRALOG-ZEILE SECTION.     "
100120     DISPLAY "++W549AX-V-ID-TRACE = "
100130        W549AX-V-ID-TRACE                             *>++DELETE
100140     DISPLAY "++W549AN-TRACE-LEVEL = "
100150        W549AN-TRACE-LEVEL                            *>++DELETE
100160     END-IF                                           *>++DELETE
100170
100180*    -- Standard im Unterprogramm
100190*    -- ab level 2 !
100200     IF W549AN-TRACE-LEVEL >= 2
100210       MOVE W1AX-TRALOG-TEXT        TO BX12AX-TEXT-TEXT
100220       MOVE 1000                    TO BX12AN-TEXT-LEN
100230
100240       PERFORM T-100-FEVX12-INSERT
100250     END-IF
100260
100270     CONTINUE.
100280 Q92-TRALOG-ZEILE-E.
100290     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
100300       DISPLAY "++25889-->Q92-TRALOG-ZEILE-E.           "
100310     DISPLAY "++W549AX-V-ID-TRACE = "
100320        W549AX-V-ID-TRACE                             *>++DELETE
100330     DISPLAY "++W549AN-TRACE-LEVEL = "
100340        W549AN-TRACE-LEVEL                            *>++DELETE
100350     END-IF                                           *>++DELETE
100360     EXIT.
100370/
100380*-----------------------------------------------------------------
100390* Lesen FEV0VP - aktueller Satz zur VIN und KEY-TYP-ID 1000
100400*-----------------------------------------------------------------
100410 T-100-FEV0VP-SELECT   SECTION.
100420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
100430       DISPLAY "++25889-->T-100-FEV0VP-SELECT   SECTION."
100440     DISPLAY "++W549AX-V-ID-TRACE = "
100450        W549AX-V-ID-TRACE                             *>++DELETE
100460     DISPLAY "++W549AN-TRACE-LEVEL = "
100470        W549AN-TRACE-LEVEL                            *>++DELETE
100480     END-IF                                           *>++DELETE
100490
100500     EXEC SQL
100510       SELECT UTC_V_ID
100520            , BGRP
100530            , KEY_TYP_ID
100540            , KEY_TYP_ID_ZAHL
100550            , KEY_TYP_IM_DLC_KZ
100560       INTO   :B0VPAX-UTC-V-ID
100570            , :B0VPAX-BGRP
100580            , :B0VPAN-KEY-TYP-ID
100590            , :B0VPAN-KEY-TYP-ID-ZAHL   :B0VPAN-I-KEY-TYP-ID-ZAHL
100600            , :B0VPAX-KEY-TYP-IM-DLC-KZ
100610       FROM   FEV0VP A
100620       WHERE  VIN        = :B0VPAX-VIN
100630         AND  BGRP       = :B0VPAX-BGRP
100640         AND  KEY_TYP_ID = :B0VPAN-KEY-TYP-ID
100650         AND  UTC_V_ID   = (SELECT MAX(UTC_V_ID)
100660                            FROM FEV0VP X
100670                            WHERE X.VIN        = A.VIN
100680                              AND X.BGRP       = A.BGRP
100690                              AND X.KEY_TYP_ID = A.KEY_TYP_ID)
100700       WITH UR
100710     END-EXEC
100720     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
100730     DISPLAY "++EXEC SQL                                         "
100740     DISPLAY "++ SELECT UTC_V_ID                                 "
100750     DISPLAY "++ , BGRP                                          "
100760     DISPLAY "++ , KEY_TYP_ID                                    "
100770     DISPLAY "++ , KEY_TYP_ID_ZAHL                               "
100780     DISPLAY "++ , KEY_TYP_IM_DLC_KZ                             "
100790     DISPLAY "++ INTO " B0VPAX-UTC-V-ID "                        "
100800     DISPLAY "++ , " B0VPAX-BGRP "                               "
100810     DISPLAY "++ , " B0VPAN-KEY-TYP-ID "                         "
100820*    DISPLAY "++ , " B0VPAN-KEY-TYP-ID-ZAHL " " B0VPAN-I-KEY-TYP-"
100830     DISPLAY "++ , " B0VPAX-KEY-TYP-IM-DLC-KZ "                  "
100840     DISPLAY "++ FROM FEV0VP A                                   "
100850     DISPLAY "++ WHERE VIN = " B0VPAX-VIN "                      "
100860     DISPLAY "++ AND BGRP = " B0VPAX-BGRP "                      "
100870     DISPLAY "++ AND KEY_TYP_ID = " B0VPAN-KEY-TYP-ID "          "
100880     DISPLAY "++ AND UTC_V_ID = (SELECT MAX(UTC_V_ID)            "
100890     DISPLAY "++ FROM FEV0VP X                                   "
100900     DISPLAY "++ WHERE X.VIN = A.VIN                             "
100910     DISPLAY "++ AND X.BGRP = A.BGRP                             "
100920     DISPLAY "++ AND X.KEY_TYP_ID = A.KEY_TYP_ID)                "
100930     DISPLAY "++ WITH UR                                         "
100940     DISPLAY "++END-EXEC                                         "
100950     DISPLAY "++SQLCODE --> " SQLCODE
100960     END-IF                                           *>++DELETE
100970
100980     MOVE SQLCA                    TO SQL-SQLCA
100990
101000     EVALUATE SQLAX-SQLSTATE
101010       WHEN DB2-OK
101020         IF B0VPAN-I-KEY-TYP-ID-ZAHL = -1
101030           MOVE ZERO                TO B0VPAN-KEY-TYP-ID-ZAHL
101040         END-IF
101050       WHEN DB2-NOT-FOUND
101060         CONTINUE
101070       WHEN OTHER
101080         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
101090         MOVE 'T-100-FEV0VP-SELECT' TO W549AX-SECTION
101100         PERFORM Z80-DB2-FEHLER
101110     END-EVALUATE
101120
101130     CONTINUE.
101140 T-100-FEV0VP-SELECT-END.
101150     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
101160       DISPLAY "++25889-->T-100-FEV0VP-SELECT-END.      "
101170     DISPLAY "++W549AX-V-ID-TRACE = "
101180        W549AX-V-ID-TRACE                             *>++DELETE
101190     DISPLAY "++W549AN-TRACE-LEVEL = "
101200        W549AN-TRACE-LEVEL                            *>++DELETE
101210     END-IF                                           *>++DELETE
101220     EXIT.
101230/
101240*-----------------------------------------------------------------
101250* Markierungsgrund lesen T4H
101260*-----------------------------------------------------------------
101270 T-100-FEV04H-SELECT SECTION.
101280     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
101290       DISPLAY "++25889-->T-100-FEV04H-SELECT SECTION.  "
101300     DISPLAY "++W549AX-V-ID-TRACE = "
101310        W549AX-V-ID-TRACE                             *>++DELETE
101320     DISPLAY "++W549AN-TRACE-LEVEL = "
101330        W549AN-TRACE-LEVEL                            *>++DELETE
101340     END-IF                                           *>++DELETE
101350
101360     EXEC SQL
101370       SELECT  TEXT_MARKIERUNG
101380             , LOESCH_KZ
101390        INTO  :B04HAN-TEXT-MARKIERUNG
101400             ,:B04HAX-LOESCH-KZ
101410       FROM FEV04H
101420       WHERE TRANSPOND_ID    = :B04HAX-TRANSPOND-ID
101430         AND TEXT_MARKIERUNG = :B04HAN-TEXT-MARKIERUNG
101440         AND V_ID =
101450         ( SELECT MAX(V_ID)
101460           FROM   FEV04H M
101470           WHERE M.TRANSPOND_ID    = :B04HAX-TRANSPOND-ID
101480             AND M.TEXT_MARKIERUNG = :B04HAN-TEXT-MARKIERUNG
101490         )
101500       FETCH FIRST ROW ONLY
101510     END-EXEC
101520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
101530     DISPLAY "++EXEC SQL                                         "
101540     DISPLAY "++ SELECT TEXT_MARKIERUNG                          "
101550     DISPLAY "++ , LOESCH_KZ                                     "
101560     DISPLAY "++ INTO " B04HAN-TEXT-MARKIERUNG "                 "
101570     DISPLAY "++ ," B04HAX-LOESCH-KZ "                           "
101580     DISPLAY "++ FROM FEV04H                                     "
101590     DISPLAY "++ WHERE TRANSPOND_ID = " B04HAX-TRANSPOND-ID "    "
101600     DISPLAY "++ AND TEXT_MARKIERUNG = " B04HAN-TEXT-MARKIERUNG
101610     DISPLAY "++ AND V_ID =                                      "
101620     DISPLAY "++ ( SELECT MAX(V_ID)                              "
101630     DISPLAY "++ FROM FEV04H M                                   "
101640     DISPLAY "++ WHERE M.TRANSPOND_ID = " B04HAX-TRANSPOND-ID "  "
101650     DISPLAY "++ AND M.TEXT_MARKIERUNG = " B04HAN-TEXT-MARKIERUNG
101660     DISPLAY "++ )                                               "
101670     DISPLAY "++ FETCH FIRST ROW ONLY                            "
101680     DISPLAY "++END-EXEC                                         "
101690     DISPLAY "++SQLCODE --> " SQLCODE
101700     END-IF                                           *>++DELETE
101710
101720     MOVE SQLCA                    TO SQL-SQLCA
101730
101740     EVALUATE SQLAX-SQLSTATE
101750       WHEN DB2-OK
101760         CONTINUE
101770       WHEN DB2-NOT-FOUND
101780         MOVE ZERO                 TO B04HAN-TEXT-MARKIERUNG
101790       WHEN OTHER
101800         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
101810         MOVE 'T-100-FEV04H-SELECT'
101820                                   TO W549AX-SECTION
101830         PERFORM Z80-DB2-FEHLER
101840     END-EVALUATE
101850
101860     CONTINUE.
101870 T-100-FEV04H-SELECT-E.
101880     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
101890       DISPLAY "++25889-->T-100-FEV04H-SELECT-E.        "
101900     DISPLAY "++W549AX-V-ID-TRACE = "
101910        W549AX-V-ID-TRACE                             *>++DELETE
101920     DISPLAY "++W549AN-TRACE-LEVEL = "
101930        W549AN-TRACE-LEVEL                            *>++DELETE
101940     END-IF                                           *>++DELETE
101950     EXIT.
101960/
101970*-----------------------------------------------------------------
101980* Lieferantendaten lesen weg. Transponder-Typ
101990*-----------------------------------------------------------------
102000 T-100-FEV043-SELECT SECTION.
102010     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
102020       DISPLAY "++25889-->T-100-FEV043-SELECT SECTION.  "
102030     DISPLAY "++W549AX-V-ID-TRACE = "
102040        W549AX-V-ID-TRACE                             *>++DELETE
102050     DISPLAY "++W549AN-TRACE-LEVEL = "
102060        W549AN-TRACE-LEVEL                            *>++DELETE
102070     END-IF                                           *>++DELETE
102080
102090     EXEC SQL
102100       SELECT SKC
102110             ,TRANSPOND_TYP
102120         INTO :B043AX-SKC
102130             ,:B043AX-TRANSPOND-TYP
102140         FROM FEV043 A
102150        WHERE TRANSPOND_ID  = :B043AX-TRANSPOND-ID
102160          AND TRANSPOND_FAM = :B043AX-TRANSPOND-FAM
102170        FETCH FIRST 1 ROW ONLY
102180        WITH UR
102190     END-EXEC
102200     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
102210     DISPLAY "++EXEC SQL                                         "
102220     DISPLAY "++ SELECT SKC                                      "
102230     DISPLAY "++ ,TRANSPOND_TYP                                  "
102240     DISPLAY "++ INTO " B043AX-SKC "                             "
102250     DISPLAY "++ ," B043AX-TRANSPOND-TYP "                       "
102260     DISPLAY "++ FROM FEV043 A                                   "
102270     DISPLAY "++ WHERE TRANSPOND_ID = " B043AX-TRANSPOND-ID "    "
102280     DISPLAY "++ AND TRANSPOND_FAM = " B043AX-TRANSPOND-FAM "    "
102290     DISPLAY "++ FETCH FIRST 1 ROW ONLY                          "
102300     DISPLAY "++ WITH UR                                         "
102310     DISPLAY "++END-EXEC                                         "
102320     DISPLAY "++SQLCODE --> " SQLCODE
102330     END-IF                                           *>++DELETE
102340
102350     MOVE SQLCA TO SQL-SQLCA
102360
102370     EVALUATE SQLAX-SQLSTATE
102380       WHEN DB2-OK
102390       WHEN DB2-NOT-FOUND
102400         CONTINUE
102410       WHEN OTHER
102420         MOVE 'T-100-FEV043-SELECT' TO W549AX-SECTION
102430         PERFORM Z80-DB2-FEHLER
102440     END-EVALUATE
102450
102460     CONTINUE.
102470 T-100-FEV043-SELECT-E.
102480     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
102490       DISPLAY "++25889-->T-100-FEV043-SELECT-E.        "
102500     DISPLAY "++W549AX-V-ID-TRACE = "
102510        W549AX-V-ID-TRACE                             *>++DELETE
102520     DISPLAY "++W549AN-TRACE-LEVEL = "
102530        W549AN-TRACE-LEVEL                            *>++DELETE
102540     END-IF                                           *>++DELETE
102550     EXIT.
102560/
102570*----------------------------------------------------------------
102580* Lesen View FEV2VI mit MAX(UTC_V_ID)
102590* - Alle Felder zu VIN und KEY_TYP_ID lesen
102600*----------------------------------------------------------------
102610 T-100-FEV2VI-SELECT   SECTION.
102620     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
102630       DISPLAY "++25889-->T-100-FEV2VI-SELECT   SECTION."
102640     DISPLAY "++W549AX-V-ID-TRACE = "
102650        W549AX-V-ID-TRACE                             *>++DELETE
102660     DISPLAY "++W549AN-TRACE-LEVEL = "
102670        W549AN-TRACE-LEVEL                            *>++DELETE
102680     END-IF                                           *>++DELETE
102690
102700     EXEC SQL
102710       SELECT UTC_V_ID
102720            , VIN
102730            , KEY_TYP_ID
102740            , KEY_TYP_ID_ZAHL
102750            , DATEN_INHALT
102760       INTO  :B2VIAX-UTC-V-ID
102770            ,:B2VIAX-VIN
102780            ,:B2VIAN-KEY-TYP-ID
102790            ,:B2VIAN-KEY-TYP-ID-ZAHL
102800            ,:B2VIAX-DATEN-INHALT    :B2VIAN-I-DATEN-INHALT
102810       FROM FEV2VI
102820       WHERE VIN        = :B2VIAX-VIN
102830       AND   KEY_TYP_ID = :B2VIAN-KEY-TYP-ID
102840       WITH UR
102850     END-EXEC
102860     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
102870     DISPLAY "++EXEC SQL                                         "
102880     DISPLAY "++ SELECT UTC_V_ID                                 "
102890     DISPLAY "++ , VIN                                           "
102900     DISPLAY "++ , KEY_TYP_ID                                    "
102910     DISPLAY "++ , KEY_TYP_ID_ZAHL                               "
102920     DISPLAY "++ , DATEN_INHALT                                  "
102930     DISPLAY "++ INTO " B2VIAX-UTC-V-ID "                        "
102940     DISPLAY "++ ," B2VIAX-VIN "                                 "
102950     DISPLAY "++ ," B2VIAN-KEY-TYP-ID "                          "
102960     DISPLAY "++ ," B2VIAN-KEY-TYP-ID-ZAHL "                     "
102970     DISPLAY "++ ," B2VIAX-DATEN-INHALT " " B2VIAN-I-DATEN-INHALT
102980     DISPLAY "++ FROM FEV2VI                                     "
102990     DISPLAY "++ WHERE VIN = " B2VIAX-VIN "                      "
103000     DISPLAY "++ AND KEY_TYP_ID = " B2VIAN-KEY-TYP-ID "          "
103010     DISPLAY "++ WITH UR                                         "
103020     DISPLAY "++END-EXEC                                         "
103030     DISPLAY "++SQLCODE --> " SQLCODE
103040     END-IF                                           *>++DELETE
103050
103060     MOVE SQLCA TO SQL-SQLCA
103070     EVALUATE SQLAX-SQLSTATE
103080     WHEN DB2-OK
103090       IF B2VIAN-I-DATEN-INHALT = -1
103100         MOVE ALL ZERO          TO B2VIAX-DATEN-INHALT
103110       END-IF
103120
103130     WHEN DB2-NOT-FOUND
103140       CONTINUE
103150     WHEN OTHER
103160       MOVE PROBA-ID (1:8)         TO W549AX-PROGRAMM
103170       MOVE 'T-100-FEV2VI-SELECT'  TO W549AX-SECTION
103180       PERFORM Z80-DB2-FEHLER
103190     END-EVALUATE
103200
103210     CONTINUE.
103220 T-100-FEV2VI-SELECT-E.
103230     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
103240       DISPLAY "++25889-->T-100-FEV2VI-SELECT-E.        "
103250     DISPLAY "++W549AX-V-ID-TRACE = "
103260        W549AX-V-ID-TRACE                             *>++DELETE
103270     DISPLAY "++W549AN-TRACE-LEVEL = "
103280        W549AN-TRACE-LEVEL                            *>++DELETE
103290     END-IF                                           *>++DELETE
103300     EXIT.
103310/
103320*-----------------------------------------------------------------
103330*
103340*-----------------------------------------------------------------
103350 T-100-FEVX12-INSERT SECTION.
103360     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
103370       DISPLAY "++25889-->T-100-FEVX12-INSERT SECTION.  "
103380     DISPLAY "++W549AX-V-ID-TRACE = "
103390        W549AX-V-ID-TRACE                             *>++DELETE
103400     DISPLAY "++W549AN-TRACE-LEVEL = "
103410        W549AN-TRACE-LEVEL                            *>++DELETE
103420     END-IF                                           *>++DELETE
103430
103440     EXEC SQL
103450          INSERT INTO FEVX12
103460                 ( V_ID_TRACE
103470                 , ZEITPUNKT
103480                 , INSTANZ
103490                 , MODUL_NAME
103500                 , TEXT
103510                 )
103520          VALUES (:BX12AX-V-ID-TRACE
103530                 , CURRENT TIMESTAMP
103540                 ,:BX12AX-INSTANZ
103550                 ,:BX12AX-MODUL-NAME
103560                 ,:BX12AX-TEXT
103570                 )
103580     END-EXEC
103590     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
103600     DISPLAY "++EXEC SQL                                         "
103610     DISPLAY "++ INSERT INTO FEVX12                              "
103620     DISPLAY "++ ( V_ID_TRACE                                    "
103630     DISPLAY "++ , ZEITPUNKT                                     "
103640     DISPLAY "++ , INSTANZ                                       "
103650     DISPLAY "++ , MODUL_NAME                                    "
103660     DISPLAY "++ , TEXT                                          "
103670     DISPLAY "++ )                                               "
103680     DISPLAY "++ VALUES (" BX12AX-V-ID-TRACE "                   "
103690     DISPLAY "++ , CURRENT TIMESTAMP                             "
103700     DISPLAY "++ ," BX12AX-INSTANZ "                             "
103710     DISPLAY "++ ," BX12AX-MODUL-NAME "                          "
103720     DISPLAY "++ ," BX12AX-TEXT "                                "
103730     DISPLAY "++ )                                               "
103740     DISPLAY "++END-EXEC                                         "
103750     DISPLAY "++SQLCODE --> " SQLCODE
103760     END-IF                                           *>++DELETE
103770
103780*    -- kein Abprüfen SQLSTATE !
103790
103800     CONTINUE.
103810 T-100-FEVX12-INSERT-E.
103820     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
103830       DISPLAY "++25889-->T-100-FEVX12-INSERT-E.        "
103840     DISPLAY "++W549AX-V-ID-TRACE = "
103850        W549AX-V-ID-TRACE                             *>++DELETE
103860     DISPLAY "++W549AN-TRACE-LEVEL = "
103870        W549AN-TRACE-LEVEL                            *>++DELETE
103880     END-IF                                           *>++DELETE
103890     EXIT.
103900/
103910*----------------------------------------------------------------
103920* DATEN DER VIEW FEV205 FAZIT-BGRP AKTUELL SELEKTIEREN
103930*----------------------------------------------------------------
103940 T-100-FEV205-SELECT SECTION.
103950     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
103960       DISPLAY "++25889-->T-100-FEV205-SELECT SECTION.  "
103970     DISPLAY "++W549AX-V-ID-TRACE = "
103980        W549AX-V-ID-TRACE                             *>++DELETE
103990     DISPLAY "++W549AN-TRACE-LEVEL = "
104000        W549AN-TRACE-LEVEL                            *>++DELETE
104010     END-IF                                           *>++DELETE
104020*
104030     EXEC SQL
104040       SELECT  BGRP_INHALT
104050              ,LOESCH_KZ
104060       INTO   :B205AX-BGRP-INHALT
104070             ,:B205AX-LOESCH-KZ
104080       FROM   FEV205
104090       WHERE  VIN         = :B205AX-VIN
104100         AND  BGRP        = :B205AX-BGRP
104110         AND  BGRP_FAM    = :B205AX-BGRP-FAM
104120     END-EXEC
104130     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
104140     DISPLAY "++EXEC SQL                                         "
104150     DISPLAY "++ SELECT BGRP_INHALT                              "
104160     DISPLAY "++ ,LOESCH_KZ                                      "
104170     DISPLAY "++ INTO " B205AX-BGRP-INHALT "                     "
104180     DISPLAY "++ ," B205AX-LOESCH-KZ "                           "
104190     DISPLAY "++ FROM FEV205                                     "
104200     DISPLAY "++ WHERE VIN = " B205AX-VIN "                      "
104210     DISPLAY "++ AND BGRP = " B205AX-BGRP "                      "
104220     DISPLAY "++ AND BGRP_FAM = " B205AX-BGRP-FAM "              "
104230     DISPLAY "++END-EXEC                                         "
104240     DISPLAY "++SQLCODE --> " SQLCODE
104250     END-IF                                           *>++DELETE
104260
104270     MOVE SQLCA                    TO SQL-SQLCA
104280
104290     EVALUATE SQLAX-SQLSTATE
104300       WHEN DB2-OK
104310       WHEN DB2-NOT-FOUND
104320         CONTINUE
104330       WHEN OTHER
104340         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
104350         MOVE 'T-100-FEV205-SELECT'
104360                                   TO W549AX-SECTION
104370         PERFORM Z80-DB2-FEHLER
104380     END-EVALUATE
104390
104400     CONTINUE.
104410 T-100-FEV205-SELECT-E.
104420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
104430       DISPLAY "++25889-->T-100-FEV205-SELECT-E.        "
104440     DISPLAY "++W549AX-V-ID-TRACE = "
104450        W549AX-V-ID-TRACE                             *>++DELETE
104460     DISPLAY "++W549AN-TRACE-LEVEL = "
104470        W549AN-TRACE-LEVEL                            *>++DELETE
104480     END-IF                                           *>++DELETE
104490     EXIT.
104500/
104510*-----------------------------------------------------------------
104520*
104530*-----------------------------------------------------------------
104540 T-100-FEV208-SELECT SECTION.
104550     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
104560       DISPLAY "++25889-->T-100-FEV208-SELECT SECTION.  "
104570     DISPLAY "++W549AX-V-ID-TRACE = "
104580        W549AX-V-ID-TRACE                             *>++DELETE
104590     DISPLAY "++W549AN-TRACE-LEVEL = "
104600        W549AN-TRACE-LEVEL                            *>++DELETE
104610     END-IF                                           *>++DELETE
104620
104630     EXEC SQL
104640       SELECT V_ID
104650            , VIN
104660            , TEXT_SYSTEM
104670            , PIN
104680            , SKC
104690            , TEXT_DRT_VERSION
104700            , WFS_INHALT
104710            , FSC
104720            , P_KLASSE
104730            , TRANSPOND_FAM
104740            , GFA
104750            , ID_ZAHL
104760            , WERK
104770            , SPJ
104780            , KNR
104790            , VIN_FZ_KLASSE
104800            , WFS_MARKE
104810            , PRNR_MOT
104820            , DATUM_ZP8
104830            , ZP8_NR
104840            , KOMP_MASTER
104850            , WFS_MASTER
104860            , MODELL
104870            , GFA_ZAHL
104880            , TEXT_SKC_ART
104890            , TEXT_GFA_ART
104900            , LABEL_SERIE_NR
104910            , GARNITUR_SERIE_NR
104920            , PIN_WERK
104930            , PIN_SPJ
104940            , PIN_KNR
104950         INTO :V208AX-V-ID
104960            , :V208AX-VIN
104970            , :V208AN-TEXT-SYSTEM
104980            , :V208AX-PIN               :V208AN-I-PIN
104990            , :V208AX-SKC               :V208AN-I-SKC
105000            , :V208AN-TEXT-DRT-VERSION  :V208AN-I-TEXT-DRT-VERSION
105010            , :V208AX-WFS-INHALT        :V208AN-I-WFS-INHALT
105020            , :V208AX-FSC               :V208AN-I-FSC
105030            , :V208AX-P-KLASSE          :V208AN-I-P-KLASSE
105040            , :V208AX-TRANSPOND-FAM     :V208AN-I-TRANSPOND-FAM
105050            , :V208AX-GFA               :V208AN-I-GFA
105060            , :V208AX-ID-ZAHL
105070            , :V208AX-WERK
105080            , :V208AX-SPJ
105090            , :V208AX-KNR
105100            , :V208AX-VIN-FZ-KLASSE
105110            , :V208AX-WFS-MARKE
105120            , :V208AX-PRNR-MOT
105130            , :V208AX-DATUM-ZP8         :V208AN-I-DATUM-ZP8
105140            , :V208AX-ZP8-NR
105150            , :V208AX-KOMP-MASTER
105160            , :V208AX-WFS-MASTER
105170            , :V208AX-MODELL
105180            , :V208AX-GFA-ZAHL
105190            , :V208AN-TEXT-SKC-ART      :V208AN-I-TEXT-SKC-ART
105200            , :V208AN-TEXT-GFA-ART      :V208AN-I-TEXT-GFA-ART
105210            , :V208AX-LABEL-SERIE-NR
105220            , :V208AX-GARNITUR-SERIE-NR
105230            , :V208AX-PIN-WERK
105240            , :V208AX-PIN-SPJ
105250            , :V208AX-PIN-KNR
105260         FROM FEV208
105270        WHERE VIN = :V208AX-VIN
105280     END-EXEC
105290     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
105300     DISPLAY "++EXEC SQL                                         "
105310     DISPLAY "++ SELECT V_ID                                     "
105320     DISPLAY "++ , VIN                                           "
105330     DISPLAY "++ , TEXT_SYSTEM                                   "
105340     DISPLAY "++ , PIN                                           "
105350     DISPLAY "++ , SKC                                           "
105360     DISPLAY "++ , TEXT_DRT_VERSION                              "
105370     DISPLAY "++ , WFS_INHALT                                    "
105380     DISPLAY "++ , FSC                                           "
105390     DISPLAY "++ , P_KLASSE                                      "
105400     DISPLAY "++ , TRANSPOND_FAM                                 "
105410     DISPLAY "++ , GFA                                           "
105420     DISPLAY "++ , ID_ZAHL                                       "
105430     DISPLAY "++ , WERK                                          "
105440     DISPLAY "++ , SPJ                                           "
105450     DISPLAY "++ , KNR                                           "
105460     DISPLAY "++ , VIN_FZ_KLASSE                                 "
105470     DISPLAY "++ , WFS_MARKE                                     "
105480     DISPLAY "++ , PRNR_MOT                                      "
105490     DISPLAY "++ , DATUM_ZP8                                     "
105500     DISPLAY "++ , ZP8_NR                                        "
105510     DISPLAY "++ , KOMP_MASTER                                   "
105520     DISPLAY "++ , WFS_MASTER                                    "
105530     DISPLAY "++ , MODELL                                        "
105540     DISPLAY "++ , GFA_ZAHL                                      "
105550     DISPLAY "++ , TEXT_SKC_ART                                  "
105560     DISPLAY "++ , TEXT_GFA_ART                                  "
105570     DISPLAY "++ , LABEL_SERIE_NR                                "
105580     DISPLAY "++ , GARNITUR_SERIE_NR                             "
105590     DISPLAY "++ , PIN_WERK                                      "
105600     DISPLAY "++ , PIN_SPJ                                       "
105610     DISPLAY "++ , PIN_KNR                                       "
105620     DISPLAY "++ INTO " V208AX-V-ID "                            "
105630     DISPLAY "++ , " V208AX-VIN "                                "
105640     DISPLAY "++ , " V208AN-TEXT-SYSTEM "                        "
105650     DISPLAY "++ , " V208AX-PIN " " V208AN-I-PIN "               "
105660     DISPLAY "++ , " V208AX-SKC " " V208AN-I-SKC "               "
105670*    DISPLAY "++ , " V208AN-TEXT-DRT-VERSION " " V208AN-I-TEXT-DRT
105680     DISPLAY "++ , " V208AX-WFS-INHALT " " V208AN-I-WFS-INHALT " "
105690     DISPLAY "++ , " V208AX-FSC " " V208AN-I-FSC "               "
105700     DISPLAY "++ , " V208AX-P-KLASSE " " V208AN-I-P-KLASSE "     "
105710*    DISPLAY "++ , " V208AX-TRANSPOND-FAM " " V208AN-I-TRANSPOND-
105720     DISPLAY "++ , " V208AX-GFA " " V208AN-I-GFA "               "
105730     DISPLAY "++ , " V208AX-ID-ZAHL "                            "
105740     DISPLAY "++ , " V208AX-WERK "                               "
105750     DISPLAY "++ , " V208AX-SPJ "                                "
105760     DISPLAY "++ , " V208AX-KNR "                                "
105770     DISPLAY "++ , " V208AX-VIN-FZ-KLASSE "                      "
105780     DISPLAY "++ , " V208AX-WFS-MARKE "                          "
105790     DISPLAY "++ , " V208AX-PRNR-MOT "                           "
105800     DISPLAY "++ , " V208AX-DATUM-ZP8 " " V208AN-I-DATUM-ZP8 "   "
105810     DISPLAY "++ , " V208AX-ZP8-NR "                             "
105820     DISPLAY "++ , " V208AX-KOMP-MASTER "                        "
105830     DISPLAY "++ , " V208AX-WFS-MASTER "                         "
105840     DISPLAY "++ , " V208AX-MODELL "                             "
105850     DISPLAY "++ , " V208AX-GFA-ZAHL "                           "
105860*    DISPLAY "++ , " V208AN-TEXT-SKC-ART " " V208AN-I-TEXT-SKC-AR
105870*    DISPLAY "++ , " V208AN-TEXT-GFA-ART " " V208AN-I-TEXT-GFA-AR
105880     DISPLAY "++ , " V208AX-LABEL-SERIE-NR "                     "
105890     DISPLAY "++ , " V208AX-GARNITUR-SERIE-NR "                  "
105900     DISPLAY "++ , " V208AX-PIN-WERK "                           "
105910     DISPLAY "++ , " V208AX-PIN-SPJ "                            "
105920     DISPLAY "++ , " V208AX-PIN-KNR "                            "
105930     DISPLAY "++ FROM FEV208                                     "
105940     DISPLAY "++ WHERE VIN = " V208AX-VIN "                      "
105950     DISPLAY "++END-EXEC                                         "
105960     DISPLAY "++SQLCODE --> " SQLCODE
105970     END-IF                                           *>++DELETE
105980
105990     MOVE SQLCA TO SQL-SQLCA
106000     EVALUATE SQLAX-SQLSTATE
106010       WHEN DB2-OK        CONTINUE
106020       WHEN DB2-NOT-FOUND
106030         SET U1AX-VERARB-FEHLER    TO TRUE
106040       WHEN OTHER
106050         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
106060         MOVE 'T-100-FEV208-SELECT' TO W549AX-SECTION
106070         PERFORM Z80-DB2-FEHLER
106080     END-EVALUATE
106090
106100     CONTINUE.
106110 T-100-FEV208-SELECT-E.
106120     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
106130       DISPLAY "++25889-->T-100-FEV208-SELECT-E.        "
106140     DISPLAY "++W549AX-V-ID-TRACE = "
106150        W549AX-V-ID-TRACE                             *>++DELETE
106160     DISPLAY "++W549AN-TRACE-LEVEL = "
106170        W549AN-TRACE-LEVEL                            *>++DELETE
106180     END-IF                                           *>++DELETE
106190     EXIT.
106200/
106210*----------------------------------------------------------------
106220* Daten der Tabelle FEV2VD VKMS Fahrzeug aktuell zur VIN
106230*----------------------------------------------------------------
106240 T-100-FEV2VD-SELECT SECTION.
106250     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
106260       DISPLAY "++25889-->T-100-FEV2VD-SELECT SECTION.  "
106270     DISPLAY "++W549AX-V-ID-TRACE = "
106280        W549AX-V-ID-TRACE                             *>++DELETE
106290     DISPLAY "++W549AN-TRACE-LEVEL = "
106300        W549AN-TRACE-LEVEL                            *>++DELETE
106310     END-IF                                           *>++DELETE
106320
106330     EXEC SQL
106340         SELECT FZ_ID_ZAHL
106350         INTO  :B2VDAN-FZ-ID-ZAHL
106360                 :B2VDAN-I-FZ-ID-ZAHL
106370         FROM   FEV2VD
106380         WHERE  VIN = :B2VDAX-VIN
106390     END-EXEC
106400     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
106410     DISPLAY "++EXEC SQL                                         "
106420     DISPLAY "++ SELECT FZ_ID_ZAHL                               "
106430     DISPLAY "++ INTO " B2VDAN-FZ-ID-ZAHL "                      "
106440     DISPLAY "++ " B2VDAN-I-FZ-ID-ZAHL "                         "
106450     DISPLAY "++ FROM FEV2VD                                     "
106460     DISPLAY "++ WHERE VIN = " B2VDAX-VIN "                      "
106470     DISPLAY "++END-EXEC                                         "
106480     DISPLAY "++SQLCODE --> " SQLCODE
106490     END-IF                                           *>++DELETE
106500
106510     MOVE SQLCA TO SQL-SQLCA
106520
106530     EVALUATE SQLAX-SQLSTATE
106540       WHEN DB2-OK
106550         IF B2VDAN-I-FZ-ID-ZAHL    < ZERO
106560           MOVE ZERO               TO B2VDAN-FZ-ID-ZAHL
106570         END-IF
106580
106590       WHEN DB2-NOT-FOUND
106600         CONTINUE
106610       WHEN OTHER
106620         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
106630         MOVE 'T-100-FEV2VD-SELECT'
106640                                   TO W549AX-SECTION
106650         PERFORM Z80-DB2-FEHLER
106660     END-EVALUATE
106670
106680     CONTINUE.
106690 T-100-FEV2VD-SELECT-E.
106700     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
106710       DISPLAY "++25889-->T-100-FEV2VD-SELECT-E.        "
106720     DISPLAY "++W549AX-V-ID-TRACE = "
106730        W549AX-V-ID-TRACE                             *>++DELETE
106740     DISPLAY "++W549AN-TRACE-LEVEL = "
106750        W549AN-TRACE-LEVEL                            *>++DELETE
106760     END-IF                                           *>++DELETE
106770     EXIT.
106780/
106790*----------------------------------------------------------------
106800* Lesen aller Transponder zur akt. VIN
106810* zur akt. SKC0-KEY-TYP-ID-ZAHL und Status 8080, 8082, 8045
106820*----------------------------------------------------------------
106830 T-100-FEV2X3-CUR-OPEN SECTION.
106840     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
106850       DISPLAY "++25889-->T-100-FEV2X3-CUR-OPEN SECTION."
106860     DISPLAY "++W549AX-V-ID-TRACE = "
106870        W549AX-V-ID-TRACE                             *>++DELETE
106880     DISPLAY "++W549AN-TRACE-LEVEL = "
106890        W549AN-TRACE-LEVEL                            *>++DELETE
106900     END-IF                                           *>++DELETE
106910
106920     EXEC SQL
106930       DECLARE C_BGRP  CURSOR FOR
106940       SELECT  TRANSPOND_ID
106950             , BGRP
106960       FROM FEV2X3
106970       WHERE VIN            = :B2X3AX-VIN
106980         AND SKC0_KEY_TYP_ID_ZAHL
106990                            = :B2X3AN-SKC0-KEY-TYP-ID-ZAHL
107000         AND TEXT_TRANSPOND_STATUS
107010                            IN (8080, 8082, 8045)
107020       FOR FETCH ONLY
107030       WITH UR
107040     END-EXEC
107050     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107060     DISPLAY "++EXEC SQL                                         "
107070     DISPLAY "++ DECLARE C_BGRP CURSOR FOR                       "
107080     DISPLAY "++ SELECT TRANSPOND_ID                             "
107090     DISPLAY "++ , BGRP                                          "
107100     DISPLAY "++ FROM FEV2X3                                     "
107110     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
107120     DISPLAY "++ AND SKC0_KEY_TYP_ID_ZAHL                        "
107130     DISPLAY "++ = " B2X3AN-SKC0-KEY-TYP-ID-ZAHL "               "
107140     DISPLAY "++ AND TEXT_TRANSPOND_STATUS                       "
107150     DISPLAY "++ IN (8080, 8082, 8045)                           "
107160     DISPLAY "++ FOR FETCH ONLY                                  "
107170     DISPLAY "++ WITH UR                                         "
107180     DISPLAY "++END-EXEC                                         "
107190     DISPLAY "++SQLCODE --> " SQLCODE
107200     END-IF                                           *>++DELETE
107210
107220     EXEC SQL
107230       OPEN C_BGRP
107240     END-EXEC
107250     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107260     DISPLAY "++EXEC SQL                                         "
107270     DISPLAY "++ OPEN C_BGRP                                     "
107280     DISPLAY "++END-EXEC                                         "
107290     DISPLAY "++SQLCODE --> " SQLCODE
107300     END-IF                                           *>++DELETE
107310
107320     MOVE SQLCA TO SQL-SQLCA
107330
107340     IF SQLAX-SQLSTATE             = DB2-OK
107350       CONTINUE
107360     ELSE
107370       MOVE 'T-100-FEV2X3-CUR-OPEN' TO W549AX-SECTION
107380       PERFORM Z80-DB2-FEHLER
107390     END-IF
107400
107410     CONTINUE.
107420 T-100-FEV2X3-CUR-OPEN-E.
107430     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107440       DISPLAY "++25889-->T-100-FEV2X3-CUR-OPEN-E.      "
107450     DISPLAY "++W549AX-V-ID-TRACE = "
107460        W549AX-V-ID-TRACE                             *>++DELETE
107470     DISPLAY "++W549AN-TRACE-LEVEL = "
107480        W549AN-TRACE-LEVEL                            *>++DELETE
107490     END-IF                                           *>++DELETE
107500     EXIT.
107510/
107520*----------------------------------------------------------------
107530* Lesen aller Transponder zur akt. VIN
107540* zur akt. SKC0-KEY-TYP-ID-ZAHL und Status 8080, 8082, 8045
107550*----------------------------------------------------------------
107560 T-100-FEV2X3-CUR-FETCH SECTION.
107570     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107580       DISPLAY "++25889-->T-100-FEV2X3-CUR-FETCH SECTION"
107590     DISPLAY "++W549AX-V-ID-TRACE = "
107600        W549AX-V-ID-TRACE                             *>++DELETE
107610     DISPLAY "++W549AN-TRACE-LEVEL = "
107620        W549AN-TRACE-LEVEL                            *>++DELETE
107630     END-IF                                           *>++DELETE
107640
107650     EXEC SQL
107660       FETCH C_BGRP
107670       INTO   :B2X3AX-TRANSPOND-ID
107680             ,:B2X3AX-BGRP
107690                :B0X3AN-I-BGRP
107700     END-EXEC
107710     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107720     DISPLAY "++EXEC SQL                                         "
107730     DISPLAY "++ FETCH C_BGRP                                    "
107740     DISPLAY "++ INTO " B2X3AX-TRANSPOND-ID "                    "
107750     DISPLAY "++ ," B2X3AX-BGRP "                                "
107760     DISPLAY "++ " B0X3AN-I-BGRP "                               "
107770     DISPLAY "++END-EXEC                                         "
107780     DISPLAY "++SQLCODE --> " SQLCODE
107790     END-IF                                           *>++DELETE
107800
107810     MOVE SQLCA TO SQL-SQLCA
107820
107830     IF  SQLAX-SQLSTATE = ( DB2-OK OR DB2-NOT-FOUND )
107840       CONTINUE
107850     ELSE
107860       MOVE 'T-100-FEV2X3-CUR-FETCH' TO W549AX-SECTION
107870       PERFORM Z80-DB2-FEHLER
107880     END-IF
107890
107900     CONTINUE.
107910 T-100-FEV2X3-CUR-FETCH-E.
107920     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
107930       DISPLAY "++25889-->T-100-FEV2X3-CUR-FETCH-E.     "
107940     DISPLAY "++W549AX-V-ID-TRACE = "
107950        W549AX-V-ID-TRACE                             *>++DELETE
107960     DISPLAY "++W549AN-TRACE-LEVEL = "
107970        W549AN-TRACE-LEVEL                            *>++DELETE
107980     END-IF                                           *>++DELETE
107990     EXIT.
108000/
108010*----------------------------------------------------------------
108020* Lesen aller Transponder zur akt. VIN
108030*----------------------------------------------------------------
108040 T-100-FEV2X3-CUR-CLOSE SECTION.
108050     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
108060       DISPLAY "++25889-->T-100-FEV2X3-CUR-CLOSE SECTION"
108070     DISPLAY "++W549AX-V-ID-TRACE = "
108080        W549AX-V-ID-TRACE                             *>++DELETE
108090     DISPLAY "++W549AN-TRACE-LEVEL = "
108100        W549AN-TRACE-LEVEL                            *>++DELETE
108110     END-IF                                           *>++DELETE
108120
108130     EXEC SQL
108140       CLOSE C_BGRP
108150     END-EXEC
108160     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
108170     DISPLAY "++EXEC SQL                                         "
108180     DISPLAY "++ CLOSE C_BGRP                                    "
108190     DISPLAY "++END-EXEC                                         "
108200     DISPLAY "++SQLCODE --> " SQLCODE
108210     END-IF                                           *>++DELETE
108220
108230     MOVE SQLCA TO SQL-SQLCA
108240
108250     IF SQLAX-SQLSTATE             = DB2-OK
108260       CONTINUE
108270     ELSE
108280       MOVE 'T-100-FEV2X3-CUR-CLOSE' TO W549AX-SECTION
108290       PERFORM Z80-DB2-FEHLER
108300     END-IF
108310
108320     CONTINUE.
108330 T-100-FEV2X3-CUR-CLOSE-E.
108340     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
108350       DISPLAY "++25889-->T-100-FEV2X3-CUR-CLOSE-E.     "
108360     DISPLAY "++W549AX-V-ID-TRACE = "
108370        W549AX-V-ID-TRACE                             *>++DELETE
108380     DISPLAY "++W549AN-TRACE-LEVEL = "
108390        W549AN-TRACE-LEVEL                            *>++DELETE
108400     END-IF                                           *>++DELETE
108410     EXIT.
108420/
108430*----------------------------------------------------------------
108440* Daten zum Transponder aktuell lesen wg. PSS-Werten
108450*----------------------------------------------------------------
108460* Transponderdaten lesen mit VIN, TRA-ID, TRA-TYP
108470*                            ältester Eintrag = MIN(UTC_V_ID)
108480*                            TRANSPOND_ID_ZAHL > 0
108490*----------------------------------------------------------------
108500 T-100-FEV0X3-SEL4PSS SECTION.
108510     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
108520       DISPLAY "++25889-->T-100-FEV0X3-SEL4PSS SECTION. "
108530     DISPLAY "++W549AX-V-ID-TRACE = "
108540        W549AX-V-ID-TRACE                             *>++DELETE
108550     DISPLAY "++W549AN-TRACE-LEVEL = "
108560        W549AN-TRACE-LEVEL                            *>++DELETE
108570     END-IF                                           *>++DELETE
108580
108590     EXEC SQL
108600       SELECT  TEXT_TRANSPOND_STATUS
108610             , VIN
108620             , BGRP
108630             , SKC0_KEY_TYP_ID
108640             , SKC0_KEY_TYP_ID_ZAHL
108650             , TRANSPOND_ID_ZAHL
108660             , PSS_FZ_ID_ZAHL
108670             , PSS_KRYPTOREGION
108680             , PSS_BGRP
108690             , PSS_KEY_TYP_ID
108700             , PSS_KEY_TYP_ID_ZAHL
108710             , PSS_VKMS_KEY_AUFBAU_VERSION
108720             , PSS_VIN
108730        INTO  :B0X3AN-TEXT-TRANSPOND-STATUS
108740             ,:B0X3AX-VIN
108750             ,:B0X3AX-BGRP
108760                :B0X3AN-I-BGRP
108770             ,:B0X3AN-SKC0-KEY-TYP-ID
108780                :B0X3AN-I-SKC0-KEY-TYP-ID
108790             ,:B0X3AN-SKC0-KEY-TYP-ID-ZAHL
108800                :B0X3AN-I-SKC0-KEY-TYP-ID-ZAHL
108810             ,:B0X3AN-TRANSPOND-ID-ZAHL
108820             ,:B0X3AN-PSS-FZ-ID-ZAHL
108830             ,:B0X3AX-PSS-KRYPTOREGION
108840             ,:B0X3AX-PSS-BGRP
108850             ,:B0X3AN-PSS-KEY-TYP-ID
108860             ,:B0X3AN-PSS-KEY-TYP-ID-ZAHL
108870             ,:B0X3AN-PSS-VKMS-KEY-AUFBAU-VER
108880             ,:B0X3AX-PSS-VIN
108890       FROM FEV0X3
108900       WHERE TRANSPOND_ID      = :B0X3AX-TRANSPOND-ID
108910         AND TRANSPOND_TYP     = :B0X3AX-TRANSPOND-TYP
108920         AND BGRP                  IS NOT NULL
108930         AND UTC_V_ID = (SELECT MAX(UTC_V_ID)
108940                         FROM FEV0X3
108950                        WHERE TRANSPOND_ID  = :B0X3AX-TRANSPOND-ID
108960                        AND TRANSPOND_TYP  = :B0X3AX-TRANSPOND-TYP
108970                        AND BGRP          IS NOT NULL
108980                        )
108990       FETCH FIRST 1 ROW ONLY
109000       WITH UR
109010     END-EXEC
109020     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
109030     DISPLAY "++EXEC SQL                                         "
109040     DISPLAY "++ SELECT TEXT_TRANSPOND_STATUS                    "
109050     DISPLAY "++ , VIN                                           "
109060     DISPLAY "++ , BGRP                                          "
109070     DISPLAY "++ , SKC0_KEY_TYP_ID                               "
109080     DISPLAY "++ , SKC0_KEY_TYP_ID_ZAHL                          "
109090     DISPLAY "++ , TRANSPOND_ID_ZAHL                             "
109100     DISPLAY "++ , PSS_FZ_ID_ZAHL                                "
109110     DISPLAY "++ , PSS_KRYPTOREGION                              "
109120     DISPLAY "++ , PSS_BGRP                                      "
109130     DISPLAY "++ , PSS_KEY_TYP_ID                                "
109140     DISPLAY "++ , PSS_KEY_TYP_ID_ZAHL                           "
109150     DISPLAY "++ , PSS_VKMS_KEY_AUFBAU_VERSION                   "
109160     DISPLAY "++ , PSS_VIN                                       "
109170     DISPLAY "++ INTO " B0X3AN-TEXT-TRANSPOND-STATUS "           "
109180     DISPLAY "++ ," B0X3AX-VIN "                                 "
109190     DISPLAY "++ ," B0X3AX-BGRP "                                "
109200     DISPLAY "++ " B0X3AN-I-BGRP "                               "
109210     DISPLAY "++ ," B0X3AN-SKC0-KEY-TYP-ID "                     "
109220     DISPLAY "++ " B0X3AN-I-SKC0-KEY-TYP-ID "                    "
109230     DISPLAY "++ ," B0X3AN-SKC0-KEY-TYP-ID-ZAHL "                "
109240     DISPLAY "++ " B0X3AN-I-SKC0-KEY-TYP-ID-ZAHL "               "
109250     DISPLAY "++ ," B0X3AN-TRANSPOND-ID-ZAHL "                   "
109260     DISPLAY "++ ," B0X3AN-PSS-FZ-ID-ZAHL "                      "
109270     DISPLAY "++ ," B0X3AX-PSS-KRYPTOREGION "                    "
109280     DISPLAY "++ ," B0X3AX-PSS-BGRP "                            "
109290     DISPLAY "++ ," B0X3AN-PSS-KEY-TYP-ID "                      "
109300     DISPLAY "++ ," B0X3AN-PSS-KEY-TYP-ID-ZAHL "                 "
109310     DISPLAY "++ ," B0X3AN-PSS-VKMS-KEY-AUFBAU-VER "             "
109320     DISPLAY "++ ," B0X3AX-PSS-VIN "                             "
109330     DISPLAY "++ FROM FEV0X3                                     "
109340     DISPLAY "++ WHERE TRANSPOND_ID = " B0X3AX-TRANSPOND-ID "    "
109350     DISPLAY "++ AND TRANSPOND_TYP = " B0X3AX-TRANSPOND-TYP "    "
109360     DISPLAY "++ AND BGRP IS NOT NULL                            "
109370     DISPLAY "++ AND UTC_V_ID = (SELECT MAX(UTC_V_ID)            "
109380     DISPLAY "++ FROM FEV0X3                                     "
109390     DISPLAY "++ WHERE TRANSPOND_ID = " B0X3AX-TRANSPOND-ID "    "
109400     DISPLAY "++ AND TRANSPOND_TYP = " B0X3AX-TRANSPOND-TYP "    "
109410     DISPLAY "++ AND BGRP IS NOT NULL                            "
109420     DISPLAY "++ )                                               "
109430     DISPLAY "++ FETCH FIRST 1 ROW ONLY                          "
109440     DISPLAY "++ WITH UR                                         "
109450     DISPLAY "++END-EXEC                                         "
109460     DISPLAY "++SQLCODE --> " SQLCODE
109470     END-IF                                           *>++DELETE
109480
109490     MOVE SQLCA TO SQL-SQLCA
109500
109510     EVALUATE SQLAX-SQLSTATE
109520       WHEN DB2-OK
109530         CONTINUE
109540       WHEN DB2-NOT-FOUND
109550*        -- Transponder nicht gefunden
109560         MOVE K1AN-T2872            TO W549AN-TEXT-RC
109570         MOVE K1AN-FEHLER           TO W549AN-TEXT-FEHLER-KLASSE
109580       WHEN OTHER
109590         MOVE 'T-100-FEV0X3-SEL4PSS' TO W549AX-SECTION
109600         PERFORM Z80-DB2-FEHLER
109610     END-EVALUATE
109620
109630     CONTINUE.
109640 T-100-FEV0X3-SEL4PSS-E.
109650     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
109660       DISPLAY "++25889-->T-100-FEV0X3-SEL4PSS-E.       "
109670     DISPLAY "++W549AX-V-ID-TRACE = "
109680        W549AX-V-ID-TRACE                             *>++DELETE
109690     DISPLAY "++W549AN-TRACE-LEVEL = "
109700        W549AN-TRACE-LEVEL                            *>++DELETE
109710     END-IF                                           *>++DELETE
109720     EXIT.
109730/
109740*----------------------------------------------------------------
109750* Höchste vergebene BGRP zur VIN lesen
109760* mit Status 8080, 8082 oder 8045
109770*----------------------------------------------------------------
109780 T-100-FEV0X3-MAX-BGRP SECTION.
109790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
109800       DISPLAY "++25889-->T-100-FEV0X3-MAX-BGRP SECTION."
109810     DISPLAY "++W549AX-V-ID-TRACE = "
109820        W549AX-V-ID-TRACE                             *>++DELETE
109830     DISPLAY "++W549AN-TRACE-LEVEL = "
109840        W549AN-TRACE-LEVEL                            *>++DELETE
109850     END-IF                                           *>++DELETE
109860
109870     EXEC SQL
109880       SELECT  MAX(BGRP)
109890        INTO  :B0X3AX-BGRP  :B0X3AN-I-BGRP
109900       FROM FEV0X3
109910       WHERE VIN          = :B0X3AX-VIN
109920         AND TEXT_TRANSPOND_STATUS IN (8080, 8082, 8045)
109930         AND UTC_V_ID = (SELECT MAX(UTC_V_ID)
109940                         FROM FEV0X3
109950                         WHERE VIN = :B0X3AX-VIN
109960                           AND TEXT_TRANSPOND_STATUS IN
109970                                        (8080, 8082, 8045)
109980                        )
109990       WITH UR
110000     END-EXEC
110010     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
110020     DISPLAY "++EXEC SQL                                         "
110030     DISPLAY "++ SELECT MAX(BGRP)                                "
110040     DISPLAY "++ INTO " B0X3AX-BGRP " " B0X3AN-I-BGRP "          "
110050     DISPLAY "++ FROM FEV0X3                                     "
110060     DISPLAY "++ WHERE VIN = " B0X3AX-VIN "                      "
110070     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN (8080, 8082, 8045) "
110080     DISPLAY "++ AND UTC_V_ID = (SELECT MAX(UTC_V_ID)            "
110090     DISPLAY "++ FROM FEV0X3                                     "
110100     DISPLAY "++ WHERE VIN = " B0X3AX-VIN "                      "
110110     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN                    "
110120     DISPLAY "++ (8080, 8082, 8045)                              "
110130     DISPLAY "++ )                                               "
110140     DISPLAY "++ WITH UR                                         "
110150     DISPLAY "++END-EXEC                                         "
110160     DISPLAY "++SQLCODE --> " SQLCODE
110170     END-IF                                           *>++DELETE
110180
110190     MOVE SQLCA TO SQL-SQLCA
110200
110210     EVALUATE SQLAX-SQLSTATE
110220       WHEN DB2-OK
110230         IF B0X3AN-I-BGRP < ZERO
110240           MOVE '500'              TO B0X3AX-BGRP
110250         END-IF
110260       WHEN DB2-NOT-FOUND
110270         CONTINUE
110280       WHEN OTHER
110290         MOVE 'T-100-FEV0X3-MAX-BGRP' TO W549AX-SECTION
110300         PERFORM Z80-DB2-FEHLER
110310     END-EVALUATE
110320
110330     CONTINUE.
110340 T-100-FEV0X3-MAX-BGRP-END.
110350     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
110360       DISPLAY "++25889-->T-100-FEV0X3-MAX-BGRP-END.    "
110370     DISPLAY "++W549AX-V-ID-TRACE = "
110380        W549AX-V-ID-TRACE                             *>++DELETE
110390     DISPLAY "++W549AN-TRACE-LEVEL = "
110400        W549AN-TRACE-LEVEL                            *>++DELETE
110410     END-IF                                           *>++DELETE
110420     EXIT.
110430/
110440*-----------------------------------------------------------------
110450* OPEN CURSOR C_FEV2X3
110460* Cursor zum deaktivieren der alten Transponder zur VIN
110470*-----------------------------------------------------------------
110480 T-100-FEV2X3-OPEN SECTION.
110490     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
110500       DISPLAY "++25889-->T-100-FEV2X3-OPEN SECTION.    "
110510     DISPLAY "++W549AX-V-ID-TRACE = "
110520        W549AX-V-ID-TRACE                             *>++DELETE
110530     DISPLAY "++W549AN-TRACE-LEVEL = "
110540        W549AN-TRACE-LEVEL                            *>++DELETE
110550     END-IF                                           *>++DELETE
110560
110570     EXEC SQL
110580       DECLARE C_FEV2X3 CURSOR FOR
110590       SELECT UTC_V_ID
110600            , VIN
110610            , TRANSPOND_ID
110620            , TRANSPOND_TYP
110630            , TEXT_TRANSPOND_STATUS
110640            , BGRP
110650            , SKC0_KEY_TYP_ID
110660            , SKC0_KEY_TYP_ID_ZAHL
110670            , TRANSPOND_ID_ZAHL
110680            , PSS_FZ_ID_ZAHL
110690            , PSS_KRYPTOREGION
110700            , PSS_BGRP
110710            , PSS_KEY_TYP_ID
110720            , PSS_KEY_TYP_ID_ZAHL
110730            , PSS_VKMS_KEY_AUFBAU_VERSION
110740            , PSS_VIN
110750       FROM   FEV2X3
110760       WHERE  VIN      = :B2X3AX-VIN
110770       FOR FETCH ONLY
110780       WITH UR
110790     END-EXEC
110800     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
110810     DISPLAY "++EXEC SQL                                         "
110820     DISPLAY "++ DECLARE C_FEV2X3 CURSOR FOR                     "
110830     DISPLAY "++ SELECT UTC_V_ID                                 "
110840     DISPLAY "++ , VIN                                           "
110850     DISPLAY "++ , TRANSPOND_ID                                  "
110860     DISPLAY "++ , TRANSPOND_TYP                                 "
110870     DISPLAY "++ , TEXT_TRANSPOND_STATUS                         "
110880     DISPLAY "++ , BGRP                                          "
110890     DISPLAY "++ , SKC0_KEY_TYP_ID                               "
110900     DISPLAY "++ , SKC0_KEY_TYP_ID_ZAHL                          "
110910     DISPLAY "++ , TRANSPOND_ID_ZAHL                             "
110920     DISPLAY "++ , PSS_FZ_ID_ZAHL                                "
110930     DISPLAY "++ , PSS_KRYPTOREGION                              "
110940     DISPLAY "++ , PSS_BGRP                                      "
110950     DISPLAY "++ , PSS_KEY_TYP_ID                                "
110960     DISPLAY "++ , PSS_KEY_TYP_ID_ZAHL                           "
110970     DISPLAY "++ , PSS_VKMS_KEY_AUFBAU_VERSION                   "
110980     DISPLAY "++ , PSS_VIN                                       "
110990     DISPLAY "++ FROM FEV2X3                                     "
111000     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
111010     DISPLAY "++ FOR FETCH ONLY                                  "
111020     DISPLAY "++ WITH UR                                         "
111030     DISPLAY "++END-EXEC                                         "
111040     DISPLAY "++SQLCODE --> " SQLCODE
111050     END-IF                                           *>++DELETE
111060
111070     EXEC SQL
111080       OPEN C_FEV2X3
111090     END-EXEC
111100     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
111110     DISPLAY "++EXEC SQL                                         "
111120     DISPLAY "++ OPEN C_FEV2X3                                   "
111130     DISPLAY "++END-EXEC                                         "
111140     DISPLAY "++SQLCODE --> " SQLCODE
111150     END-IF                                           *>++DELETE
111160
111170     MOVE SQLCA                    TO SQL-SQLCA
111180
111190     EVALUATE SQLAX-SQLSTATE
111200       WHEN DB2-OK
111210         CONTINUE
111220       WHEN OTHER
111230         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
111240         MOVE 'T-100-FEV2X3-OPEN'  TO W549AX-SECTION
111250         PERFORM Z80-DB2-FEHLER
111260     END-EVALUATE
111270
111280     CONTINUE.
111290 T-100-FEV2X3-OPEN-END.
111300     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
111310       DISPLAY "++25889-->T-100-FEV2X3-OPEN-END.        "
111320     DISPLAY "++W549AX-V-ID-TRACE = "
111330        W549AX-V-ID-TRACE                             *>++DELETE
111340     DISPLAY "++W549AN-TRACE-LEVEL = "
111350        W549AN-TRACE-LEVEL                            *>++DELETE
111360     END-IF                                           *>++DELETE
111370     EXIT.
111380*-----------------------------------------------------------------
111390* FETCH CURSOR C_FEV2X3
111400*-----------------------------------------------------------------
111410 T-100-FEV2X3-FETCH SECTION.
111420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
111430       DISPLAY "++25889-->T-100-FEV2X3-FETCH SECTION.   "
111440     DISPLAY "++W549AX-V-ID-TRACE = "
111450        W549AX-V-ID-TRACE                             *>++DELETE
111460     DISPLAY "++W549AN-TRACE-LEVEL = "
111470        W549AN-TRACE-LEVEL                            *>++DELETE
111480     END-IF                                           *>++DELETE
111490
111500     EXEC SQL
111510       FETCH C_FEV2X3
111520       INTO    :B2X3AX-UTC-V-ID
111530             , :B2X3AX-VIN
111540             , :B2X3AX-TRANSPOND-ID
111550             , :B2X3AX-TRANSPOND-TYP
111560             , :B2X3AN-TEXT-TRANSPOND-STATUS
111570             , :B2X3AX-BGRP
111580                 :B2X3AN-I-BGRP
111590             , :B2X3AN-SKC0-KEY-TYP-ID
111600                 :B2X3AN-I-SKC0-KEY-TYP-ID
111610             , :B2X3AN-SKC0-KEY-TYP-ID-ZAHL
111620                 :B2X3AN-I-SKC0-KEY-TYP-ID-ZAHL
111630             , :B2X3AN-TRANSPOND-ID-ZAHL
111640             , :B2X3AN-PSS-FZ-ID-ZAHL
111650             , :B2X3AX-PSS-KRYPTOREGION
111660             , :B2X3AX-PSS-BGRP
111670             , :B2X3AN-PSS-KEY-TYP-ID
111680             , :B2X3AN-PSS-KEY-TYP-ID-ZAHL
111690             , :B2X3AN-PSS-VKMS-KEY-AUFBAU-VER
111700             , :B2X3AX-PSS-VIN
111710     END-EXEC
111720     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
111730     DISPLAY "++EXEC SQL                                         "
111740     DISPLAY "++ FETCH C_FEV2X3                                  "
111750     DISPLAY "++ INTO " B2X3AX-UTC-V-ID "                        "
111760     DISPLAY "++ , " B2X3AX-VIN "                                "
111770     DISPLAY "++ , " B2X3AX-TRANSPOND-ID "                       "
111780     DISPLAY "++ , " B2X3AX-TRANSPOND-TYP "                      "
111790     DISPLAY "++ , " B2X3AN-TEXT-TRANSPOND-STATUS "              "
111800     DISPLAY "++ , " B2X3AX-BGRP "                               "
111810     DISPLAY "++ " B2X3AN-I-BGRP "                               "
111820     DISPLAY "++ , " B2X3AN-SKC0-KEY-TYP-ID "                    "
111830     DISPLAY "++ " B2X3AN-I-SKC0-KEY-TYP-ID "                    "
111840     DISPLAY "++ , " B2X3AN-SKC0-KEY-TYP-ID-ZAHL "               "
111850     DISPLAY "++ " B2X3AN-I-SKC0-KEY-TYP-ID-ZAHL "               "
111860     DISPLAY "++ , " B2X3AN-TRANSPOND-ID-ZAHL "                  "
111870     DISPLAY "++ , " B2X3AN-PSS-FZ-ID-ZAHL "                     "
111880     DISPLAY "++ , " B2X3AX-PSS-KRYPTOREGION "                   "
111890     DISPLAY "++ , " B2X3AX-PSS-BGRP "                           "
111900     DISPLAY "++ , " B2X3AN-PSS-KEY-TYP-ID "                     "
111910     DISPLAY "++ , " B2X3AN-PSS-KEY-TYP-ID-ZAHL "                "
111920     DISPLAY "++ , " B2X3AN-PSS-VKMS-KEY-AUFBAU-VER "            "
111930     DISPLAY "++ , " B2X3AX-PSS-VIN "                            "
111940     DISPLAY "++END-EXEC                                         "
111950     DISPLAY "++SQLCODE --> " SQLCODE
111960     END-IF                                           *>++DELETE
111970
111980     MOVE SQLCA                    TO SQL-SQLCA
111990
112000     EVALUATE SQLAX-SQLSTATE
112010       WHEN DB2-OK
112020       WHEN DB2-NOT-FOUND
112030         CONTINUE
112040       WHEN OTHER
112050         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
112060         MOVE 'T-100-FEV2X3-FETCH' TO W549AX-SECTION
112070         PERFORM Z80-DB2-FEHLER
112080     END-EVALUATE
112090
112100     CONTINUE.
112110 T-100-FEV2X3-FETCH-END.
112120     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112130       DISPLAY "++25889-->T-100-FEV2X3-FETCH-END.       "
112140     DISPLAY "++W549AX-V-ID-TRACE = "
112150        W549AX-V-ID-TRACE                             *>++DELETE
112160     DISPLAY "++W549AN-TRACE-LEVEL = "
112170        W549AN-TRACE-LEVEL                            *>++DELETE
112180     END-IF                                           *>++DELETE
112190     EXIT.
112200/
112210*-----------------------------------------------------------------
112220* CLOSE CURSOR C_FEV2X3
112230*-----------------------------------------------------------------
112240 T-100-FEV2X3-CLOSE SECTION.
112250     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112260       DISPLAY "++25889-->T-100-FEV2X3-CLOSE SECTION.   "
112270     DISPLAY "++W549AX-V-ID-TRACE = "
112280        W549AX-V-ID-TRACE                             *>++DELETE
112290     DISPLAY "++W549AN-TRACE-LEVEL = "
112300        W549AN-TRACE-LEVEL                            *>++DELETE
112310     END-IF                                           *>++DELETE
112320
112330     EXEC SQL
112340       CLOSE C_FEV2X3
112350     END-EXEC
112360     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112370     DISPLAY "++EXEC SQL                                         "
112380     DISPLAY "++ CLOSE C_FEV2X3                                  "
112390     DISPLAY "++END-EXEC                                         "
112400     DISPLAY "++SQLCODE --> " SQLCODE
112410     END-IF                                           *>++DELETE
112420
112430     MOVE SQLCA                    TO SQL-SQLCA
112440
112450     EVALUATE SQLAX-SQLSTATE
112460       WHEN DB2-OK
112470         CONTINUE
112480       WHEN OTHER
112490         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
112500         MOVE 'T-100-FEV2X3-CLOSE' TO W549AX-SECTION
112510         PERFORM Z80-DB2-FEHLER
112520     END-EVALUATE
112530
112540     CONTINUE.
112550 T-100-FEV2X3-CLOSE-END.
112560     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112570       DISPLAY "++25889-->T-100-FEV2X3-CLOSE-END.       "
112580     DISPLAY "++W549AX-V-ID-TRACE = "
112590        W549AX-V-ID-TRACE                             *>++DELETE
112600     DISPLAY "++W549AN-TRACE-LEVEL = "
112610        W549AN-TRACE-LEVEL                            *>++DELETE
112620     END-IF                                           *>++DELETE
112630     EXIT.
112640/
112650*-----------------------------------------------------------------
112660* Alle Transponder zur VIN lesen, die bereits angelernt wurden
112670* Eingabe: S551AX-E-VIN
112680* Ausgabe: W1AN-ANZ-TRA-X30-ANG
112690*-----------------------------------------------------------------
112700 T-100-FEV2X3-ANZ-TRA SECTION.
112710     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112720       DISPLAY "++25889-->T-100-FEV2X3-ANZ-TRA SECTION. "
112730     DISPLAY "++W549AX-V-ID-TRACE = "
112740        W549AX-V-ID-TRACE                             *>++DELETE
112750     DISPLAY "++W549AN-TRACE-LEVEL = "
112760        W549AN-TRACE-LEVEL                            *>++DELETE
112770     END-IF                                           *>++DELETE
112780
112790     MOVE ZERO                    TO W1AN-I-ANZ-TRA-X30-ANG
112800                                     W1AN-ANZ-TRA-X30-ANG
112810
112820     EXEC SQL
112830       SELECT COUNT(TRANSPOND_ID)
112840       INTO :W1AN-ANZ-TRA-X30-ANG
112850                  :W1AN-I-ANZ-TRA-X30-ANG
112860       FROM  FEV2X3
112870       WHERE VIN                   = :B2X3AX-VIN
112880         AND TEXT_TRANSPOND_STATUS in (8080, 8082, 8045)
112890         AND SKC0_KEY_TYP_ID_ZAHL
112900                             = :B2X3AN-SKC0-KEY-TYP-ID-ZAHL
112910         AND TRANSPOND_ID NOT IN
112920             ( :W1AX-TRA-1, :W1AX-TRA-2, :W1AX-TRA-3,
112930               :W1AX-TRA-4, :W1AX-TRA-5, :W1AX-TRA-6,
112940               :W1AX-TRA-7, :W1AX-TRA-8
112950             )
112960         AND BGRP BETWEEN '501' AND '508'
112970     END-EXEC
112980     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
112990     DISPLAY "++EXEC SQL                                         "
113000     DISPLAY "++ SELECT COUNT(TRANSPOND_ID)                      "
113010     DISPLAY "++ INTO " W1AN-ANZ-TRA-X30-ANG "                   "
113020     DISPLAY "++ " W1AN-I-ANZ-TRA-X30-ANG "                      "
113030     DISPLAY "++ FROM FEV2X3                                     "
113040     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
113050     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN (8080, 8082, 8045) "
113060     DISPLAY "++ AND SKC0_KEY_TYP_ID_ZAHL                        "
113070     DISPLAY "++ = " B2X3AN-SKC0-KEY-TYP-ID-ZAHL "               "
113080     DISPLAY "++ AND TRANSPOND_ID NOT IN                         "
113090*    DISPLAY "++ ( " W1AX-TRA-1, " " W1AX-TRA-2, " " W1AX-TRA-3,
113100     DISPLAY "++ " W1AX-TRA-4, " " W1AX-TRA-5, " " W1AX-TRA-6, " "
113110     DISPLAY "++ " W1AX-TRA-7, " " W1AX-TRA-8 "                  "
113120     DISPLAY "++ )                                               "
113130     DISPLAY "++ AND BGRP BETWEEN '501' AND '508'                "
113140     DISPLAY "++END-EXEC                                         "
113150     DISPLAY "++SQLCODE --> " SQLCODE
113160     END-IF                                           *>++DELETE
113170
113180     MOVE SQLCA                    TO SQL-SQLCA
113190
113200     EVALUATE SQLAX-SQLSTATE
113210       WHEN DB2-OK
113220         IF W1AN-I-ANZ-TRA-X30-ANG = -1
113230           MOVE ZERO               TO W1AN-ANZ-TRA-X30-ANG
113240         ELSE
113250           CONTINUE
113260         END-IF
113270       WHEN DB2-NOT-FOUND
113280         CONTINUE
113290       WHEN OTHER
113300         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
113310         MOVE 'T-100-FEV2X3-ANZ-TRA' TO W549AX-SECTION
113320         PERFORM Z80-DB2-FEHLER
113330     END-EVALUATE
113340
113350     CONTINUE.
113360 T-100-FEV2X3-ANZ-TRA-END.
113370     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
113380       DISPLAY "++25889-->T-100-FEV2X3-ANZ-TRA-END.     "
113390     DISPLAY "++W549AX-V-ID-TRACE = "
113400        W549AX-V-ID-TRACE                             *>++DELETE
113410     DISPLAY "++W549AN-TRACE-LEVEL = "
113420        W549AN-TRACE-LEVEL                            *>++DELETE
113430     END-IF                                           *>++DELETE
113440     EXIT.
113450/
113460*-----------------------------------------------------------------
113470* DATEN DER TABELLE FE01TX30 LESEN
113480* Feststellen, ob Transponder einem anderen Fzg zugeordnet ist
113490* View FEV2X3
113500*-----------------------------------------------------------------
113510 T-100-FEV2X3-SELECT    SECTION.
113520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
113530       DISPLAY "++25889-->T-100-FEV2X3-SELECT    SECTION"
113540     DISPLAY "++W549AX-V-ID-TRACE = "
113550        W549AX-V-ID-TRACE                             *>++DELETE
113560     DISPLAY "++W549AN-TRACE-LEVEL = "
113570        W549AN-TRACE-LEVEL                            *>++DELETE
113580     END-IF                                           *>++DELETE
113590
113600     EXEC SQL
113610       SELECT UTC_V_ID
113620             ,VIN
113630       INTO   :B2X3AX-UTC-V-ID
113640             ,:B2X3AX-VIN
113650       FROM  FEV2X3
113660       WHERE TRANSPOND_ID = :B2X3AX-TRANSPOND-ID
113670       AND UTC_V_ID = (SELECT MAX(UTC_V_ID)
113680                       FROM  FEV2X3
113690                       WHERE TRANSPOND_ID = :B2X3AX-TRANSPOND-ID
113700                      )
113710       WITH UR
113720     END-EXEC
113730     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
113740     DISPLAY "++EXEC SQL                                         "
113750     DISPLAY "++ SELECT UTC_V_ID                                 "
113760     DISPLAY "++ ,VIN                                            "
113770     DISPLAY "++ INTO " B2X3AX-UTC-V-ID "                        "
113780     DISPLAY "++ ," B2X3AX-VIN "                                 "
113790     DISPLAY "++ FROM FEV2X3                                     "
113800     DISPLAY "++ WHERE TRANSPOND_ID = " B2X3AX-TRANSPOND-ID "    "
113810     DISPLAY "++ AND UTC_V_ID = (SELECT MAX(UTC_V_ID)            "
113820     DISPLAY "++ FROM FEV2X3                                     "
113830     DISPLAY "++ WHERE TRANSPOND_ID = " B2X3AX-TRANSPOND-ID "    "
113840     DISPLAY "++ )                                               "
113850     DISPLAY "++ WITH UR                                         "
113860     DISPLAY "++END-EXEC                                         "
113870     DISPLAY "++SQLCODE --> " SQLCODE
113880     END-IF                                           *>++DELETE
113890
113900     MOVE SQLCA TO SQL-SQLCA
113910
113920     EVALUATE SQLAX-SQLSTATE
113930       WHEN DB2-OK
113940       WHEN DB2-NOT-FOUND
113950         CONTINUE
113960       WHEN OTHER
113970         MOVE 'T-100-FEV2X3-SELECT' TO W549AX-SECTION
113980         PERFORM Z80-DB2-FEHLER
113990     END-EVALUATE
114000
114010     CONTINUE.
114020 T-100-FEV2X3-SELECT-END.
114030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
114040       DISPLAY "++25889-->T-100-FEV2X3-SELECT-END.      "
114050     DISPLAY "++W549AX-V-ID-TRACE = "
114060        W549AX-V-ID-TRACE                             *>++DELETE
114070     DISPLAY "++W549AN-TRACE-LEVEL = "
114080        W549AN-TRACE-LEVEL                            *>++DELETE
114090     END-IF                                           *>++DELETE
114100     EXIT.
114110/
114120*-----------------------------------------------------------------
114130* DATEN DER TABELLE FE01TX30 LESEN
114140* Feststellen, ob Transponder einem anderen Fzg zugeordnet ist
114150* View FEV2X3
114160*-----------------------------------------------------------------
114170 T-100-FEV2X3-SEL-2     SECTION.
114180     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
114190       DISPLAY "++25889-->T-100-FEV2X3-SEL-2     SECTION"
114200     DISPLAY "++W549AX-V-ID-TRACE = "
114210        W549AX-V-ID-TRACE                             *>++DELETE
114220     DISPLAY "++W549AN-TRACE-LEVEL = "
114230        W549AN-TRACE-LEVEL                            *>++DELETE
114240     END-IF                                           *>++DELETE
114250
114260     EXEC SQL
114270       SELECT UTC_V_ID
114280       INTO   :B2X3AX-UTC-V-ID
114290       FROM  FEV2X3
114300       WHERE TRANSPOND_ID = :B2X3AX-TRANSPOND-ID
114310         AND VIN          = :B2X3AX-VIN
114320       FETCH FIRST ROW ONLY
114330       WITH UR
114340     END-EXEC
114350     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
114360     DISPLAY "++EXEC SQL                                         "
114370     DISPLAY "++ SELECT UTC_V_ID                                 "
114380     DISPLAY "++ INTO " B2X3AX-UTC-V-ID "                        "
114390     DISPLAY "++ FROM FEV2X3                                     "
114400     DISPLAY "++ WHERE TRANSPOND_ID = " B2X3AX-TRANSPOND-ID "    "
114410     DISPLAY "++ AND VIN = " B2X3AX-VIN "                        "
114420     DISPLAY "++ FETCH FIRST ROW ONLY                            "
114430     DISPLAY "++ WITH UR                                         "
114440     DISPLAY "++END-EXEC                                         "
114450     DISPLAY "++SQLCODE --> " SQLCODE
114460     END-IF                                           *>++DELETE
114470
114480     MOVE SQLCA TO SQL-SQLCA
114490
114500     EVALUATE SQLAX-SQLSTATE
114510       WHEN DB2-OK
114520       WHEN DB2-NOT-FOUND
114530         CONTINUE
114540       WHEN OTHER
114550         MOVE 'T-100-FEV2X3-SEL-2 ' TO W549AX-SECTION
114560         PERFORM Z80-DB2-FEHLER
114570     END-EVALUATE
114580
114590     CONTINUE.
114600 T-100-FEV2X3-SEL-2-END.
114610     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
114620       DISPLAY "++25889-->T-100-FEV2X3-SEL-2-END.       "
114630     DISPLAY "++W549AX-V-ID-TRACE = "
114640        W549AX-V-ID-TRACE                             *>++DELETE
114650     DISPLAY "++W549AN-TRACE-LEVEL = "
114660        W549AN-TRACE-LEVEL                            *>++DELETE
114670     END-IF                                           *>++DELETE
114680     EXIT.
114690/
114700*-----------------------------------------------------------------
114710* OPEN CURSOR C_DT02
114720* Cursor zum lesen aller Transponder zur VIN mit Status 8080
114730* und zur akt. SKC0-KEY-TYP-ID-ZAHL aus der VP
114740* Eingabe: S551AX-E-VIN
114750* Ausgabe: B0X3AX-TRANSPOND-ID
114760*-----------------------------------------------------------------
114770 T-100-OPEN-C-DT02 SECTION.
114780     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
114790       DISPLAY "++25889-->T-100-OPEN-C-DT02 SECTION.    "
114800     DISPLAY "++W549AX-V-ID-TRACE = "
114810        W549AX-V-ID-TRACE                             *>++DELETE
114820     DISPLAY "++W549AN-TRACE-LEVEL = "
114830        W549AN-TRACE-LEVEL                            *>++DELETE
114840     END-IF                                           *>++DELETE
114850
114860     EXEC SQL
114870       DECLARE C_DT02 CURSOR FOR
114880       SELECT TRANSPOND_ID
114890             ,TEXT_TRANSPOND_STATUS
114900             ,BGRP
114910       FROM  FEV2X3
114920       WHERE VIN                   = :B2X3AX-VIN
114930         AND TEXT_TRANSPOND_STATUS IN (8080, 8082)
114940         AND SKC0_KEY_TYP_ID_ZAHL
114950                             = :B2X3AN-SKC0-KEY-TYP-ID-ZAHL
114960       ORDER BY BGRP
114970       FOR FETCH ONLY
114980       WITH UR
114990     END-EXEC
115000     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115010     DISPLAY "++EXEC SQL                                         "
115020     DISPLAY "++ DECLARE C_DT02 CURSOR FOR                       "
115030     DISPLAY "++ SELECT TRANSPOND_ID                             "
115040     DISPLAY "++ ,TEXT_TRANSPOND_STATUS                          "
115050     DISPLAY "++ ,BGRP                                           "
115060     DISPLAY "++ FROM FEV2X3                                     "
115070     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
115080     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN (8080, 8082)       "
115090     DISPLAY "++ AND SKC0_KEY_TYP_ID_ZAHL                        "
115100     DISPLAY "++ = " B2X3AN-SKC0-KEY-TYP-ID-ZAHL "               "
115110     DISPLAY "++ ORDER BY BGRP                                   "
115120     DISPLAY "++ FOR FETCH ONLY                                  "
115130     DISPLAY "++ WITH UR                                         "
115140     DISPLAY "++END-EXEC                                         "
115150     DISPLAY "++SQLCODE --> " SQLCODE
115160     END-IF                                           *>++DELETE
115170
115180     EXEC SQL
115190       OPEN C_DT02
115200     END-EXEC
115210     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115220     DISPLAY "++EXEC SQL                                         "
115230     DISPLAY "++ OPEN C_DT02                                     "
115240     DISPLAY "++END-EXEC                                         "
115250     DISPLAY "++SQLCODE --> " SQLCODE
115260     END-IF                                           *>++DELETE
115270
115280     MOVE SQLCA                    TO SQL-SQLCA
115290
115300     EVALUATE SQLAX-SQLSTATE
115310       WHEN DB2-OK
115320         CONTINUE
115330       WHEN OTHER
115340         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
115350         MOVE 'T-100-OPEN-C-DT02'  TO W549AX-SECTION
115360         PERFORM Z80-DB2-FEHLER
115370     END-EVALUATE
115380
115390     CONTINUE.
115400 T-100-OPEN-C-DT02-END.
115410     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115420       DISPLAY "++25889-->T-100-OPEN-C-DT02-END.        "
115430     DISPLAY "++W549AX-V-ID-TRACE = "
115440        W549AX-V-ID-TRACE                             *>++DELETE
115450     DISPLAY "++W549AN-TRACE-LEVEL = "
115460        W549AN-TRACE-LEVEL                            *>++DELETE
115470     END-IF                                           *>++DELETE
115480     EXIT.
115490/
115500*-----------------------------------------------------------------
115510* FETCH CURSOR C_DT02
115520*-----------------------------------------------------------------
115530 T-100-FETCH-C-DT02   SECTION.
115540     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115550       DISPLAY "++25889-->T-100-FETCH-C-DT02   SECTION. "
115560     DISPLAY "++W549AX-V-ID-TRACE = "
115570        W549AX-V-ID-TRACE                             *>++DELETE
115580     DISPLAY "++W549AN-TRACE-LEVEL = "
115590        W549AN-TRACE-LEVEL                            *>++DELETE
115600     END-IF                                           *>++DELETE
115610
115620     EXEC SQL
115630       FETCH C_DT02
115640       INTO  :B2X3AX-TRANSPOND-ID
115650            ,:B2X3AN-TEXT-TRANSPOND-STATUS
115660            ,:B2X3AX-BGRP
115670     END-EXEC
115680     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115690     DISPLAY "++EXEC SQL                                         "
115700     DISPLAY "++ FETCH C_DT02                                    "
115710     DISPLAY "++ INTO " B2X3AX-TRANSPOND-ID "                    "
115720     DISPLAY "++ ," B2X3AN-TEXT-TRANSPOND-STATUS "               "
115730     DISPLAY "++ ," B2X3AX-BGRP "                                "
115740     DISPLAY "++END-EXEC                                         "
115750     DISPLAY "++SQLCODE --> " SQLCODE
115760     END-IF                                           *>++DELETE
115770
115780     MOVE SQLCA                    TO SQL-SQLCA
115790
115800     EVALUATE SQLAX-SQLSTATE
115810       WHEN DB2-OK
115820       WHEN DB2-NOT-FOUND
115830         CONTINUE
115840       WHEN OTHER
115850         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
115860         MOVE 'T-100-FETCH-C-DT02' TO W549AX-SECTION
115870         PERFORM Z80-DB2-FEHLER
115880     END-EVALUATE
115890
115900     CONTINUE.
115910 T-100-FETCH-C-DT02-END.
115920     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
115930       DISPLAY "++25889-->T-100-FETCH-C-DT02-END.       "
115940     DISPLAY "++W549AX-V-ID-TRACE = "
115950        W549AX-V-ID-TRACE                             *>++DELETE
115960     DISPLAY "++W549AN-TRACE-LEVEL = "
115970        W549AN-TRACE-LEVEL                            *>++DELETE
115980     END-IF                                           *>++DELETE
115990     EXIT.
116000*-----------------------------------------------------------------
116010* CLOSE CURSOR C_DT02
116020*-----------------------------------------------------------------
116030 T-100-CLOSE-C-DT02   SECTION.
116040     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
116050       DISPLAY "++25889-->T-100-CLOSE-C-DT02   SECTION. "
116060     DISPLAY "++W549AX-V-ID-TRACE = "
116070        W549AX-V-ID-TRACE                             *>++DELETE
116080     DISPLAY "++W549AN-TRACE-LEVEL = "
116090        W549AN-TRACE-LEVEL                            *>++DELETE
116100     END-IF                                           *>++DELETE
116110
116120     EXEC SQL
116130       CLOSE C_DT02
116140     END-EXEC
116150     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
116160     DISPLAY "++EXEC SQL                                         "
116170     DISPLAY "++ CLOSE C_DT02                                    "
116180     DISPLAY "++END-EXEC                                         "
116190     DISPLAY "++SQLCODE --> " SQLCODE
116200     END-IF                                           *>++DELETE
116210
116220     MOVE SQLCA                    TO SQL-SQLCA
116230
116240     EVALUATE SQLAX-SQLSTATE
116250       WHEN DB2-OK
116260         CONTINUE
116270       WHEN OTHER
116280         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
116290         MOVE 'T-100-CLOSE-C-DT02' TO W549AX-SECTION
116300         PERFORM Z80-DB2-FEHLER
116310     END-EVALUATE
116320
116330     CONTINUE.
116340 T-100-CLOSE-C-DT02-END.
116350     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
116360       DISPLAY "++25889-->T-100-CLOSE-C-DT02-END.       "
116370     DISPLAY "++W549AX-V-ID-TRACE = "
116380        W549AX-V-ID-TRACE                             *>++DELETE
116390     DISPLAY "++W549AN-TRACE-LEVEL = "
116400        W549AN-TRACE-LEVEL                            *>++DELETE
116410     END-IF                                           *>++DELETE
116420     EXIT.
116430/
116440*----------------------------------------------------------------
116450* VKMS Transponderdaten schreiben
116460*----------------------------------------------------------------
116470 T-100-FEVXX3-INSERT SECTION.
116480     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
116490       DISPLAY "++25889-->T-100-FEVXX3-INSERT SECTION.  "
116500     DISPLAY "++W549AX-V-ID-TRACE = "
116510        W549AX-V-ID-TRACE                             *>++DELETE
116520     DISPLAY "++W549AN-TRACE-LEVEL = "
116530        W549AN-TRACE-LEVEL                            *>++DELETE
116540     END-IF                                           *>++DELETE
116550
116560     MOVE '00;T-100-FEVXX3-INSERT;Beginn'
116570                                   TO W1AX-TRALOG-TEXT
116580     PERFORM Q92-TRALOG-ZEILE
116590
116600     EXEC SQL
116610       INSERT INTO FEVXX3
116620              ( UTC_V_ID
116630              , VIN
116640              , TRANSPOND_ID
116650              , TRANSPOND_TYP
116660              , TEXT_TRANSPOND_STATUS
116670              , BGRP
116680              , SKC0_KEY_TYP_ID
116690              , SKC0_KEY_TYP_ID_ZAHL
116700              , TRANSPOND_ID_ZAHL
116710              , PSS_FZ_ID_ZAHL
116720              , PSS_KRYPTOREGION
116730              , PSS_BGRP
116740              , PSS_KEY_TYP_ID
116750              , PSS_KEY_TYP_ID_ZAHL
116760              , PSS_VKMS_KEY_AUFBAU_VERSION
116770              , PSS_VIN
116780              )
116790       VALUES (
116800                :BXX3AX-UTC-V-ID
116810               ,:BXX3AX-VIN
116820               ,:BXX3AX-TRANSPOND-ID
116830               ,:BXX3AX-TRANSPOND-TYP
116840               ,:BXX3AN-TEXT-TRANSPOND-STATUS
116850               ,:BXX3AX-BGRP
116860                             :BXX3AN-I-BGRP
116870               ,:BXX3AN-SKC0-KEY-TYP-ID
116880                             :BXX3AN-I-SKC0-KEY-TYP-ID
116890               ,:BXX3AN-SKC0-KEY-TYP-ID-ZAHL
116900                             :BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL
116910               ,:BXX3AN-TRANSPOND-ID-ZAHL
116920               ,:BXX3AN-PSS-FZ-ID-ZAHL
116930               ,:BXX3AX-PSS-KRYPTOREGION
116940               ,:BXX3AX-PSS-BGRP
116950               ,:BXX3AN-PSS-KEY-TYP-ID
116960               ,:BXX3AN-PSS-KEY-TYP-ID-ZAHL
116970               ,:BXX3AN-PSS-VKMS-KEY-AUFBAU-VER
116980               ,:BXX3AX-PSS-VIN
116990              )
117000     END-EXEC
117010     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
117020     DISPLAY "++EXEC SQL                                         "
117030     DISPLAY "++ INSERT INTO FEVXX3                              "
117040     DISPLAY "++ ( UTC_V_ID                                      "
117050     DISPLAY "++ , VIN                                           "
117060     DISPLAY "++ , TRANSPOND_ID                                  "
117070     DISPLAY "++ , TRANSPOND_TYP                                 "
117080     DISPLAY "++ , TEXT_TRANSPOND_STATUS                         "
117090     DISPLAY "++ , BGRP                                          "
117100     DISPLAY "++ , SKC0_KEY_TYP_ID                               "
117110     DISPLAY "++ , SKC0_KEY_TYP_ID_ZAHL                          "
117120     DISPLAY "++ , TRANSPOND_ID_ZAHL                             "
117130     DISPLAY "++ , PSS_FZ_ID_ZAHL                                "
117140     DISPLAY "++ , PSS_KRYPTOREGION                              "
117150     DISPLAY "++ , PSS_BGRP                                      "
117160     DISPLAY "++ , PSS_KEY_TYP_ID                                "
117170     DISPLAY "++ , PSS_KEY_TYP_ID_ZAHL                           "
117180     DISPLAY "++ , PSS_VKMS_KEY_AUFBAU_VERSION                   "
117190     DISPLAY "++ , PSS_VIN                                       "
117200     DISPLAY "++ )                                               "
117210     DISPLAY "++ VALUES (                                        "
117220     DISPLAY "++ " BXX3AX-UTC-V-ID "                             "
117230     DISPLAY "++ ," BXX3AX-VIN "                                 "
117240     DISPLAY "++ ," BXX3AX-TRANSPOND-ID "                        "
117250     DISPLAY "++ ," BXX3AX-TRANSPOND-TYP "                       "
117260     DISPLAY "++ ," BXX3AN-TEXT-TRANSPOND-STATUS "               "
117270     DISPLAY "++ ," BXX3AX-BGRP "                                "
117280     DISPLAY "++ " BXX3AN-I-BGRP "                               "
117290     DISPLAY "++ ," BXX3AN-SKC0-KEY-TYP-ID "                     "
117300     DISPLAY "++ " BXX3AN-I-SKC0-KEY-TYP-ID "                    "
117310     DISPLAY "++ ," BXX3AN-SKC0-KEY-TYP-ID-ZAHL "                "
117320     DISPLAY "++ " BXX3AN-I-SKC0-KEY-TYP-ID-ZAHL "               "
117330     DISPLAY "++ ," BXX3AN-TRANSPOND-ID-ZAHL "                   "
117340     DISPLAY "++ ," BXX3AN-PSS-FZ-ID-ZAHL "                      "
117350     DISPLAY "++ ," BXX3AX-PSS-KRYPTOREGION "                    "
117360     DISPLAY "++ ," BXX3AX-PSS-BGRP "                            "
117370     DISPLAY "++ ," BXX3AN-PSS-KEY-TYP-ID "                      "
117380     DISPLAY "++ ," BXX3AN-PSS-KEY-TYP-ID-ZAHL "                 "
117390     DISPLAY "++ ," BXX3AN-PSS-VKMS-KEY-AUFBAU-VER "             "
117400     DISPLAY "++ ," BXX3AX-PSS-VIN "                             "
117410     DISPLAY "++ )                                               "
117420     DISPLAY "++END-EXEC                                         "
117430     DISPLAY "++SQLCODE --> " SQLCODE
117440     END-IF                                           *>++DELETE
117450
117460     MOVE SQLCA TO SQL-SQLCA
117470     EVALUATE SQLAX-SQLSTATE
117480       WHEN DB2-OK
117490       WHEN DB2-DUP-KEY
117500         CONTINUE
117510       WHEN OTHER
117520         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
117530         MOVE 'T-100-FEVXX3-INSERT'
117540                                   TO W549AX-SECTION
117550         PERFORM Z80-DB2-FEHLER
117560     END-EVALUATE
117570
117580     MOVE '00;T-100-FEVXX3-INSERT;Ende'
117590                                   TO W1AX-TRALOG-TEXT
117600     PERFORM Q92-TRALOG-ZEILE
117610
117620     CONTINUE.
117630 T-100-FEVXX3-INSERT-END.
117640     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
117650       DISPLAY "++25889-->T-100-FEVXX3-INSERT-END.      "
117660     DISPLAY "++W549AX-V-ID-TRACE = "
117670        W549AX-V-ID-TRACE                             *>++DELETE
117680     DISPLAY "++W549AN-TRACE-LEVEL = "
117690        W549AN-TRACE-LEVEL                            *>++DELETE
117700     END-IF                                           *>++DELETE
117710     EXIT.
117720/
117730*-----------------------------------------------------------------
117740* DATEN DER TABELLE FE01TXA LESEN
117750* Feststellen, ob eine Smartcard dem FZ zugeordnet ist
117760* View FEV2XA
117770*-----------------------------------------------------------------
117780 T-100-FEV0XA-SELECT   SECTION.
117790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
117800       DISPLAY "++25889-->T-100-FEV0XA-SELECT   SECTION."
117810     DISPLAY "++W549AX-V-ID-TRACE = "
117820        W549AX-V-ID-TRACE                             *>++DELETE
117830     DISPLAY "++W549AN-TRACE-LEVEL = "
117840        W549AN-TRACE-LEVEL                            *>++DELETE
117850     END-IF                                           *>++DELETE
117860
117870     MOVE '00;T-100-FEV0XA-SELECT;Beginn'
117880                                   TO W1AX-TRALOG-TEXT
117890     PERFORM Q92-TRALOG-ZEILE
117900
117910     EXEC SQL
117920       SELECT A.UTC_V_ID
117930             ,A.VIN
117940             ,A.SMARTCARD_ID
117950             ,A.TEXT_SMARTCARD_STATUS
117960             ,A.SKC0_KEY_TYP_ID
117970             ,A.SKC0_KEY_TYP_ID_ZAHL
117980       INTO   :B0XAAX-UTC-V-ID
117990             ,:B0XAAX-VIN
118000             ,:B0XAAX-SMARTCARD-ID
118010             ,:B0XAAN-TEXT-SMARTCARD-STATUS
118020             ,:B0XAAN-SKC0-KEY-TYP-ID
118030                 :B0XAAN-I-SKC0-KEY-TYP-ID
118040             ,:B0XAAN-SKC0-KEY-TYP-ID-ZAHL
118050                 :B0XAAN-I-SKC0-KEY-TYP-ID-ZAHL
118060       FROM  FEV0XA A
118070       WHERE A.VIN                   = :B0XAAX-VIN
118080         AND A.TEXT_SMARTCARD_STATUS IN (5381, 5385)
118090         AND A.UTC_V_ID = (SELECT MAX(B.UTC_V_ID)
118100                           FROM  FEV0XA B
118110                           WHERE B.VIN  = :B0XAAX-VIN
118120                           AND A.SMARTCARD_ID
118130                                        = B.SMARTCARD_ID
118140                          )
118150       WITH UR
118160     END-EXEC
118170     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
118180     DISPLAY "++EXEC SQL                                         "
118190     DISPLAY "++ SELECT A.UTC_V_ID                               "
118200     DISPLAY "++ ,A.VIN                                          "
118210     DISPLAY "++ ,A.SMARTCARD_ID                                 "
118220     DISPLAY "++ ,A.TEXT_SMARTCARD_STATUS                        "
118230     DISPLAY "++ ,A.SKC0_KEY_TYP_ID                              "
118240     DISPLAY "++ ,A.SKC0_KEY_TYP_ID_ZAHL                         "
118250     DISPLAY "++ INTO " B0XAAX-UTC-V-ID "                        "
118260     DISPLAY "++ ," B0XAAX-VIN "                                 "
118270     DISPLAY "++ ," B0XAAX-SMARTCARD-ID "                        "
118280     DISPLAY "++ ," B0XAAN-TEXT-SMARTCARD-STATUS "               "
118290     DISPLAY "++ ," B0XAAN-SKC0-KEY-TYP-ID "                     "
118300     DISPLAY "++ " B0XAAN-I-SKC0-KEY-TYP-ID "                    "
118310     DISPLAY "++ ," B0XAAN-SKC0-KEY-TYP-ID-ZAHL "                "
118320     DISPLAY "++ " B0XAAN-I-SKC0-KEY-TYP-ID-ZAHL "               "
118330     DISPLAY "++ FROM FEV0XA A                                   "
118340     DISPLAY "++ WHERE A.VIN = " B0XAAX-VIN "                    "
118350     DISPLAY "++ AND A.TEXT_SMARTCARD_STATUS IN (5381, 5385)     "
118360     DISPLAY "++ AND A.UTC_V_ID = (SELECT MAX(B.UTC_V_ID)        "
118370     DISPLAY "++ FROM FEV0XA B                                   "
118380     DISPLAY "++ WHERE B.VIN = " B0XAAX-VIN "                    "
118390     DISPLAY "++ AND A.SMARTCARD_ID                              "
118400     DISPLAY "++ = B.SMARTCARD_ID                                "
118410     DISPLAY "++ )                                               "
118420     DISPLAY "++ WITH UR                                         "
118430     DISPLAY "++END-EXEC                                         "
118440     DISPLAY "++SQLCODE --> " SQLCODE
118450     END-IF                                           *>++DELETE
118460
118470     MOVE SQLCA                    TO SQL-SQLCA
118480
118490     EVALUATE SQLAX-SQLSTATE
118500       WHEN DB2-OK
118510       WHEN DB2-NOT-FOUND
118520         CONTINUE
118530       WHEN OTHER
118540         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
118550         MOVE 'T-100-FEV0XA-SELECT' TO W549AX-SECTION
118560*        -- kein Aufruf, da sonst Fehlertelegramm...
118570*        PERFORM Z80-DB2-FEHLER
118580     END-EVALUATE
118590
118600     MOVE '00;T-100-FEV0XA-SELECT;Ende'
118610                                   TO W1AX-TRALOG-TEXT
118620     PERFORM Q92-TRALOG-ZEILE
118630
118640     CONTINUE.
118650 T-100-FEV0XA-SELECT-END.
118660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
118670       DISPLAY "++25889-->T-100-FEV0XA-SELECT-END.      "
118680     DISPLAY "++W549AX-V-ID-TRACE = "
118690        W549AX-V-ID-TRACE                             *>++DELETE
118700     DISPLAY "++W549AN-TRACE-LEVEL = "
118710        W549AN-TRACE-LEVEL                            *>++DELETE
118720     END-IF                                           *>++DELETE
118730     EXIT.
118740/
118750*----------------------------------------------------------------
118760* VKMS SmartCarddaten schreiben
118770*----------------------------------------------------------------
118780 T-100-FEVXXA-INSERT SECTION.
118790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
118800       DISPLAY "++25889-->T-100-FEVXXA-INSERT SECTION.  "
118810     DISPLAY "++W549AX-V-ID-TRACE = "
118820        W549AX-V-ID-TRACE                             *>++DELETE
118830     DISPLAY "++W549AN-TRACE-LEVEL = "
118840        W549AN-TRACE-LEVEL                            *>++DELETE
118850     END-IF                                           *>++DELETE
118860
118870     MOVE '00;T-100-FEVXXA-INSERT;Beginn'
118880                                   TO W1AX-TRALOG-TEXT
118890     PERFORM Q92-TRALOG-ZEILE
118900
118910     EXEC SQL
118920       INSERT INTO FEVXXA
118930              ( UTC_V_ID
118940              , VIN
118950              , SMARTCARD_ID
118960              , TEXT_SMARTCARD_STATUS
118970              , SKC0_KEY_TYP_ID
118980              , SKC0_KEY_TYP_ID_ZAHL
118990              )
119000       VALUES (
119010                :BXXAAX-UTC-V-ID
119020               ,:BXXAAX-VIN
119030               ,:BXXAAX-SMARTCARD-ID
119040               ,:BXXAAN-TEXT-SMARTCARD-STATUS
119050               ,:BXXAAN-SKC0-KEY-TYP-ID
119060                  :BXXAAN-I-SKC0-KEY-TYP-ID
119070               ,:BXXAAN-SKC0-KEY-TYP-ID-ZAHL
119080                  :BXXAAN-I-SKC0-KEY-TYP-ID-ZAHL
119090              )
119100     END-EXEC
119110     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
119120     DISPLAY "++EXEC SQL                                         "
119130     DISPLAY "++ INSERT INTO FEVXXA                              "
119140     DISPLAY "++ ( UTC_V_ID                                      "
119150     DISPLAY "++ , VIN                                           "
119160     DISPLAY "++ , SMARTCARD_ID                                  "
119170     DISPLAY "++ , TEXT_SMARTCARD_STATUS                         "
119180     DISPLAY "++ , SKC0_KEY_TYP_ID                               "
119190     DISPLAY "++ , SKC0_KEY_TYP_ID_ZAHL                          "
119200     DISPLAY "++ )                                               "
119210     DISPLAY "++ VALUES (                                        "
119220     DISPLAY "++ " BXXAAX-UTC-V-ID "                             "
119230     DISPLAY "++ ," BXXAAX-VIN "                                 "
119240     DISPLAY "++ ," BXXAAX-SMARTCARD-ID "                        "
119250     DISPLAY "++ ," BXXAAN-TEXT-SMARTCARD-STATUS "               "
119260     DISPLAY "++ ," BXXAAN-SKC0-KEY-TYP-ID "                     "
119270     DISPLAY "++ " BXXAAN-I-SKC0-KEY-TYP-ID "                    "
119280     DISPLAY "++ ," BXXAAN-SKC0-KEY-TYP-ID-ZAHL "                "
119290     DISPLAY "++ " BXXAAN-I-SKC0-KEY-TYP-ID-ZAHL "               "
119300     DISPLAY "++ )                                               "
119310     DISPLAY "++END-EXEC                                         "
119320     DISPLAY "++SQLCODE --> " SQLCODE
119330     END-IF                                           *>++DELETE
119340
119350     MOVE SQLCA                    TO SQL-SQLCA
119360
119370     EVALUATE SQLAX-SQLSTATE
119380       WHEN DB2-OK
119390       WHEN DB2-DUP-KEY
119400         CONTINUE
119410       WHEN OTHER
119420         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
119430         MOVE 'T-100-FEVXXA-INSERT' TO W549AX-SECTION
119440*        -- kein Aufruf, da sonst Fehlertelegramm...
119450*        PERFORM Z80-DB2-FEHLER
119460     END-EVALUATE
119470
119480     MOVE '00;T-100-FEVXXA-INSERT;Ende'
119490                                   TO W1AX-TRALOG-TEXT
119500     PERFORM Q92-TRALOG-ZEILE
119510
119520     CONTINUE.
119530 T-100-FEVXXA-INSERT-END.
119540     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
119550       DISPLAY "++25889-->T-100-FEVXXA-INSERT-END.      "
119560     DISPLAY "++W549AX-V-ID-TRACE = "
119570        W549AX-V-ID-TRACE                             *>++DELETE
119580     DISPLAY "++W549AN-TRACE-LEVEL = "
119590        W549AN-TRACE-LEVEL                            *>++DELETE
119600     END-IF                                           *>++DELETE
119610     EXIT.
119620/
119630*----------------------------------------------------------------
119640* CURSOR FEV0X0 FOR SmardCards for given VIN
119650*----------------------------------------------------------------
119660 T-100-FEV0XA-OPEN SECTION.
119670     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
119680       DISPLAY "++25889-->T-100-FEV0XA-OPEN SECTION.    "
119690     DISPLAY "++W549AX-V-ID-TRACE = "
119700        W549AX-V-ID-TRACE                             *>++DELETE
119710     DISPLAY "++W549AN-TRACE-LEVEL = "
119720        W549AN-TRACE-LEVEL                            *>++DELETE
119730     END-IF                                           *>++DELETE
119740
119750     EXEC SQL
119760       DECLARE C_0XA CURSOR FOR
119770        SELECT  A.UTC_V_ID
119780               ,A.VIN
119790               ,A.SMARTCARD_ID
119800               ,A.TEXT_SMARTCARD_STATUS
119810               ,A.SKC0_KEY_TYP_ID
119820               ,A.SKC0_KEY_TYP_ID_ZAHL
119830        FROM   FEV0XA A
119840        WHERE  A.VIN                   = :B0XAAX-VIN
119850          AND  A.TEXT_SMARTCARD_STATUS IN (5381, 5382, 5385)
119860          AND  A.UTC_V_ID = (SELECT MAX(B.UTC_V_ID)
119870                             FROM  FEV0XA B
119880                             WHERE B.VIN  = :B0XAAX-VIN
119890                             AND A.SMARTCARD_ID
119900                                          = B.SMARTCARD_ID
119910                            )
119920        FOR FETCH ONLY
119930        WITH UR
119940     END-EXEC
119950     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
119960     DISPLAY "++EXEC SQL                                         "
119970     DISPLAY "++ DECLARE C_0XA CURSOR FOR                        "
119980     DISPLAY "++ SELECT A.UTC_V_ID                               "
119990     DISPLAY "++ ,A.VIN                                          "
120000     DISPLAY "++ ,A.SMARTCARD_ID                                 "
120010     DISPLAY "++ ,A.TEXT_SMARTCARD_STATUS                        "
120020     DISPLAY "++ ,A.SKC0_KEY_TYP_ID                              "
120030     DISPLAY "++ ,A.SKC0_KEY_TYP_ID_ZAHL                         "
120040     DISPLAY "++ FROM FEV0XA A                                   "
120050     DISPLAY "++ WHERE A.VIN = " B0XAAX-VIN "                    "
120060*    DISPLAY "++ AND A.TEXT_SMARTCARD_STATUS IN (5381, 5382, 5385"
120070     DISPLAY "++ AND A.UTC_V_ID = (SELECT MAX(B.UTC_V_ID)        "
120080     DISPLAY "++ FROM FEV0XA B                                   "
120090     DISPLAY "++ WHERE B.VIN = " B0XAAX-VIN "                    "
120100     DISPLAY "++ AND A.SMARTCARD_ID                              "
120110     DISPLAY "++ = B.SMARTCARD_ID                                "
120120     DISPLAY "++ )                                               "
120130     DISPLAY "++ FOR FETCH ONLY                                  "
120140     DISPLAY "++ WITH UR                                         "
120150     DISPLAY "++END-EXEC                                         "
120160     DISPLAY "++SQLCODE --> " SQLCODE
120170     END-IF                                           *>++DELETE
120180
120190     EXEC SQL
120200          OPEN C_0XA
120210     END-EXEC
120220     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
120230     DISPLAY "++EXEC SQL                                         "
120240     DISPLAY "++ OPEN C_0XA                                      "
120250     DISPLAY "++END-EXEC                                         "
120260     DISPLAY "++SQLCODE --> " SQLCODE
120270     END-IF                                           *>++DELETE
120280
120290     MOVE SQLCA TO SQL-SQLCA
120300
120310     EVALUATE SQLAX-SQLSTATE
120320       WHEN DB2-OK
120330         CONTINUE
120340       WHEN OTHER
120350         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
120360         MOVE 'T-100-FEV0XA-OPEN'  TO W549AX-SECTION
120370         PERFORM Z80-DB2-FEHLER
120380     END-EVALUATE
120390
120400     CONTINUE.
120410 T-100-FEV0XA-OPEN-END.
120420     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
120430       DISPLAY "++25889-->T-100-FEV0XA-OPEN-END.        "
120440     DISPLAY "++W549AX-V-ID-TRACE = "
120450        W549AX-V-ID-TRACE                             *>++DELETE
120460     DISPLAY "++W549AN-TRACE-LEVEL = "
120470        W549AN-TRACE-LEVEL                            *>++DELETE
120480     END-IF                                           *>++DELETE
120490     EXIT.
120500
120510*-----------------------------------------------------------------
120520* FETCH CURSOR FEV0XA
120530*-----------------------------------------------------------------
120540 T-100-FEV0XA-FETCH SECTION.
120550     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
120560       DISPLAY "++25889-->T-100-FEV0XA-FETCH SECTION.   "
120570     DISPLAY "++W549AX-V-ID-TRACE = "
120580        W549AX-V-ID-TRACE                             *>++DELETE
120590     DISPLAY "++W549AN-TRACE-LEVEL = "
120600        W549AN-TRACE-LEVEL                            *>++DELETE
120610     END-IF                                           *>++DELETE
120620
120630     EXEC SQL
120640          FETCH C_0XA
120650          INTO  :B0XAAX-UTC-V-ID
120660               ,:B0XAAX-VIN
120670               ,:B0XAAX-SMARTCARD-ID
120680               ,:B0XAAN-TEXT-SMARTCARD-STATUS
120690               ,:B0XAAN-SKC0-KEY-TYP-ID
120700                   :B0XAAN-I-SKC0-KEY-TYP-ID
120710               ,:B0XAAN-SKC0-KEY-TYP-ID-ZAHL
120720                   :B0XAAN-I-SKC0-KEY-TYP-ID-ZAHL
120730     END-EXEC
120740     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
120750     DISPLAY "++EXEC SQL                                         "
120760     DISPLAY "++ FETCH C_0XA                                     "
120770     DISPLAY "++ INTO " B0XAAX-UTC-V-ID "                        "
120780     DISPLAY "++ ," B0XAAX-VIN "                                 "
120790     DISPLAY "++ ," B0XAAX-SMARTCARD-ID "                        "
120800     DISPLAY "++ ," B0XAAN-TEXT-SMARTCARD-STATUS "               "
120810     DISPLAY "++ ," B0XAAN-SKC0-KEY-TYP-ID "                     "
120820     DISPLAY "++ " B0XAAN-I-SKC0-KEY-TYP-ID "                    "
120830     DISPLAY "++ ," B0XAAN-SKC0-KEY-TYP-ID-ZAHL "                "
120840     DISPLAY "++ " B0XAAN-I-SKC0-KEY-TYP-ID-ZAHL "               "
120850     DISPLAY "++END-EXEC                                         "
120860     DISPLAY "++SQLCODE --> " SQLCODE
120870     END-IF                                           *>++DELETE
120880
120890     MOVE SQLCA TO SQL-SQLCA
120900
120910     EVALUATE SQLAX-SQLSTATE
120920       WHEN DB2-OK
120930       WHEN DB2-NOT-FOUND
120940         CONTINUE
120950       WHEN OTHER
120960         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
120970         MOVE 'T-100-FEV0XA-FETCH' TO W549AX-SECTION
120980         PERFORM Z80-DB2-FEHLER
120990     END-EVALUATE
121000
121010     CONTINUE.
121020 T-100-FEV0XA-FETCH-END.
121030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121040       DISPLAY "++25889-->T-100-FEV0XA-FETCH-END.       "
121050     DISPLAY "++W549AX-V-ID-TRACE = "
121060        W549AX-V-ID-TRACE                             *>++DELETE
121070     DISPLAY "++W549AN-TRACE-LEVEL = "
121080        W549AN-TRACE-LEVEL                            *>++DELETE
121090     END-IF                                           *>++DELETE
121100     EXIT.
121110/
121120*-----------------------------------------------------------------
121130* CLOSE CURSOR
121140*-----------------------------------------------------------------
121150 T-100-FEV0XA-CLOSE SECTION.
121160     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121170       DISPLAY "++25889-->T-100-FEV0XA-CLOSE SECTION.   "
121180     DISPLAY "++W549AX-V-ID-TRACE = "
121190        W549AX-V-ID-TRACE                             *>++DELETE
121200     DISPLAY "++W549AN-TRACE-LEVEL = "
121210        W549AN-TRACE-LEVEL                            *>++DELETE
121220     END-IF                                           *>++DELETE
121230
121240     EXEC SQL
121250          CLOSE C_0XA
121260     END-EXEC
121270     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121280     DISPLAY "++EXEC SQL                                         "
121290     DISPLAY "++ CLOSE C_0XA                                     "
121300     DISPLAY "++END-EXEC                                         "
121310     DISPLAY "++SQLCODE --> " SQLCODE
121320     END-IF                                           *>++DELETE
121330
121340     MOVE SQLCA TO SQL-SQLCA
121350
121360     EVALUATE SQLAX-SQLSTATE
121370       WHEN DB2-OK
121380         CONTINUE
121390       WHEN OTHER
121400         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
121410         MOVE 'T-100-C0XA-CLOSE'   TO W549AX-SECTION
121420         PERFORM Z80-DB2-FEHLER
121430     END-EVALUATE
121440
121450     CONTINUE.
121460 T-100-FEV0XA-CLOSE-END.
121470     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121480       DISPLAY "++25889-->T-100-FEV0XA-CLOSE-END.       "
121490     DISPLAY "++W549AX-V-ID-TRACE = "
121500        W549AX-V-ID-TRACE                             *>++DELETE
121510     DISPLAY "++W549AN-TRACE-LEVEL = "
121520        W549AN-TRACE-LEVEL                            *>++DELETE
121530     END-IF                                           *>++DELETE
121540     EXIT.
121550/
121560*----------------------------------------------------------------
121570* LESEN FEV045 WFS-MARKE
121580*----------------------------------------------------------------
121590 T-100-FEV045-OPEN SECTION.
121600     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121610       DISPLAY "++25889-->T-100-FEV045-OPEN SECTION.    "
121620     DISPLAY "++W549AX-V-ID-TRACE = "
121630        W549AX-V-ID-TRACE                             *>++DELETE
121640     DISPLAY "++W549AN-TRACE-LEVEL = "
121650        W549AN-TRACE-LEVEL                            *>++DELETE
121660     END-IF                                           *>++DELETE
121670
121680     EXEC SQL
121690       DECLARE C_045 CURSOR FOR
121700        SELECT WFS_MARKE
121710        FROM   FEV045
121720          WHERE NUR_RECHTE_KZ = 'N'
121730        FOR FETCH ONLY
121740        WITH UR
121750     END-EXEC
121760     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121770     DISPLAY "++EXEC SQL                                         "
121780     DISPLAY "++ DECLARE C_045 CURSOR FOR                        "
121790     DISPLAY "++ SELECT WFS_MARKE                                "
121800     DISPLAY "++ FROM FEV045                                     "
121810     DISPLAY "++ WHERE NUR_RECHTE_KZ = 'N'                       "
121820     DISPLAY "++ FOR FETCH ONLY                                  "
121830     DISPLAY "++ WITH UR                                         "
121840     DISPLAY "++END-EXEC                                         "
121850     DISPLAY "++SQLCODE --> " SQLCODE
121860     END-IF                                           *>++DELETE
121870
121880     EXEC SQL
121890          OPEN C_045
121900     END-EXEC
121910     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
121920     DISPLAY "++EXEC SQL                                         "
121930     DISPLAY "++ OPEN C_045                                      "
121940     DISPLAY "++END-EXEC                                         "
121950     DISPLAY "++SQLCODE --> " SQLCODE
121960     END-IF                                           *>++DELETE
121970
121980     MOVE SQLCA TO SQL-SQLCA
121990
122000     EVALUATE SQLAX-SQLSTATE
122010       WHEN DB2-OK
122020         CONTINUE
122030       WHEN OTHER
122040         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
122050         MOVE 'T-100-FEV045-OPEN'  TO W549AX-SECTION
122060         PERFORM Z80-DB2-FEHLER
122070     END-EVALUATE
122080
122090     CONTINUE.
122100 T-100-FEV045-OPEN-END.
122110     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122120       DISPLAY "++25889-->T-100-FEV045-OPEN-END.        "
122130     DISPLAY "++W549AX-V-ID-TRACE = "
122140        W549AX-V-ID-TRACE                             *>++DELETE
122150     DISPLAY "++W549AN-TRACE-LEVEL = "
122160        W549AN-TRACE-LEVEL                            *>++DELETE
122170     END-IF                                           *>++DELETE
122180     EXIT.
122190
122200*-----------------------------------------------------------------
122210* ...
122220*-----------------------------------------------------------------
122230 T-100-FEV045-FETCH SECTION.
122240     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122250       DISPLAY "++25889-->T-100-FEV045-FETCH SECTION.   "
122260     DISPLAY "++W549AX-V-ID-TRACE = "
122270        W549AX-V-ID-TRACE                             *>++DELETE
122280     DISPLAY "++W549AN-TRACE-LEVEL = "
122290        W549AN-TRACE-LEVEL                            *>++DELETE
122300     END-IF                                           *>++DELETE
122310
122320     EXEC SQL
122330          FETCH C_045
122340          INTO :B045AX-WFS-MARKE
122350     END-EXEC
122360     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122370     DISPLAY "++EXEC SQL                                         "
122380     DISPLAY "++ FETCH C_045                                     "
122390     DISPLAY "++ INTO " B045AX-WFS-MARKE "                       "
122400     DISPLAY "++END-EXEC                                         "
122410     DISPLAY "++SQLCODE --> " SQLCODE
122420     END-IF                                           *>++DELETE
122430
122440     MOVE SQLCA TO SQL-SQLCA
122450
122460     EVALUATE SQLAX-SQLSTATE
122470       WHEN DB2-OK
122480       WHEN DB2-NOT-FOUND
122490         CONTINUE
122500       WHEN OTHER
122510         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
122520         MOVE 'T-100-FEV045-FETCH' TO W549AX-SECTION
122530         PERFORM Z80-DB2-FEHLER
122540     END-EVALUATE
122550
122560     CONTINUE.
122570 T-100-C024-FETCH-END.
122580     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122590       DISPLAY "++25889-->T-100-C024-FETCH-END.         "
122600     DISPLAY "++W549AX-V-ID-TRACE = "
122610        W549AX-V-ID-TRACE                             *>++DELETE
122620     DISPLAY "++W549AN-TRACE-LEVEL = "
122630        W549AN-TRACE-LEVEL                            *>++DELETE
122640     END-IF                                           *>++DELETE
122650     EXIT.
122660/
122670*-----------------------------------------------------------------
122680* ...
122690*-----------------------------------------------------------------
122700 T-100-FEV045-CLOSE SECTION.
122710     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122720       DISPLAY "++25889-->T-100-FEV045-CLOSE SECTION.   "
122730     DISPLAY "++W549AX-V-ID-TRACE = "
122740        W549AX-V-ID-TRACE                             *>++DELETE
122750     DISPLAY "++W549AN-TRACE-LEVEL = "
122760        W549AN-TRACE-LEVEL                            *>++DELETE
122770     END-IF                                           *>++DELETE
122780
122790     EXEC SQL
122800          CLOSE C_045
122810     END-EXEC
122820     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
122830     DISPLAY "++EXEC SQL                                         "
122840     DISPLAY "++ CLOSE C_045                                     "
122850     DISPLAY "++END-EXEC                                         "
122860     DISPLAY "++SQLCODE --> " SQLCODE
122870     END-IF                                           *>++DELETE
122880
122890     MOVE SQLCA TO SQL-SQLCA
122900
122910     EVALUATE SQLAX-SQLSTATE
122920       WHEN DB2-OK
122930         CONTINUE
122940       WHEN OTHER
122950         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
122960         MOVE 'T-100-C045-CLOSE'   TO W549AX-SECTION
122970         PERFORM Z80-DB2-FEHLER
122980     END-EVALUATE
122990
123000     CONTINUE.
123010 T-100-FEV045-CLOSE-END.
123020     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
123030       DISPLAY "++25889-->T-100-FEV045-CLOSE-END.       "
123040     DISPLAY "++W549AX-V-ID-TRACE = "
123050        W549AX-V-ID-TRACE                             *>++DELETE
123060     DISPLAY "++W549AN-TRACE-LEVEL = "
123070        W549AN-TRACE-LEVEL                            *>++DELETE
123080     END-IF                                           *>++DELETE
123090     EXIT.
123100/
123110*----------------------------------------------------------------
123120*    UTC-V-ID aus VKMS-Fz-Baugruppe-DLC lesen
123130*----------------------------------------------------------------
123140 T-100-FEV2VN-SELECT SECTION.
123150     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
123160       DISPLAY "++25889-->T-100-FEV2VN-SELECT SECTION.  "
123170     DISPLAY "++W549AX-V-ID-TRACE = "
123180        W549AX-V-ID-TRACE                             *>++DELETE
123190     DISPLAY "++W549AN-TRACE-LEVEL = "
123200        W549AN-TRACE-LEVEL                            *>++DELETE
123210     END-IF                                           *>++DELETE
123220
123230     EXEC SQL
123240       SELECT   UTC_V_ID
123250               ,PSS_VIN
123260               ,PSS_FZ_ID_ZAHL
123270               ,PSS_KRYPTOREGION
123280               ,PSS_BGRP
123290               ,PSS_KEY_TYP_ID
123300               ,PSS_KEY_TYP_ID_ZAHL
123310               ,PSS_KEY_AUFBAU_VERSION
123320       INTO    :B2VNAX-UTC-V-ID
123330              ,:B2VNAX-PSS-VIN
123340              ,:B2VNAN-PSS-FZ-ID-ZAHL
123350              ,:B2VNAX-PSS-KRYPTOREGION
123360              ,:B2VNAX-PSS-BGRP
123370              ,:B2VNAN-PSS-KEY-TYP-ID
123380              ,:B2VNAN-PSS-KEY-TYP-ID-ZAHL
123390              ,:B2VNAN-PSS-KEY-AUFBAU-VERSION
123400       FROM FEV2VN
123410       WHERE VIN  = :B2VNAX-VIN
123420       AND   BGRP = :B2VNAX-BGRP
123430       WITH UR
123440     END-EXEC
123450     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
123460     DISPLAY "++EXEC SQL                                         "
123470     DISPLAY "++ SELECT UTC_V_ID                                 "
123480     DISPLAY "++ ,PSS_VIN                                        "
123490     DISPLAY "++ ,PSS_FZ_ID_ZAHL                                 "
123500     DISPLAY "++ ,PSS_KRYPTOREGION                               "
123510     DISPLAY "++ ,PSS_BGRP                                       "
123520     DISPLAY "++ ,PSS_KEY_TYP_ID                                 "
123530     DISPLAY "++ ,PSS_KEY_TYP_ID_ZAHL                            "
123540     DISPLAY "++ ,PSS_KEY_AUFBAU_VERSION                         "
123550     DISPLAY "++ INTO " B2VNAX-UTC-V-ID "                        "
123560     DISPLAY "++ ," B2VNAX-PSS-VIN "                             "
123570     DISPLAY "++ ," B2VNAN-PSS-FZ-ID-ZAHL "                      "
123580     DISPLAY "++ ," B2VNAX-PSS-KRYPTOREGION "                    "
123590     DISPLAY "++ ," B2VNAX-PSS-BGRP "                            "
123600     DISPLAY "++ ," B2VNAN-PSS-KEY-TYP-ID "                      "
123610     DISPLAY "++ ," B2VNAN-PSS-KEY-TYP-ID-ZAHL "                 "
123620     DISPLAY "++ ," B2VNAN-PSS-KEY-AUFBAU-VERSION "              "
123630     DISPLAY "++ FROM FEV2VN                                     "
123640     DISPLAY "++ WHERE VIN = " B2VNAX-VIN "                      "
123650     DISPLAY "++ AND BGRP = " B2VNAX-BGRP "                      "
123660     DISPLAY "++ WITH UR                                         "
123670     DISPLAY "++END-EXEC                                         "
123680     DISPLAY "++SQLCODE --> " SQLCODE
123690     END-IF                                           *>++DELETE
123700
123710     MOVE SQLCA TO SQL-SQLCA
123720
123730     EVALUATE SQLAX-SQLSTATE
123740       WHEN DB2-OK
123750       WHEN DB2-NOT-FOUND
123760         CONTINUE
123770       WHEN OTHER
123780         MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
123790         MOVE 'T-100-FEV2VN-SELECT' TO W549AX-SECTION
123800         PERFORM Z80-DB2-FEHLER
123810     END-EVALUATE
123820
123830     CONTINUE.
123840 T-100-FEV2VN-SELECT-END.
123850     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
123860       DISPLAY "++25889-->T-100-FEV2VN-SELECT-END.      "
123870     DISPLAY "++W549AX-V-ID-TRACE = "
123880        W549AX-V-ID-TRACE                             *>++DELETE
123890     DISPLAY "++W549AN-TRACE-LEVEL = "
123900        W549AN-TRACE-LEVEL                            *>++DELETE
123910     END-IF                                           *>++DELETE
123920     EXIT.
123930/
123940*V11 IR Neue Section
123950*-----------------------------------------------------------------
123960* Transponder zur VIN mit Status 8082/8045 zählen
123970*-----------------------------------------------------------------
123980 T-100-FEV2X3-CNT-TRA SECTION.
123990     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
124000       DISPLAY "++25889-->T-100-FEV2X3-CNT-TRA SECTION. "
124010     DISPLAY "++W549AX-V-ID-TRACE = "
124020        W549AX-V-ID-TRACE                             *>++DELETE
124030     DISPLAY "++W549AN-TRACE-LEVEL = "
124040        W549AN-TRACE-LEVEL                            *>++DELETE
124050     END-IF                                           *>++DELETE
124060
124070     INITIALIZE B2X3-DCLFEV2X3
124080                B2X3-I-DCLFEV2X3
124090
124100     MOVE S551AX-E-VIN             TO B2X3AX-VIN
124110
124120     EXEC SQL
124130       SELECT COUNT(TRANSPOND_ID)
124140       INTO :W1AN-ANZ-TRA-X30
124150                  :W1AN-I-ANZ-TRA-X30
124160       FROM  FEV2X3
124170       WHERE VIN  = :B2X3AX-VIN
124180         AND TEXT_TRANSPOND_STATUS in (8082, 8045)
124190         AND BGRP BETWEEN '501' AND '508'
124200     END-EXEC
124210     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
124220     DISPLAY "++EXEC SQL                                         "
124230     DISPLAY "++ SELECT COUNT(TRANSPOND_ID)                      "
124240     DISPLAY "++ INTO " W1AN-ANZ-TRA-X30 "                       "
124250     DISPLAY "++ " W1AN-I-ANZ-TRA-X30 "                          "
124260     DISPLAY "++ FROM FEV2X3                                     "
124270     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
124280     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN (8082, 8045)       "
124290     DISPLAY "++ AND BGRP BETWEEN '501' AND '508'                "
124300     DISPLAY "++END-EXEC                                         "
124310     DISPLAY "++SQLCODE --> " SQLCODE
124320     END-IF                                           *>++DELETE
124330
124340     MOVE SQLCA                    TO SQL-SQLCA
124350
124360     EVALUATE SQLAX-SQLSTATE
124370       WHEN DB2-OK
124380         IF W1AN-I-ANZ-TRA-X30     = -1
124390           MOVE ZERO               TO W1AN-ANZ-TRA-X30
124400         ELSE
124410           CONTINUE
124420         END-IF
124430       WHEN OTHER
124440         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
124450         MOVE 'T-100-FEV2X3-CNT-TRA'
124460                                   TO W549AX-SECTION
124470         PERFORM Z80-DB2-FEHLER
124480     END-EVALUATE
124490
124500     CONTINUE.
124510 T-100-FEV2X3-CNT-TRA-END.
124520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
124530       DISPLAY "++25889-->T-100-FEV2X3-CNT-TRA-END.     "
124540     DISPLAY "++W549AX-V-ID-TRACE = "
124550        W549AX-V-ID-TRACE                             *>++DELETE
124560     DISPLAY "++W549AN-TRACE-LEVEL = "
124570        W549AN-TRACE-LEVEL                            *>++DELETE
124580     END-IF                                           *>++DELETE
124590     EXIT.
124600/
124610*V11 IR Neue Section
124620*-----------------------------------------------------------------
124630* Transponder zur VIN mit Status 2937/8045/8080/8082/8087 zählen
124640*-----------------------------------------------------------------
124650 T-100-FEV2X3-TRA-FAZ SECTION.
124660     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
124670       DISPLAY "++25889-->T-100-FEV2X3-TRA-FAZ SECTION. "
124680     DISPLAY "++W549AX-V-ID-TRACE = "
124690        W549AX-V-ID-TRACE                             *>++DELETE
124700     DISPLAY "++W549AN-TRACE-LEVEL = "
124710        W549AN-TRACE-LEVEL                            *>++DELETE
124720     END-IF                                           *>++DELETE
124730
124740     INITIALIZE B2X3-DCLFEV2X3
124750                B2X3-I-DCLFEV2X3
124760
124770     MOVE S551AX-E-VIN             TO B2X3AX-VIN
124780
124790     EXEC SQL
124800       SELECT COUNT(TRANSPOND_ID)
124810       INTO :W1AN-ANZ-TRA-2X3-FAZ
124820                  :W1AN-I-ANZ-TRA-2X3-FAZ
124830       FROM  FEV2X3
124840       WHERE VIN  = :B2X3AX-VIN
124850         AND TEXT_TRANSPOND_STATUS in
124860             (2937, 8045, 8080, 8082, 8087)
124870     END-EXEC
124880     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
124890     DISPLAY "++EXEC SQL                                         "
124900     DISPLAY "++ SELECT COUNT(TRANSPOND_ID)                      "
124910     DISPLAY "++ INTO " W1AN-ANZ-TRA-2X3-FAZ "                   "
124920     DISPLAY "++ " W1AN-I-ANZ-TRA-2X3-FAZ "                      "
124930     DISPLAY "++ FROM FEV2X3                                     "
124940     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
124950     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN                    "
124960     DISPLAY "++ (2937, 8045, 8080, 8082, 8087)                  "
124970     DISPLAY "++END-EXEC                                         "
124980     DISPLAY "++SQLCODE --> " SQLCODE
124990     END-IF                                           *>++DELETE
125000
125010     MOVE SQLCA                    TO SQL-SQLCA
125020
125030     EVALUATE SQLAX-SQLSTATE
125040       WHEN DB2-OK
125050         IF W1AN-I-ANZ-TRA-X30     = -1
125060           MOVE ZERO               TO W1AN-ANZ-TRA-2X3-FAZ
125070         END-IF
125080       WHEN OTHER
125090         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
125100         MOVE 'T-100-FEV2X3-TRA-FAZ'
125110                                   TO W549AX-SECTION
125120         PERFORM Z80-DB2-FEHLER
125130     END-EVALUATE
125140
125150     CONTINUE.
125160 T-100-FEV2X3-TRA-FAZ-END.
125170     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
125180       DISPLAY "++25889-->T-100-FEV2X3-TRA-FAZ-END.     "
125190     DISPLAY "++W549AX-V-ID-TRACE = "
125200        W549AX-V-ID-TRACE                             *>++DELETE
125210     DISPLAY "++W549AN-TRACE-LEVEL = "
125220        W549AN-TRACE-LEVEL                            *>++DELETE
125230     END-IF                                           *>++DELETE
125240     EXIT.
125250/
125260*V11 IR Neue Section
125270*-----------------------------------------------------------------
125280* Alle Transponder zur VIN lesen, die bereits angelernt wurden
125290* Eingabe: S551AX-E-VIN
125300* Ausgabe: W1AN-ANZ-TRA-X30-REG
125310*-----------------------------------------------------------------
125320 T-100-FEV2X3-ANZ-TRA-REG SECTION.
125330     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
125340       DISPLAY "++25889-->T-100-FEV2X3-ANZ-TRA-REG SECTI"
125350     DISPLAY "++W549AX-V-ID-TRACE = "
125360        W549AX-V-ID-TRACE                             *>++DELETE
125370     DISPLAY "++W549AN-TRACE-LEVEL = "
125380        W549AN-TRACE-LEVEL                            *>++DELETE
125390     END-IF                                           *>++DELETE
125400     MOVE ZERO TO W1AN-I-ANZ-TRA-X30-REG
125410                  W1AN-ANZ-TRA-X30-REG
125420     MOVE S551AX-E-VIN             TO B2X3AX-VIN
125430     EXEC SQL
125440       SELECT COUNT(TRANSPOND_ID)
125450       INTO :W1AN-ANZ-TRA-X30-REG
125460            :W1AN-I-ANZ-TRA-X30-REG
125470       FROM  FEV2X3
125480       WHERE VIN = :B2X3AX-VIN
125490       AND TEXT_TRANSPOND_STATUS IN ('8082', '8045')
125500     END-EXEC
125510     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
125520     DISPLAY "++EXEC SQL                                         "
125530     DISPLAY "++ SELECT COUNT(TRANSPOND_ID)                      "
125540     DISPLAY "++ INTO " W1AN-ANZ-TRA-X30-REG "                   "
125550     DISPLAY "++ " W1AN-I-ANZ-TRA-X30-REG "                      "
125560     DISPLAY "++ FROM FEV2X3                                     "
125570     DISPLAY "++ WHERE VIN = " B2X3AX-VIN "                      "
125580     DISPLAY "++ AND TEXT_TRANSPOND_STATUS IN ('8082', '8045')   "
125590     DISPLAY "++END-EXEC                                         "
125600     DISPLAY "++SQLCODE --> " SQLCODE
125610     END-IF                                           *>++DELETE
125620     MOVE SQLCA                    TO SQL-SQLCA
125630     EVALUATE SQLAX-SQLSTATE
125640       WHEN DB2-OK
125650         IF W1AN-I-ANZ-TRA-X30-REG = -1
125660           MOVE ZERO               TO W1AN-ANZ-TRA-X30-REG
125670         ELSE
125680           CONTINUE
125690         END-IF
125700       WHEN DB2-NOT-FOUND
125710         CONTINUE
125720       WHEN OTHER
125730         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
125740         MOVE 'T-100-FEV0X3-ANZ-TRA' TO W549AX-SECTION
125750         PERFORM Z80-DB2-FEHLER
125760     END-EVALUATE
125770     CONTINUE.
125780 T-100-FEV2X3-ANZ-TRA-REG-END.
125790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
125800       DISPLAY "++25889-->T-100-FEV2X3-ANZ-TRA-REG-END. "
125810     DISPLAY "++W549AX-V-ID-TRACE = "
125820        W549AX-V-ID-TRACE                             *>++DELETE
125830     DISPLAY "++W549AN-TRACE-LEVEL = "
125840        W549AN-TRACE-LEVEL                            *>++DELETE
125850     END-IF                                           *>++DELETE
125860     EXIT.
125870*-----------------------------------------------------------------
125880* OPEN CURSOR FÜR TABELLE FEV2VI
125890*-----------------------------------------------------------------
125900 T-100-FEV2VI-OPEN SECTION.
125910     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
125920       DISPLAY "++25889-->T-100-FEV2VI-OPEN SECTION.    "
125930     DISPLAY "++W549AX-V-ID-TRACE = "
125940        W549AX-V-ID-TRACE                             *>++DELETE
125950     DISPLAY "++W549AN-TRACE-LEVEL = "
125960        W549AN-TRACE-LEVEL                            *>++DELETE
125970     END-IF                                           *>++DELETE
125980
125990     EXEC SQL
126000       DECLARE FEV2VI_C CURSOR FOR
126010       SELECT  UTC_V_ID
126020             , VIN
126030             , KEY_TYP_ID
126040             , KEY_TYP_ID_ZAHL
126050             , DATEN_INHALT
126060       FROM  FEV2VI
126070       WHERE VIN          = :B2VIAX-VIN
126080         FOR FETCH ONLY
126090     END-EXEC
126100     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
126110     DISPLAY "++EXEC SQL                                         "
126120     DISPLAY "++ DECLARE FEV2VI_C CURSOR FOR                     "
126130     DISPLAY "++ SELECT UTC_V_ID                                 "
126140     DISPLAY "++ , VIN                                           "
126150     DISPLAY "++ , KEY_TYP_ID                                    "
126160     DISPLAY "++ , KEY_TYP_ID_ZAHL                               "
126170     DISPLAY "++ , DATEN_INHALT                                  "
126180     DISPLAY "++ FROM FEV2VI                                     "
126190     DISPLAY "++ WHERE VIN = " B2VIAX-VIN "                      "
126200     DISPLAY "++ FOR FETCH ONLY                                  "
126210     DISPLAY "++END-EXEC                                         "
126220     DISPLAY "++SQLCODE --> " SQLCODE
126230     END-IF                                           *>++DELETE
126240
126250     EXEC SQL
126260          OPEN FEV2VI_C
126270     END-EXEC
126280     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
126290     DISPLAY "++EXEC SQL                                         "
126300     DISPLAY "++ OPEN FEV2VI_C                                   "
126310     DISPLAY "++END-EXEC                                         "
126320     DISPLAY "++SQLCODE --> " SQLCODE
126330     END-IF                                           *>++DELETE
126340
126350     MOVE SQLCA TO SQL-SQLCA
126360     EVALUATE SQLAX-SQLSTATE
126370       WHEN DB2-OK CONTINUE
126380       WHEN OTHER
126390         MOVE PROBA-ID (1:8)      TO W549AX-PROGRAMM
126400         MOVE 'T-100-FEV2VI-OPEN' TO W549AX-SECTION
126410         PERFORM Z80-DB2-FEHLER
126420     END-EVALUATE
126430
126440     CONTINUE.
126450 T-100-FEV2VI-OPEN-END.
126460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
126470       DISPLAY "++25889-->T-100-FEV2VI-OPEN-END.        "
126480     DISPLAY "++W549AX-V-ID-TRACE = "
126490        W549AX-V-ID-TRACE                             *>++DELETE
126500     DISPLAY "++W549AN-TRACE-LEVEL = "
126510        W549AN-TRACE-LEVEL                            *>++DELETE
126520     END-IF                                           *>++DELETE
126530     EXIT.
126540/
126550*V11 IR Neue Section
126560*-----------------------------------------------------------------
126570* FETCH CURSOR FÜR TABELLE FEV2VI
126580*-----------------------------------------------------------------
126590 T-100-FEV2VI-FETCH SECTION.
126600     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
126610       DISPLAY "++25889-->T-100-FEV2VI-FETCH SECTION.   "
126620     DISPLAY "++W549AX-V-ID-TRACE = "
126630        W549AX-V-ID-TRACE                             *>++DELETE
126640     DISPLAY "++W549AN-TRACE-LEVEL = "
126650        W549AN-TRACE-LEVEL                            *>++DELETE
126660     END-IF                                           *>++DELETE
126670
126680     EXEC SQL
126690       FETCH FEV2VI_C
126700       INTO   :B2VIAX-UTC-V-ID
126710             ,:B2VIAX-VIN
126720             ,:B2VIAN-KEY-TYP-ID
126730             ,:B2VIAN-KEY-TYP-ID-ZAHL
126740             ,:B2VIAX-DATEN-INHALT    :B2VIAN-I-DATEN-INHALT
126750     END-EXEC
126760     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
126770     DISPLAY "++EXEC SQL                                         "
126780     DISPLAY "++ FETCH FEV2VI_C                                  "
126790     DISPLAY "++ INTO " B2VIAX-UTC-V-ID "                        "
126800     DISPLAY "++ ," B2VIAX-VIN "                                 "
126810     DISPLAY "++ ," B2VIAN-KEY-TYP-ID "                          "
126820     DISPLAY "++ ," B2VIAN-KEY-TYP-ID-ZAHL "                     "
126830     DISPLAY "++ ," B2VIAX-DATEN-INHALT " " B2VIAN-I-DATEN-INHALT
126840     DISPLAY "++END-EXEC                                         "
126850     DISPLAY "++SQLCODE --> " SQLCODE
126860     END-IF                                           *>++DELETE
126870
126880     MOVE SQLCA TO SQL-SQLCA
126890     EVALUATE SQLAX-SQLSTATE
126900       WHEN DB2-OK
126910         IF B2VIAN-I-DATEN-INHALT  < ZERO
126920           MOVE SPACE TO B2VIAX-DATEN-INHALT
126930         END-IF
126940       WHEN DB2-NOT-FOUND CONTINUE
126950       WHEN OTHER
126960         MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
126970         MOVE 'T-100-FEV2VI-FETCH ' TO W549AX-SECTION
126980         PERFORM Z80-DB2-FEHLER
126990     END-EVALUATE
127000
127010     CONTINUE.
127020 T-100-FEV2VI-FETCH-END.
127030     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127040       DISPLAY "++25889-->T-100-FEV2VI-FETCH-END.       "
127050     DISPLAY "++W549AX-V-ID-TRACE = "
127060        W549AX-V-ID-TRACE                             *>++DELETE
127070     DISPLAY "++W549AN-TRACE-LEVEL = "
127080        W549AN-TRACE-LEVEL                            *>++DELETE
127090     END-IF                                           *>++DELETE
127100     EXIT.
127110/
127120*V11 IR Neue Section
127130*-----------------------------------------------------------------
127140* CLOSE CURSOR FÜR TABELLE FEV2VI
127150*-----------------------------------------------------------------
127160 T-100-FEV2VI-CLOSE SECTION.
127170     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127180       DISPLAY "++25889-->T-100-FEV2VI-CLOSE SECTION.   "
127190     DISPLAY "++W549AX-V-ID-TRACE = "
127200        W549AX-V-ID-TRACE                             *>++DELETE
127210     DISPLAY "++W549AN-TRACE-LEVEL = "
127220        W549AN-TRACE-LEVEL                            *>++DELETE
127230     END-IF                                           *>++DELETE
127240
127250     EXEC SQL
127260          CLOSE FEV2VI_C
127270     END-EXEC
127280     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127290     DISPLAY "++EXEC SQL                                         "
127300     DISPLAY "++ CLOSE FEV2VI_C                                  "
127310     DISPLAY "++END-EXEC                                         "
127320     DISPLAY "++SQLCODE --> " SQLCODE
127330     END-IF                                           *>++DELETE
127340
127350     MOVE SQLCA TO SQL-SQLCA
127360     EVALUATE SQLAX-SQLSTATE
127370       WHEN DB2-OK CONTINUE
127380       WHEN OTHER
127390         MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
127400         MOVE 'T-100-FEV2VI-CLOSE ' TO W549AX-SECTION
127410         PERFORM Z80-DB2-FEHLER
127420     END-EVALUATE
127430
127440     CONTINUE.
127450 T-100-FEV2VI-CLOSE-END.
127460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127470       DISPLAY "++25889-->T-100-FEV2VI-CLOSE-END.       "
127480     DISPLAY "++W549AX-V-ID-TRACE = "
127490        W549AX-V-ID-TRACE                             *>++DELETE
127500     DISPLAY "++W549AN-TRACE-LEVEL = "
127510        W549AN-TRACE-LEVEL                            *>++DELETE
127520     END-IF                                           *>++DELETE
127530     EXIT.
127540/
127550*V11 IR Neue Section
127560*-----------------------------------------------------------------
127570* Insert FEVXVI - neuer Satz zur VIN und KEY-TYP-ID
127580*                 mit Werte aus Select und neuer KEY-TYP-ID-ZAHL
127590*                                      und akt. LOG-UTC-V-ID
127600*-----------------------------------------------------------------
127610 T-100-FEVXVI-INSERT   SECTION.
127620     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127630       DISPLAY "++25889-->T-100-FEVXVI-INSERT   SECTION."
127640     DISPLAY "++W549AX-V-ID-TRACE = "
127650        W549AX-V-ID-TRACE                             *>++DELETE
127660     DISPLAY "++W549AN-TRACE-LEVEL = "
127670        W549AN-TRACE-LEVEL                            *>++DELETE
127680     END-IF                                           *>++DELETE
127690
127700     EXEC SQL
127710       INSERT INTO FEVXVI
127720              ( UTC_V_ID
127730               ,VIN
127740               ,KEY_TYP_ID
127750               ,KEY_TYP_ID_ZAHL
127760               ,DATEN_INHALT
127770              )
127780       VALUES (
127790                :BXVIAX-UTC-V-ID
127800               ,:BXVIAX-VIN
127810               ,:BXVIAN-KEY-TYP-ID
127820               ,:BXVIAN-KEY-TYP-ID-ZAHL
127830               ,:BXVIAX-DATEN-INHALT
127840                        :BXVIAN-I-DATEN-INHALT
127850              )
127860     END-EXEC
127870     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
127880     DISPLAY "++EXEC SQL                                         "
127890     DISPLAY "++ INSERT INTO FEVXVI                              "
127900     DISPLAY "++ ( UTC_V_ID                                      "
127910     DISPLAY "++ ,VIN                                            "
127920     DISPLAY "++ ,KEY_TYP_ID                                     "
127930     DISPLAY "++ ,KEY_TYP_ID_ZAHL                                "
127940     DISPLAY "++ ,DATEN_INHALT                                   "
127950     DISPLAY "++ )                                               "
127960     DISPLAY "++ VALUES (                                        "
127970     DISPLAY "++ " BXVIAX-UTC-V-ID "                             "
127980     DISPLAY "++ ," BXVIAX-VIN "                                 "
127990     DISPLAY "++ ," BXVIAN-KEY-TYP-ID "                          "
128000     DISPLAY "++ ," BXVIAN-KEY-TYP-ID-ZAHL "                     "
128010     DISPLAY "++ ," BXVIAX-DATEN-INHALT "                        "
128020     DISPLAY "++ " BXVIAN-I-DATEN-INHALT "                       "
128030     DISPLAY "++ )                                               "
128040     DISPLAY "++END-EXEC                                         "
128050     DISPLAY "++SQLCODE --> " SQLCODE
128060     END-IF                                           *>++DELETE
128070
128080     MOVE SQLCA                    TO SQL-SQLCA
128090
128100     EVALUATE SQLAX-SQLSTATE
128110       WHEN DB2-OK
128120         CONTINUE
128130       WHEN OTHER
128140         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
128150         MOVE 'T-100-FEVXVI-INSERT'
128160                                   TO W549AX-SECTION
128170         PERFORM Z80-DB2-FEHLER
128180     END-EVALUATE
128190
128200     CONTINUE.
128210 T-100-FEVXVI-INSERT-END.
128220     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
128230       DISPLAY "++25889-->T-100-FEVXVI-INSERT-END.      "
128240     DISPLAY "++W549AX-V-ID-TRACE = "
128250        W549AX-V-ID-TRACE                             *>++DELETE
128260     DISPLAY "++W549AN-TRACE-LEVEL = "
128270        W549AN-TRACE-LEVEL                            *>++DELETE
128280     END-IF                                           *>++DELETE
128290     EXIT.
128300/
128310*V11 IR Neue Section
128320*-----------------------------------------------------------------
128330* Select mit FEV3V2
128340* Nur 1 Feld selektieren, benutzt wird nur der DB2-RC
128350*-----------------------------------------------------------------
128360 T-100-FEV3V2-SELECT SECTION.
128370     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
128380       DISPLAY "++25889-->T-100-FEV3V2-SELECT SECTION.  "
128390     DISPLAY "++W549AX-V-ID-TRACE = "
128400        W549AX-V-ID-TRACE                             *>++DELETE
128410     DISPLAY "++W549AN-TRACE-LEVEL = "
128420        W549AN-TRACE-LEVEL                            *>++DELETE
128430     END-IF                                           *>++DELETE
128440
128450      EXEC SQL
128460        SELECT KEY_TYP_ID
128470        INTO   :B3V2AN-KEY-TYP-ID
128480        FROM   FEV3V2
128490        WHERE  KEY_TYP_ID = :B3V2AN-KEY-TYP-ID
128500          AND  ROOT       = 1000
128510        WITH UR
128520      END-EXEC
128530     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
128540     DISPLAY "++ EXEC SQL                                        "
128550     DISPLAY "++ SELECT KEY_TYP_ID                               "
128560     DISPLAY "++ INTO " B3V2AN-KEY-TYP-ID "                      "
128570     DISPLAY "++ FROM FEV3V2                                     "
128580     DISPLAY "++ WHERE KEY_TYP_ID = " B3V2AN-KEY-TYP-ID "        "
128590     DISPLAY "++ AND ROOT = 1000                                 "
128600     DISPLAY "++ WITH UR                                         "
128610     DISPLAY "++ END-EXEC                                        "
128620     DISPLAY "++SQLCODE --> " SQLCODE
128630     END-IF                                           *>++DELETE
128640
128650      MOVE SQLCA                     TO SQL-SQLCA
128660
128670      EVALUATE SQLAX-SQLSTATE
128680        WHEN DB2-OK
128690        WHEN DB2-NOT-FOUND
128700          CONTINUE
128710        WHEN OTHER
128720          MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
128730          MOVE 'T-100-FEV3V2-SELECT' TO W549AX-SECTION
128740          PERFORM Z80-DB2-FEHLER
128750      END-EVALUATE
128760
128770     CONTINUE.
128780 T-100-FEV3V2-SELECT-END.
128790     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
128800       DISPLAY "++25889-->T-100-FEV3V2-SELECT-END.      "
128810     DISPLAY "++W549AX-V-ID-TRACE = "
128820        W549AX-V-ID-TRACE                             *>++DELETE
128830     DISPLAY "++W549AN-TRACE-LEVEL = "
128840        W549AN-TRACE-LEVEL                            *>++DELETE
128850     END-IF                                           *>++DELETE
128860     EXIT.
128870/
128880*V11 IR Neue Section
128890*-----------------------------------------------------------------
128900* OPEN CURSOR FÜR TABELLE FEV2VM
128910*-----------------------------------------------------------------
128920 T-100-FEV2VM-OPEN SECTION.
128930     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
128940       DISPLAY "++25889-->T-100-FEV2VM-OPEN SECTION.    "
128950     DISPLAY "++W549AX-V-ID-TRACE = "
128960        W549AX-V-ID-TRACE                             *>++DELETE
128970     DISPLAY "++W549AN-TRACE-LEVEL = "
128980        W549AN-TRACE-LEVEL                            *>++DELETE
128990     END-IF                                           *>++DELETE
129000
129010     EXEC SQL
129020       DECLARE FEV2VM_C CURSOR FOR
129030       SELECT  UTC_V_ID
129040             , VIN
129050             , BGRP
129060             , KEY_TYP_ID
129070             , KEY_TYP_ID_ZAHL
129080             , DATEN_INHALT
129090       FROM  FEV2VM
129100       WHERE VIN          = :B2VMAX-VIN
129110         FOR FETCH ONLY
129120     END-EXEC
129130     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
129140     DISPLAY "++EXEC SQL                                         "
129150     DISPLAY "++ DECLARE FEV2VM_C CURSOR FOR                     "
129160     DISPLAY "++ SELECT UTC_V_ID                                 "
129170     DISPLAY "++ , VIN                                           "
129180     DISPLAY "++ , BGRP                                          "
129190     DISPLAY "++ , KEY_TYP_ID                                    "
129200     DISPLAY "++ , KEY_TYP_ID_ZAHL                               "
129210     DISPLAY "++ , DATEN_INHALT                                  "
129220     DISPLAY "++ FROM FEV2VM                                     "
129230     DISPLAY "++ WHERE VIN = " B2VMAX-VIN "                      "
129240     DISPLAY "++ FOR FETCH ONLY                                  "
129250     DISPLAY "++END-EXEC                                         "
129260     DISPLAY "++SQLCODE --> " SQLCODE
129270     END-IF                                           *>++DELETE
129280
129290     EXEC SQL
129300          OPEN FEV2VM_C
129310     END-EXEC
129320     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
129330     DISPLAY "++EXEC SQL                                         "
129340     DISPLAY "++ OPEN FEV2VM_C                                   "
129350     DISPLAY "++END-EXEC                                         "
129360     DISPLAY "++SQLCODE --> " SQLCODE
129370     END-IF                                           *>++DELETE
129380
129390     MOVE SQLCA TO SQL-SQLCA
129400     EVALUATE SQLAX-SQLSTATE
129410       WHEN DB2-OK CONTINUE
129420       WHEN OTHER
129430          MOVE PROBA-ID (1:8)     TO W549AX-PROGRAMM
129440         MOVE 'T-100-FEV2VM-OPEN' TO W549AX-SECTION
129450         PERFORM Z80-DB2-FEHLER
129460     END-EVALUATE
129470
129480     CONTINUE.
129490 T-100-FEV2VM-OPEN-END.
129500     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
129510       DISPLAY "++25889-->T-100-FEV2VM-OPEN-END.        "
129520     DISPLAY "++W549AX-V-ID-TRACE = "
129530        W549AX-V-ID-TRACE                             *>++DELETE
129540     DISPLAY "++W549AN-TRACE-LEVEL = "
129550        W549AN-TRACE-LEVEL                            *>++DELETE
129560     END-IF                                           *>++DELETE
129570     EXIT.
129580
129590*V11 IR Neue Section
129600*-----------------------------------------------------------------
129610* FETCH CURSOR FÜR TABELLE FEV2VM
129620*-----------------------------------------------------------------
129630 T-100-FEV2VM-FETCH SECTION.
129640     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
129650       DISPLAY "++25889-->T-100-FEV2VM-FETCH SECTION.   "
129660     DISPLAY "++W549AX-V-ID-TRACE = "
129670        W549AX-V-ID-TRACE                             *>++DELETE
129680     DISPLAY "++W549AN-TRACE-LEVEL = "
129690        W549AN-TRACE-LEVEL                            *>++DELETE
129700     END-IF                                           *>++DELETE
129710
129720     EXEC SQL
129730       FETCH FEV2VM_C
129740       INTO   :B2VMAX-UTC-V-ID
129750             ,:B2VMAX-VIN
129760             ,:B2VMAX-BGRP
129770             ,:B2VMAN-KEY-TYP-ID
129780             ,:B2VMAN-KEY-TYP-ID-ZAHL
129790             ,:B2VMAX-DATEN-INHALT    :B2VMAN-I-DATEN-INHALT
129800     END-EXEC
129810     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
129820     DISPLAY "++EXEC SQL                                         "
129830     DISPLAY "++ FETCH FEV2VM_C                                  "
129840     DISPLAY "++ INTO " B2VMAX-UTC-V-ID "                        "
129850     DISPLAY "++ ," B2VMAX-VIN "                                 "
129860     DISPLAY "++ ," B2VMAX-BGRP "                                "
129870     DISPLAY "++ ," B2VMAN-KEY-TYP-ID "                          "
129880     DISPLAY "++ ," B2VMAN-KEY-TYP-ID-ZAHL "                     "
129890     DISPLAY "++ ," B2VMAX-DATEN-INHALT " " B2VMAN-I-DATEN-INHALT
129900     DISPLAY "++END-EXEC                                         "
129910     DISPLAY "++SQLCODE --> " SQLCODE
129920     END-IF                                           *>++DELETE
129930
129940     MOVE SQLCA TO SQL-SQLCA
129950     EVALUATE SQLAX-SQLSTATE
129960       WHEN DB2-OK
129970         IF B2VMAN-I-DATEN-INHALT  < ZERO
129980           MOVE SPACE TO B2VMAX-DATEN-INHALT
129990         END-IF
130000       WHEN DB2-NOT-FOUND CONTINUE
130010       WHEN OTHER
130020         MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
130030         MOVE 'T-100-FEV2VM-FETCH ' TO W549AX-SECTION
130040         PERFORM Z80-DB2-FEHLER
130050     END-EVALUATE
130060
130070     CONTINUE.
130080 T-100-FEV2VM-FETCH-END.
130090     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130100       DISPLAY "++25889-->T-100-FEV2VM-FETCH-END.       "
130110     DISPLAY "++W549AX-V-ID-TRACE = "
130120        W549AX-V-ID-TRACE                             *>++DELETE
130130     DISPLAY "++W549AN-TRACE-LEVEL = "
130140        W549AN-TRACE-LEVEL                            *>++DELETE
130150     END-IF                                           *>++DELETE
130160     EXIT.
130170
130180*V11 IR Neue Section
130190*-----------------------------------------------------------------
130200* CLOSE CURSOR FÜR TABELLE FEV2VM
130210*-----------------------------------------------------------------
130220 T-100-FEV2VM-CLOSE SECTION.
130230     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130240       DISPLAY "++25889-->T-100-FEV2VM-CLOSE SECTION.   "
130250     DISPLAY "++W549AX-V-ID-TRACE = "
130260        W549AX-V-ID-TRACE                             *>++DELETE
130270     DISPLAY "++W549AN-TRACE-LEVEL = "
130280        W549AN-TRACE-LEVEL                            *>++DELETE
130290     END-IF                                           *>++DELETE
130300
130310     EXEC SQL
130320          CLOSE FEV2VM_C
130330     END-EXEC
130340     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130350     DISPLAY "++EXEC SQL                                         "
130360     DISPLAY "++ CLOSE FEV2VM_C                                  "
130370     DISPLAY "++END-EXEC                                         "
130380     DISPLAY "++SQLCODE --> " SQLCODE
130390     END-IF                                           *>++DELETE
130400
130410     MOVE SQLCA TO SQL-SQLCA
130420     EVALUATE SQLAX-SQLSTATE
130430       WHEN DB2-OK CONTINUE
130440       WHEN OTHER
130450         MOVE PROBA-ID (1:8)        TO W549AX-PROGRAMM
130460         MOVE 'T-100-FEV2VM-CLOSE ' TO W549AX-SECTION
130470         PERFORM Z80-DB2-FEHLER
130480     END-EVALUATE
130490
130500     CONTINUE.
130510 T-100-FEV2VM-CLOSE-END.
130520     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130530       DISPLAY "++25889-->T-100-FEV2VM-CLOSE-END.       "
130540     DISPLAY "++W549AX-V-ID-TRACE = "
130550        W549AX-V-ID-TRACE                             *>++DELETE
130560     DISPLAY "++W549AN-TRACE-LEVEL = "
130570        W549AN-TRACE-LEVEL                            *>++DELETE
130580     END-IF                                           *>++DELETE
130590     EXIT.
130600/
130610*V11 IR Neue Section
130620*-----------------------------------------------------------------
130630* INSERT FEVXVM - NEUER SATZ ZUR VIN+BGRP+KEY-TYP-ID
130640*                 mit Werte aus Select und neuer KEY-TYP-ID-ZAHL
130650*                                      und akt. LOG-UTC-V-ID
130660*-----------------------------------------------------------------
130670 T-100-FEVXVM-INSERT   SECTION.
130680     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130690       DISPLAY "++25889-->T-100-FEVXVM-INSERT   SECTION."
130700     DISPLAY "++W549AX-V-ID-TRACE = "
130710        W549AX-V-ID-TRACE                             *>++DELETE
130720     DISPLAY "++W549AN-TRACE-LEVEL = "
130730        W549AN-TRACE-LEVEL                            *>++DELETE
130740     END-IF                                           *>++DELETE
130750
130760     EXEC SQL
130770       INSERT INTO FEVXVM
130780              ( UTC_V_ID
130790               ,VIN
130800               ,BGRP
130810               ,KEY_TYP_ID
130820               ,KEY_TYP_ID_ZAHL
130830               ,DATEN_INHALT
130840              )
130850       VALUES (
130860                :BXVMAX-UTC-V-ID
130870               ,:BXVMAX-VIN
130880               ,:BXVMAX-BGRP
130890               ,:BXVMAN-KEY-TYP-ID
130900               ,:BXVMAN-KEY-TYP-ID-ZAHL
130910               ,:BXVMAX-DATEN-INHALT
130920                        :BXVMAN-I-DATEN-INHALT
130930              )
130940     END-EXEC
130950     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
130960     DISPLAY "++EXEC SQL                                         "
130970     DISPLAY "++ INSERT INTO FEVXVM                              "
130980     DISPLAY "++ ( UTC_V_ID                                      "
130990     DISPLAY "++ ,VIN                                            "
131000     DISPLAY "++ ,BGRP                                           "
131010     DISPLAY "++ ,KEY_TYP_ID                                     "
131020     DISPLAY "++ ,KEY_TYP_ID_ZAHL                                "
131030     DISPLAY "++ ,DATEN_INHALT                                   "
131040     DISPLAY "++ )                                               "
131050     DISPLAY "++ VALUES (                                        "
131060     DISPLAY "++ " BXVMAX-UTC-V-ID "                             "
131070     DISPLAY "++ ," BXVMAX-VIN "                                 "
131080     DISPLAY "++ ," BXVMAX-BGRP "                                "
131090     DISPLAY "++ ," BXVMAN-KEY-TYP-ID "                          "
131100     DISPLAY "++ ," BXVMAN-KEY-TYP-ID-ZAHL "                     "
131110     DISPLAY "++ ," BXVMAX-DATEN-INHALT "                        "
131120     DISPLAY "++ " BXVMAN-I-DATEN-INHALT "                       "
131130     DISPLAY "++ )                                               "
131140     DISPLAY "++END-EXEC                                         "
131150     DISPLAY "++SQLCODE --> " SQLCODE
131160     END-IF                                           *>++DELETE
131170
131180     MOVE SQLCA                    TO SQL-SQLCA
131190
131200     EVALUATE SQLAX-SQLSTATE
131210       WHEN DB2-OK
131220         CONTINUE
131230       WHEN OTHER
131240         MOVE PROBA-ID (1:8)       TO W549AX-PROGRAMM
131250         MOVE 'T-100-FEVXVM-INSERT'
131260                                   TO W549AX-SECTION
131270         PERFORM Z80-DB2-FEHLER
131280     END-EVALUATE
131290
131300     CONTINUE.
131310 T-100-FEVXVM-INSERT-END.
131320     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
131330       DISPLAY "++25889-->T-100-FEVXVM-INSERT-END.      "
131340     DISPLAY "++W549AX-V-ID-TRACE = "
131350        W549AX-V-ID-TRACE                             *>++DELETE
131360     DISPLAY "++W549AN-TRACE-LEVEL = "
131370        W549AN-TRACE-LEVEL                            *>++DELETE
131380     END-IF                                           *>++DELETE
131390     EXIT.
131400/
131410*-----------------------------------------------------------------
131420* DB2-FEHLERAUSGANG
131430* mit Aufbereitung eines Fehlertelegramms
131440*-----------------------------------------------------------------
131450 Z80-DB2-FEHLER SECTION.
131460     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
131470       DISPLAY "++25889-->Z80-DB2-FEHLER SECTION.       "
131480     DISPLAY "++W549AX-V-ID-TRACE = "
131490        W549AX-V-ID-TRACE                             *>++DELETE
131500     DISPLAY "++W549AN-TRACE-LEVEL = "
131510        W549AN-TRACE-LEVEL                            *>++DELETE
131520     END-IF                                           *>++DELETE
131530
131540     MOVE K1AN-T1004               TO W549AN-TEXT-RC
131550     MOVE 1                        TO W549AN-FEHLER-PARM-LEN
131560     STRING PROBA-ID (1:8) ' '
131570            W549AX-SECTION
131580            ' Systemproblem in DB2 SQLSTATE=' SQLAX-SQLSTATE
131590            ' DB2-RESOURCE=' SQLERRMC
131600       DELIMITED BY SIZE         INTO W549AX-FEHLER-PARM-TEXT
131610       WITH POINTER                   W549AN-FEHLER-PARM-LEN
131620
131630     MOVE PROBA-ID (1:8)           TO W549AX-PROGRAMM
131640     MOVE SQLCA                    TO W549AX-INFO
131650     PERFORM Z90-PGM-EXIT
131660
131670
131680     CONTINUE.
131690 Z80-DB2-FEHLER-E.
131700     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
131710       DISPLAY "++25889-->Z80-DB2-FEHLER-E.             "
131720     DISPLAY "++W549AX-V-ID-TRACE = "
131730        W549AX-V-ID-TRACE                             *>++DELETE
131740     DISPLAY "++W549AN-TRACE-LEVEL = "
131750        W549AN-TRACE-LEVEL                            *>++DELETE
131760     END-IF                                           *>++DELETE
131770     EXIT.
131780
131790*-----------------------------------------------------------------
131800* PROGRAMMENDE
131810*-----------------------------------------------------------------
131820 Z90-PGM-EXIT SECTION.
131830     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
131840       DISPLAY "++25889-->Z90-PGM-EXIT SECTION.         "
131850     DISPLAY "++W549AX-V-ID-TRACE = "
131860        W549AX-V-ID-TRACE                             *>++DELETE
131870     DISPLAY "++W549AN-TRACE-LEVEL = "
131880        W549AN-TRACE-LEVEL                            *>++DELETE
131890     END-IF                                           *>++DELETE
131900
131910     MOVE '00;Z90-PGM-EXIT;Ende FE549'
131920                                   TO W1AX-TRALOG-TEXT
131930     PERFORM Q92-TRALOG-ZEILE
131940
131950     DISPLAY "++END-DEBUG  FE549C  25889 DD 251211 HH 140121".
131960     GOBACK
131970     DISPLAY "++END-DEBUG  FE549C  25889 DD 251211 HH 140121".
131980
131990     CONTINUE.
132000 Z90-PGM-EXIT-END.
132010     IF S551AX-E-VIN = 'TFE540B3HFDC25750'            *>++DELETE
132020       DISPLAY "++25889-->Z90-PGM-EXIT-END.             "
132030     DISPLAY "++W549AX-V-ID-TRACE = "
132040        W549AX-V-ID-TRACE                             *>++DELETE
132050     DISPLAY "++W549AN-TRACE-LEVEL = "
132060        W549AN-TRACE-LEVEL                            *>++DELETE
132070     END-IF                                           *>++DELETE
132080     EXIT.
